function Nd(_,b){const A=Object.create(null),D=_.split(",");for(let R=0;R<D.length;R++)A[D[R]]=!0;return b?R=>!!A[R.toLowerCase()]:R=>!!A[R]}const Cx="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",zx=Nd(Cx);function jm(_){return!!_||_===""}function jd(_){if(Ut(_)){const b={};for(let A=0;A<_.length;A++){const D=_[A],R=xr(D)?Dx(D):jd(D);if(R)for(const j in R)b[j]=R[j]}return b}else{if(xr(_))return _;if(zr(_))return _}}const Px=/;(?![^(]*\))/g,kx=/:(.+)/;function Dx(_){const b={};return _.split(Px).forEach(A=>{if(A){const D=A.split(kx);D.length>1&&(b[D[0].trim()]=D[1].trim())}}),b}function Gd(_){let b="";if(xr(_))b=_;else if(Ut(_))for(let A=0;A<_.length;A++){const D=Gd(_[A]);D&&(b+=D+" ")}else if(zr(_))for(const A in _)_[A]&&(b+=A+" ");return b.trim()}const vi={},sl=[],Ln=()=>{},Lx=()=>!1,Bx=/^on[^a-z]/,Xu=_=>Bx.test(_),$d=_=>_.startsWith("onUpdate:"),yr=Object.assign,Zd=(_,b)=>{const A=_.indexOf(b);A>-1&&_.splice(A,1)},Rx=Object.prototype.hasOwnProperty,ti=(_,b)=>Rx.call(_,b),Ut=Array.isArray,_c=_=>Hu(_)==="[object Map]",Fx=_=>Hu(_)==="[object Set]",qt=_=>typeof _=="function",xr=_=>typeof _=="string",qd=_=>typeof _=="symbol",zr=_=>_!==null&&typeof _=="object",Gm=_=>zr(_)&&qt(_.then)&&qt(_.catch),Ox=Object.prototype.toString,Hu=_=>Ox.call(_),Ux=_=>Hu(_).slice(8,-1),Vx=_=>Hu(_)==="[object Object]",Wd=_=>xr(_)&&_!=="NaN"&&_[0]!=="-"&&""+parseInt(_,10)===_,Ku=Nd(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Yu=_=>{const b=Object.create(null);return A=>b[A]||(b[A]=_(A))},Nx=/-(\w)/g,al=Yu(_=>_.replace(Nx,(b,A)=>A?A.toUpperCase():"")),jx=/\B([A-Z])/g,ll=Yu(_=>_.replace(jx,"-$1").toLowerCase()),$m=Yu(_=>_.charAt(0).toUpperCase()+_.slice(1)),Xd=Yu(_=>_?`on${$m(_)}`:""),Ju=(_,b)=>!Object.is(_,b),Hd=(_,b)=>{for(let A=0;A<_.length;A++)_[A](b)},Qu=(_,b,A)=>{Object.defineProperty(_,b,{configurable:!0,enumerable:!1,value:A})},Gx=_=>{const b=parseFloat(_);return isNaN(b)?_:b};let Zm;const $x=()=>Zm||(Zm=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});let Eo;class Zx{constructor(b=!1){this.active=!0,this.effects=[],this.cleanups=[],!b&&Eo&&(this.parent=Eo,this.index=(Eo.scopes||(Eo.scopes=[])).push(this)-1)}run(b){if(this.active)try{return Eo=this,b()}finally{Eo=this.parent}}on(){Eo=this}off(){Eo=this.parent}stop(b){if(this.active){let A,D;for(A=0,D=this.effects.length;A<D;A++)this.effects[A].stop();for(A=0,D=this.cleanups.length;A<D;A++)this.cleanups[A]();if(this.scopes)for(A=0,D=this.scopes.length;A<D;A++)this.scopes[A].stop(!0);if(this.parent&&!b){const R=this.parent.scopes.pop();R&&R!==this&&(this.parent.scopes[this.index]=R,R.index=this.index)}this.active=!1}}}function qx(_,b=Eo){b&&b.active&&b.effects.push(_)}const Kd=_=>{const b=new Set(_);return b.w=0,b.n=0,b},qm=_=>(_.w&ns)>0,Wm=_=>(_.n&ns)>0,Wx=({deps:_})=>{if(_.length)for(let b=0;b<_.length;b++)_[b].w|=ns},Xx=_=>{const{deps:b}=_;if(b.length){let A=0;for(let D=0;D<b.length;D++){const R=b[D];qm(R)&&!Wm(R)?R.delete(_):b[A++]=R,R.w&=~ns,R.n&=~ns}b.length=A}},Yd=new WeakMap;let gc=0,ns=1;const Jd=30;let ro;const Ks=Symbol(""),Qd=Symbol("");class ep{constructor(b,A=null,D){this.fn=b,this.scheduler=A,this.active=!0,this.deps=[],this.parent=void 0,qx(this,D)}run(){if(!this.active)return this.fn();let b=ro,A=os;for(;b;){if(b===this)return;b=b.parent}try{return this.parent=ro,ro=this,os=!0,ns=1<<++gc,gc<=Jd?Wx(this):Xm(this),this.fn()}finally{gc<=Jd&&Xx(this),ns=1<<--gc,ro=this.parent,os=A,this.parent=void 0}}stop(){this.active&&(Xm(this),this.onStop&&this.onStop(),this.active=!1)}}function Xm(_){const{deps:b}=_;if(b.length){for(let A=0;A<b.length;A++)b[A].delete(_);b.length=0}}let os=!0;const Hm=[];function cl(){Hm.push(os),os=!1}function ul(){const _=Hm.pop();os=_===void 0?!0:_}function tn(_,b,A){if(os&&ro){let D=Yd.get(_);D||Yd.set(_,D=new Map);let R=D.get(A);R||D.set(A,R=Kd()),Km(R)}}function Km(_,b){let A=!1;gc<=Jd?Wm(_)||(_.n|=ns,A=!qm(_)):A=!_.has(ro),A&&(_.add(ro),ro.deps.push(_))}function So(_,b,A,D,R,j){const oe=Yd.get(_);if(!oe)return;let s=[];if(b==="clear")s=[...oe.values()];else if(A==="length"&&Ut(_))oe.forEach((pe,Ie)=>{(Ie==="length"||Ie>=D)&&s.push(pe)});else switch(A!==void 0&&s.push(oe.get(A)),b){case"add":Ut(_)?Wd(A)&&s.push(oe.get("length")):(s.push(oe.get(Ks)),_c(_)&&s.push(oe.get(Qd)));break;case"delete":Ut(_)||(s.push(oe.get(Ks)),_c(_)&&s.push(oe.get(Qd)));break;case"set":_c(_)&&s.push(oe.get(Ks));break}if(s.length===1)s[0]&&tp(s[0]);else{const pe=[];for(const Ie of s)Ie&&pe.push(...Ie);tp(Kd(pe))}}function tp(_,b){for(const A of Ut(_)?_:[..._])(A!==ro||A.allowRecurse)&&(A.scheduler?A.scheduler():A.run())}const Hx=Nd("__proto__,__v_isRef,__isVue"),Ym=new Set(Object.getOwnPropertyNames(Symbol).map(_=>Symbol[_]).filter(qd)),Kx=ip(),Yx=ip(!1,!0),Jx=ip(!0),Jm=Qx();function Qx(){const _={};return["includes","indexOf","lastIndexOf"].forEach(b=>{_[b]=function(...A){const D=ui(this);for(let j=0,oe=this.length;j<oe;j++)tn(D,"get",j+"");const R=D[b](...A);return R===-1||R===!1?D[b](...A.map(ui)):R}}),["push","pop","shift","unshift","splice"].forEach(b=>{_[b]=function(...A){cl();const D=ui(this)[b].apply(this,A);return ul(),D}}),_}function ip(_=!1,b=!1){return function(D,R,j){if(R==="__v_isReactive")return!_;if(R==="__v_isReadonly")return _;if(R==="__v_isShallow")return b;if(R==="__v_raw"&&j===(_?b?m0:a_:b?s_:o_).get(D))return D;const oe=Ut(D);if(!_&&oe&&ti(Jm,R))return Reflect.get(Jm,R,j);const s=Reflect.get(D,R,j);return(qd(R)?Ym.has(R):Hx(R))||(_||tn(D,"get",R),b)?s:vr(s)?!oe||!Wd(R)?s.value:s:zr(s)?_?l_(s):op(s):s}}const e0=Qm(),t0=Qm(!0);function Qm(_=!1){return function(A,D,R,j){let oe=A[D];if(yc(oe)&&vr(oe)&&!vr(R))return!1;if(!_&&!yc(R)&&(c_(R)||(R=ui(R),oe=ui(oe)),!Ut(A)&&vr(oe)&&!vr(R)))return oe.value=R,!0;const s=Ut(A)&&Wd(D)?Number(D)<A.length:ti(A,D),pe=Reflect.set(A,D,R,j);return A===ui(j)&&(s?Ju(R,oe)&&So(A,"set",D,R):So(A,"add",D,R)),pe}}function i0(_,b){const A=ti(_,b);_[b];const D=Reflect.deleteProperty(_,b);return D&&A&&So(_,"delete",b,void 0),D}function r0(_,b){const A=Reflect.has(_,b);return(!qd(b)||!Ym.has(b))&&tn(_,"has",b),A}function n0(_){return tn(_,"iterate",Ut(_)?"length":Ks),Reflect.ownKeys(_)}const e_={get:Kx,set:e0,deleteProperty:i0,has:r0,ownKeys:n0},o0={get:Jx,set(_,b){return!0},deleteProperty(_,b){return!0}},s0=yr({},e_,{get:Yx,set:t0}),rp=_=>_,eh=_=>Reflect.getPrototypeOf(_);function th(_,b,A=!1,D=!1){_=_.__v_raw;const R=ui(_),j=ui(b);b!==j&&!A&&tn(R,"get",b),!A&&tn(R,"get",j);const{has:oe}=eh(R),s=D?rp:A?lp:ap;if(oe.call(R,b))return s(_.get(b));if(oe.call(R,j))return s(_.get(j));_!==R&&_.get(b)}function ih(_,b=!1){const A=this.__v_raw,D=ui(A),R=ui(_);return _!==R&&!b&&tn(D,"has",_),!b&&tn(D,"has",R),_===R?A.has(_):A.has(_)||A.has(R)}function rh(_,b=!1){return _=_.__v_raw,!b&&tn(ui(_),"iterate",Ks),Reflect.get(_,"size",_)}function t_(_){_=ui(_);const b=ui(this);return eh(b).has.call(b,_)||(b.add(_),So(b,"add",_,_)),this}function i_(_,b){b=ui(b);const A=ui(this),{has:D,get:R}=eh(A);let j=D.call(A,_);j||(_=ui(_),j=D.call(A,_));const oe=R.call(A,_);return A.set(_,b),j?Ju(b,oe)&&So(A,"set",_,b):So(A,"add",_,b),this}function r_(_){const b=ui(this),{has:A,get:D}=eh(b);let R=A.call(b,_);R||(_=ui(_),R=A.call(b,_)),D&&D.call(b,_);const j=b.delete(_);return R&&So(b,"delete",_,void 0),j}function n_(){const _=ui(this),b=_.size!==0,A=_.clear();return b&&So(_,"clear",void 0,void 0),A}function nh(_,b){return function(D,R){const j=this,oe=j.__v_raw,s=ui(oe),pe=b?rp:_?lp:ap;return!_&&tn(s,"iterate",Ks),oe.forEach((Ie,Ue)=>D.call(R,pe(Ie),pe(Ue),j))}}function oh(_,b,A){return function(...D){const R=this.__v_raw,j=ui(R),oe=_c(j),s=_==="entries"||_===Symbol.iterator&&oe,pe=_==="keys"&&oe,Ie=R[_](...D),Ue=A?rp:b?lp:ap;return!b&&tn(j,"iterate",pe?Qd:Ks),{next(){const{value:_e,done:Le}=Ie.next();return Le?{value:_e,done:Le}:{value:s?[Ue(_e[0]),Ue(_e[1])]:Ue(_e),done:Le}},[Symbol.iterator](){return this}}}}function ss(_){return function(...b){return _==="delete"?!1:this}}function a0(){const _={get(j){return th(this,j)},get size(){return rh(this)},has:ih,add:t_,set:i_,delete:r_,clear:n_,forEach:nh(!1,!1)},b={get(j){return th(this,j,!1,!0)},get size(){return rh(this)},has:ih,add:t_,set:i_,delete:r_,clear:n_,forEach:nh(!1,!0)},A={get(j){return th(this,j,!0)},get size(){return rh(this,!0)},has(j){return ih.call(this,j,!0)},add:ss("add"),set:ss("set"),delete:ss("delete"),clear:ss("clear"),forEach:nh(!0,!1)},D={get(j){return th(this,j,!0,!0)},get size(){return rh(this,!0)},has(j){return ih.call(this,j,!0)},add:ss("add"),set:ss("set"),delete:ss("delete"),clear:ss("clear"),forEach:nh(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(j=>{_[j]=oh(j,!1,!1),A[j]=oh(j,!0,!1),b[j]=oh(j,!1,!0),D[j]=oh(j,!0,!0)}),[_,A,b,D]}const[l0,c0,u0,h0]=a0();function np(_,b){const A=b?_?h0:u0:_?c0:l0;return(D,R,j)=>R==="__v_isReactive"?!_:R==="__v_isReadonly"?_:R==="__v_raw"?D:Reflect.get(ti(A,R)&&R in D?A:D,R,j)}const d0={get:np(!1,!1)},p0={get:np(!1,!0)},f0={get:np(!0,!1)},o_=new WeakMap,s_=new WeakMap,a_=new WeakMap,m0=new WeakMap;function _0(_){switch(_){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function g0(_){return _.__v_skip||!Object.isExtensible(_)?0:_0(Ux(_))}function op(_){return yc(_)?_:sp(_,!1,e_,d0,o_)}function y0(_){return sp(_,!1,s0,p0,s_)}function l_(_){return sp(_,!0,o0,f0,a_)}function sp(_,b,A,D,R){if(!zr(_)||_.__v_raw&&!(b&&_.__v_isReactive))return _;const j=R.get(_);if(j)return j;const oe=g0(_);if(oe===0)return _;const s=new Proxy(_,oe===2?D:A);return R.set(_,s),s}function hl(_){return yc(_)?hl(_.__v_raw):!!(_&&_.__v_isReactive)}function yc(_){return!!(_&&_.__v_isReadonly)}function c_(_){return!!(_&&_.__v_isShallow)}function u_(_){return hl(_)||yc(_)}function ui(_){const b=_&&_.__v_raw;return b?ui(b):_}function h_(_){return Qu(_,"__v_skip",!0),_}const ap=_=>zr(_)?op(_):_,lp=_=>zr(_)?l_(_):_;function x0(_){os&&ro&&(_=ui(_),Km(_.dep||(_.dep=Kd())))}function v0(_,b){_=ui(_),_.dep&&tp(_.dep)}function vr(_){return!!(_&&_.__v_isRef===!0)}function b0(_){return vr(_)?_.value:_}const w0={get:(_,b,A)=>b0(Reflect.get(_,b,A)),set:(_,b,A,D)=>{const R=_[b];return vr(R)&&!vr(A)?(R.value=A,!0):Reflect.set(_,b,A,D)}};function d_(_){return hl(_)?_:new Proxy(_,w0)}class T0{constructor(b,A,D,R){this._setter=A,this.dep=void 0,this.__v_isRef=!0,this._dirty=!0,this.effect=new ep(b,()=>{this._dirty||(this._dirty=!0,v0(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!R,this.__v_isReadonly=D}get value(){const b=ui(this);return x0(b),(b._dirty||!b._cacheable)&&(b._dirty=!1,b._value=b.effect.run()),b._value}set value(b){this._setter(b)}}function E0(_,b,A=!1){let D,R;const j=qt(_);return j?(D=_,R=Ln):(D=_.get,R=_.set),new T0(D,R,j||!R,A)}Promise.resolve();function as(_,b,A,D){let R;try{R=D?_(...D):_()}catch(j){sh(j,b,A)}return R}function yn(_,b,A,D){if(qt(_)){const j=as(_,b,A,D);return j&&Gm(j)&&j.catch(oe=>{sh(oe,b,A)}),j}const R=[];for(let j=0;j<_.length;j++)R.push(yn(_[j],b,A,D));return R}function sh(_,b,A,D=!0){const R=b?b.vnode:null;if(b){let j=b.parent;const oe=b.proxy,s=A;for(;j;){const Ie=j.ec;if(Ie){for(let Ue=0;Ue<Ie.length;Ue++)if(Ie[Ue](_,oe,s)===!1)return}j=j.parent}const pe=b.appContext.config.errorHandler;if(pe){as(pe,null,10,[_,oe,s]);return}}S0(_,A,R,D)}function S0(_,b,A,D=!0){console.error(_)}let ah=!1,cp=!1;const rn=[];let Io=0;const xc=[];let vc=null,dl=0;const bc=[];let ls=null,pl=0;const p_=Promise.resolve();let up=null,hp=null;function I0(_){const b=up||p_;return _?b.then(this?_.bind(this):_):b}function M0(_){let b=Io+1,A=rn.length;for(;b<A;){const D=b+A>>>1;wc(rn[D])<_?b=D+1:A=D}return b}function f_(_){(!rn.length||!rn.includes(_,ah&&_.allowRecurse?Io+1:Io))&&_!==hp&&(_.id==null?rn.push(_):rn.splice(M0(_.id),0,_),m_())}function m_(){!ah&&!cp&&(cp=!0,up=p_.then(y_))}function A0(_){const b=rn.indexOf(_);b>Io&&rn.splice(b,1)}function __(_,b,A,D){Ut(_)?A.push(..._):(!b||!b.includes(_,_.allowRecurse?D+1:D))&&A.push(_),m_()}function C0(_){__(_,vc,xc,dl)}function z0(_){__(_,ls,bc,pl)}function dp(_,b=null){if(xc.length){for(hp=b,vc=[...new Set(xc)],xc.length=0,dl=0;dl<vc.length;dl++)vc[dl]();vc=null,dl=0,hp=null,dp(_,b)}}function g_(_){if(bc.length){const b=[...new Set(bc)];if(bc.length=0,ls){ls.push(...b);return}for(ls=b,ls.sort((A,D)=>wc(A)-wc(D)),pl=0;pl<ls.length;pl++)ls[pl]();ls=null,pl=0}}const wc=_=>_.id==null?1/0:_.id;function y_(_){cp=!1,ah=!0,dp(_),rn.sort((A,D)=>wc(A)-wc(D));const b=Ln;try{for(Io=0;Io<rn.length;Io++){const A=rn[Io];A&&A.active!==!1&&as(A,null,14)}}finally{Io=0,rn.length=0,g_(),ah=!1,up=null,(rn.length||xc.length||bc.length)&&y_(_)}}function P0(_,b,...A){const D=_.vnode.props||vi;let R=A;const j=b.startsWith("update:"),oe=j&&b.slice(7);if(oe&&oe in D){const Ue=`${oe==="modelValue"?"model":oe}Modifiers`,{number:_e,trim:Le}=D[Ue]||vi;Le?R=A.map(fe=>fe.trim()):_e&&(R=A.map(Gx))}let s,pe=D[s=Xd(b)]||D[s=Xd(al(b))];!pe&&j&&(pe=D[s=Xd(ll(b))]),pe&&yn(pe,_,6,R);const Ie=D[s+"Once"];if(Ie){if(!_.emitted)_.emitted={};else if(_.emitted[s])return;_.emitted[s]=!0,yn(Ie,_,6,R)}}function x_(_,b,A=!1){const D=b.emitsCache,R=D.get(_);if(R!==void 0)return R;const j=_.emits;let oe={},s=!1;if(!qt(_)){const pe=Ie=>{const Ue=x_(Ie,b,!0);Ue&&(s=!0,yr(oe,Ue))};!A&&b.mixins.length&&b.mixins.forEach(pe),_.extends&&pe(_.extends),_.mixins&&_.mixins.forEach(pe)}return!j&&!s?(D.set(_,null),null):(Ut(j)?j.forEach(pe=>oe[pe]=null):yr(oe,j),D.set(_,oe),oe)}function pp(_,b){return!_||!Xu(b)?!1:(b=b.slice(2).replace(/Once$/,""),ti(_,b[0].toLowerCase()+b.slice(1))||ti(_,ll(b))||ti(_,b))}let no=null,v_=null;function lh(_){const b=no;return no=_,v_=_&&_.type.__scopeId||null,b}function k0(_,b=no,A){if(!b||_._n)return _;const D=(...R)=>{D._d&&W_(-1);const j=lh(b),oe=_(...R);return lh(j),D._d&&W_(1),oe};return D._n=!0,D._c=!0,D._d=!0,D}function fp(_){const{type:b,vnode:A,proxy:D,withProxy:R,props:j,propsOptions:[oe],slots:s,attrs:pe,emit:Ie,render:Ue,renderCache:_e,data:Le,setupState:fe,ctx:wt,inheritAttrs:dt}=_;let xt,yt;const Ui=lh(_);try{if(A.shapeFlag&4){const Wt=R||D;xt=so(Ue.call(Wt,Wt,_e,j,fe,Le,wt)),yt=pe}else{const Wt=b;xt=so(Wt.length>1?Wt(j,{attrs:pe,slots:s,emit:Ie}):Wt(j,null)),yt=b.props?pe:D0(pe)}}catch(Wt){Tc.length=0,sh(Wt,_,1),xt=us(cs)}let ai=xt;if(yt&&dt!==!1){const Wt=Object.keys(yt),{shapeFlag:Di}=ai;Wt.length&&Di&(1|6)&&(oe&&Wt.some($d)&&(yt=L0(yt,oe)),ai=ml(ai,yt))}return A.dirs&&(ai.dirs=ai.dirs?ai.dirs.concat(A.dirs):A.dirs),A.transition&&(ai.transition=A.transition),xt=ai,lh(Ui),xt}const D0=_=>{let b;for(const A in _)(A==="class"||A==="style"||Xu(A))&&((b||(b={}))[A]=_[A]);return b},L0=(_,b)=>{const A={};for(const D in _)(!$d(D)||!(D.slice(9)in b))&&(A[D]=_[D]);return A};function B0(_,b,A){const{props:D,children:R,component:j}=_,{props:oe,children:s,patchFlag:pe}=b,Ie=j.emitsOptions;if(b.dirs||b.transition)return!0;if(A&&pe>=0){if(pe&1024)return!0;if(pe&16)return D?b_(D,oe,Ie):!!oe;if(pe&8){const Ue=b.dynamicProps;for(let _e=0;_e<Ue.length;_e++){const Le=Ue[_e];if(oe[Le]!==D[Le]&&!pp(Ie,Le))return!0}}}else return(R||s)&&(!s||!s.$stable)?!0:D===oe?!1:D?oe?b_(D,oe,Ie):!0:!!oe;return!1}function b_(_,b,A){const D=Object.keys(b);if(D.length!==Object.keys(_).length)return!0;for(let R=0;R<D.length;R++){const j=D[R];if(b[j]!==_[j]&&!pp(A,j))return!0}return!1}function R0({vnode:_,parent:b},A){for(;b&&b.subTree===_;)(_=b.vnode).el=A,b=b.parent}const F0=_=>_.__isSuspense;function O0(_,b){b&&b.pendingBranch?Ut(_)?b.effects.push(..._):b.effects.push(_):z0(_)}function U0(_,b){if(hr){let A=hr.provides;const D=hr.parent&&hr.parent.provides;D===A&&(A=hr.provides=Object.create(D)),A[_]=b}}function mp(_,b,A=!1){const D=hr||no;if(D){const R=D.parent==null?D.vnode.appContext&&D.vnode.appContext.provides:D.parent.provides;if(R&&_ in R)return R[_];if(arguments.length>1)return A&&qt(b)?b.call(D.proxy):b}}const w_={};function _p(_,b,A){return T_(_,b,A)}function T_(_,b,{immediate:A,deep:D,flush:R,onTrack:j,onTrigger:oe}=vi){const s=hr;let pe,Ie=!1,Ue=!1;if(vr(_)?(pe=()=>_.value,Ie=c_(_)):hl(_)?(pe=()=>_,D=!0):Ut(_)?(Ue=!0,Ie=_.some(hl),pe=()=>_.map(yt=>{if(vr(yt))return yt.value;if(hl(yt))return fl(yt);if(qt(yt))return as(yt,s,2)})):qt(_)?b?pe=()=>as(_,s,2):pe=()=>{if(!(s&&s.isUnmounted))return _e&&_e(),yn(_,s,3,[Le])}:pe=Ln,b&&D){const yt=pe;pe=()=>fl(yt())}let _e,Le=yt=>{_e=xt.onStop=()=>{as(yt,s,4)}};if(Ec)return Le=Ln,b?A&&yn(b,s,3,[pe(),Ue?[]:void 0,Le]):pe(),Ln;let fe=Ue?[]:w_;const wt=()=>{if(!!xt.active)if(b){const yt=xt.run();(D||Ie||(Ue?yt.some((Ui,ai)=>Ju(Ui,fe[ai])):Ju(yt,fe)))&&(_e&&_e(),yn(b,s,3,[yt,fe===w_?void 0:fe,Le]),fe=yt)}else xt.run()};wt.allowRecurse=!!b;let dt;R==="sync"?dt=wt:R==="post"?dt=()=>jr(wt,s&&s.suspense):dt=()=>{!s||s.isMounted?C0(wt):wt()};const xt=new ep(pe,dt);return b?A?wt():fe=xt.run():R==="post"?jr(xt.run.bind(xt),s&&s.suspense):xt.run(),()=>{xt.stop(),s&&s.scope&&Zd(s.scope.effects,xt)}}function V0(_,b,A){const D=this.proxy,R=xr(_)?_.includes(".")?E_(D,_):()=>D[_]:_.bind(D,D);let j;qt(b)?j=b:(j=b.handler,A=b);const oe=hr;_l(this);const s=T_(R,j.bind(D),A);return oe?_l(oe):ia(),s}function E_(_,b){const A=b.split(".");return()=>{let D=_;for(let R=0;R<A.length&&D;R++)D=D[A[R]];return D}}function fl(_,b){if(!zr(_)||_.__v_skip||(b=b||new Set,b.has(_)))return _;if(b.add(_),vr(_))fl(_.value,b);else if(Ut(_))for(let A=0;A<_.length;A++)fl(_[A],b);else if(Fx(_)||_c(_))_.forEach(A=>{fl(A,b)});else if(Vx(_))for(const A in _)fl(_[A],b);return _}function N0(){const _={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return C_(()=>{_.isMounted=!0}),z_(()=>{_.isUnmounting=!0}),_}const xn=[Function,Array],j0={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:xn,onEnter:xn,onAfterEnter:xn,onEnterCancelled:xn,onBeforeLeave:xn,onLeave:xn,onAfterLeave:xn,onLeaveCancelled:xn,onBeforeAppear:xn,onAppear:xn,onAfterAppear:xn,onAppearCancelled:xn},setup(_,{slots:b}){const A=Mv(),D=N0();let R;return()=>{const j=b.default&&M_(b.default(),!0);if(!j||!j.length)return;const oe=ui(_),{mode:s}=oe,pe=j[0];if(D.isLeaving)return yp(pe);const Ie=I_(pe);if(!Ie)return yp(pe);const Ue=gp(Ie,oe,D,A);xp(Ie,Ue);const _e=A.subTree,Le=_e&&I_(_e);let fe=!1;const{getTransitionKey:wt}=Ie.type;if(wt){const dt=wt();R===void 0?R=dt:dt!==R&&(R=dt,fe=!0)}if(Le&&Le.type!==cs&&(!ta(Ie,Le)||fe)){const dt=gp(Le,oe,D,A);if(xp(Le,dt),s==="out-in")return D.isLeaving=!0,dt.afterLeave=()=>{D.isLeaving=!1,A.update()},yp(pe);s==="in-out"&&Ie.type!==cs&&(dt.delayLeave=(xt,yt,Ui)=>{const ai=S_(D,Le);ai[String(Le.key)]=Le,xt._leaveCb=()=>{yt(),xt._leaveCb=void 0,delete Ue.delayedLeave},Ue.delayedLeave=Ui})}return pe}}},G0=j0;function S_(_,b){const{leavingVNodes:A}=_;let D=A.get(b.type);return D||(D=Object.create(null),A.set(b.type,D)),D}function gp(_,b,A,D){const{appear:R,mode:j,persisted:oe=!1,onBeforeEnter:s,onEnter:pe,onAfterEnter:Ie,onEnterCancelled:Ue,onBeforeLeave:_e,onLeave:Le,onAfterLeave:fe,onLeaveCancelled:wt,onBeforeAppear:dt,onAppear:xt,onAfterAppear:yt,onAppearCancelled:Ui}=b,ai=String(_.key),Wt=S_(A,_),Di=(Vt,bi)=>{Vt&&yn(Vt,D,9,bi)},Vi={mode:j,persisted:oe,beforeEnter(Vt){let bi=s;if(!A.isMounted)if(R)bi=dt||s;else return;Vt._leaveCb&&Vt._leaveCb(!0);const li=Wt[ai];li&&ta(_,li)&&li.el._leaveCb&&li.el._leaveCb(),Di(bi,[Vt])},enter(Vt){let bi=pe,li=Ie,tr=Ue;if(!A.isMounted)if(R)bi=xt||pe,li=yt||Ie,tr=Ui||Ue;else return;let wi=!1;const Ki=Vt._enterCb=br=>{wi||(wi=!0,br?Di(tr,[Vt]):Di(li,[Vt]),Vi.delayedLeave&&Vi.delayedLeave(),Vt._enterCb=void 0)};bi?(bi(Vt,Ki),bi.length<=1&&Ki()):Ki()},leave(Vt,bi){const li=String(_.key);if(Vt._enterCb&&Vt._enterCb(!0),A.isUnmounting)return bi();Di(_e,[Vt]);let tr=!1;const wi=Vt._leaveCb=Ki=>{tr||(tr=!0,bi(),Ki?Di(wt,[Vt]):Di(fe,[Vt]),Vt._leaveCb=void 0,Wt[li]===_&&delete Wt[li])};Wt[li]=_,Le?(Le(Vt,wi),Le.length<=1&&wi()):wi()},clone(Vt){return gp(Vt,b,A,D)}};return Vi}function yp(_){if(ch(_))return _=ml(_),_.children=null,_}function I_(_){return ch(_)?_.children?_.children[0]:void 0:_}function xp(_,b){_.shapeFlag&6&&_.component?xp(_.component.subTree,b):_.shapeFlag&128?(_.ssContent.transition=b.clone(_.ssContent),_.ssFallback.transition=b.clone(_.ssFallback)):_.transition=b}function M_(_,b=!1){let A=[],D=0;for(let R=0;R<_.length;R++){const j=_[R];j.type===oo?(j.patchFlag&128&&D++,A=A.concat(M_(j.children,b))):(b||j.type!==cs)&&A.push(j)}if(D>1)for(let R=0;R<A.length;R++)A[R].patchFlag=-2;return A}const vp=_=>!!_.type.__asyncLoader,ch=_=>_.type.__isKeepAlive;function $0(_,b){A_(_,"a",b)}function Z0(_,b){A_(_,"da",b)}function A_(_,b,A=hr){const D=_.__wdc||(_.__wdc=()=>{let R=A;for(;R;){if(R.isDeactivated)return;R=R.parent}return _()});if(uh(b,D,A),A){let R=A.parent;for(;R&&R.parent;)ch(R.parent.vnode)&&q0(D,b,A,R),R=R.parent}}function q0(_,b,A,D){const R=uh(b,_,D,!0);P_(()=>{Zd(D[b],R)},A)}function uh(_,b,A=hr,D=!1){if(A){const R=A[_]||(A[_]=[]),j=b.__weh||(b.__weh=(...oe)=>{if(A.isUnmounted)return;cl(),_l(A);const s=yn(b,A,_,oe);return ia(),ul(),s});return D?R.unshift(j):R.push(j),j}}const Mo=_=>(b,A=hr)=>(!Ec||_==="sp")&&uh(_,b,A),W0=Mo("bm"),C_=Mo("m"),X0=Mo("bu"),H0=Mo("u"),z_=Mo("bum"),P_=Mo("um"),K0=Mo("sp"),Y0=Mo("rtg"),J0=Mo("rtc");function Q0(_,b=hr){uh("ec",_,b)}let bp=!0;function ev(_){const b=L_(_),A=_.proxy,D=_.ctx;bp=!1,b.beforeCreate&&k_(b.beforeCreate,_,"bc");const{data:R,computed:j,methods:oe,watch:s,provide:pe,inject:Ie,created:Ue,beforeMount:_e,mounted:Le,beforeUpdate:fe,updated:wt,activated:dt,deactivated:xt,beforeDestroy:yt,beforeUnmount:Ui,destroyed:ai,unmounted:Wt,render:Di,renderTracked:Vi,renderTriggered:Vt,errorCaptured:bi,serverPrefetch:li,expose:tr,inheritAttrs:wi,components:Ki,directives:br,filters:vn}=b;if(Ie&&tv(Ie,D,null,_.appContext.config.unwrapInjectedRef),oe)for(const Nt in oe){const Ht=oe[Nt];qt(Ht)&&(D[Nt]=Ht.bind(A))}if(R){const Nt=R.call(A,A);zr(Nt)&&(_.data=op(Nt))}if(bp=!0,j)for(const Nt in j){const Ht=j[Nt],Li=qt(Ht)?Ht.bind(A,A):qt(Ht.get)?Ht.get.bind(A,A):Ln,nn=!qt(Ht)&&qt(Ht.set)?Ht.set.bind(A):Ln,vt=Dv({get:Li,set:nn});Object.defineProperty(D,Nt,{enumerable:!0,configurable:!0,get:()=>vt.value,set:Gr=>vt.value=Gr})}if(s)for(const Nt in s)D_(s[Nt],D,A,Nt);if(pe){const Nt=qt(pe)?pe.call(A):pe;Reflect.ownKeys(Nt).forEach(Ht=>{U0(Ht,Nt[Ht])})}Ue&&k_(Ue,_,"c");function mi(Nt,Ht){Ut(Ht)?Ht.forEach(Li=>Nt(Li.bind(A))):Ht&&Nt(Ht.bind(A))}if(mi(W0,_e),mi(C_,Le),mi(X0,fe),mi(H0,wt),mi($0,dt),mi(Z0,xt),mi(Q0,bi),mi(J0,Vi),mi(Y0,Vt),mi(z_,Ui),mi(P_,Wt),mi(K0,li),Ut(tr))if(tr.length){const Nt=_.exposed||(_.exposed={});tr.forEach(Ht=>{Object.defineProperty(Nt,Ht,{get:()=>A[Ht],set:Li=>A[Ht]=Li})})}else _.exposed||(_.exposed={});Di&&_.render===Ln&&(_.render=Di),wi!=null&&(_.inheritAttrs=wi),Ki&&(_.components=Ki),br&&(_.directives=br)}function tv(_,b,A=Ln,D=!1){Ut(_)&&(_=wp(_));for(const R in _){const j=_[R];let oe;zr(j)?"default"in j?oe=mp(j.from||R,j.default,!0):oe=mp(j.from||R):oe=mp(j),vr(oe)&&D?Object.defineProperty(b,R,{enumerable:!0,configurable:!0,get:()=>oe.value,set:s=>oe.value=s}):b[R]=oe}}function k_(_,b,A){yn(Ut(_)?_.map(D=>D.bind(b.proxy)):_.bind(b.proxy),b,A)}function D_(_,b,A,D){const R=D.includes(".")?E_(A,D):()=>A[D];if(xr(_)){const j=b[_];qt(j)&&_p(R,j)}else if(qt(_))_p(R,_.bind(A));else if(zr(_))if(Ut(_))_.forEach(j=>D_(j,b,A,D));else{const j=qt(_.handler)?_.handler.bind(A):b[_.handler];qt(j)&&_p(R,j,_)}}function L_(_){const b=_.type,{mixins:A,extends:D}=b,{mixins:R,optionsCache:j,config:{optionMergeStrategies:oe}}=_.appContext,s=j.get(b);let pe;return s?pe=s:!R.length&&!A&&!D?pe=b:(pe={},R.length&&R.forEach(Ie=>hh(pe,Ie,oe,!0)),hh(pe,b,oe)),j.set(b,pe),pe}function hh(_,b,A,D=!1){const{mixins:R,extends:j}=b;j&&hh(_,j,A,!0),R&&R.forEach(oe=>hh(_,oe,A,!0));for(const oe in b)if(!(D&&oe==="expose")){const s=iv[oe]||A&&A[oe];_[oe]=s?s(_[oe],b[oe]):b[oe]}return _}const iv={data:B_,props:Ys,emits:Ys,methods:Ys,computed:Ys,beforeCreate:Pr,created:Pr,beforeMount:Pr,mounted:Pr,beforeUpdate:Pr,updated:Pr,beforeDestroy:Pr,beforeUnmount:Pr,destroyed:Pr,unmounted:Pr,activated:Pr,deactivated:Pr,errorCaptured:Pr,serverPrefetch:Pr,components:Ys,directives:Ys,watch:nv,provide:B_,inject:rv};function B_(_,b){return b?_?function(){return yr(qt(_)?_.call(this,this):_,qt(b)?b.call(this,this):b)}:b:_}function rv(_,b){return Ys(wp(_),wp(b))}function wp(_){if(Ut(_)){const b={};for(let A=0;A<_.length;A++)b[_[A]]=_[A];return b}return _}function Pr(_,b){return _?[...new Set([].concat(_,b))]:b}function Ys(_,b){return _?yr(yr(Object.create(null),_),b):b}function nv(_,b){if(!_)return b;if(!b)return _;const A=yr(Object.create(null),_);for(const D in b)A[D]=Pr(_[D],b[D]);return A}function ov(_,b,A,D=!1){const R={},j={};Qu(j,ph,1),_.propsDefaults=Object.create(null),R_(_,b,R,j);for(const oe in _.propsOptions[0])oe in R||(R[oe]=void 0);A?_.props=D?R:y0(R):_.type.props?_.props=R:_.props=j,_.attrs=j}function sv(_,b,A,D){const{props:R,attrs:j,vnode:{patchFlag:oe}}=_,s=ui(R),[pe]=_.propsOptions;let Ie=!1;if((D||oe>0)&&!(oe&16)){if(oe&8){const Ue=_.vnode.dynamicProps;for(let _e=0;_e<Ue.length;_e++){let Le=Ue[_e];const fe=b[Le];if(pe)if(ti(j,Le))fe!==j[Le]&&(j[Le]=fe,Ie=!0);else{const wt=al(Le);R[wt]=Tp(pe,s,wt,fe,_,!1)}else fe!==j[Le]&&(j[Le]=fe,Ie=!0)}}}else{R_(_,b,R,j)&&(Ie=!0);let Ue;for(const _e in s)(!b||!ti(b,_e)&&((Ue=ll(_e))===_e||!ti(b,Ue)))&&(pe?A&&(A[_e]!==void 0||A[Ue]!==void 0)&&(R[_e]=Tp(pe,s,_e,void 0,_,!0)):delete R[_e]);if(j!==s)for(const _e in j)(!b||!ti(b,_e)&&!0)&&(delete j[_e],Ie=!0)}Ie&&So(_,"set","$attrs")}function R_(_,b,A,D){const[R,j]=_.propsOptions;let oe=!1,s;if(b)for(let pe in b){if(Ku(pe))continue;const Ie=b[pe];let Ue;R&&ti(R,Ue=al(pe))?!j||!j.includes(Ue)?A[Ue]=Ie:(s||(s={}))[Ue]=Ie:pp(_.emitsOptions,pe)||(!(pe in D)||Ie!==D[pe])&&(D[pe]=Ie,oe=!0)}if(j){const pe=ui(A),Ie=s||vi;for(let Ue=0;Ue<j.length;Ue++){const _e=j[Ue];A[_e]=Tp(R,pe,_e,Ie[_e],_,!ti(Ie,_e))}}return oe}function Tp(_,b,A,D,R,j){const oe=_[A];if(oe!=null){const s=ti(oe,"default");if(s&&D===void 0){const pe=oe.default;if(oe.type!==Function&&qt(pe)){const{propsDefaults:Ie}=R;A in Ie?D=Ie[A]:(_l(R),D=Ie[A]=pe.call(null,b),ia())}else D=pe}oe[0]&&(j&&!s?D=!1:oe[1]&&(D===""||D===ll(A))&&(D=!0))}return D}function F_(_,b,A=!1){const D=b.propsCache,R=D.get(_);if(R)return R;const j=_.props,oe={},s=[];let pe=!1;if(!qt(_)){const Ue=_e=>{pe=!0;const[Le,fe]=F_(_e,b,!0);yr(oe,Le),fe&&s.push(...fe)};!A&&b.mixins.length&&b.mixins.forEach(Ue),_.extends&&Ue(_.extends),_.mixins&&_.mixins.forEach(Ue)}if(!j&&!pe)return D.set(_,sl),sl;if(Ut(j))for(let Ue=0;Ue<j.length;Ue++){const _e=al(j[Ue]);O_(_e)&&(oe[_e]=vi)}else if(j)for(const Ue in j){const _e=al(Ue);if(O_(_e)){const Le=j[Ue],fe=oe[_e]=Ut(Le)||qt(Le)?{type:Le}:Le;if(fe){const wt=N_(Boolean,fe.type),dt=N_(String,fe.type);fe[0]=wt>-1,fe[1]=dt<0||wt<dt,(wt>-1||ti(fe,"default"))&&s.push(_e)}}}const Ie=[oe,s];return D.set(_,Ie),Ie}function O_(_){return _[0]!=="$"}function U_(_){const b=_&&_.toString().match(/^\s*function (\w+)/);return b?b[1]:_===null?"null":""}function V_(_,b){return U_(_)===U_(b)}function N_(_,b){return Ut(b)?b.findIndex(A=>V_(A,_)):qt(b)&&V_(b,_)?0:-1}const j_=_=>_[0]==="_"||_==="$stable",Ep=_=>Ut(_)?_.map(so):[so(_)],av=(_,b,A)=>{const D=k0((...R)=>Ep(b(...R)),A);return D._c=!1,D},G_=(_,b,A)=>{const D=_._ctx;for(const R in _){if(j_(R))continue;const j=_[R];if(qt(j))b[R]=av(R,j,D);else if(j!=null){const oe=Ep(j);b[R]=()=>oe}}},$_=(_,b)=>{const A=Ep(b);_.slots.default=()=>A},lv=(_,b)=>{if(_.vnode.shapeFlag&32){const A=b._;A?(_.slots=ui(b),Qu(b,"_",A)):G_(b,_.slots={})}else _.slots={},b&&$_(_,b);Qu(_.slots,ph,1)},cv=(_,b,A)=>{const{vnode:D,slots:R}=_;let j=!0,oe=vi;if(D.shapeFlag&32){const s=b._;s?A&&s===1?j=!1:(yr(R,b),!A&&s===1&&delete R._):(j=!b.$stable,G_(b,R)),oe=b}else b&&($_(_,b),oe={default:1});if(j)for(const s in R)!j_(s)&&!(s in oe)&&delete R[s]};function Js(_,b,A,D){const R=_.dirs,j=b&&b.dirs;for(let oe=0;oe<R.length;oe++){const s=R[oe];j&&(s.oldValue=j[oe].value);let pe=s.dir[D];pe&&(cl(),yn(pe,A,8,[_.el,s,_,b]),ul())}}function Z_(){return{app:null,config:{isNativeTag:Lx,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let uv=0;function hv(_,b){return function(D,R=null){R!=null&&!zr(R)&&(R=null);const j=Z_(),oe=new Set;let s=!1;const pe=j.app={_uid:uv++,_component:D,_props:R,_container:null,_context:j,_instance:null,version:Lv,get config(){return j.config},set config(Ie){},use(Ie,...Ue){return oe.has(Ie)||(Ie&&qt(Ie.install)?(oe.add(Ie),Ie.install(pe,...Ue)):qt(Ie)&&(oe.add(Ie),Ie(pe,...Ue))),pe},mixin(Ie){return j.mixins.includes(Ie)||j.mixins.push(Ie),pe},component(Ie,Ue){return Ue?(j.components[Ie]=Ue,pe):j.components[Ie]},directive(Ie,Ue){return Ue?(j.directives[Ie]=Ue,pe):j.directives[Ie]},mount(Ie,Ue,_e){if(!s){const Le=us(D,R);return Le.appContext=j,Ue&&b?b(Le,Ie):_(Le,Ie,_e),s=!0,pe._container=Ie,Ie.__vue_app__=pe,zp(Le.component)||Le.component.proxy}},unmount(){s&&(_(null,pe._container),delete pe._container.__vue_app__)},provide(Ie,Ue){return j.provides[Ie]=Ue,pe}};return pe}}function Sp(_,b,A,D,R=!1){if(Ut(_)){_.forEach((Le,fe)=>Sp(Le,b&&(Ut(b)?b[fe]:b),A,D,R));return}if(vp(D)&&!R)return;const j=D.shapeFlag&4?zp(D.component)||D.component.proxy:D.el,oe=R?null:j,{i:s,r:pe}=_,Ie=b&&b.r,Ue=s.refs===vi?s.refs={}:s.refs,_e=s.setupState;if(Ie!=null&&Ie!==pe&&(xr(Ie)?(Ue[Ie]=null,ti(_e,Ie)&&(_e[Ie]=null)):vr(Ie)&&(Ie.value=null)),qt(pe))as(pe,s,12,[oe,Ue]);else{const Le=xr(pe),fe=vr(pe);if(Le||fe){const wt=()=>{if(_.f){const dt=Le?Ue[pe]:pe.value;R?Ut(dt)&&Zd(dt,j):Ut(dt)?dt.includes(j)||dt.push(j):Le?Ue[pe]=[j]:(pe.value=[j],_.k&&(Ue[_.k]=pe.value))}else Le?(Ue[pe]=oe,ti(_e,pe)&&(_e[pe]=oe)):vr(pe)&&(pe.value=oe,_.k&&(Ue[_.k]=oe))};oe?(wt.id=-1,jr(wt,A)):wt()}}}const jr=O0;function dv(_){return pv(_)}function pv(_,b){const A=$x();A.__VUE__=!0;const{insert:D,remove:R,patchProp:j,createElement:oe,createText:s,createComment:pe,setText:Ie,setElementText:Ue,parentNode:_e,nextSibling:Le,setScopeId:fe=Ln,cloneNode:wt,insertStaticContent:dt}=_,xt=(ee,re,ye,Re=null,Fe=null,qe=null,Qe=!1,ze=null,We=!!re.dynamicChildren)=>{if(ee===re)return;ee&&!ta(ee,re)&&(Re=sn(ee),ir(ee,Fe,qe,!0),ee=null),re.patchFlag===-2&&(We=!1,re.dynamicChildren=null);const{type:Ne,ref:at,shapeFlag:nt}=re;switch(Ne){case Ip:yt(ee,re,ye,Re);break;case cs:Ui(ee,re,ye,Re);break;case Mp:ee==null&&ai(re,ye,Re,Qe);break;case oo:br(ee,re,ye,Re,Fe,qe,Qe,ze,We);break;default:nt&1?Vi(ee,re,ye,Re,Fe,qe,Qe,ze,We):nt&6?vn(ee,re,ye,Re,Fe,qe,Qe,ze,We):(nt&64||nt&128)&&Ne.process(ee,re,ye,Re,Fe,qe,Qe,ze,We,$r)}at!=null&&Fe&&Sp(at,ee&&ee.ref,qe,re||ee,!re)},yt=(ee,re,ye,Re)=>{if(ee==null)D(re.el=s(re.children),ye,Re);else{const Fe=re.el=ee.el;re.children!==ee.children&&Ie(Fe,re.children)}},Ui=(ee,re,ye,Re)=>{ee==null?D(re.el=pe(re.children||""),ye,Re):re.el=ee.el},ai=(ee,re,ye,Re)=>{[ee.el,ee.anchor]=dt(ee.children,re,ye,Re,ee.el,ee.anchor)},Wt=({el:ee,anchor:re},ye,Re)=>{let Fe;for(;ee&&ee!==re;)Fe=Le(ee),D(ee,ye,Re),ee=Fe;D(re,ye,Re)},Di=({el:ee,anchor:re})=>{let ye;for(;ee&&ee!==re;)ye=Le(ee),R(ee),ee=ye;R(re)},Vi=(ee,re,ye,Re,Fe,qe,Qe,ze,We)=>{Qe=Qe||re.type==="svg",ee==null?Vt(re,ye,Re,Fe,qe,Qe,ze,We):tr(ee,re,Fe,qe,Qe,ze,We)},Vt=(ee,re,ye,Re,Fe,qe,Qe,ze)=>{let We,Ne;const{type:at,props:nt,shapeFlag:Je,transition:ft,patchFlag:Ct,dirs:Yt}=ee;if(ee.el&&wt!==void 0&&Ct===-1)We=ee.el=wt(ee.el);else{if(We=ee.el=oe(ee.type,qe,nt&&nt.is,nt),Je&8?Ue(We,ee.children):Je&16&&li(ee.children,We,null,Re,Fe,qe&&at!=="foreignObject",Qe,ze),Yt&&Js(ee,null,Re,"created"),nt){for(const Jt in nt)Jt!=="value"&&!Ku(Jt)&&j(We,Jt,null,nt[Jt],qe,ee.children,Re,Fe,Bi);"value"in nt&&j(We,"value",null,nt.value),(Ne=nt.onVnodeBeforeMount)&&ao(Ne,Re,ee)}bi(We,ee,ee.scopeId,Qe,Re)}Yt&&Js(ee,null,Re,"beforeMount");const Mt=(!Fe||Fe&&!Fe.pendingBranch)&&ft&&!ft.persisted;Mt&&ft.beforeEnter(We),D(We,re,ye),((Ne=nt&&nt.onVnodeMounted)||Mt||Yt)&&jr(()=>{Ne&&ao(Ne,Re,ee),Mt&&ft.enter(We),Yt&&Js(ee,null,Re,"mounted")},Fe)},bi=(ee,re,ye,Re,Fe)=>{if(ye&&fe(ee,ye),Re)for(let qe=0;qe<Re.length;qe++)fe(ee,Re[qe]);if(Fe){let qe=Fe.subTree;if(re===qe){const Qe=Fe.vnode;bi(ee,Qe,Qe.scopeId,Qe.slotScopeIds,Fe.parent)}}},li=(ee,re,ye,Re,Fe,qe,Qe,ze,We=0)=>{for(let Ne=We;Ne<ee.length;Ne++){const at=ee[Ne]=ze?hs(ee[Ne]):so(ee[Ne]);xt(null,at,re,ye,Re,Fe,qe,Qe,ze)}},tr=(ee,re,ye,Re,Fe,qe,Qe)=>{const ze=re.el=ee.el;let{patchFlag:We,dynamicChildren:Ne,dirs:at}=re;We|=ee.patchFlag&16;const nt=ee.props||vi,Je=re.props||vi;let ft;ye&&Qs(ye,!1),(ft=Je.onVnodeBeforeUpdate)&&ao(ft,ye,re,ee),at&&Js(re,ee,ye,"beforeUpdate"),ye&&Qs(ye,!0);const Ct=Fe&&re.type!=="foreignObject";if(Ne?wi(ee.dynamicChildren,Ne,ze,ye,Re,Ct,qe):Qe||Li(ee,re,ze,null,ye,Re,Ct,qe,!1),We>0){if(We&16)Ki(ze,re,nt,Je,ye,Re,Fe);else if(We&2&&nt.class!==Je.class&&j(ze,"class",null,Je.class,Fe),We&4&&j(ze,"style",nt.style,Je.style,Fe),We&8){const Yt=re.dynamicProps;for(let Mt=0;Mt<Yt.length;Mt++){const Jt=Yt[Mt],Ni=nt[Jt],wr=Je[Jt];(wr!==Ni||Jt==="value")&&j(ze,Jt,Ni,wr,Fe,ee.children,ye,Re,Bi)}}We&1&&ee.children!==re.children&&Ue(ze,re.children)}else!Qe&&Ne==null&&Ki(ze,re,nt,Je,ye,Re,Fe);((ft=Je.onVnodeUpdated)||at)&&jr(()=>{ft&&ao(ft,ye,re,ee),at&&Js(re,ee,ye,"updated")},Re)},wi=(ee,re,ye,Re,Fe,qe,Qe)=>{for(let ze=0;ze<re.length;ze++){const We=ee[ze],Ne=re[ze],at=We.el&&(We.type===oo||!ta(We,Ne)||We.shapeFlag&(6|64))?_e(We.el):ye;xt(We,Ne,at,null,Re,Fe,qe,Qe,!0)}},Ki=(ee,re,ye,Re,Fe,qe,Qe)=>{if(ye!==Re){for(const ze in Re){if(Ku(ze))continue;const We=Re[ze],Ne=ye[ze];We!==Ne&&ze!=="value"&&j(ee,ze,Ne,We,Qe,re.children,Fe,qe,Bi)}if(ye!==vi)for(const ze in ye)!Ku(ze)&&!(ze in Re)&&j(ee,ze,ye[ze],null,Qe,re.children,Fe,qe,Bi);"value"in Re&&j(ee,"value",ye.value,Re.value)}},br=(ee,re,ye,Re,Fe,qe,Qe,ze,We)=>{const Ne=re.el=ee?ee.el:s(""),at=re.anchor=ee?ee.anchor:s("");let{patchFlag:nt,dynamicChildren:Je,slotScopeIds:ft}=re;ft&&(ze=ze?ze.concat(ft):ft),ee==null?(D(Ne,ye,Re),D(at,ye,Re),li(re.children,ye,at,Fe,qe,Qe,ze,We)):nt>0&&nt&64&&Je&&ee.dynamicChildren?(wi(ee.dynamicChildren,Je,ye,Fe,qe,Qe,ze),(re.key!=null||Fe&&re===Fe.subTree)&&q_(ee,re,!0)):Li(ee,re,ye,at,Fe,qe,Qe,ze,We)},vn=(ee,re,ye,Re,Fe,qe,Qe,ze,We)=>{re.slotScopeIds=ze,ee==null?re.shapeFlag&512?Fe.ctx.activate(re,ye,Re,Qe,We):lo(re,ye,Re,Fe,qe,Qe,We):mi(ee,re,We)},lo=(ee,re,ye,Re,Fe,qe,Qe)=>{const ze=ee.component=Iv(ee,Re,Fe);if(ch(ee)&&(ze.ctx.renderer=$r),Av(ze),ze.asyncDep){if(Fe&&Fe.registerDep(ze,Nt),!ee.el){const We=ze.subTree=us(cs);Ui(null,We,re,ye)}return}Nt(ze,ee,re,ye,Fe,qe,Qe)},mi=(ee,re,ye)=>{const Re=re.component=ee.component;if(B0(ee,re,ye))if(Re.asyncDep&&!Re.asyncResolved){Ht(Re,re,ye);return}else Re.next=re,A0(Re.update),Re.update();else re.component=ee.component,re.el=ee.el,Re.vnode=re},Nt=(ee,re,ye,Re,Fe,qe,Qe)=>{const ze=()=>{if(ee.isMounted){let{next:at,bu:nt,u:Je,parent:ft,vnode:Ct}=ee,Yt=at,Mt;Qs(ee,!1),at?(at.el=Ct.el,Ht(ee,at,Qe)):at=Ct,nt&&Hd(nt),(Mt=at.props&&at.props.onVnodeBeforeUpdate)&&ao(Mt,ft,at,Ct),Qs(ee,!0);const Jt=fp(ee),Ni=ee.subTree;ee.subTree=Jt,xt(Ni,Jt,_e(Ni.el),sn(Ni),ee,Fe,qe),at.el=Jt.el,Yt===null&&R0(ee,Jt.el),Je&&jr(Je,Fe),(Mt=at.props&&at.props.onVnodeUpdated)&&jr(()=>ao(Mt,ft,at,Ct),Fe)}else{let at;const{el:nt,props:Je}=re,{bm:ft,m:Ct,parent:Yt}=ee,Mt=vp(re);if(Qs(ee,!1),ft&&Hd(ft),!Mt&&(at=Je&&Je.onVnodeBeforeMount)&&ao(at,Yt,re),Qs(ee,!0),nt&&Rn){const Jt=()=>{ee.subTree=fp(ee),Rn(nt,ee.subTree,ee,Fe,null)};Mt?re.type.__asyncLoader().then(()=>!ee.isUnmounted&&Jt()):Jt()}else{const Jt=ee.subTree=fp(ee);xt(null,Jt,ye,Re,ee,Fe,qe),re.el=Jt.el}if(Ct&&jr(Ct,Fe),!Mt&&(at=Je&&Je.onVnodeMounted)){const Jt=re;jr(()=>ao(at,Yt,Jt),Fe)}re.shapeFlag&256&&ee.a&&jr(ee.a,Fe),ee.isMounted=!0,re=ye=Re=null}},We=ee.effect=new ep(ze,()=>f_(ee.update),ee.scope),Ne=ee.update=We.run.bind(We);Ne.id=ee.uid,Qs(ee,!0),Ne()},Ht=(ee,re,ye)=>{re.component=ee;const Re=ee.vnode.props;ee.vnode=re,ee.next=null,sv(ee,re.props,Re,ye),cv(ee,re.children,ye),cl(),dp(void 0,ee.update),ul()},Li=(ee,re,ye,Re,Fe,qe,Qe,ze,We=!1)=>{const Ne=ee&&ee.children,at=ee?ee.shapeFlag:0,nt=re.children,{patchFlag:Je,shapeFlag:ft}=re;if(Je>0){if(Je&128){vt(Ne,nt,ye,Re,Fe,qe,Qe,ze,We);return}else if(Je&256){nn(Ne,nt,ye,Re,Fe,qe,Qe,ze,We);return}}ft&8?(at&16&&Bi(Ne,Fe,qe),nt!==Ne&&Ue(ye,nt)):at&16?ft&16?vt(Ne,nt,ye,Re,Fe,qe,Qe,ze,We):Bi(Ne,Fe,qe,!0):(at&8&&Ue(ye,""),ft&16&&li(nt,ye,Re,Fe,qe,Qe,ze,We))},nn=(ee,re,ye,Re,Fe,qe,Qe,ze,We)=>{ee=ee||sl,re=re||sl;const Ne=ee.length,at=re.length,nt=Math.min(Ne,at);let Je;for(Je=0;Je<nt;Je++){const ft=re[Je]=We?hs(re[Je]):so(re[Je]);xt(ee[Je],ft,ye,null,Fe,qe,Qe,ze,We)}Ne>at?Bi(ee,Fe,qe,!0,!1,nt):li(re,ye,Re,Fe,qe,Qe,ze,We,nt)},vt=(ee,re,ye,Re,Fe,qe,Qe,ze,We)=>{let Ne=0;const at=re.length;let nt=ee.length-1,Je=at-1;for(;Ne<=nt&&Ne<=Je;){const ft=ee[Ne],Ct=re[Ne]=We?hs(re[Ne]):so(re[Ne]);if(ta(ft,Ct))xt(ft,Ct,ye,null,Fe,qe,Qe,ze,We);else break;Ne++}for(;Ne<=nt&&Ne<=Je;){const ft=ee[nt],Ct=re[Je]=We?hs(re[Je]):so(re[Je]);if(ta(ft,Ct))xt(ft,Ct,ye,null,Fe,qe,Qe,ze,We);else break;nt--,Je--}if(Ne>nt){if(Ne<=Je){const ft=Je+1,Ct=ft<at?re[ft].el:Re;for(;Ne<=Je;)xt(null,re[Ne]=We?hs(re[Ne]):so(re[Ne]),ye,Ct,Fe,qe,Qe,ze,We),Ne++}}else if(Ne>Je)for(;Ne<=nt;)ir(ee[Ne],Fe,qe,!0),Ne++;else{const ft=Ne,Ct=Ne,Yt=new Map;for(Ne=Ct;Ne<=Je;Ne++){const ji=re[Ne]=We?hs(re[Ne]):so(re[Ne]);ji.key!=null&&Yt.set(ji.key,Ne)}let Mt,Jt=0;const Ni=Je-Ct+1;let wr=!1,Zr=0;const kr=new Array(Ni);for(Ne=0;Ne<Ni;Ne++)kr[Ne]=0;for(Ne=ft;Ne<=nt;Ne++){const ji=ee[Ne];if(Jt>=Ni){ir(ji,Fe,qe,!0);continue}let jt;if(ji.key!=null)jt=Yt.get(ji.key);else for(Mt=Ct;Mt<=Je;Mt++)if(kr[Mt-Ct]===0&&ta(ji,re[Mt])){jt=Mt;break}jt===void 0?ir(ji,Fe,qe,!0):(kr[jt-Ct]=Ne+1,jt>=Zr?Zr=jt:wr=!0,xt(ji,re[jt],ye,null,Fe,qe,Qe,ze,We),Jt++)}const or=wr?fv(kr):sl;for(Mt=or.length-1,Ne=Ni-1;Ne>=0;Ne--){const ji=Ct+Ne,jt=re[ji],sr=ji+1<at?re[ji+1].el:Re;kr[Ne]===0?xt(null,jt,ye,sr,Fe,qe,Qe,ze,We):wr&&(Mt<0||Ne!==or[Mt]?Gr(jt,ye,sr,2):Mt--)}}},Gr=(ee,re,ye,Re,Fe=null)=>{const{el:qe,type:Qe,transition:ze,children:We,shapeFlag:Ne}=ee;if(Ne&6){Gr(ee.component.subTree,re,ye,Re);return}if(Ne&128){ee.suspense.move(re,ye,Re);return}if(Ne&64){Qe.move(ee,re,ye,$r);return}if(Qe===oo){D(qe,re,ye);for(let nt=0;nt<We.length;nt++)Gr(We[nt],re,ye,Re);D(ee.anchor,re,ye);return}if(Qe===Mp){Wt(ee,re,ye);return}if(Re!==2&&Ne&1&&ze)if(Re===0)ze.beforeEnter(qe),D(qe,re,ye),jr(()=>ze.enter(qe),Fe);else{const{leave:nt,delayLeave:Je,afterLeave:ft}=ze,Ct=()=>D(qe,re,ye),Yt=()=>{nt(qe,()=>{Ct(),ft&&ft()})};Je?Je(qe,Ct,Yt):Yt()}else D(qe,re,ye)},ir=(ee,re,ye,Re=!1,Fe=!1)=>{const{type:qe,props:Qe,ref:ze,children:We,dynamicChildren:Ne,shapeFlag:at,patchFlag:nt,dirs:Je}=ee;if(ze!=null&&Sp(ze,null,ye,ee,!0),at&256){re.ctx.deactivate(ee);return}const ft=at&1&&Je,Ct=!vp(ee);let Yt;if(Ct&&(Yt=Qe&&Qe.onVnodeBeforeUnmount)&&ao(Yt,re,ee),at&6)Bn(ee.component,ye,Re);else{if(at&128){ee.suspense.unmount(ye,Re);return}ft&&Js(ee,null,re,"beforeUnmount"),at&64?ee.type.remove(ee,re,ye,Fe,$r,Re):Ne&&(qe!==oo||nt>0&&nt&64)?Bi(Ne,re,ye,!1,!0):(qe===oo&&nt&(128|256)||!Fe&&at&16)&&Bi(We,re,ye),Re&&on(ee)}(Ct&&(Yt=Qe&&Qe.onVnodeUnmounted)||ft)&&jr(()=>{Yt&&ao(Yt,re,ee),ft&&Js(ee,null,re,"unmounted")},ye)},on=ee=>{const{type:re,el:ye,anchor:Re,transition:Fe}=ee;if(re===oo){ds(ye,Re);return}if(re===Mp){Di(ee);return}const qe=()=>{R(ye),Fe&&!Fe.persisted&&Fe.afterLeave&&Fe.afterLeave()};if(ee.shapeFlag&1&&Fe&&!Fe.persisted){const{leave:Qe,delayLeave:ze}=Fe,We=()=>Qe(ye,qe);ze?ze(ee.el,qe,We):We()}else qe()},ds=(ee,re)=>{let ye;for(;ee!==re;)ye=Le(ee),R(ee),ee=ye;R(re)},Bn=(ee,re,ye)=>{const{bum:Re,scope:Fe,update:qe,subTree:Qe,um:ze}=ee;Re&&Hd(Re),Fe.stop(),qe&&(qe.active=!1,ir(Qe,ee,re,ye)),ze&&jr(ze,re),jr(()=>{ee.isUnmounted=!0},re),re&&re.pendingBranch&&!re.isUnmounted&&ee.asyncDep&&!ee.asyncResolved&&ee.suspenseId===re.pendingId&&(re.deps--,re.deps===0&&re.resolve())},Bi=(ee,re,ye,Re=!1,Fe=!1,qe=0)=>{for(let Qe=qe;Qe<ee.length;Qe++)ir(ee[Qe],re,ye,Re,Fe)},sn=ee=>ee.shapeFlag&6?sn(ee.component.subTree):ee.shapeFlag&128?ee.suspense.next():Le(ee.anchor||ee.el),co=(ee,re,ye)=>{ee==null?re._vnode&&ir(re._vnode,null,null,!0):xt(re._vnode||null,ee,re,null,null,null,ye),g_(),re._vnode=ee},$r={p:xt,um:ir,m:Gr,r:on,mt:lo,mc:li,pc:Li,pbc:wi,n:sn,o:_};let bn,Rn;return b&&([bn,Rn]=b($r)),{render:co,hydrate:bn,createApp:hv(co,bn)}}function Qs({effect:_,update:b},A){_.allowRecurse=b.allowRecurse=A}function q_(_,b,A=!1){const D=_.children,R=b.children;if(Ut(D)&&Ut(R))for(let j=0;j<D.length;j++){const oe=D[j];let s=R[j];s.shapeFlag&1&&!s.dynamicChildren&&((s.patchFlag<=0||s.patchFlag===32)&&(s=R[j]=hs(R[j]),s.el=oe.el),A||q_(oe,s))}}function fv(_){const b=_.slice(),A=[0];let D,R,j,oe,s;const pe=_.length;for(D=0;D<pe;D++){const Ie=_[D];if(Ie!==0){if(R=A[A.length-1],_[R]<Ie){b[D]=R,A.push(D);continue}for(j=0,oe=A.length-1;j<oe;)s=j+oe>>1,_[A[s]]<Ie?j=s+1:oe=s;Ie<_[A[j]]&&(j>0&&(b[D]=A[j-1]),A[j]=D)}}for(j=A.length,oe=A[j-1];j-- >0;)A[j]=oe,oe=b[oe];return A}const mv=_=>_.__isTeleport,_v=Symbol(),oo=Symbol(void 0),Ip=Symbol(void 0),cs=Symbol(void 0),Mp=Symbol(void 0),Tc=[];let ea=null;function n1(_=!1){Tc.push(ea=_?null:[])}function gv(){Tc.pop(),ea=Tc[Tc.length-1]||null}let dh=1;function W_(_){dh+=_}function X_(_){return _.dynamicChildren=dh>0?ea||sl:null,gv(),dh>0&&ea&&ea.push(_),_}function o1(_,b,A,D,R,j){return X_(K_(_,b,A,D,R,j,!0))}function s1(_,b,A,D,R){return X_(us(_,b,A,D,R,!0))}function yv(_){return _?_.__v_isVNode===!0:!1}function ta(_,b){return _.type===b.type&&_.key===b.key}const ph="__vInternal",H_=({key:_})=>_!=null?_:null,fh=({ref:_,ref_key:b,ref_for:A})=>_!=null?xr(_)||vr(_)||qt(_)?{i:no,r:_,k:b,f:!!A}:_:null;function K_(_,b=null,A=null,D=0,R=null,j=_===oo?0:1,oe=!1,s=!1){const pe={__v_isVNode:!0,__v_skip:!0,type:_,props:b,key:b&&H_(b),ref:b&&fh(b),scopeId:v_,slotScopeIds:null,children:A,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:j,patchFlag:D,dynamicProps:R,dynamicChildren:null,appContext:null};return s?(Ap(pe,A),j&128&&_.normalize(pe)):A&&(pe.shapeFlag|=xr(A)?8:16),dh>0&&!oe&&ea&&(pe.patchFlag>0||j&6)&&pe.patchFlag!==32&&ea.push(pe),pe}const us=xv;function xv(_,b=null,A=null,D=0,R=null,j=!1){if((!_||_===_v)&&(_=cs),yv(_)){const s=ml(_,b,!0);return A&&Ap(s,A),s}if(kv(_)&&(_=_.__vccOpts),b){b=vv(b);let{class:s,style:pe}=b;s&&!xr(s)&&(b.class=Gd(s)),zr(pe)&&(u_(pe)&&!Ut(pe)&&(pe=yr({},pe)),b.style=jd(pe))}const oe=xr(_)?1:F0(_)?128:mv(_)?64:zr(_)?4:qt(_)?2:0;return K_(_,b,A,D,R,oe,j,!0)}function vv(_){return _?u_(_)||ph in _?yr({},_):_:null}function ml(_,b,A=!1){const{props:D,ref:R,patchFlag:j,children:oe}=_,s=b?wv(D||{},b):D;return{__v_isVNode:!0,__v_skip:!0,type:_.type,props:s,key:s&&H_(s),ref:b&&b.ref?A&&R?Ut(R)?R.concat(fh(b)):[R,fh(b)]:fh(b):R,scopeId:_.scopeId,slotScopeIds:_.slotScopeIds,children:oe,target:_.target,targetAnchor:_.targetAnchor,staticCount:_.staticCount,shapeFlag:_.shapeFlag,patchFlag:b&&_.type!==oo?j===-1?16:j|16:j,dynamicProps:_.dynamicProps,dynamicChildren:_.dynamicChildren,appContext:_.appContext,dirs:_.dirs,transition:_.transition,component:_.component,suspense:_.suspense,ssContent:_.ssContent&&ml(_.ssContent),ssFallback:_.ssFallback&&ml(_.ssFallback),el:_.el,anchor:_.anchor}}function bv(_=" ",b=0){return us(Ip,null,_,b)}function so(_){return _==null||typeof _=="boolean"?us(cs):Ut(_)?us(oo,null,_.slice()):typeof _=="object"?hs(_):us(Ip,null,String(_))}function hs(_){return _.el===null||_.memo?_:ml(_)}function Ap(_,b){let A=0;const{shapeFlag:D}=_;if(b==null)b=null;else if(Ut(b))A=16;else if(typeof b=="object")if(D&(1|64)){const R=b.default;R&&(R._c&&(R._d=!1),Ap(_,R()),R._c&&(R._d=!0));return}else{A=32;const R=b._;!R&&!(ph in b)?b._ctx=no:R===3&&no&&(no.slots._===1?b._=1:(b._=2,_.patchFlag|=1024))}else qt(b)?(b={default:b,_ctx:no},A=32):(b=String(b),D&64?(A=16,b=[bv(b)]):A=8);_.children=b,_.shapeFlag|=A}function wv(..._){const b={};for(let A=0;A<_.length;A++){const D=_[A];for(const R in D)if(R==="class")b.class!==D.class&&(b.class=Gd([b.class,D.class]));else if(R==="style")b.style=jd([b.style,D.style]);else if(Xu(R)){const j=b[R],oe=D[R];oe&&j!==oe&&!(Ut(j)&&j.includes(oe))&&(b[R]=j?[].concat(j,oe):oe)}else R!==""&&(b[R]=D[R])}return b}function ao(_,b,A,D=null){yn(_,b,7,[A,D])}const Cp=_=>_?Y_(_)?zp(_)||_.proxy:Cp(_.parent):null,mh=yr(Object.create(null),{$:_=>_,$el:_=>_.vnode.el,$data:_=>_.data,$props:_=>_.props,$attrs:_=>_.attrs,$slots:_=>_.slots,$refs:_=>_.refs,$parent:_=>Cp(_.parent),$root:_=>Cp(_.root),$emit:_=>_.emit,$options:_=>L_(_),$forceUpdate:_=>()=>f_(_.update),$nextTick:_=>I0.bind(_.proxy),$watch:_=>V0.bind(_)}),Tv={get({_},b){const{ctx:A,setupState:D,data:R,props:j,accessCache:oe,type:s,appContext:pe}=_;let Ie;if(b[0]!=="$"){const fe=oe[b];if(fe!==void 0)switch(fe){case 1:return D[b];case 2:return R[b];case 4:return A[b];case 3:return j[b]}else{if(D!==vi&&ti(D,b))return oe[b]=1,D[b];if(R!==vi&&ti(R,b))return oe[b]=2,R[b];if((Ie=_.propsOptions[0])&&ti(Ie,b))return oe[b]=3,j[b];if(A!==vi&&ti(A,b))return oe[b]=4,A[b];bp&&(oe[b]=0)}}const Ue=mh[b];let _e,Le;if(Ue)return b==="$attrs"&&tn(_,"get",b),Ue(_);if((_e=s.__cssModules)&&(_e=_e[b]))return _e;if(A!==vi&&ti(A,b))return oe[b]=4,A[b];if(Le=pe.config.globalProperties,ti(Le,b))return Le[b]},set({_},b,A){const{data:D,setupState:R,ctx:j}=_;if(R!==vi&&ti(R,b))R[b]=A;else if(D!==vi&&ti(D,b))D[b]=A;else if(ti(_.props,b))return!1;return b[0]==="$"&&b.slice(1)in _?!1:(j[b]=A,!0)},has({_:{data:_,setupState:b,accessCache:A,ctx:D,appContext:R,propsOptions:j}},oe){let s;return!!A[oe]||_!==vi&&ti(_,oe)||b!==vi&&ti(b,oe)||(s=j[0])&&ti(s,oe)||ti(D,oe)||ti(mh,oe)||ti(R.config.globalProperties,oe)}},Ev=Z_();let Sv=0;function Iv(_,b,A){const D=_.type,R=(b?b.appContext:_.appContext)||Ev,j={uid:Sv++,vnode:_,type:D,parent:b,appContext:R,root:null,next:null,subTree:null,effect:null,update:null,scope:new Zx(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:b?b.provides:Object.create(R.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:F_(D,R),emitsOptions:x_(D,R),emit:null,emitted:null,propsDefaults:vi,inheritAttrs:D.inheritAttrs,ctx:vi,data:vi,props:vi,attrs:vi,slots:vi,refs:vi,setupState:vi,setupContext:null,suspense:A,suspenseId:A?A.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return j.ctx={_:j},j.root=b?b.root:j,j.emit=P0.bind(null,j),_.ce&&_.ce(j),j}let hr=null;const Mv=()=>hr||no,_l=_=>{hr=_,_.scope.on()},ia=()=>{hr&&hr.scope.off(),hr=null};function Y_(_){return _.vnode.shapeFlag&4}let Ec=!1;function Av(_,b=!1){Ec=b;const{props:A,children:D}=_.vnode,R=Y_(_);ov(_,A,R,b),lv(_,D);const j=R?Cv(_,b):void 0;return Ec=!1,j}function Cv(_,b){const A=_.type;_.accessCache=Object.create(null),_.proxy=h_(new Proxy(_.ctx,Tv));const{setup:D}=A;if(D){const R=_.setupContext=D.length>1?Pv(_):null;_l(_),cl();const j=as(D,_,0,[_.props,R]);if(ul(),ia(),Gm(j)){if(j.then(ia,ia),b)return j.then(oe=>{J_(_,oe,b)}).catch(oe=>{sh(oe,_,0)});_.asyncDep=j}else J_(_,j,b)}else eg(_,b)}function J_(_,b,A){qt(b)?_.type.__ssrInlineRender?_.ssrRender=b:_.render=b:zr(b)&&(_.setupState=d_(b)),eg(_,A)}let Q_;function eg(_,b,A){const D=_.type;if(!_.render){if(!b&&Q_&&!D.render){const R=D.template;if(R){const{isCustomElement:j,compilerOptions:oe}=_.appContext.config,{delimiters:s,compilerOptions:pe}=D,Ie=yr(yr({isCustomElement:j,delimiters:s},oe),pe);D.render=Q_(R,Ie)}}_.render=D.render||Ln}_l(_),cl(),ev(_),ul(),ia()}function zv(_){return new Proxy(_.attrs,{get(b,A){return tn(_,"get","$attrs"),b[A]}})}function Pv(_){const b=D=>{_.exposed=D||{}};let A;return{get attrs(){return A||(A=zv(_))},slots:_.slots,emit:_.emit,expose:b}}function zp(_){if(_.exposed)return _.exposeProxy||(_.exposeProxy=new Proxy(d_(h_(_.exposed)),{get(b,A){if(A in b)return b[A];if(A in mh)return mh[A](_)}}))}function kv(_){return qt(_)&&"__vccOpts"in _}const Dv=(_,b)=>E0(_,b,Ec),Lv="3.2.30",Bv="http://www.w3.org/2000/svg",ra=typeof document!="undefined"?document:null,tg=ra&&ra.createElement("template"),Rv={insert:(_,b,A)=>{b.insertBefore(_,A||null)},remove:_=>{const b=_.parentNode;b&&b.removeChild(_)},createElement:(_,b,A,D)=>{const R=b?ra.createElementNS(Bv,_):ra.createElement(_,A?{is:A}:void 0);return _==="select"&&D&&D.multiple!=null&&R.setAttribute("multiple",D.multiple),R},createText:_=>ra.createTextNode(_),createComment:_=>ra.createComment(_),setText:(_,b)=>{_.nodeValue=b},setElementText:(_,b)=>{_.textContent=b},parentNode:_=>_.parentNode,nextSibling:_=>_.nextSibling,querySelector:_=>ra.querySelector(_),setScopeId(_,b){_.setAttribute(b,"")},cloneNode(_){const b=_.cloneNode(!0);return"_value"in _&&(b._value=_._value),b},insertStaticContent(_,b,A,D,R,j){const oe=A?A.previousSibling:b.lastChild;if(R&&(R===j||R.nextSibling))for(;b.insertBefore(R.cloneNode(!0),A),!(R===j||!(R=R.nextSibling)););else{tg.innerHTML=D?`<svg>${_}</svg>`:_;const s=tg.content;if(D){const pe=s.firstChild;for(;pe.firstChild;)s.appendChild(pe.firstChild);s.removeChild(pe)}b.insertBefore(s,A)}return[oe?oe.nextSibling:b.firstChild,A?A.previousSibling:b.lastChild]}};function Fv(_,b,A){const D=_._vtc;D&&(b=(b?[b,...D]:[...D]).join(" ")),b==null?_.removeAttribute("class"):A?_.setAttribute("class",b):_.className=b}function Ov(_,b,A){const D=_.style,R=xr(A);if(A&&!R){for(const j in A)Pp(D,j,A[j]);if(b&&!xr(b))for(const j in b)A[j]==null&&Pp(D,j,"")}else{const j=D.display;R?b!==A&&(D.cssText=A):b&&_.removeAttribute("style"),"_vod"in _&&(D.display=j)}}const ig=/\s*!important$/;function Pp(_,b,A){if(Ut(A))A.forEach(D=>Pp(_,b,D));else if(b.startsWith("--"))_.setProperty(b,A);else{const D=Uv(_,b);ig.test(A)?_.setProperty(ll(D),A.replace(ig,""),"important"):_[D]=A}}const rg=["Webkit","Moz","ms"],kp={};function Uv(_,b){const A=kp[b];if(A)return A;let D=al(b);if(D!=="filter"&&D in _)return kp[b]=D;D=$m(D);for(let R=0;R<rg.length;R++){const j=rg[R]+D;if(j in _)return kp[b]=j}return b}const ng="http://www.w3.org/1999/xlink";function Vv(_,b,A,D,R){if(D&&b.startsWith("xlink:"))A==null?_.removeAttributeNS(ng,b.slice(6,b.length)):_.setAttributeNS(ng,b,A);else{const j=zx(b);A==null||j&&!jm(A)?_.removeAttribute(b):_.setAttribute(b,j?"":A)}}function Nv(_,b,A,D,R,j,oe){if(b==="innerHTML"||b==="textContent"){D&&oe(D,R,j),_[b]=A==null?"":A;return}if(b==="value"&&_.tagName!=="PROGRESS"&&!_.tagName.includes("-")){_._value=A;const s=A==null?"":A;(_.value!==s||_.tagName==="OPTION")&&(_.value=s),A==null&&_.removeAttribute(b);return}if(A===""||A==null){const s=typeof _[b];if(s==="boolean"){_[b]=jm(A);return}else if(A==null&&s==="string"){_[b]="",_.removeAttribute(b);return}else if(s==="number"){try{_[b]=0}catch{}_.removeAttribute(b);return}}try{_[b]=A}catch{}}let _h=Date.now,og=!1;if(typeof window!="undefined"){_h()>document.createEvent("Event").timeStamp&&(_h=()=>performance.now());const _=navigator.userAgent.match(/firefox\/(\d+)/i);og=!!(_&&Number(_[1])<=53)}let Dp=0;const jv=Promise.resolve(),Gv=()=>{Dp=0},$v=()=>Dp||(jv.then(Gv),Dp=_h());function Zv(_,b,A,D){_.addEventListener(b,A,D)}function qv(_,b,A,D){_.removeEventListener(b,A,D)}function Wv(_,b,A,D,R=null){const j=_._vei||(_._vei={}),oe=j[b];if(D&&oe)oe.value=D;else{const[s,pe]=Xv(b);if(D){const Ie=j[b]=Hv(D,R);Zv(_,s,Ie,pe)}else oe&&(qv(_,s,oe,pe),j[b]=void 0)}}const sg=/(?:Once|Passive|Capture)$/;function Xv(_){let b;if(sg.test(_)){b={};let A;for(;A=_.match(sg);)_=_.slice(0,_.length-A[0].length),b[A[0].toLowerCase()]=!0}return[ll(_.slice(2)),b]}function Hv(_,b){const A=D=>{const R=D.timeStamp||_h();(og||R>=A.attached-1)&&yn(Kv(D,A.value),b,5,[D])};return A.value=_,A.attached=$v(),A}function Kv(_,b){if(Ut(b)){const A=_.stopImmediatePropagation;return _.stopImmediatePropagation=()=>{A.call(_),_._stopped=!0},b.map(D=>R=>!R._stopped&&D&&D(R))}else return b}const ag=/^on[a-z]/,Yv=(_,b,A,D,R=!1,j,oe,s,pe)=>{b==="class"?Fv(_,D,R):b==="style"?Ov(_,A,D):Xu(b)?$d(b)||Wv(_,b,A,D,oe):(b[0]==="."?(b=b.slice(1),!0):b[0]==="^"?(b=b.slice(1),!1):Jv(_,b,D,R))?Nv(_,b,D,j,oe,s,pe):(b==="true-value"?_._trueValue=D:b==="false-value"&&(_._falseValue=D),Vv(_,b,D,R))};function Jv(_,b,A,D){return D?!!(b==="innerHTML"||b==="textContent"||b in _&&ag.test(b)&&qt(A)):b==="spellcheck"||b==="draggable"||b==="form"||b==="list"&&_.tagName==="INPUT"||b==="type"&&_.tagName==="TEXTAREA"||ag.test(b)&&xr(A)?!1:b in _}const Qv={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};G0.props;const e1=yr({patchProp:Yv},Rv);let lg;function t1(){return lg||(lg=dv(e1))}const a1=(..._)=>{const b=t1().createApp(..._),{mount:A}=b;return b.mount=D=>{const R=i1(D);if(!R)return;const j=b._component;!qt(j)&&!j.render&&!j.template&&(j.template=R.innerHTML),R.innerHTML="";const oe=A(R,!1,R instanceof SVGElement);return R instanceof Element&&(R.removeAttribute("v-cloak"),R.setAttribute("data-v-app","")),oe},b};function i1(_){return xr(_)?document.querySelector(_):_}var r1=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},cg={exports:{}};(function(_,b){(function(A,D){_.exports=D()})(r1,function(){var A,D,R;function j(s,pe){if(!A)A=pe;else if(!D)D=pe;else{var Ie="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+A+")(sharedChunk); ("+D+")(sharedChunk); self.onerror = null;",Ue={};A(Ue),R=pe(Ue),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(R.workerUrl=window.URL.createObjectURL(new Blob([Ie],{type:"text/javascript"})))}}j(["exports"],function(s){var pe="2.7.0",Ie=Ue;function Ue(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=r,this.p2y=n}Ue.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},Ue.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},Ue.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},Ue.prototype.solveCurveX=function(t,e){var r,n,a,l,h;for(e===void 0&&(e=1e-6),a=t,h=0;h<8;h++){if(l=this.sampleCurveX(a)-t,Math.abs(l)<e)return a;var p=this.sampleCurveDerivativeX(a);if(Math.abs(p)<1e-6)break;a-=l/p}if((a=t)<(r=0))return r;if(a>(n=1))return n;for(;r<n;){if(l=this.sampleCurveX(a),Math.abs(l-t)<e)return a;t>l?r=a:n=a,a=.5*(n-r)+r}return a},Ue.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var _e=Le;function Le(t,e){this.x=t,this.y=e}Le.prototype={clone:function(){return new Le(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),a=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-n*(this.y-e.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Le.convert=function(t){return t instanceof Le?t:Array.isArray(t)?new Le(t[0],t[1]):t};var fe=typeof self!="undefined"?self:{},wt=1e-6,dt=typeof Float32Array!="undefined"?Float32Array:Array;function xt(){var t=new dt(9);return dt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function yt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ui(t,e,r){var n=e[0],a=e[1],l=e[2],h=e[3],p=e[4],m=e[5],y=e[6],v=e[7],w=e[8],T=e[9],C=e[10],P=e[11],B=e[12],O=e[13],Z=e[14],Y=e[15],ie=r[0],se=r[1],ae=r[2],le=r[3];return t[0]=ie*n+se*p+ae*w+le*B,t[1]=ie*a+se*m+ae*T+le*O,t[2]=ie*l+se*y+ae*C+le*Z,t[3]=ie*h+se*v+ae*P+le*Y,t[4]=(ie=r[4])*n+(se=r[5])*p+(ae=r[6])*w+(le=r[7])*B,t[5]=ie*a+se*m+ae*T+le*O,t[6]=ie*l+se*y+ae*C+le*Z,t[7]=ie*h+se*v+ae*P+le*Y,t[8]=(ie=r[8])*n+(se=r[9])*p+(ae=r[10])*w+(le=r[11])*B,t[9]=ie*a+se*m+ae*T+le*O,t[10]=ie*l+se*y+ae*C+le*Z,t[11]=ie*h+se*v+ae*P+le*Y,t[12]=(ie=r[12])*n+(se=r[13])*p+(ae=r[14])*w+(le=r[15])*B,t[13]=ie*a+se*m+ae*T+le*O,t[14]=ie*l+se*y+ae*C+le*Z,t[15]=ie*h+se*v+ae*P+le*Y,t}function ai(t,e,r){var n,a,l,h,p,m,y,v,w,T,C,P,B=r[0],O=r[1],Z=r[2];return e===t?(t[12]=e[0]*B+e[4]*O+e[8]*Z+e[12],t[13]=e[1]*B+e[5]*O+e[9]*Z+e[13],t[14]=e[2]*B+e[6]*O+e[10]*Z+e[14],t[15]=e[3]*B+e[7]*O+e[11]*Z+e[15]):(a=e[1],l=e[2],h=e[3],p=e[4],m=e[5],y=e[6],v=e[7],w=e[8],T=e[9],C=e[10],P=e[11],t[0]=n=e[0],t[1]=a,t[2]=l,t[3]=h,t[4]=p,t[5]=m,t[6]=y,t[7]=v,t[8]=w,t[9]=T,t[10]=C,t[11]=P,t[12]=n*B+p*O+w*Z+e[12],t[13]=a*B+m*O+T*Z+e[13],t[14]=l*B+y*O+C*Z+e[14],t[15]=h*B+v*O+P*Z+e[15]),t}function Wt(t,e,r){var n=r[0],a=r[1],l=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*l,t[9]=e[9]*l,t[10]=e[10]*l,t[11]=e[11]*l,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Di(t,e,r){var n=Math.sin(r),a=Math.cos(r),l=e[4],h=e[5],p=e[6],m=e[7],y=e[8],v=e[9],w=e[10],T=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=l*a+y*n,t[5]=h*a+v*n,t[6]=p*a+w*n,t[7]=m*a+T*n,t[8]=y*a-l*n,t[9]=v*a-h*n,t[10]=w*a-p*n,t[11]=T*a-m*n,t}function Vi(t,e,r){var n=Math.sin(r),a=Math.cos(r),l=e[0],h=e[1],p=e[2],m=e[3],y=e[8],v=e[9],w=e[10],T=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*a-y*n,t[1]=h*a-v*n,t[2]=p*a-w*n,t[3]=m*a-T*n,t[8]=l*n+y*a,t[9]=h*n+v*a,t[10]=p*n+w*a,t[11]=m*n+T*a,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Vt=Ui;function bi(){var t=new dt(3);return dt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function li(t){var e=new dt(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function tr(t){return Math.hypot(t[0],t[1],t[2])}function wi(t,e,r){var n=new dt(3);return n[0]=t,n[1]=e,n[2]=r,n}function Ki(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function br(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function vn(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function lo(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function mi(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function Nt(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function Ht(t,e){var r=e[0],n=e[1],a=e[2],l=r*r+n*n+a*a;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t[2]=e[2]*l,t}function Li(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function nn(t,e,r){var n=e[0],a=e[1],l=e[2],h=r[0],p=r[1],m=r[2];return t[0]=a*m-l*p,t[1]=l*h-n*m,t[2]=n*p-a*h,t}function vt(t,e,r){var n=e[0],a=e[1],l=e[2],h=r[3]*n+r[7]*a+r[11]*l+r[15];return t[0]=(r[0]*n+r[4]*a+r[8]*l+r[12])/(h=h||1),t[1]=(r[1]*n+r[5]*a+r[9]*l+r[13])/h,t[2]=(r[2]*n+r[6]*a+r[10]*l+r[14])/h,t}function Gr(t,e,r){var n=r[0],a=r[1],l=r[2],h=e[0],p=e[1],m=e[2],y=a*m-l*p,v=l*h-n*m,w=n*p-a*h,T=a*w-l*v,C=l*y-n*w,P=n*v-a*y,B=2*r[3];return v*=B,w*=B,C*=2,P*=2,t[0]=h+(y*=B)+(T*=2),t[1]=p+v+C,t[2]=m+w+P,t}var ir,on=br,ds=vn,Bn=tr;function Bi(t,e,r){var n=e[0],a=e[1],l=e[2],h=e[3];return t[0]=r[0]*n+r[4]*a+r[8]*l+r[12]*h,t[1]=r[1]*n+r[5]*a+r[9]*l+r[13]*h,t[2]=r[2]*n+r[6]*a+r[10]*l+r[14]*h,t[3]=r[3]*n+r[7]*a+r[11]*l+r[15]*h,t}function sn(){var t=new dt(4);return dt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function co(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function $r(t,e,r){r*=.5;var n=e[0],a=e[1],l=e[2],h=e[3],p=Math.sin(r),m=Math.cos(r);return t[0]=n*m+h*p,t[1]=a*m+l*p,t[2]=l*m-a*p,t[3]=h*m-n*p,t}function bn(t,e){return t[0]===e[0]&&t[1]===e[1]}bi(),ir=new dt(4),dt!=Float32Array&&(ir[0]=0,ir[1]=0,ir[2]=0,ir[3]=0),bi(),wi(1,0,0),wi(0,1,0),sn(),sn(),xt(),function(){var t;t=new dt(2),dt!=Float32Array&&(t[0]=0,t[1]=0)}();const Rn=Math.PI/180,ee=180/Math.PI;function re(t){return t*Rn}function ye(t){return t*ee}const Re=[[0,0],[1,0],[1,1],[0,1]];function Fe(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}function qe(t,e,r,n){const a=new Ie(t,e,r,n);return function(l){return a.solve(l)}}const Qe=qe(.25,.1,.25,1);function ze(t,e,r){return Math.min(r,Math.max(e,t))}function We(t,e,r){return(r=ze((r-t)/(e-t),0,1))*r*(3-2*r)}function Ne(t,e,r){const n=r-e,a=((t-e)%n+n)%n+e;return a===e?r:a}function at(t,e,r){if(!t.length)return r(null,[]);let n=t.length;const a=new Array(t.length);let l=null;t.forEach((h,p)=>{e(h,(m,y)=>{m&&(l=m),a[p]=y,--n==0&&r(l,a)})})}function nt(t){const e=[];for(const r in t)e.push(t[r]);return e}function Je(t,...e){for(const r of e)for(const n in r)t[n]=r[n];return t}let ft=1;function Ct(){return ft++}function Yt(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Mt(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Jt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Ni(t,e){t.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function wr(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Zr(t,e,r){const n={};for(const a in t)n[a]=e.call(r||this,t[a],a,t);return n}function kr(t,e,r){const n={};for(const a in t)e.call(r||this,t[a],a,t)&&(n[a]=t[a]);return n}function or(t){return Array.isArray(t)?t.map(or):typeof t=="object"&&t?Zr(t,or):t}const ji={};function jt(t){ji[t]||(typeof console!="undefined"&&console.warn(t),ji[t]=!0)}function sr(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function Ao(t){let e=0;for(let r,n,a=0,l=t.length,h=l-1;a<l;h=a++)r=t[a],n=t[h],e+=(n.x-r.x)*(r.y+n.y);return e}function an(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Co(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,n,a,l)=>{const h=a||l;return e[n]=!h||h.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let uo,wn,qr,Fn=null;function ln(t){if(Fn==null){const e=t.navigator?t.navigator.userAgent:null;Fn=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Fn}function zo(t){try{const e=fe[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}const Tr={now:()=>qr!==void 0?qr:fe.performance.now(),setNow(t){qr=t},restoreNow(){qr=void 0},frame(t){const e=fe.requestAnimationFrame(t);return{cancel:()=>fe.cancelAnimationFrame(e)}},getImageData(t,e=0){const r=fe.document.createElement("canvas"),n=r.getContext("2d");if(!n)throw new Error("failed to create canvas 2d context");return r.width=t.width,r.height=t.height,n.drawImage(t,0,0,t.width,t.height),n.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:t=>(uo||(uo=fe.document.createElement("a")),uo.href=t,uo.href),get devicePixelRatio(){return fe.devicePixelRatio},get prefersReducedMotion(){return!!fe.matchMedia&&(wn==null&&(wn=fe.matchMedia("(prefers-reduced-motion: reduce)")),wn.matches)}};let $;const M={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if($==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{$={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):t}catch{$=t}}return $},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},k={supported:!1,testSupport:function(t){!te&&q&&(ce?ue(t):G=t)}};let G,q,te=!1,ce=!1;function ue(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,q),t.isContextLost())return;k.supported=!0}catch{}t.deleteTexture(e),te=!0}fe.document&&(q=fe.document.createElement("img"),q.onload=function(){G&&ue(G),G=null,ce=!0},q.onerror=function(){te=!0,G=null},q.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ne="01",de="NO_ACCESS_TOKEN";function Ee(t){return t.indexOf("mapbox:")===0}function Me(t){return M.API_URL_REGEX.test(t)}const ke=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function it(t){const e=t.match(ke);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function lt(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function ct(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(fe.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ht{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=ct(M.ACCESS_TOKEN);let n="";return n=r&&r.u?fe.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(a,l)=>String.fromCharCode(Number("0x"+l)))):M.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const e=zo("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const a=fe.localStorage.getItem(r);a&&(this.eventData=JSON.parse(a));const l=fe.localStorage.getItem(n);l&&(this.anonId=l)}catch{jt("Unable to read from LocalStorage")}}saveEventData(){const e=zo("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{fe.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&fe.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{jt("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,n,a){if(!M.EVENTS_URL)return;const l=it(M.EVENTS_URL);l.params.push(`access_token=${a||M.ACCESS_TOKEN||""}`);const h={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:pe,skuId:ne,userId:this.anonId},p=r?Je(h,r):h,m={url:lt(l),headers:{"Content-Type":"text/plain"},body:JSON.stringify([p])};this.pendingRequest=un(m,y=>{this.pendingRequest=null,n(y),this.saveEventData(),this.processRequests(a)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const St=new class extends ht{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){M.EVENTS_URL&&M.ACCESS_TOKEN&&Array.isArray(t)&&t.some(r=>Ee(r)||Me(r))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=ct(M.ACCESS_TOKEN),r=e?e.u:M.ACCESS_TOKEN;let n=r!==this.eventData.tokenU;Jt(this.anonId)||(this.anonId=Yt(),n=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const l=new Date(this.eventData.lastSuccess),h=new Date(a),p=(a-this.eventData.lastSuccess)/864e5;n=n||p>=1||p<-1||l.getDate()!==h.getDate()}else n=!0;if(!n)return this.processRequests();this.postEvent(a,{"enabled.telemetry":!1},l=>{l||(this.eventData.lastSuccess=a,this.eventData.tokenU=r)},t)}},si=St.postTurnstileEvent.bind(St),hi=new class extends ht{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,r,n){this.skuToken=e,this.errorCb=n,M.EVENTS_URL&&(r||M.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(de)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Jt(this.anonId)||(this.anonId=Yt()),this.postEvent(r,{skuToken:this.skuToken},n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},t))}},ii=hi.postMapLoadEvent.bind(hi),di=new class extends ht{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,r,n){if(!M.API_URL||!M.SESSION_PATH)return;const a=it(M.API_URL+M.SESSION_PATH);a.params.push(`sku=${e||""}`),a.params.push(`access_token=${n||M.ACCESS_TOKEN||""}`);const l={url:lt(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=gh(l,h=>{this.pendingRequest=null,r(h),this.saveEventData(),this.processRequests(n)})}getSessionAPI(t,e,r,n){this.skuToken=e,this.errorCb=n,M.SESSION_PATH&&M.API_URL&&(r||M.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(de)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},t)}},On=di.getSessionAPI.bind(di),Tn=new Set,Yi="mapbox-tiles";let cn,na,Sc=500,gl=50;function ps(){fe.caches&&!cn&&(cn=fe.caches.open(Yi))}function yl(t){const e=t.indexOf("?");return e<0?t:t.slice(0,e)}let oa=1/0;const sa={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(sa);class fs extends Error{constructor(e,r,n){r===401&&Me(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const xl=an()?()=>self.worker&&self.worker.referrer:()=>(fe.location.protocol==="blob:"?fe.parent:fe).location.href,Wr=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(xl())&&!/^\w+:/.test(r))){if(fe.fetch&&fe.Request&&fe.AbortController&&fe.Request.prototype.hasOwnProperty("signal"))return function(n,a){const l=new fe.AbortController,h=new fe.Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:xl(),signal:l.signal});let p=!1,m=!1;const y=(v=h.url).indexOf("sku=")>0&&Me(v);var v;n.type==="json"&&h.headers.set("Accept","application/json");const w=(C,P,B)=>{if(m)return;if(C&&C.message!=="SecurityError"&&jt(C),P&&B)return T(P);const O=Date.now();fe.fetch(h).then(Z=>{if(Z.ok){const Y=y?Z.clone():null;return T(Z,Y,O)}return a(new fs(Z.statusText,Z.status,n.url))}).catch(Z=>{Z.code!==20&&a(new Error(Z.message))})},T=(C,P,B)=>{(n.type==="arrayBuffer"?C.arrayBuffer():n.type==="json"?C.json():C.text()).then(O=>{m||(P&&B&&function(Z,Y,ie){if(ps(),!cn)return;const se={status:Y.status,statusText:Y.statusText,headers:new fe.Headers};Y.headers.forEach((le,Te)=>se.headers.set(Te,le));const ae=Co(Y.headers.get("Cache-Control")||"");ae["no-store"]||(ae["max-age"]&&se.headers.set("Expires",new Date(ie+1e3*ae["max-age"]).toUTCString()),new Date(se.headers.get("Expires")).getTime()-ie<42e4||function(le,Te){if(na===void 0)try{new Response(new ReadableStream),na=!0}catch{na=!1}na?Te(le.body):le.blob().then(Te)}(Y,le=>{const Te=new fe.Response(le,se);ps(),cn&&cn.then(be=>be.put(yl(Z.url),Te)).catch(be=>jt(be.message))}))}(h,P,B),p=!0,a(null,O,C.headers.get("Cache-Control"),C.headers.get("Expires")))}).catch(O=>{m||a(new Error(O.message))})};return y?function(C,P){if(ps(),!cn)return P(null);const B=yl(C.url);cn.then(O=>{O.match(B).then(Z=>{const Y=function(ie){if(!ie)return!1;const se=new Date(ie.headers.get("Expires")||0),ae=Co(ie.headers.get("Cache-Control")||"");return se>Date.now()&&!ae["no-cache"]}(Z);O.delete(B),Y&&O.put(B,Z.clone()),P(null,Z,Y)}).catch(P)}).catch(P)}(h,w):w(null,null),{cancel:()=>{m=!0,p||l.abort()}}}(t,e);if(an()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(n,a){const l=new fe.XMLHttpRequest;l.open(n.method||"GET",n.url,!0),n.type==="arrayBuffer"&&(l.responseType="arraybuffer");for(const h in n.headers)l.setRequestHeader(h,n.headers[h]);return n.type==="json"&&(l.responseType="text",l.setRequestHeader("Accept","application/json")),l.withCredentials=n.credentials==="include",l.onerror=()=>{a(new Error(l.statusText))},l.onload=()=>{if((l.status>=200&&l.status<300||l.status===0)&&l.response!==null){let h=l.response;if(n.type==="json")try{h=JSON.parse(l.response)}catch(p){return a(p)}a(null,h,l.getResponseHeader("Cache-Control"),l.getResponseHeader("Expires"))}else a(new fs(l.statusText,l.status,n.url))},l.send(n.body),{cancel:()=>l.abort()}}(t,e)},ms=function(t,e){return Wr(Je(t,{type:"arrayBuffer"}),e)},un=function(t,e){return Wr(Je(t,{method:"POST"}),e)},gh=function(t,e){return Wr(Je(t,{method:"GET"}),e)};function Ic(t){const e=fe.document.createElement("a");return e.href=t,e.protocol===fe.document.location.protocol&&e.host===fe.document.location.host}const Po="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ko,_s;ko=[],_s=0;const Mc=function(t,e){if(k.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),_s>=M.MAX_PARALLEL_IMAGE_REQUESTS){const l={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ko.push(l),l}_s++;let r=!1;const n=()=>{if(!r)for(r=!0,_s--;ko.length&&_s<M.MAX_PARALLEL_IMAGE_REQUESTS;){const l=ko.shift(),{requestParameters:h,callback:p,cancelled:m}=l;m||(l.cancel=Mc(h,p).cancel)}},a=ms(t,(l,h,p,m)=>{n(),l?e(l):h&&(fe.createImageBitmap?function(y,v){const w=new fe.Blob([new Uint8Array(y)],{type:"image/png"});fe.createImageBitmap(w).then(T=>{v(null,T)}).catch(T=>{v(new Error(`Could not load image because of ${T.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(h,(y,v)=>e(y,v,p,m)):function(y,v){const w=new fe.Image,T=fe.URL;w.onload=()=>{v(null,w),T.revokeObjectURL(w.src),w.onload=null,fe.requestAnimationFrame(()=>{w.src=Po})},w.onerror=()=>v(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const C=new fe.Blob([new Uint8Array(y)],{type:"image/png"});w.src=y.byteLength?T.createObjectURL(C):Po}(h,(y,v)=>e(y,v,p,m)))});return{cancel:()=>{a.cancel(),n()}}};function Ac(t,e,r){r[t]&&r[t].indexOf(e)!==-1||(r[t]=r[t]||[],r[t].push(e))}function aa(t,e,r){if(r&&r[t]){const n=r[t].indexOf(e);n!==-1&&r[t].splice(n,1)}}class Un{constructor(e,r={}){Je(this,r),this.type=e}}class la extends Un{constructor(e,r={}){super("error",Je({error:e},r))}}class Vn{on(e,r){return this._listeners=this._listeners||{},Ac(e,r,this._listeners),this}off(e,r){return aa(e,r,this._listeners),aa(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Ac(e,r,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,r){typeof e=="string"&&(e=new Un(e,r||{}));const n=e.type;if(this.listens(n)){e.target=this;const a=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const p of a)p.call(this,e);const l=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const p of l)aa(n,p,this._oneTimeListeners),p.call(this,e);const h=this._eventedParent;h&&(Je(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),h.fire(e))}else e instanceof la&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var xe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class He{constructor(e,r,n,a){this.message=(e?`${e}: `:"")+n,a&&(this.identifier=a),r!=null&&r.__line__&&(this.line=r.__line__)}}function Cc(t){const e=t.value;return e?[new He(t.key,e,"constants have been deprecated as of v8")]:[]}function Nn(t,...e){for(const r of e)for(const n in r)t[n]=r[n];return t}function Si(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function En(t){if(Array.isArray(t))return t.map(En);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const r in t)e[r]=En(t[r]);return e}return Si(t)}class hn extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class ca{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[n,a]of r)this.bindings[n]=a}concat(e){return new ca(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const jn={kind:"null"},Xe={kind:"number"},zt={kind:"string"},Tt={kind:"boolean"},dn={kind:"color"},Do={kind:"object"},Et={kind:"value"},gs={kind:"collator"},Gn={kind:"formatted"},ys={kind:"resolvedImage"};function Dr(t,e){return{kind:"array",itemType:t,N:e}}function yi(t){if(t.kind==="array"){const e=yi(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const yh=[jn,Xe,zt,Tt,dn,Gn,Do,Dr(Et),ys];function dr(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!dr(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const r of yh)if(!dr(r,e))return null}}return`Expected ${yi(t)} but found ${yi(e)} instead.`}function ua(t,e){return e.some(r=>r.kind===t.kind)}function Lo(t,e){return e.some(r=>r==="null"?t===null:r==="array"?Array.isArray(t):r==="object"?t&&!Array.isArray(t)&&typeof t=="object":r===typeof t)}function Bo(t){var e={exports:{}};return t(e,e.exports),e.exports}var Ro=Bo(function(t,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(p){return(p=Math.round(p))<0?0:p>255?255:p}function a(p){return n(p[p.length-1]==="%"?parseFloat(p)/100*255:parseInt(p))}function l(p){return(m=p[p.length-1]==="%"?parseFloat(p)/100:parseFloat(p))<0?0:m>1?1:m;var m}function h(p,m,y){return y<0?y+=1:y>1&&(y-=1),6*y<1?p+(m-p)*y*6:2*y<1?m:3*y<2?p+(m-p)*(2/3-y)*6:p}try{e.parseCSSColor=function(p){var m,y=p.replace(/ /g,"").toLowerCase();if(y in r)return r[y].slice();if(y[0]==="#")return y.length===4?(m=parseInt(y.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:y.length===7&&(m=parseInt(y.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var v=y.indexOf("("),w=y.indexOf(")");if(v!==-1&&w+1===y.length){var T=y.substr(0,v),C=y.substr(v+1,w-(v+1)).split(","),P=1;switch(T){case"rgba":if(C.length!==4)return null;P=l(C.pop());case"rgb":return C.length!==3?null:[a(C[0]),a(C[1]),a(C[2]),P];case"hsla":if(C.length!==4)return null;P=l(C.pop());case"hsl":if(C.length!==3)return null;var B=(parseFloat(C[0])%360+360)%360/360,O=l(C[1]),Z=l(C[2]),Y=Z<=.5?Z*(O+1):Z+O-Z*O,ie=2*Z-Y;return[n(255*h(ie,Y,B+1/3)),n(255*h(ie,Y,B)),n(255*h(ie,Y,B-1/3)),P];default:return null}}return null}}catch{}});class Ft{constructor(e,r,n,a=1){this.r=e,this.g=r,this.b=n,this.a=a}static parse(e){if(!e)return;if(e instanceof Ft)return e;if(typeof e!="string")return;const r=Ro.parseCSSColor(e);return r?new Ft(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,n,a]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(n)},${a})`}toArray(){const{r:e,g:r,b:n,a}=this;return a===0?[0,0,0,0]:[255*e/a,255*r/a,255*n/a,a]}}Ft.black=new Ft(0,0,0,1),Ft.white=new Ft(1,1,1,1),Ft.transparent=new Ft(0,0,0,0),Ft.red=new Ft(1,0,0,1),Ft.blue=new Ft(0,0,1,1);class ha{constructor(e,r,n){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class vl{constructor(e,r,n,a,l){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=n,this.fontStack=a,this.textColor=l}}class gt{constructor(e){this.sections=e}static fromString(e){return new gt([new vl(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof gt?e:gt.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const n={};r.fontStack&&(n["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(n["font-scale"]=r.scale),r.textColor&&(n["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(n)}return e}}class Lr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Lr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function zc(t,e,r,n){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[t,e,r,n]:[t,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function da(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Ft||t instanceof ha||t instanceof gt||t instanceof Lr)return!0;if(Array.isArray(t)){for(const e of t)if(!da(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!da(t[e]))return!1;return!0}return!1}function Mi(t){if(t===null)return jn;if(typeof t=="string")return zt;if(typeof t=="boolean")return Tt;if(typeof t=="number")return Xe;if(t instanceof Ft)return dn;if(t instanceof ha)return gs;if(t instanceof gt)return Gn;if(t instanceof Lr)return ys;if(Array.isArray(t)){const e=t.length;let r;for(const n of t){const a=Mi(n);if(r){if(r===a)continue;r=Et;break}r=a}return Dr(r||Et,e)}return Do}function xs(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Ft||t instanceof gt||t instanceof Lr?t.toString():JSON.stringify(t)}class $n{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!da(e[1]))return r.error("invalid value");const n=e[1];let a=Mi(n);const l=r.expectedType;return a.kind!=="array"||a.N!==0||!l||l.kind!=="array"||typeof l.N=="number"&&l.N!==0||(a=l),new $n(a,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ft?["rgba"].concat(this.value.toArray()):this.value instanceof gt?this.value.serialize():this.value}}class Gi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const pa={string:zt,number:Xe,boolean:Tt,object:Do};class Br{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let n,a=1;const l=e[0];if(l==="array"){let p,m;if(e.length>2){const y=e[1];if(typeof y!="string"||!(y in pa)||y==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);p=pa[y],a++}else p=Et;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);m=e[2],a++}n=Dr(p,m)}else n=pa[l];const h=[];for(;a<e.length;a++){const p=r.parse(e[a],a,Et);if(!p)return null;h.push(p)}return new Br(n,h)}evaluate(e){for(let r=0;r<this.args.length;r++){const n=this.args[r].evaluate(e);if(!dr(this.type,Mi(n)))return n;if(r===this.args.length-1)throw new Gi(`Expected value to be of type ${yi(this.type)}, but found ${yi(Mi(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const n=e.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){r.push(n.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&r.push(a)}}return r.concat(this.args.map(n=>n.serialize()))}}class pn{constructor(e){this.type=Gn,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return r.error("First argument must be an image or text section.");const a=[];let l=!1;for(let h=1;h<=e.length-1;++h){const p=e[h];if(l&&typeof p=="object"&&!Array.isArray(p)){l=!1;let m=null;if(p["font-scale"]&&(m=r.parse(p["font-scale"],1,Xe),!m))return null;let y=null;if(p["text-font"]&&(y=r.parse(p["text-font"],1,Dr(zt)),!y))return null;let v=null;if(p["text-color"]&&(v=r.parse(p["text-color"],1,dn),!v))return null;const w=a[a.length-1];w.scale=m,w.font=y,w.textColor=v}else{const m=r.parse(e[h],1,Et);if(!m)return null;const y=m.type.kind;if(y!=="string"&&y!=="value"&&y!=="null"&&y!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,a.push({content:m,scale:null,font:null,textColor:null})}}return new pn(a)}evaluate(e){return new gt(this.sections.map(r=>{const n=r.content.evaluate(e);return Mi(n)===ys?new vl("",n,null,null,null):new vl(xs(n),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const n={};r.scale&&(n["font-scale"]=r.scale.serialize()),r.font&&(n["text-font"]=r.font.serialize()),r.textColor&&(n["text-color"]=r.textColor.serialize()),e.push(n)}return e}}class ho{constructor(e){this.type=ys,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const n=r.parse(e[1],1,zt);return n?new ho(n):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),n=Lr.fromString(r);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(r)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const xh={"to-boolean":Tt,"to-color":dn,"to-number":Xe,"to-string":zt};class fn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const n=e[0];if((n==="to-boolean"||n==="to-string")&&e.length!==2)return r.error("Expected one argument.");const a=xh[n],l=[];for(let h=1;h<e.length;h++){const p=r.parse(e[h],h,Et);if(!p)return null;l.push(p)}return new fn(a,l)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let r,n;for(const a of this.args){if(r=a.evaluate(e),n=null,r instanceof Ft)return r;if(typeof r=="string"){const l=e.parseColor(r);if(l)return l}else if(Array.isArray(r)&&(n=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:zc(r[0],r[1],r[2],r[3]),!n))return new Ft(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Gi(n||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const n of this.args){if(r=n.evaluate(e),r===null)return 0;const a=Number(r);if(!isNaN(a))return a}throw new Gi(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?gt.fromString(xs(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Lr.fromString(xs(this.args[0].evaluate(e))):xs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new pn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ho(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Pc=["Unknown","Point","LineString","Polygon"];class kc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Pc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:n,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*r-e[0])+this.featureDistanceData.bearing[1]*(a*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=Ft.parse(e)),r}}class Er{constructor(e,r,n,a){this.name=e,this.type=r,this._evaluate=n,this.args=a}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const n=e[0],a=Er.definitions[n];if(!a)return r.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const l=Array.isArray(a)?a[0]:a.type,h=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,p=h.filter(([y])=>!Array.isArray(y)||y.length===e.length-1);let m=null;for(const[y,v]of p){m=new _a(r.registry,r.path,null,r.scope);const w=[];let T=!1;for(let C=1;C<e.length;C++){const P=e[C],B=Array.isArray(y)?y[C-1]:y.type,O=m.parse(P,1+w.length,B);if(!O){T=!0;break}w.push(O)}if(!T)if(Array.isArray(y)&&y.length!==w.length)m.error(`Expected ${y.length} arguments, but found ${w.length} instead.`);else{for(let C=0;C<w.length;C++){const P=Array.isArray(y)?y[C]:y.type,B=w[C];m.concat(C+1).checkSubtype(P,B.type)}if(m.errors.length===0)return new Er(n,l,v,w)}}if(p.length===1)r.errors.push(...m.errors);else{const y=(p.length?p:h).map(([w])=>{return T=w,Array.isArray(T)?`(${T.map(yi).join(", ")})`:`(${yi(T.type)}...)`;var T}).join(" | "),v=[];for(let w=1;w<e.length;w++){const T=r.parse(e[w],1+v.length);if(!T)return null;v.push(yi(T.type))}r.error(`Expected arguments of type ${y}, but found (${v.join(", ")}) instead.`)}return null}static register(e,r){Er.definitions=r;for(const n in r)e[n]=Er}}class vs{constructor(e,r,n){this.type=gs,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return r.error("Collator options argument must be an object.");const a=r.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,Tt);if(!a)return null;const l=r.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,Tt);if(!l)return null;let h=null;return n.locale&&(h=r.parse(n.locale,1,zt),!h)?null:new vs(a,l,h)}evaluate(e){return new ha(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Zn=8192;function fa(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function bs(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Dc(t,e){const r=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(r*a*Zn),Math.round(n*a*Zn)]}function Lc(t,e,r){const n=t[0]-e[0],a=t[1]-e[1],l=t[0]-r[0],h=t[1]-r[1];return n*h-l*a==0&&n*l<=0&&a*h<=0}function bl(t,e){let r=!1;for(let h=0,p=e.length;h<p;h++){const m=e[h];for(let y=0,v=m.length;y<v-1;y++){if(Lc(t,m[y],m[y+1]))return!1;(a=m[y])[1]>(n=t)[1]!=(l=m[y+1])[1]>n[1]&&n[0]<(l[0]-a[0])*(n[1]-a[1])/(l[1]-a[1])+a[0]&&(r=!r)}}var n,a,l;return r}function Bc(t,e){for(let r=0;r<e.length;r++)if(bl(t,e[r]))return!0;return!1}function wl(t,e,r,n){const a=n[0]-r[0],l=n[1]-r[1],h=(t[0]-r[0])*l-a*(t[1]-r[1]),p=(e[0]-r[0])*l-a*(e[1]-r[1]);return h>0&&p<0||h<0&&p>0}function vh(t,e,r){for(const y of r)for(let v=0;v<y.length-1;++v)if((p=[(h=y[v+1])[0]-(l=y[v])[0],h[1]-l[1]])[0]*(m=[(a=e)[0]-(n=t)[0],a[1]-n[1]])[1]-p[1]*m[0]!=0&&wl(n,a,l,h)&&wl(l,h,n,a))return!0;var n,a,l,h,p,m;return!1}function Rc(t,e){for(let r=0;r<t.length;++r)if(!bl(t[r],e))return!1;for(let r=0;r<t.length-1;++r)if(vh(t[r],t[r+1],e))return!1;return!0}function bh(t,e){for(let r=0;r<e.length;r++)if(Rc(t,e[r]))return!0;return!1}function Tl(t,e,r){const n=[];for(let a=0;a<t.length;a++){const l=[];for(let h=0;h<t[a].length;h++){const p=Dc(t[a][h],r);fa(e,p),l.push(p)}n.push(l)}return n}function Fc(t,e,r){const n=[];for(let a=0;a<t.length;a++){const l=Tl(t[a],e,r);n.push(l)}return n}function El(t,e,r,n){if(t[0]<r[0]||t[0]>r[2]){const a=.5*n;let l=t[0]-r[0]>a?-n:r[0]-t[0]>a?n:0;l===0&&(l=t[0]-r[2]>a?-n:r[2]-t[0]>a?n:0),t[0]+=l}fa(e,t)}function Oc(t,e,r,n){const a=Math.pow(2,n.z)*Zn,l=[n.x*Zn,n.y*Zn],h=[];for(const p of t)for(const m of p){const y=[m.x+l[0],m.y+l[1]];El(y,e,r,a),h.push(y)}return h}function Uc(t,e,r,n){const a=Math.pow(2,n.z)*Zn,l=[n.x*Zn,n.y*Zn],h=[];for(const m of t){const y=[];for(const v of m){const w=[v.x+l[0],v.y+l[1]];fa(e,w),y.push(w)}h.push(y)}if(e[2]-e[0]<=a/2){(p=e)[0]=p[1]=1/0,p[2]=p[3]=-1/0;for(const m of h)for(const y of m)El(y,e,r,a)}var p;return h}class po{constructor(e,r){this.type=Tt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(da(e[1])){const n=e[1];if(n.type==="FeatureCollection")for(let a=0;a<n.features.length;++a){const l=n.features[a].geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new po(n,n.features[a].geometry)}else if(n.type==="Feature"){const a=n.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new po(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new po(n,n)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,n){const a=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],h=r.canonicalID();if(n.type==="Polygon"){const p=Tl(n.coordinates,l,h),m=Oc(r.geometry(),a,l,h);if(!bs(a,l))return!1;for(const y of m)if(!bl(y,p))return!1}if(n.type==="MultiPolygon"){const p=Fc(n.coordinates,l,h),m=Oc(r.geometry(),a,l,h);if(!bs(a,l))return!1;for(const y of m)if(!Bc(y,p))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,n){const a=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],h=r.canonicalID();if(n.type==="Polygon"){const p=Tl(n.coordinates,l,h),m=Uc(r.geometry(),a,l,h);if(!bs(a,l))return!1;for(const y of m)if(!Rc(y,p))return!1}if(n.type==="MultiPolygon"){const p=Fc(n.coordinates,l,h),m=Uc(r.geometry(),a,l,h);if(!bs(a,l))return!1;for(const y of m)if(!bh(y,p))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Fo(t){if(t instanceof Er&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof po)return!1;let e=!0;return t.eachChild(r=>{e&&!Fo(r)&&(e=!1)}),e}function ws(t){if(t instanceof Er&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(r=>{e&&!ws(r)&&(e=!1)}),e}function Ts(t,e){if(t instanceof Er&&e.indexOf(t.name)>=0)return!1;let r=!0;return t.eachChild(n=>{r&&!Ts(n,e)&&(r=!1)}),r}class ma{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const n=e[1];return r.scope.has(n)?new ma(n,r.scope.get(n)):r.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class _a{constructor(e,r=[],n,a=new ca,l=[]){this.registry=e,this.path=r,this.key=r.map(h=>`[${h}]`).join(""),this.scope=a,this.errors=l,this.expectedType=n}parse(e,r,n,a,l={}){return r?this.concat(r,n,a)._parse(e,l):this._parse(e,l)}_parse(e,r){function n(a,l,h){return h==="assert"?new Br(l,[a]):h==="coerce"?new fn(l,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=e[0];if(typeof a!="string")return this.error(`Expression name must be a string, but found ${typeof a} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const l=this.registry[a];if(l){let h=l.parse(e,this);if(!h)return null;if(this.expectedType){const p=this.expectedType,m=h.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||m.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||m.kind!=="value"&&m.kind!=="string"){if(this.checkSubtype(p,m))return null}else h=n(h,p,r.typeAnnotation||"coerce");else h=n(h,p,r.typeAnnotation||"assert")}if(!(h instanceof $n)&&h.type.kind!=="resolvedImage"&&ga(h)){const p=new kc;try{h=new $n(h.type,h.evaluate(p))}catch(m){return this.error(m.message),null}}return h}return this.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,n){const a=typeof e=="number"?this.path.concat(e):this.path,l=n?this.scope.concat(n):this.scope;return new _a(this.registry,a,r||null,l,this.errors)}error(e,...r){const n=`${this.key}${r.map(a=>`[${a}]`).join("")}`;this.errors.push(new hn(n,e))}checkSubtype(e,r){const n=dr(e,r);return n&&this.error(n),n}}function ga(t){if(t instanceof ma)return ga(t.boundExpression);if(t instanceof Er&&t.name==="error"||t instanceof vs||t instanceof po)return!1;const e=t instanceof fn||t instanceof Br;let r=!0;return t.eachChild(n=>{r=e?r&&ga(n):r&&n instanceof $n}),!!r&&Fo(t)&&Ts(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Es(t,e){const r=t.length-1;let n,a,l=0,h=r,p=0;for(;l<=h;)if(p=Math.floor((l+h)/2),n=t[p],a=t[p+1],n<=e){if(p===r||e<a)return p;l=p+1}else{if(!(n>e))throw new Gi("Input is not a number.");h=p-1}return 0}class Ss{constructor(e,r,n){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[a,l]of n)this.labels.push(a),this.outputs.push(l)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const n=r.parse(e[1],1,Xe);if(!n)return null;const a=[];let l=null;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);for(let h=1;h<e.length;h+=2){const p=h===1?-1/0:e[h],m=e[h+1],y=h,v=h+1;if(typeof p!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',y);if(a.length&&a[a.length-1][0]>=p)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',y);const w=r.parse(m,v,l);if(!w)return null;l=l||w.type,a.push([p,w])}return new Ss(l,n,a)}evaluate(e){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);const a=this.input.evaluate(e);if(a<=r[0])return n[0].evaluate(e);const l=r.length;return a>=r[l-1]?n[l-1].evaluate(e):n[Es(r,a)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}function Xt(t,e,r){return t*(1-r)+e*r}var ya=Object.freeze({__proto__:null,number:Xt,color:function(t,e,r){return new Ft(Xt(t.r,e.r,r),Xt(t.g,e.g,r),Xt(t.b,e.b,r),Xt(t.a,e.a,r))},array:function(t,e,r){return t.map((n,a)=>Xt(n,e[a],r))}});const Vc=.95047,Is=1.08883,Sl=4/29,xa=6/29,Nc=3*xa*xa,wh=Math.PI/180,Th=180/Math.PI;function va(t){return t>.008856451679035631?Math.pow(t,1/3):t/Nc+Sl}function ba(t){return t>xa?t*t*t:Nc*(t-Sl)}function wa(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ms(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function jc(t){const e=Ms(t.r),r=Ms(t.g),n=Ms(t.b),a=va((.4124564*e+.3575761*r+.1804375*n)/Vc),l=va((.2126729*e+.7151522*r+.072175*n)/1);return{l:116*l-16,a:500*(a-l),b:200*(l-va((.0193339*e+.119192*r+.9503041*n)/Is)),alpha:t.a}}function Gc(t){let e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*ba(e),r=Vc*ba(r),n=Is*ba(n),new Ft(wa(3.2404542*r-1.5371385*e-.4985314*n),wa(-.969266*r+1.8760108*e+.041556*n),wa(.0556434*r-.2040259*e+1.0572252*n),t.alpha)}function Eh(t,e,r){const n=e-t;return t+r*(n>180||n<-180?n-360*Math.round(n/360):n)}const As={forward:jc,reverse:Gc,interpolate:function(t,e,r){return{l:Xt(t.l,e.l,r),a:Xt(t.a,e.a,r),b:Xt(t.b,e.b,r),alpha:Xt(t.alpha,e.alpha,r)}}},Cs={forward:function(t){const{l:e,a:r,b:n}=jc(t),a=Math.atan2(n,r)*Th;return{h:a<0?a+360:a,c:Math.sqrt(r*r+n*n),l:e,alpha:t.a}},reverse:function(t){const e=t.h*wh,r=t.c;return Gc({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:Eh(t.h,e.h,r),c:Xt(t.c,e.c,r),l:Xt(t.l,e.l,r),alpha:Xt(t.alpha,e.alpha,r)}}};var $c=Object.freeze({__proto__:null,lab:As,hcl:Cs});class pr{constructor(e,r,n,a,l){this.type=e,this.operator=r,this.interpolation=n,this.input=a,this.labels=[],this.outputs=[];for(const[h,p]of l)this.labels.push(h),this.outputs.push(p)}static interpolationFactor(e,r,n,a){let l=0;if(e.name==="exponential")l=Ta(r,e.base,n,a);else if(e.name==="linear")l=Ta(r,1,n,a);else if(e.name==="cubic-bezier"){const h=e.controlPoints;l=new Ie(h[0],h[1],h[2],h[3]).solve(Ta(r,1,n,a))}return l}static parse(e,r){let[n,a,l,...h]=e;if(!Array.isArray(a)||a.length===0)return r.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const y=a[1];if(typeof y!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:y}}else{if(a[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const y=a.slice(1);if(y.length!==4||y.some(v=>typeof v!="number"||v<0||v>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:y}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(l=r.parse(l,2,Xe),!l)return null;const p=[];let m=null;n==="interpolate-hcl"||n==="interpolate-lab"?m=dn:r.expectedType&&r.expectedType.kind!=="value"&&(m=r.expectedType);for(let y=0;y<h.length;y+=2){const v=h[y],w=h[y+1],T=y+3,C=y+4;if(typeof v!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(p.length&&p[p.length-1][0]>=v)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',T);const P=r.parse(w,C,m);if(!P)return null;m=m||P.type,p.push([v,P])}return m.kind==="number"||m.kind==="color"||m.kind==="array"&&m.itemType.kind==="number"&&typeof m.N=="number"?new pr(m,n,a,l,p):r.error(`Type ${yi(m)} is not interpolatable.`)}evaluate(e){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);const a=this.input.evaluate(e);if(a<=r[0])return n[0].evaluate(e);const l=r.length;if(a>=r[l-1])return n[l-1].evaluate(e);const h=Es(r,a),p=pr.interpolationFactor(this.interpolation,a,r[h],r[h+1]),m=n[h].evaluate(e),y=n[h+1].evaluate(e);return this.operator==="interpolate"?ya[this.type.kind.toLowerCase()](m,y,p):this.operator==="interpolate-hcl"?Cs.reverse(Cs.interpolate(Cs.forward(m),Cs.forward(y),p)):As.reverse(As.interpolate(As.forward(m),As.forward(y),p))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)r.push(this.labels[n],this.outputs[n].serialize());return r}}function Ta(t,e,r,n){const a=n-r,l=t-r;return a===0?0:e===1?l/a:(Math.pow(e,l)-1)/(Math.pow(e,a)-1)}class fo{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let n=null;const a=r.expectedType;a&&a.kind!=="value"&&(n=a);const l=[];for(const p of e.slice(1)){const m=r.parse(p,1+l.length,n,void 0,{typeAnnotation:"omit"});if(!m)return null;n=n||m.type,l.push(m)}const h=a&&l.some(p=>dr(a,p.type));return new fo(h?Et:n,l)}evaluate(e){let r,n=null,a=0;for(const l of this.args){if(a++,n=l.evaluate(e),n&&n instanceof Lr&&!n.available&&(r||(r=n),n=null,a===this.args.length))return r;if(n!==null)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Ea{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let l=1;l<e.length-1;l+=2){const h=e[l];if(typeof h!="string")return r.error(`Expected string, but found ${typeof h} instead.`,l);if(/[^a-zA-Z0-9_]/.test(h))return r.error("Variable names must contain only alphanumeric characters or '_'.",l);const p=r.parse(e[l+1],l+1);if(!p)return null;n.push([h,p])}const a=r.parse(e[e.length-1],e.length-1,r.expectedType,n);return a?new Ea(n,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,n]of this.bindings)e.push(r,n.serialize());return e.push(this.result.serialize()),e}}class Il{constructor(e,r,n){this.type=e,this.index=r,this.input=n}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Xe),a=r.parse(e[2],2,Dr(r.expectedType||Et));return n&&a?new Il(a.type.itemType,n,a):null}evaluate(e){const r=this.index.evaluate(e),n=this.input.evaluate(e);if(r<0)throw new Gi(`Array index out of bounds: ${r} < 0.`);if(r>=n.length)throw new Gi(`Array index out of bounds: ${r} > ${n.length-1}.`);if(r!==Math.floor(r))throw new Gi(`Array index must be an integer, but found ${r} instead.`);return n[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ml{constructor(e,r){this.type=Tt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Et),a=r.parse(e[2],2,Et);return n&&a?ua(n.type,[Tt,zt,Xe,jn,Et])?new Ml(n,a):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${yi(n.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!Lo(r,["boolean","string","number","null"]))throw new Gi(`Expected first argument to be of type boolean, string, number or null, but found ${yi(Mi(r))} instead.`);if(!Lo(n,["string","array"]))throw new Gi(`Expected second argument to be of type array or string, but found ${yi(Mi(n))} instead.`);return n.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Xr{constructor(e,r,n){this.type=Xe,this.needle=e,this.haystack=r,this.fromIndex=n}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Et),a=r.parse(e[2],2,Et);if(!n||!a)return null;if(!ua(n.type,[Tt,zt,Xe,jn,Et]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${yi(n.type)} instead`);if(e.length===4){const l=r.parse(e[3],3,Xe);return l?new Xr(n,a,l):null}return new Xr(n,a)}evaluate(e){const r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!Lo(r,["boolean","string","number","null"]))throw new Gi(`Expected first argument to be of type boolean, string, number or null, but found ${yi(Mi(r))} instead.`);if(!Lo(n,["string","array"]))throw new Gi(`Expected second argument to be of type array or string, but found ${yi(Mi(n))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return n.indexOf(r,a)}return n.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Sa{constructor(e,r,n,a,l,h){this.inputType=e,this.type=r,this.input=n,this.cases=a,this.outputs=l,this.otherwise=h}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let n,a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const l={},h=[];for(let y=2;y<e.length-1;y+=2){let v=e[y];const w=e[y+1];Array.isArray(v)||(v=[v]);const T=r.concat(y);if(v.length===0)return T.error("Expected at least one branch label.");for(const P of v){if(typeof P!="number"&&typeof P!="string")return T.error("Branch labels must be numbers or strings.");if(typeof P=="number"&&Math.abs(P)>Number.MAX_SAFE_INTEGER)return T.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof P=="number"&&Math.floor(P)!==P)return T.error("Numeric branch labels must be integer values.");if(n){if(T.checkSubtype(n,Mi(P)))return null}else n=Mi(P);if(l[String(P)]!==void 0)return T.error("Branch labels must be unique.");l[String(P)]=h.length}const C=r.parse(w,y,a);if(!C)return null;a=a||C.type,h.push(C)}const p=r.parse(e[1],1,Et);if(!p)return null;const m=r.parse(e[e.length-1],e.length-1,a);return m?p.type.kind!=="value"&&r.concat(1).checkSubtype(n,p.type)?null:new Sa(n,a,p,l,h,m):null}evaluate(e){const r=this.input.evaluate(e);return(Mi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),n=[],a={};for(const h of r){const p=a[this.cases[h]];p===void 0?(a[this.cases[h]]=n.length,n.push([this.cases[h],[h]])):n[p][1].push(h)}const l=h=>this.inputType.kind==="number"?Number(h):h;for(const[h,p]of n)e.push(p.length===1?l(p[0]):p.map(l)),e.push(this.outputs[h].serialize());return e.push(this.otherwise.serialize()),e}}class qn{constructor(e,r,n){this.type=e,this.branches=r,this.otherwise=n}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let n;r.expectedType&&r.expectedType.kind!=="value"&&(n=r.expectedType);const a=[];for(let h=1;h<e.length-1;h+=2){const p=r.parse(e[h],h,Tt);if(!p)return null;const m=r.parse(e[h+1],h+1,n);if(!m)return null;a.push([p,m]),n=n||m.type}const l=r.parse(e[e.length-1],e.length-1,n);return l?new qn(n,a,l):null}evaluate(e){for(const[r,n]of this.branches)if(r.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,n]of this.branches)e(r),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class zs{constructor(e,r,n,a){this.type=e,this.input=r,this.beginIndex=n,this.endIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Et),a=r.parse(e[2],2,Xe);if(!n||!a)return null;if(!ua(n.type,[Dr(Et),zt,Et]))return r.error(`Expected first argument to be of type array or string, but found ${yi(n.type)} instead`);if(e.length===4){const l=r.parse(e[3],3,Xe);return l?new zs(n.type,n,a,l):null}return new zs(n.type,n,a)}evaluate(e){const r=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!Lo(r,["string","array"]))throw new Gi(`Expected first argument to be of type array or string, but found ${yi(Mi(r))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return r.slice(n,a)}return r.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Zc(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Ia(t,e,r,n){return n.compare(e,r)===0}function Wn(t,e,r){const n=t!=="=="&&t!=="!=";return class ug{constructor(l,h,p){this.type=Tt,this.lhs=l,this.rhs=h,this.collator=p,this.hasUntypedArgument=l.type.kind==="value"||h.type.kind==="value"}static parse(l,h){if(l.length!==3&&l.length!==4)return h.error("Expected two or three arguments.");const p=l[0];let m=h.parse(l[1],1,Et);if(!m)return null;if(!Zc(p,m.type))return h.concat(1).error(`"${p}" comparisons are not supported for type '${yi(m.type)}'.`);let y=h.parse(l[2],2,Et);if(!y)return null;if(!Zc(p,y.type))return h.concat(2).error(`"${p}" comparisons are not supported for type '${yi(y.type)}'.`);if(m.type.kind!==y.type.kind&&m.type.kind!=="value"&&y.type.kind!=="value")return h.error(`Cannot compare types '${yi(m.type)}' and '${yi(y.type)}'.`);n&&(m.type.kind==="value"&&y.type.kind!=="value"?m=new Br(y.type,[m]):m.type.kind!=="value"&&y.type.kind==="value"&&(y=new Br(m.type,[y])));let v=null;if(l.length===4){if(m.type.kind!=="string"&&y.type.kind!=="string"&&m.type.kind!=="value"&&y.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(v=h.parse(l[3],3,gs),!v)return null}return new ug(m,y,v)}evaluate(l){const h=this.lhs.evaluate(l),p=this.rhs.evaluate(l);if(n&&this.hasUntypedArgument){const m=Mi(h),y=Mi(p);if(m.kind!==y.kind||m.kind!=="string"&&m.kind!=="number")throw new Gi(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${m.kind}, ${y.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const m=Mi(h),y=Mi(p);if(m.kind!=="string"||y.kind!=="string")return e(l,h,p)}return this.collator?r(l,h,p,this.collator.evaluate(l)):e(l,h,p)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}serialize(){const l=[t];return this.eachChild(h=>{l.push(h.serialize())}),l}}}const qc=Wn("==",function(t,e,r){return e===r},Ia),Al=Wn("!=",function(t,e,r){return e!==r},function(t,e,r,n){return!Ia(0,e,r,n)}),Cl=Wn("<",function(t,e,r){return e<r},function(t,e,r,n){return n.compare(e,r)<0}),Wc=Wn(">",function(t,e,r){return e>r},function(t,e,r,n){return n.compare(e,r)>0}),zl=Wn("<=",function(t,e,r){return e<=r},function(t,e,r,n){return n.compare(e,r)<=0}),Xc=Wn(">=",function(t,e,r){return e>=r},function(t,e,r,n){return n.compare(e,r)>=0});class Ma{constructor(e,r,n,a,l){this.type=zt,this.number=e,this.locale=r,this.currency=n,this.minFractionDigits=a,this.maxFractionDigits=l}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const n=r.parse(e[1],1,Xe);if(!n)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return r.error("NumberFormat options argument must be an object.");let l=null;if(a.locale&&(l=r.parse(a.locale,1,zt),!l))return null;let h=null;if(a.currency&&(h=r.parse(a.currency,1,zt),!h))return null;let p=null;if(a["min-fraction-digits"]&&(p=r.parse(a["min-fraction-digits"],1,Xe),!p))return null;let m=null;return a["max-fraction-digits"]&&(m=r.parse(a["max-fraction-digits"],1,Xe),!m)?null:new Ma(n,l,h,p,m)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Aa{constructor(e){this.type=Xe,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=r.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${yi(n.type)} instead.`):new Aa(n):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Gi(`Expected value to be of type string or array, but found ${yi(Mi(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Hr={"==":qc,"!=":Al,">":Wc,"<":Cl,">=":Xc,"<=":zl,array:Br,at:Il,boolean:Br,case:qn,coalesce:fo,collator:vs,format:pn,image:ho,in:Ml,"index-of":Xr,interpolate:pr,"interpolate-hcl":pr,"interpolate-lab":pr,length:Aa,let:Ea,literal:$n,match:Sa,number:Br,"number-format":Ma,object:Br,slice:zs,step:Ss,string:Br,"to-boolean":fn,"to-color":fn,"to-number":fn,"to-string":fn,var:ma,within:po};function Pl(t,[e,r,n,a]){e=e.evaluate(t),r=r.evaluate(t),n=n.evaluate(t);const l=a?a.evaluate(t):1,h=zc(e,r,n,l);if(h)throw new Gi(h);return new Ft(e/255*l,r/255*l,n/255*l,l)}function kl(t,e){return t in e}function Ps(t,e){const r=e[t];return r===void 0?null:r}function Xn(t){return{type:t}}function Hc(t){return{result:"success",value:t}}function Sn(t){return{result:"error",value:t}}function Oo(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function Kc(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Dl(t){return!!t.expression&&t.expression.interpolated}function Gt(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Ca(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function za(t){return t}function ks(t,e){const r=e.type==="color",n=t.stops&&typeof t.stops[0][0]=="object",a=n||!(n||t.property!==void 0),l=t.type||(Dl(e)?"exponential":"interval");if(r&&((t=Nn({},t)).stops&&(t.stops=t.stops.map(y=>[y[0],Ft.parse(y[1])])),t.default=Ft.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!$c[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let h,p,m;if(l==="exponential")h=Yc;else if(l==="interval")h=Sh;else if(l==="categorical"){h=Pa,p=Object.create(null);for(const y of t.stops)p[y[0]]=y[1];m=typeof t.stops[0][0]}else{if(l!=="identity")throw new Error(`Unknown function type "${l}"`);h=Ih}if(n){const y={},v=[];for(let C=0;C<t.stops.length;C++){const P=t.stops[C],B=P[0].zoom;y[B]===void 0&&(y[B]={zoom:B,type:t.type,property:t.property,default:t.default,stops:[]},v.push(B)),y[B].stops.push([P[0].value,P[1]])}const w=[];for(const C of v)w.push([y[C].zoom,ks(y[C],e)]);const T={name:"linear"};return{kind:"composite",interpolationType:T,interpolationFactor:pr.interpolationFactor.bind(void 0,T),zoomStops:w.map(C=>C[0]),evaluate:({zoom:C},P)=>Yc({stops:w,base:t.base},e,C).evaluate(C,P)}}if(a){const y=l==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:y,interpolationFactor:pr.interpolationFactor.bind(void 0,y),zoomStops:t.stops.map(v=>v[0]),evaluate:({zoom:v})=>h(t,e,v,p,m)}}return{kind:"source",evaluate(y,v){const w=v&&v.properties?v.properties[t.property]:void 0;return w===void 0?Ji(t.default,e.default):h(t,e,w,p,m)}}}function Ji(t,e,r){return t!==void 0?t:e!==void 0?e:r!==void 0?r:void 0}function Pa(t,e,r,n,a){return Ji(typeof r===a?n[r]:void 0,t.default,e.default)}function Sh(t,e,r){if(Gt(r)!=="number")return Ji(t.default,e.default);const n=t.stops.length;if(n===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[n-1][0])return t.stops[n-1][1];const a=Es(t.stops.map(l=>l[0]),r);return t.stops[a][1]}function Yc(t,e,r){const n=t.base!==void 0?t.base:1;if(Gt(r)!=="number")return Ji(t.default,e.default);const a=t.stops.length;if(a===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[a-1][0])return t.stops[a-1][1];const l=Es(t.stops.map(v=>v[0]),r),h=function(v,w,T,C){const P=C-T,B=v-T;return P===0?0:w===1?B/P:(Math.pow(w,B)-1)/(Math.pow(w,P)-1)}(r,n,t.stops[l][0],t.stops[l+1][0]),p=t.stops[l][1],m=t.stops[l+1][1];let y=ya[e.type]||za;if(t.colorSpace&&t.colorSpace!=="rgb"){const v=$c[t.colorSpace];y=(w,T)=>v.reverse(v.interpolate(v.forward(w),v.forward(T),h))}return typeof p.evaluate=="function"?{evaluate(...v){const w=p.evaluate.apply(void 0,v),T=m.evaluate.apply(void 0,v);if(w!==void 0&&T!==void 0)return y(w,T,h)}}:y(p,m,h)}function Ih(t,e,r){return e.type==="color"?r=Ft.parse(r):e.type==="formatted"?r=gt.fromString(r.toString()):e.type==="resolvedImage"?r=Lr.fromString(r.toString()):Gt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),Ji(r,t.default,e.default)}Er.register(Hr,{error:[{kind:"error"},[zt],(t,[e])=>{throw new Gi(e.evaluate(t))}],typeof:[zt,[Et],(t,[e])=>yi(Mi(e.evaluate(t)))],"to-rgba":[Dr(Xe,4),[dn],(t,[e])=>e.evaluate(t).toArray()],rgb:[dn,[Xe,Xe,Xe],Pl],rgba:[dn,[Xe,Xe,Xe,Xe],Pl],has:{type:Tt,overloads:[[[zt],(t,[e])=>kl(e.evaluate(t),t.properties())],[[zt,Do],(t,[e,r])=>kl(e.evaluate(t),r.evaluate(t))]]},get:{type:Et,overloads:[[[zt],(t,[e])=>Ps(e.evaluate(t),t.properties())],[[zt,Do],(t,[e,r])=>Ps(e.evaluate(t),r.evaluate(t))]]},"feature-state":[Et,[zt],(t,[e])=>Ps(e.evaluate(t),t.featureState||{})],properties:[Do,[],t=>t.properties()],"geometry-type":[zt,[],t=>t.geometryType()],id:[Et,[],t=>t.id()],zoom:[Xe,[],t=>t.globals.zoom],pitch:[Xe,[],t=>t.globals.pitch||0],"distance-from-center":[Xe,[],t=>t.distanceFromCenter()],"heatmap-density":[Xe,[],t=>t.globals.heatmapDensity||0],"line-progress":[Xe,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Xe,[],t=>t.globals.skyRadialProgress||0],accumulated:[Et,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Xe,Xn(Xe),(t,e)=>{let r=0;for(const n of e)r+=n.evaluate(t);return r}],"*":[Xe,Xn(Xe),(t,e)=>{let r=1;for(const n of e)r*=n.evaluate(t);return r}],"-":{type:Xe,overloads:[[[Xe,Xe],(t,[e,r])=>e.evaluate(t)-r.evaluate(t)],[[Xe],(t,[e])=>-e.evaluate(t)]]},"/":[Xe,[Xe,Xe],(t,[e,r])=>e.evaluate(t)/r.evaluate(t)],"%":[Xe,[Xe,Xe],(t,[e,r])=>e.evaluate(t)%r.evaluate(t)],ln2:[Xe,[],()=>Math.LN2],pi:[Xe,[],()=>Math.PI],e:[Xe,[],()=>Math.E],"^":[Xe,[Xe,Xe],(t,[e,r])=>Math.pow(e.evaluate(t),r.evaluate(t))],sqrt:[Xe,[Xe],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Xe,[Xe],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Xe,[Xe],(t,[e])=>Math.log(e.evaluate(t))],log2:[Xe,[Xe],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Xe,[Xe],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Xe,[Xe],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Xe,[Xe],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Xe,[Xe],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Xe,[Xe],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Xe,[Xe],(t,[e])=>Math.atan(e.evaluate(t))],min:[Xe,Xn(Xe),(t,e)=>Math.min(...e.map(r=>r.evaluate(t)))],max:[Xe,Xn(Xe),(t,e)=>Math.max(...e.map(r=>r.evaluate(t)))],abs:[Xe,[Xe],(t,[e])=>Math.abs(e.evaluate(t))],round:[Xe,[Xe],(t,[e])=>{const r=e.evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[Xe,[Xe],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Xe,[Xe],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Tt,[zt,Et],(t,[e,r])=>t.properties()[e.value]===r.value],"filter-id-==":[Tt,[Et],(t,[e])=>t.id()===e.value],"filter-type-==":[Tt,[zt],(t,[e])=>t.geometryType()===e.value],"filter-<":[Tt,[zt,Et],(t,[e,r])=>{const n=t.properties()[e.value],a=r.value;return typeof n==typeof a&&n<a}],"filter-id-<":[Tt,[Et],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r<n}],"filter->":[Tt,[zt,Et],(t,[e,r])=>{const n=t.properties()[e.value],a=r.value;return typeof n==typeof a&&n>a}],"filter-id->":[Tt,[Et],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r>n}],"filter-<=":[Tt,[zt,Et],(t,[e,r])=>{const n=t.properties()[e.value],a=r.value;return typeof n==typeof a&&n<=a}],"filter-id-<=":[Tt,[Et],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r<=n}],"filter->=":[Tt,[zt,Et],(t,[e,r])=>{const n=t.properties()[e.value],a=r.value;return typeof n==typeof a&&n>=a}],"filter-id->=":[Tt,[Et],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r>=n}],"filter-has":[Tt,[Et],(t,[e])=>e.value in t.properties()],"filter-has-id":[Tt,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Tt,[Dr(zt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Tt,[Dr(Et)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Tt,[zt,Dr(Et)],(t,[e,r])=>r.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Tt,[zt,Dr(Et)],(t,[e,r])=>function(n,a,l,h){for(;l<=h;){const p=l+h>>1;if(a[p]===n)return!0;a[p]>n?h=p-1:l=p+1}return!1}(t.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Tt,overloads:[[[Tt,Tt],(t,[e,r])=>e.evaluate(t)&&r.evaluate(t)],[Xn(Tt),(t,e)=>{for(const r of e)if(!r.evaluate(t))return!1;return!0}]]},any:{type:Tt,overloads:[[[Tt,Tt],(t,[e,r])=>e.evaluate(t)||r.evaluate(t)],[Xn(Tt),(t,e)=>{for(const r of e)if(r.evaluate(t))return!0;return!1}]]},"!":[Tt,[Tt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Tt,[zt],(t,[e])=>{const r=t.globals&&t.globals.isSupportedScript;return!r||r(e.evaluate(t))}],upcase:[zt,[zt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[zt,[zt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[zt,Xn(Et),(t,e)=>e.map(r=>xs(r.evaluate(t))).join("")],"resolved-locale":[zt,[gs],(t,[e])=>e.evaluate(t).resolvedLocale()]});class Ll{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new kc,this._defaultValue=r?function(n){return n.type==="color"&&Ca(n.default)?new Ft(0,0,0,0):n.type==="color"?Ft.parse(n.default)||null:n.default===void 0?null:n.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,n,a,l,h,p,m){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=n,this._evaluator.canonical=a,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=h,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=m||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,n,a,l,h,p,m){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=n||null,this._evaluator.canonical=a,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=h||null,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=m||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new Gi(`Expected value to be one of ${Object.keys(this._enumValues).map(v=>JSON.stringify(v)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console!="undefined"&&console.warn(y.message)),this._defaultValue}}}function Uo(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Hr}function Ds(t,e){const r=new _a(Hr,[],e?function(a){const l={color:dn,string:zt,number:Xe,enum:zt,boolean:Tt,formatted:Gn,resolvedImage:ys};return a.type==="array"?Dr(l[a.value]||Et,a.length):l[a.type]}(e):void 0),n=r.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?Hc(new Ll(n,e)):Sn(r.errors)}class Ls{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!ws(r.expression)}evaluateWithoutErrorHandling(e,r,n,a,l,h){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,a,l,h)}evaluate(e,r,n,a,l,h){return this._styleExpression.evaluate(e,r,n,a,l,h)}}class Bl{constructor(e,r,n,a){this.kind=e,this.zoomStops=n,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!ws(r.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,r,n,a,l,h){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,a,l,h)}evaluate(e,r,n,a,l,h){return this._styleExpression.evaluate(e,r,n,a,l,h)}interpolationFactor(e,r,n){return this.interpolationType?pr.interpolationFactor(this.interpolationType,e,r,n):0}}function Jc(t,e){if((t=Ds(t,e)).result==="error")return t;const r=t.value.expression,n=Fo(r);if(!n&&!Oo(e))return Sn([new hn("","data expressions not supported")]);const a=Ts(r,["zoom","pitch","distance-from-center"]);if(!a&&!Kc(e))return Sn([new hn("","zoom expressions not supported")]);const l=ka(r);return l||a?l instanceof hn?Sn([l]):l instanceof pr&&!Dl(e)?Sn([new hn("",'"interpolate" expressions cannot be used with this property')]):Hc(l?new Bl(n?"camera":"composite",t.value,l.labels,l instanceof pr?l.interpolation:void 0):new Ls(n?"constant":"source",t.value)):Sn([new hn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Vo{constructor(e,r){this._parameters=e,this._specification=r,Nn(this,ks(this._parameters,this._specification))}static deserialize(e){return new Vo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ka(t){let e=null;if(t instanceof Ea)e=ka(t.result);else if(t instanceof fo){for(const r of t.args)if(e=ka(r),e)break}else(t instanceof Ss||t instanceof pr)&&t.input instanceof Er&&t.input.name==="zoom"&&(e=t);return e instanceof hn||t.eachChild(r=>{const n=ka(r);n instanceof hn?e=n:!e&&n?e=new hn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new hn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Rr(t){const e=t.key,r=t.value,n=t.valueSpec||{},a=t.objectElementValidators||{},l=t.style,h=t.styleSpec;let p=[];const m=Gt(r);if(m!=="object")return[new He(e,r,`object expected, ${m} found`)];for(const y in r){const v=y.split(".")[0],w=n[v]||n["*"];let T;if(a[v])T=a[v];else if(n[v])T=$i;else if(a["*"])T=a["*"];else{if(!n["*"]){p.push(new He(e,r[y],`unknown property "${y}"`));continue}T=$i}p=p.concat(T({key:(e&&`${e}.`)+y,value:r[y],valueSpec:w,style:l,styleSpec:h,object:r,objectKey:y},r))}for(const y in n)a[y]||n[y].required&&n[y].default===void 0&&r[y]===void 0&&p.push(new He(e,r,`missing required property "${y}"`));return p}function Rl(t){const e=t.value,r=t.valueSpec,n=t.style,a=t.styleSpec,l=t.key,h=t.arrayElementValidator||$i;if(Gt(e)!=="array")return[new He(l,e,`array expected, ${Gt(e)} found`)];if(r.length&&e.length!==r.length)return[new He(l,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new He(l,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let p={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum};a.$version<7&&(p.function=r.function),Gt(r.value)==="object"&&(p=r.value);let m=[];for(let y=0;y<e.length;y++)m=m.concat(h({array:e,arrayIndex:y,value:e[y],valueSpec:p,style:n,styleSpec:a,key:`${l}[${y}]`}));return m}function Qc(t){const e=t.key,r=t.value,n=t.valueSpec;let a=Gt(r);if(a==="number"&&r!=r&&(a="NaN"),a!=="number")return[new He(e,r,`number expected, ${a} found`)];if("minimum"in n){let l=n.minimum;if(Gt(n.minimum)==="array"&&(l=n.minimum[t.arrayIndex]),r<l)return[new He(e,r,`${r} is less than the minimum value ${l}`)]}if("maximum"in n){let l=n.maximum;if(Gt(n.maximum)==="array"&&(l=n.maximum[t.arrayIndex]),r>l)return[new He(e,r,`${r} is greater than the maximum value ${l}`)]}return[]}function Da(t){const e=t.valueSpec,r=Si(t.value.type);let n,a,l,h={};const p=r!=="categorical"&&t.value.property===void 0,m=!p,y=Gt(t.value.stops)==="array"&&Gt(t.value.stops[0])==="array"&&Gt(t.value.stops[0][0])==="object",v=Rr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(C){if(r==="identity")return[new He(C.key,C.value,'identity function may not have a "stops" property')];let P=[];const B=C.value;return P=P.concat(Rl({key:C.key,value:B,valueSpec:C.valueSpec,style:C.style,styleSpec:C.styleSpec,arrayElementValidator:w})),Gt(B)==="array"&&B.length===0&&P.push(new He(C.key,B,"array must have at least one stop")),P},default:function(C){return $i({key:C.key,value:C.value,valueSpec:e,style:C.style,styleSpec:C.styleSpec})}}});return r==="identity"&&p&&v.push(new He(t.key,t.value,'missing required property "property"')),r==="identity"||t.value.stops||v.push(new He(t.key,t.value,'missing required property "stops"')),r==="exponential"&&t.valueSpec.expression&&!Dl(t.valueSpec)&&v.push(new He(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(m&&!Oo(t.valueSpec)?v.push(new He(t.key,t.value,"property functions not supported")):p&&!Kc(t.valueSpec)&&v.push(new He(t.key,t.value,"zoom functions not supported"))),r!=="categorical"&&!y||t.value.property!==void 0||v.push(new He(t.key,t.value,'"property" property is required')),v;function w(C){let P=[];const B=C.value,O=C.key;if(Gt(B)!=="array")return[new He(O,B,`array expected, ${Gt(B)} found`)];if(B.length!==2)return[new He(O,B,`array length 2 expected, length ${B.length} found`)];if(y){if(Gt(B[0])!=="object")return[new He(O,B,`object expected, ${Gt(B[0])} found`)];if(B[0].zoom===void 0)return[new He(O,B,"object stop key must have zoom")];if(B[0].value===void 0)return[new He(O,B,"object stop key must have value")];if(l&&l>Si(B[0].zoom))return[new He(O,B[0].zoom,"stop zoom values must appear in ascending order")];Si(B[0].zoom)!==l&&(l=Si(B[0].zoom),a=void 0,h={}),P=P.concat(Rr({key:`${O}[0]`,value:B[0],valueSpec:{zoom:{}},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{zoom:Qc,value:T}}))}else P=P.concat(T({key:`${O}[0]`,value:B[0],valueSpec:{},style:C.style,styleSpec:C.styleSpec},B));return Uo(En(B[1]))?P.concat([new He(`${O}[1]`,B[1],"expressions are not allowed in function stops.")]):P.concat($i({key:`${O}[1]`,value:B[1],valueSpec:e,style:C.style,styleSpec:C.styleSpec}))}function T(C,P){const B=Gt(C.value),O=Si(C.value),Z=C.value!==null?C.value:P;if(n){if(B!==n)return[new He(C.key,Z,`${B} stop domain type must match previous stop domain type ${n}`)]}else n=B;if(B!=="number"&&B!=="string"&&B!=="boolean")return[new He(C.key,Z,"stop domain value must be a number, string, or boolean")];if(B!=="number"&&r!=="categorical"){let Y=`number expected, ${B} found`;return Oo(e)&&r===void 0&&(Y+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new He(C.key,Z,Y)]}return r!=="categorical"||B!=="number"||isFinite(O)&&Math.floor(O)===O?r!=="categorical"&&B==="number"&&a!==void 0&&O<a?[new He(C.key,Z,"stop domain values must appear in ascending order")]:(a=O,r==="categorical"&&O in h?[new He(C.key,Z,"stop domain values must be unique")]:(h[O]=!0,[])):[new He(C.key,Z,`integer expected, found ${O}`)]}}function In(t){const e=(t.expressionContext==="property"?Jc:Ds)(En(t.value),t.valueSpec);if(e.result==="error")return e.value.map(n=>new He(`${t.key}${n.key}`,t.value,n.message));const r=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!r.outputDefined())return[new He(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!ws(r))return[new He(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return Fl(r,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Ts(r,["zoom","feature-state"]))return[new He(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Fo(r))return[new He(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Fl(t,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const a of e.valueSpec.expression.parameters)r.delete(a);if(r.size===0)return[];const n=[];return t instanceof Er&&r.has(t.name)?[new He(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(a=>{n.push(...Fl(a,e))}),n)}function La(t){const e=t.key,r=t.value,n=t.valueSpec,a=[];return Array.isArray(n.values)?n.values.indexOf(Si(r))===-1&&a.push(new He(e,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(n.values).indexOf(Si(r))===-1&&a.push(new He(e,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),a}function Ba(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Ba(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Ra(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ba(t)||(t=Oa(t));const r=t;let n=!0;try{n=function(y){if(!No(y))return y;let v=En(y);return eu(v),v=Fa(v),v}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const a=xe[`filter_${e}`],l=Ds(n,a);let h=null;if(l.result==="error")throw new Error(l.value.map(y=>`${y.key}: ${y.message}`).join(", "));h=(y,v,w)=>l.value.evaluate(y,v,{},w);let p=null,m=null;if(n!==r){const y=Ds(r,a);if(y.result==="error")throw new Error(y.value.map(v=>`${v.key}: ${v.message}`).join(", "));p=(v,w,T,C,P)=>y.value.evaluate(v,w,{},T,void 0,void 0,C,P),m=!Fo(y.value.expression)}return h=h,{filter:h,dynamicFilter:p||void 0,needGeometry:Ol(n),needFeature:!!m}}function Fa(t){if(!Array.isArray(t))return t;const e=function(r){if(Mh.has(r[0])){for(let n=1;n<r.length;n++)if(No(r[n]))return!0}return r}(t);return e===!0?e:e.map(r=>Fa(r))}function eu(t){let e=!1;const r=[];if(t[0]==="case"){for(let n=1;n<t.length-1;n+=2)e=e||No(t[n]),r.push(t[n+1]);r.push(t[t.length-1])}else if(t[0]==="match"){e=e||No(t[1]);for(let n=2;n<t.length-1;n+=2)r.push(t[n+1]);r.push(t[t.length-1])}else if(t[0]==="step"){e=e||No(t[1]);for(let n=1;n<t.length-1;n+=2)r.push(t[n+1])}e&&(t.length=0,t.push("any",...r));for(let n=1;n<t.length;n++)eu(t[n])}function No(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<t.length;r++)if(No(t[r]))return!0;return!1}const Mh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ah(t,e){return t<e?-1:t>e?1:0}function Ol(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(Ol(t[e]))return!0;return!1}function Oa(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?Ul(t[1],t[2],"=="):e==="!="?Ua(Ul(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ul(t[1],t[2],e):e==="any"?(r=t.slice(1),["any"].concat(r.map(Oa))):e==="all"?["all"].concat(t.slice(1).map(Oa)):e==="none"?["all"].concat(t.slice(1).map(Oa).map(Ua)):e==="in"?tu(t[1],t.slice(2)):e==="!in"?Ua(tu(t[1],t.slice(2))):e==="has"?iu(t[1]):e==="!has"?Ua(iu(t[1])):e!=="within"||t;var r}function Ul(t,e,r){switch(t){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,t,e]}}function tu(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Ah)]]:["filter-in-small",t,["literal",e]]}}function iu(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Ua(t){return["!",t]}function Vl(t){if(Ba(En(t.value))){const e=En(t.layerType);return In(Nn({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${e||"fill"}`]}))}return ru(t)}function ru(t){const e=t.value,r=t.key;if(Gt(e)!=="array")return[new He(r,e,`array expected, ${Gt(e)} found`)];const n=t.styleSpec;let a,l=[];if(e.length<1)return[new He(r,e,"filter array must have at least 1 element")];switch(l=l.concat(La({key:`${r}[0]`,value:e[0],valueSpec:n.filter_operator,style:t.style,styleSpec:t.styleSpec})),Si(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Si(e[1])==="$type"&&l.push(new He(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&l.push(new He(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(a=Gt(e[1]),a!=="string"&&l.push(new He(`${r}[1]`,e[1],`string expected, ${a} found`)));for(let h=2;h<e.length;h++)a=Gt(e[h]),Si(e[1])==="$type"?l=l.concat(La({key:`${r}[${h}]`,value:e[h],valueSpec:n.geometry_type,style:t.style,styleSpec:t.styleSpec})):a!=="string"&&a!=="number"&&a!=="boolean"&&l.push(new He(`${r}[${h}]`,e[h],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let h=1;h<e.length;h++)l=l.concat(ru({key:`${r}[${h}]`,value:e[h],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":a=Gt(e[1]),e.length!==2?l.push(new He(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):a!=="string"&&l.push(new He(`${r}[1]`,e[1],`string expected, ${a} found`));break;case"within":a=Gt(e[1]),e.length!==2?l.push(new He(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):a!=="object"&&l.push(new He(`${r}[1]`,e[1],`object expected, ${a} found`))}return l}function Bs(t,e){const r=t.key,n=t.style,a=t.styleSpec,l=t.value,h=t.objectKey,p=a[`${e}_${t.layerType}`];if(!p)return[];const m=h.match(/^(.*)-transition$/);if(e==="paint"&&m&&p[m[1]]&&p[m[1]].transition)return $i({key:r,value:l,valueSpec:a.transition,style:n,styleSpec:a});const y=t.valueSpec||p[h];if(!y)return[new He(r,l,`unknown property "${h}"`)];let v;if(Gt(l)==="string"&&Oo(y)&&!y.tokens&&(v=/^{([^}]+)}$/.exec(l)))return[new He(r,l,`"${h}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(v[1])} }\`.`)];const w=[];return t.layerType==="symbol"&&(h==="text-field"&&n&&!n.glyphs&&w.push(new He(r,l,'use of "text-field" requires a style "glyphs" property')),h==="text-font"&&Ca(En(l))&&Si(l.type)==="identity"&&w.push(new He(r,l,'"text-font" does not support identity functions'))),w.concat($i({key:t.key,value:l,valueSpec:y,style:n,styleSpec:a,expressionContext:"property",propertyType:e,propertyKey:h}))}function nu(t){return Bs(t,"paint")}function ou(t){return Bs(t,"layout")}function Rs(t){let e=[];const r=t.value,n=t.key,a=t.style,l=t.styleSpec;r.type||r.ref||e.push(new He(n,r,'either "type" or "ref" is required'));let h=Si(r.type);const p=Si(r.ref);if(r.id){const m=Si(r.id);for(let y=0;y<t.arrayIndex;y++){const v=a.layers[y];Si(v.id)===m&&e.push(new He(n,r.id,`duplicate layer id "${r.id}", previously used at line ${v.id.__line__}`))}}if("ref"in r){let m;["type","source","source-layer","filter","layout"].forEach(y=>{y in r&&e.push(new He(n,r[y],`"${y}" is prohibited for ref layers`))}),a.layers.forEach(y=>{Si(y.id)===p&&(m=y)}),m?m.ref?e.push(new He(n,r.ref,"ref cannot reference another ref layer")):h=Si(m.type):e.push(new He(n,r.ref,`ref layer "${p}" not found`))}else if(h!=="background"&&h!=="sky")if(r.source){const m=a.sources&&a.sources[r.source],y=m&&Si(m.type);m?y==="vector"&&h==="raster"?e.push(new He(n,r.source,`layer "${r.id}" requires a raster source`)):y==="raster"&&h!=="raster"?e.push(new He(n,r.source,`layer "${r.id}" requires a vector source`)):y!=="vector"||r["source-layer"]?y==="raster-dem"&&h!=="hillshade"?e.push(new He(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):h!=="line"||!r.paint||!r.paint["line-gradient"]||y==="geojson"&&m.lineMetrics||e.push(new He(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new He(n,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new He(n,r.source,`source "${r.source}" not found`))}else e.push(new He(n,r,'missing required property "source"'));return e=e.concat(Rr({key:n,value:r,valueSpec:l.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>$i({key:`${n}.type`,value:r.type,valueSpec:l.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"}),filter:m=>Vl(Nn({layerType:h},m)),layout:m=>Rr({layer:r,key:m.key,value:m.value,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":y=>ou(Nn({layerType:h},y))}}),paint:m=>Rr({layer:r,key:m.key,value:m.value,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":y=>nu(Nn({layerType:h},y))}})}})),e}function jo(t){const e=t.value,r=t.key,n=Gt(e);return n!=="string"?[new He(r,e,`string expected, ${n} found`)]:[]}const Nl={promoteId:function({key:t,value:e}){if(Gt(e)==="string")return jo({key:t,value:e});{const r=[];for(const n in e)r.push(...jo({key:`${t}.${n}`,value:e[n]}));return r}}};function su(t){const e=t.value,r=t.key,n=t.styleSpec,a=t.style;if(!e.type)return[new He(r,e,'"type" is required')];const l=Si(e.type);let h;switch(l){case"vector":case"raster":case"raster-dem":return h=Rr({key:r,value:e,valueSpec:n[`source_${l.replace("-","_")}`],style:t.style,styleSpec:n,objectElementValidators:Nl}),h;case"geojson":if(h=Rr({key:r,value:e,valueSpec:n.source_geojson,style:a,styleSpec:n,objectElementValidators:Nl}),e.cluster)for(const p in e.clusterProperties){const[m,y]=e.clusterProperties[p],v=typeof m=="string"?[m,["accumulated"],["get",p]]:m;h.push(...In({key:`${r}.${p}.map`,value:y,expressionContext:"cluster-map"})),h.push(...In({key:`${r}.${p}.reduce`,value:v,expressionContext:"cluster-reduce"}))}return h;case"video":return Rr({key:r,value:e,valueSpec:n.source_video,style:a,styleSpec:n});case"image":return Rr({key:r,value:e,valueSpec:n.source_image,style:a,styleSpec:n});case"canvas":return[new He(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return La({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:a,styleSpec:n})}}function jl(t){const e=t.value,r=t.styleSpec,n=r.light,a=t.style;let l=[];const h=Gt(e);if(e===void 0)return l;if(h!=="object")return l=l.concat([new He("light",e,`object expected, ${h} found`)]),l;for(const p in e){const m=p.match(/^(.*)-transition$/);l=l.concat(m&&n[m[1]]&&n[m[1]].transition?$i({key:p,value:e[p],valueSpec:r.transition,style:a,styleSpec:r}):n[p]?$i({key:p,value:e[p],valueSpec:n[p],style:a,styleSpec:r}):[new He(p,e[p],`unknown property "${p}"`)])}return l}function Gl(t){const e=t.value,r=t.key,n=t.style,a=t.styleSpec,l=a.terrain;let h=[];const p=Gt(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new He("terrain",e,`object expected, ${p} found`)]),h;for(const m in e){const y=m.match(/^(.*)-transition$/);h=h.concat(y&&l[y[1]]&&l[y[1]].transition?$i({key:m,value:e[m],valueSpec:a.transition,style:n,styleSpec:a}):l[m]?$i({key:m,value:e[m],valueSpec:l[m],style:n,styleSpec:a}):[new He(m,e[m],`unknown property "${m}"`)])}if(e.source){const m=n.sources&&n.sources[e.source],y=m&&Si(m.type);m?y!=="raster-dem"&&h.push(new He(r,e.source,`terrain cannot be used with a source of type ${y}, it only be used with a "raster-dem" source type`)):h.push(new He(r,e.source,`source "${e.source}" not found`))}else h.push(new He(r,e,'terrain is missing required property "source"'));return h}function $l(t){const e=t.value,r=t.style,n=t.styleSpec,a=n.fog;let l=[];const h=Gt(e);if(e===void 0)return l;if(h!=="object")return l=l.concat([new He("fog",e,`object expected, ${h} found`)]),l;for(const p in e){const m=p.match(/^(.*)-transition$/);l=l.concat(m&&a[m[1]]&&a[m[1]].transition?$i({key:p,value:e[p],valueSpec:n.transition,style:r,styleSpec:n}):a[p]?$i({key:p,value:e[p],valueSpec:a[p],style:r,styleSpec:n}):[new He(p,e[p],`unknown property "${p}"`)])}return l}const Zl={"*":()=>[],array:Rl,boolean:function(t){const e=t.value,r=t.key,n=Gt(e);return n!=="boolean"?[new He(r,e,`boolean expected, ${n} found`)]:[]},number:Qc,color:function(t){const e=t.key,r=t.value,n=Gt(r);return n!=="string"?[new He(e,r,`color expected, ${n} found`)]:Ro.parseCSSColor(r)===null?[new He(e,r,`color expected, "${r}" found`)]:[]},constants:Cc,enum:La,filter:Vl,function:Da,layer:Rs,object:Rr,source:su,light:jl,terrain:Gl,fog:$l,string:jo,formatted:function(t){return jo(t).length===0?[]:In(t)},resolvedImage:function(t){return jo(t).length===0?[]:In(t)},projection:function(t){const e=t.value,r=t.styleSpec,n=r.projection,a=t.style;let l=[];const h=Gt(e);if(h==="object")for(const p in e)l=l.concat($i({key:p,value:e[p],valueSpec:n[p],style:a,styleSpec:r}));else h!=="string"&&(l=l.concat([new He("projection",e,`object or string expected, ${h} found`)]));return l}};function $i(t){const e=t.value,r=t.valueSpec,n=t.styleSpec;return r.expression&&Ca(Si(e))?Da(t):r.expression&&Uo(En(e))?In(t):r.type&&Zl[r.type]?Zl[r.type](t):Rr(Nn({},t,{valueSpec:r.type?n[r.type]:r}))}function ql(t){const e=t.value,r=t.key,n=jo(t);return n.length||(e.indexOf("{fontstack}")===-1&&n.push(new He(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&n.push(new He(r,e,'"glyphs" url must include a "{range}" token'))),n}function Mn(t,e=xe){let r=[];return r=r.concat($i({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:ql,"*":()=>[]}})),t.constants&&(r=r.concat(Cc({key:"constants",value:t.constants,style:t,styleSpec:e}))),au(r)}function au(t){return[].concat(t).sort((e,r)=>e.line-r.line)}function Kr(t){return function(...e){return au(t.apply(this,e))}}Mn.source=Kr(su),Mn.light=Kr(jl),Mn.terrain=Kr(Gl),Mn.fog=Kr($l),Mn.layer=Kr(Rs),Mn.filter=Kr(Vl),Mn.paintProperty=Kr(nu),Mn.layoutProperty=Kr(ou);const Go=Mn,$o=Go.light,Ch=Go.fog,Wl=Go.paintProperty,zh=Go.layoutProperty;function lu(t,e){let r=!1;if(e&&e.length)for(const n of e)t.fire(new la(new Error(n.message))),r=!0;return r}var Fs=ar;function ar(t,e,r){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var a=new Int32Array(this.arrayBuffer);t=a[0],this.d=(e=a[1])+2*(r=a[2]);for(var l=0;l<this.d*this.d;l++){var h=a[3+l],p=a[3+l+1];n.push(h===p?null:a.subarray(h,p))}var m=a[3+n.length+1];this.keys=a.subarray(a[3+n.length],m),this.bboxes=a.subarray(m),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var y=0;y<this.d*this.d;y++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var v=r/e*t;this.min=-v,this.max=t+v}ar.prototype.insert=function(t,e,r,n,a){this._forEachCell(e,r,n,a,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(a)},ar.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ar.prototype._insertCell=function(t,e,r,n,a,l){this.cells[a].push(l)},ar.prototype.query=function(t,e,r,n,a){var l=this.min,h=this.max;if(t<=l&&e<=l&&h<=r&&h<=n&&!a)return Array.prototype.slice.call(this.keys);var p=[];return this._forEachCell(t,e,r,n,this._queryCell,p,{},a),p},ar.prototype._queryCell=function(t,e,r,n,a,l,h,p){var m=this.cells[a];if(m!==null)for(var y=this.keys,v=this.bboxes,w=0;w<m.length;w++){var T=m[w];if(h[T]===void 0){var C=4*T;(p?p(v[C+0],v[C+1],v[C+2],v[C+3]):t<=v[C+2]&&e<=v[C+3]&&r>=v[C+0]&&n>=v[C+1])?(h[T]=!0,l.push(y[T])):h[T]=!1}}},ar.prototype._forEachCell=function(t,e,r,n,a,l,h,p){for(var m=this._convertToCellCoord(t),y=this._convertToCellCoord(e),v=this._convertToCellCoord(r),w=this._convertToCellCoord(n),T=m;T<=v;T++)for(var C=y;C<=w;C++){var P=this.d*C+T;if((!p||p(this._convertFromCellCoord(T),this._convertFromCellCoord(C),this._convertFromCellCoord(T+1),this._convertFromCellCoord(C+1)))&&a.call(this,t,e,r,n,P,l,h,p))return}},ar.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ar.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ar.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var a=new Int32Array(e+r+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var l=e,h=0;h<t.length;h++){var p=t[h];a[3+h]=l,a.set(p,l),l+=p.length}return a[3+t.length]=l,a.set(this.keys,l),a[3+t.length+1]=l+=this.keys.length,a.set(this.bboxes,l),l+=this.bboxes.length,a.buffer};const{ImageData:Os,ImageBitmap:Zo}=fe,Us={};function Ye(t,e,r={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Us[t]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}Ye("Object",Object),Fs.serialize=function(t,e){const r=t.toArrayBuffer();return e&&e.push(r),{buffer:r}},Fs.deserialize=function(t){return new Fs(t.buffer)},Ye("Grid",Fs),Ye("Color",Ft),Ye("Error",Error),Ye("ResolvedImage",Lr),Ye("StylePropertyFunction",Vo),Ye("StyleExpression",Ll,{omit:["_evaluator"]}),Ye("ZoomDependentExpression",Bl),Ye("ZoomConstantExpression",Ls),Ye("CompoundExpression",Er,{omit:["_evaluate"]});for(const t in Hr)Hr[t]._classRegistryKey||Ye(`Expression_${t}`,Hr[t]);function qo(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function cu(t){return Zo&&t instanceof Zo}function Vs(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(qo(t)||cu(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const r=t;return e&&e.push(r.buffer),r}if(t instanceof Os)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const r=[];for(const n of t)r.push(Vs(n,e));return r}if(typeof t=="object"){const r=t.constructor,n=r._classRegistryKey;if(!n)throw new Error("can't serialize object of unregistered class");const a=r.serialize?r.serialize(t,e):{};if(!r.serialize){for(const l in t){if(!t.hasOwnProperty(l)||Us[n].omit.indexOf(l)>=0)continue;const h=t[l];a[l]=Us[n].shallow.indexOf(l)>=0?h:Vs(h,e)}t instanceof Error&&(a.message=t.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(a.$name=n),a}throw new Error("can't serialize object of type "+typeof t)}function Hn(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||qo(t)||cu(t)||ArrayBuffer.isView(t)||t instanceof Os)return t;if(Array.isArray(t))return t.map(Hn);if(typeof t=="object"){const e=t.$name||"Object",{klass:r}=Us[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(t);const n=Object.create(r.prototype);for(const a of Object.keys(t)){if(a==="$name")continue;const l=t[a];n[a]=Us[e].shallow.indexOf(a)>=0?l:Hn(l)}return n}throw new Error("can't deserialize object of type "+typeof t)}class c{constructor(){this.first=!0}update(e,r){const n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}const i=t=>t>=1536&&t<=1791,o=t=>t>=1872&&t<=1919,u=t=>t>=2208&&t<=2303,d=t=>t>=11904&&t<=12031,f=t=>t>=12032&&t<=12255,g=t=>t>=12272&&t<=12287,x=t=>t>=12288&&t<=12351,E=t=>t>=12352&&t<=12447,S=t=>t>=12448&&t<=12543,I=t=>t>=12544&&t<=12591,z=t=>t>=12704&&t<=12735,L=t=>t>=12736&&t<=12783,V=t=>t>=12784&&t<=12799,F=t=>t>=12800&&t<=13055,N=t=>t>=13056&&t<=13311,J=t=>t>=13312&&t<=19903,U=t=>t>=19968&&t<=40959,H=t=>t>=40960&&t<=42127,K=t=>t>=42128&&t<=42191,W=t=>t>=44032&&t<=55215,X=t=>t>=63744&&t<=64255,Q=t=>t>=64336&&t<=65023,he=t=>t>=65040&&t<=65055,ge=t=>t>=65072&&t<=65103,Ge=t=>t>=65104&&t<=65135,De=t=>t>=65136&&t<=65279,Pe=t=>t>=65280&&t<=65519;function ve(t){for(const e of t)if(Se(e.charCodeAt(0)))return!0;return!1}function me(t){for(const e of t)if(!Ae(e.charCodeAt(0)))return!1;return!0}function Ae(t){return!(i(t)||o(t)||u(t)||Q(t)||De(t))}function Se(t){return!(t!==746&&t!==747&&(t<4352||!(z(t)||I(t)||ge(t)&&!(t>=65097&&t<=65103)||X(t)||N(t)||d(t)||L(t)||!(!x(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||J(t)||U(t)||F(t)||(e=>e>=12592&&e<=12687)(t)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||W(t)||E(t)||g(t)||(e=>e>=12688&&e<=12703)(t)||f(t)||V(t)||S(t)&&t!==12540||!(!Pe(t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Ge(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||he(t)||(e=>e>=19904&&e<=19967)(t)||H(t)||K(t))))}function rt(t){return!(Se(t)||function(e){return!!((r=>r>=128&&r<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(r=>r>=8192&&r<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(r=>r>=8448&&r<=8527)(e)||(r=>r>=8528&&r<=8591)(e)||(r=>r>=8960&&r<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(r=>r>=9216&&r<=9279)(e)&&e!==9251||(r=>r>=9280&&r<=9311)(e)||(r=>r>=9312&&r<=9471)(e)||(r=>r>=9632&&r<=9727)(e)||(r=>r>=9728&&r<=9983)(e)&&!(e>=9754&&e<=9759)||(r=>r>=11008&&r<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||x(e)||S(e)||(r=>r>=57344&&r<=63743)(e)||ge(e)||Ge(e)||Pe(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function ut(t){return t>=1424&&t<=2303||Q(t)||De(t)}function bt(t,e){return!(!e&&ut(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(r=>r>=6016&&r<=6143)(t))}function je(t){for(const e of t)if(ut(e.charCodeAt(0)))return!0;return!1}const ot="deferred",mt="loading",Kt="loaded";let ri=null,pt="unavailable",It=null;const pi=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(pt="error"),ri&&ri(t)};function Ri(){fr.fire(new Un("pluginStateChange",{pluginStatus:pt,pluginURL:It}))}const fr=new Vn,Fr=function(){return pt},Yr=function(){if(pt!==ot||!It)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");pt=mt,Ri(),It&&ms({url:It},t=>{t?pi(t):(pt=Kt,Ri())})},Lt={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>pt===Kt||Lt.applyArabicShaping!=null,isLoading:()=>pt===mt,setState(t){pt=t.pluginStatus,It=t.pluginURL},isParsed:()=>Lt.applyArabicShaping!=null&&Lt.processBidirectionalText!=null&&Lt.processStyledBidirectionalText!=null,getPluginURL:()=>It};class _t{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new c,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,n){for(const a of r)if(!bt(a.charCodeAt(0),n))return!1;return!0}(e,Lt.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*r}}}class Pt{constructor(e,r){this.property=e,this.value=r,this.expression=function(n,a){if(Ca(n))return new Vo(n,a);if(Uo(n)){const l=Jc(n,a);if(l.result==="error")throw new Error(l.value.map(h=>`${h.key}: ${h.message}`).join(", "));return l.value}{let l=n;return typeof n=="string"&&a.type==="color"&&(l=Ft.parse(n)),{kind:"constant",evaluate:()=>l}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,n){return this.property.possiblyEvaluate(this,e,r,n)}}class Ti{constructor(e){this.property=e,this.value=new Pt(e,void 0)}transitioned(e,r){return new ci(this.property,this.value,r,Je({},e.transition,this.transition),e.now)}untransitioned(){return new ci(this.property,this.value,null,{},0)}}class Sr{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return or(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Ti(this._values[e].property)),this._values[e].value=new Pt(this._values[e].property,r===null?void 0:or(r))}getTransition(e){return or(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Ti(this._values[e].property)),this._values[e].transition=or(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(e[r]=n);const a=this.getTransition(r);a!==void 0&&(e[`${r}-transition`]=a)}return e}transitioned(e,r){const n=new Ir(this._properties);for(const a of Object.keys(this._values))n._values[a]=this._values[a].transitioned(e,r._values[a]);return n}untransitioned(){const e=new Ir(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class ci{constructor(e,r,n,a,l){const h=a.delay||0,p=a.duration||0;l=l||0,this.property=e,this.value=r,this.begin=l+h,this.end=this.begin+p,e.specification.transition&&(a.delay||a.duration)&&(this.prior=n)}possiblyEvaluate(e,r,n){const a=e.now||0,l=this.value.possiblyEvaluate(e,r,n),h=this.prior;if(h){if(a>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(a<this.begin)return h.possiblyEvaluate(e,r,n);{const p=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(e,r,n),l,Fe(p))}}return l}}class Ir{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,n){const a=new mo(this._properties);for(const l of Object.keys(this._values))a._values[l]=this._values[l].possiblyEvaluate(e,r,n);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ns{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return or(this._values[e].value)}setValue(e,r){this._values[e]=new Pt(this._values[e].property,r===null?void 0:or(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(e[r]=n)}return e}possiblyEvaluate(e,r,n){const a=new mo(this._properties);for(const l of Object.keys(this._values))a._values[l]=this._values[l].possiblyEvaluate(e,r,n);return a}}class mr{constructor(e,r,n){this.property=e,this.value=r,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,n,a){return this.property.evaluate(this.value,this.parameters,e,r,n,a)}}class mo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class et{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,n){const a=ya[this.specification.type];return a?a(e,r,n):e}}class st{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,n,a){return new mr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},n,a)}:e.expression,r)}interpolate(e,r,n){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new mr(this,{kind:"constant",value:void 0},e.parameters);const a=ya[this.specification.type];return a?new mr(this,{kind:"constant",value:a(e.value.value,r.value.value,n)},e.parameters):e}evaluate(e,r,n,a,l,h){return e.kind==="constant"?e.value:e.evaluate(r,n,a,l,h)}}class Zi extends st{possiblyEvaluate(e,r,n,a){if(e.value===void 0)return new mr(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const l=e.expression.evaluate(r,null,{},n,a),h=e.property.specification.type==="resolvedImage"&&typeof l!="string"?l.name:l,p=this._calculate(h,h,h,r);return new mr(this,{kind:"constant",value:p},r)}if(e.expression.kind==="camera"){const l=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new mr(this,{kind:"constant",value:l},r)}return new mr(this,e.expression,r)}evaluate(e,r,n,a,l,h){if(e.kind==="source"){const p=e.evaluate(r,n,a,l,h);return this._calculate(p,p,p,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},n,a),e.evaluate({zoom:Math.floor(r.zoom)},n,a),e.evaluate({zoom:Math.floor(r.zoom)+1},n,a),r):e.value}_calculate(e,r,n,a){return a.zoom>a.zoomHistory.lastIntegerZoom?{from:e,to:r,other:n}:{from:n,to:r,other:e}}interpolate(e){return e}}class _o{constructor(e){this.specification=e}possiblyEvaluate(e,r,n,a){if(e.value!==void 0){if(e.expression.kind==="constant"){const l=e.expression.evaluate(r,null,{},n,a);return this._calculate(l,l,l,r)}return this._calculate(e.expression.evaluate(new _t(Math.floor(r.zoom-1),r)),e.expression.evaluate(new _t(Math.floor(r.zoom),r)),e.expression.evaluate(new _t(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,n,a){return a.zoom>a.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:n,to:r}}interpolate(e){return e}}class Kn{constructor(e){this.specification=e}possiblyEvaluate(e,r,n,a){return!!e.expression.evaluate(r,null,{},n,a)}interpolate(){return!1}}class Qi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const n=e[r];n.specification.overridable&&this.overridableProperties.push(r);const a=this.defaultPropertyValues[r]=new Pt(n,void 0),l=this.defaultTransitionablePropertyValues[r]=new Ti(n);this.defaultTransitioningPropertyValues[r]=l.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=a.possiblyEvaluate({})}}}function Lp(t,e){return 256*(t=ze(Math.floor(t),0,255))+ze(Math.floor(e),0,255)}Ye("DataDrivenProperty",st),Ye("DataConstantProperty",et),Ye("CrossFadedDataDrivenProperty",Zi),Ye("CrossFadedProperty",_o),Ye("ColorRampProperty",Kn);const hg={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Xl{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ai{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function xi(t,e=1){let r=0,n=0;return{members:t.map(a=>{const l=hg[a.type].BYTES_PER_ELEMENT,h=r=Bp(r,Math.max(e,l)),p=a.components||1;return n=Math.max(n,l),r+=l*p,{name:a.name,type:a.type,components:p,offset:h}}),size:Bp(r,Math.max(n,e)),alignment:e}}function Bp(t,e){return Math.ceil(t/e)*e}class Va extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const a=2*e;return this.int16[a+0]=r,this.int16[a+1]=n,e}}Va.prototype.bytesPerElement=4,Ye("StructArrayLayout2i4",Va);class Na extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,n,a)}emplace(e,r,n,a,l){const h=4*e;return this.int16[h+0]=r,this.int16[h+1]=n,this.int16[h+2]=a,this.int16[h+3]=l,e}}Na.prototype.bytesPerElement=8,Ye("StructArrayLayout4i8",Na);class Ph extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,n,a,l,h,p)}emplace(e,r,n,a,l,h,p,m){const y=6*e,v=12*e,w=3*e;return this.int16[y+0]=r,this.int16[y+1]=n,this.uint8[v+4]=a,this.uint8[v+5]=l,this.uint8[v+6]=h,this.uint8[v+7]=p,this.float32[w+2]=m,e}}Ph.prototype.bytesPerElement=12,Ye("StructArrayLayout2i4ub1f12",Ph);class ja extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,n)}emplace(e,r,n,a){const l=3*e;return this.float32[l+0]=r,this.float32[l+1]=n,this.float32[l+2]=a,e}}ja.prototype.bytesPerElement=12,Ye("StructArrayLayout3f12",ja);class Wo extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h,p,m,y,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,r,n,a,l,h,p,m,y,v)}emplace(e,r,n,a,l,h,p,m,y,v,w){const T=10*e;return this.uint16[T+0]=r,this.uint16[T+1]=n,this.uint16[T+2]=a,this.uint16[T+3]=l,this.uint16[T+4]=h,this.uint16[T+5]=p,this.uint16[T+6]=m,this.uint16[T+7]=y,this.uint16[T+8]=v,this.uint16[T+9]=w,e}}Wo.prototype.bytesPerElement=20,Ye("StructArrayLayout10ui20",Wo);class uu extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h,p,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,n,a,l,h,p,m)}emplace(e,r,n,a,l,h,p,m,y){const v=8*e;return this.uint16[v+0]=r,this.uint16[v+1]=n,this.uint16[v+2]=a,this.uint16[v+3]=l,this.uint16[v+4]=h,this.uint16[v+5]=p,this.uint16[v+6]=m,this.uint16[v+7]=y,e}}uu.prototype.bytesPerElement=16,Ye("StructArrayLayout8ui16",uu);class kh extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h,p,m,y,v,w,T,C,P,B,O){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,r,n,a,l,h,p,m,y,v,w,T,C,P,B,O)}emplace(e,r,n,a,l,h,p,m,y,v,w,T,C,P,B,O,Z){const Y=16*e;return this.int16[Y+0]=r,this.int16[Y+1]=n,this.int16[Y+2]=a,this.int16[Y+3]=l,this.uint16[Y+4]=h,this.uint16[Y+5]=p,this.uint16[Y+6]=m,this.uint16[Y+7]=y,this.int16[Y+8]=v,this.int16[Y+9]=w,this.int16[Y+10]=T,this.int16[Y+11]=C,this.int16[Y+12]=P,this.int16[Y+13]=B,this.int16[Y+14]=O,this.int16[Y+15]=Z,e}}kh.prototype.bytesPerElement=32,Ye("StructArrayLayout4i4ui4i4i32",kh);class Dh extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Dh.prototype.bytesPerElement=4,Ye("StructArrayLayout1ul4",Dh);class Lh extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h,p,m,y,v,w,T,C){const P=this.length;return this.resize(P+1),this.emplace(P,e,r,n,a,l,h,p,m,y,v,w,T,C)}emplace(e,r,n,a,l,h,p,m,y,v,w,T,C,P){const B=20*e,O=10*e;return this.int16[B+0]=r,this.int16[B+1]=n,this.int16[B+2]=a,this.int16[B+3]=l,this.int16[B+4]=h,this.float32[O+3]=p,this.float32[O+4]=m,this.float32[O+5]=y,this.float32[O+6]=v,this.int16[B+14]=w,this.uint32[O+8]=T,this.uint16[B+18]=C,this.uint16[B+19]=P,e}}Lh.prototype.bytesPerElement=40,Ye("StructArrayLayout5i4f1i1ul2ui40",Lh);class hu extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,n,a,l,h,p)}emplace(e,r,n,a,l,h,p,m){const y=8*e;return this.int16[y+0]=r,this.int16[y+1]=n,this.int16[y+2]=a,this.int16[y+4]=l,this.int16[y+5]=h,this.int16[y+6]=p,this.int16[y+7]=m,e}}hu.prototype.bytesPerElement=16,Ye("StructArrayLayout3i2i2i16",hu);class Bh extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,n,a,l)}emplace(e,r,n,a,l,h){const p=4*e,m=8*e;return this.float32[p+0]=r,this.float32[p+1]=n,this.float32[p+2]=a,this.int16[m+6]=l,this.int16[m+7]=h,e}}Bh.prototype.bytesPerElement=16,Ye("StructArrayLayout2f1f2i16",Bh);class Rh extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,n,a)}emplace(e,r,n,a,l){const h=12*e,p=3*e;return this.uint8[h+0]=r,this.uint8[h+1]=n,this.float32[p+1]=a,this.float32[p+2]=l,e}}Rh.prototype.bytesPerElement=12,Ye("StructArrayLayout2ub2f12",Rh);class Jr extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,n)}emplace(e,r,n,a){const l=3*e;return this.uint16[l+0]=r,this.uint16[l+1]=n,this.uint16[l+2]=a,e}}Jr.prototype.bytesPerElement=6,Ye("StructArrayLayout3ui6",Jr);class Fh extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h,p,m,y,v,w,T,C,P,B,O,Z,Y,ie,se,ae){const le=this.length;return this.resize(le+1),this.emplace(le,e,r,n,a,l,h,p,m,y,v,w,T,C,P,B,O,Z,Y,ie,se,ae)}emplace(e,r,n,a,l,h,p,m,y,v,w,T,C,P,B,O,Z,Y,ie,se,ae,le){const Te=30*e,be=15*e,$e=60*e;return this.int16[Te+0]=r,this.int16[Te+1]=n,this.int16[Te+2]=a,this.float32[be+2]=l,this.float32[be+3]=h,this.uint16[Te+8]=p,this.uint16[Te+9]=m,this.uint32[be+5]=y,this.uint32[be+6]=v,this.uint32[be+7]=w,this.uint16[Te+16]=T,this.uint16[Te+17]=C,this.uint16[Te+18]=P,this.float32[be+10]=B,this.float32[be+11]=O,this.uint8[$e+48]=Z,this.uint8[$e+49]=Y,this.uint8[$e+50]=ie,this.uint32[be+13]=se,this.int16[Te+28]=ae,this.uint8[$e+58]=le,e}}Fh.prototype.bytesPerElement=60,Ye("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",Fh);class Oh extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h,p,m,y,v,w,T,C,P,B,O,Z,Y,ie,se,ae,le,Te,be,$e,Oe,we,Ve,Ze,Ce){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,e,r,n,a,l,h,p,m,y,v,w,T,C,P,B,O,Z,Y,ie,se,ae,le,Te,be,$e,Oe,we,Ve,Ze,Ce)}emplace(e,r,n,a,l,h,p,m,y,v,w,T,C,P,B,O,Z,Y,ie,se,ae,le,Te,be,$e,Oe,we,Ve,Ze,Ce,Ke){const tt=38*e,Dt=19*e;return this.int16[tt+0]=r,this.int16[tt+1]=n,this.int16[tt+2]=a,this.float32[Dt+2]=l,this.float32[Dt+3]=h,this.int16[tt+8]=p,this.int16[tt+9]=m,this.int16[tt+10]=y,this.int16[tt+11]=v,this.int16[tt+12]=w,this.int16[tt+13]=T,this.uint16[tt+14]=C,this.uint16[tt+15]=P,this.uint16[tt+16]=B,this.uint16[tt+17]=O,this.uint16[tt+18]=Z,this.uint16[tt+19]=Y,this.uint16[tt+20]=ie,this.uint16[tt+21]=se,this.uint16[tt+22]=ae,this.uint16[tt+23]=le,this.uint16[tt+24]=Te,this.uint16[tt+25]=be,this.uint16[tt+26]=$e,this.uint16[tt+27]=Oe,this.uint16[tt+28]=we,this.uint32[Dt+15]=Ve,this.float32[Dt+16]=Ze,this.float32[Dt+17]=Ce,this.float32[Dt+18]=Ke,e}}Oh.prototype.bytesPerElement=76,Ye("StructArrayLayout3i2f6i15ui1ul3f76",Oh);class du extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}du.prototype.bytesPerElement=4,Ye("StructArrayLayout1f4",du);class Uh extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,n)}emplace(e,r,n,a){const l=3*e;return this.int16[l+0]=r,this.int16[l+1]=n,this.int16[l+2]=a,e}}Uh.prototype.bytesPerElement=6,Ye("StructArrayLayout3i6",Uh);class Hl extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,l,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,n,a,l,h,p)}emplace(e,r,n,a,l,h,p,m){const y=7*e;return this.float32[y+0]=r,this.float32[y+1]=n,this.float32[y+2]=a,this.float32[y+3]=l,this.float32[y+4]=h,this.float32[y+5]=p,this.float32[y+6]=m,e}}Hl.prototype.bytesPerElement=28,Ye("StructArrayLayout7f28",Hl);class Vh extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,n,a)}emplace(e,r,n,a,l){const h=6*e;return this.uint32[3*e+0]=r,this.uint16[h+2]=n,this.uint16[h+3]=a,this.uint16[h+4]=l,e}}Vh.prototype.bytesPerElement=12,Ye("StructArrayLayout1ul3ui12",Vh);class Xo extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const a=2*e;return this.uint16[a+0]=r,this.uint16[a+1]=n,e}}Xo.prototype.bytesPerElement=4,Ye("StructArrayLayout2ui4",Xo);class pu extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}pu.prototype.bytesPerElement=2,Ye("StructArrayLayout1ui2",pu);class fu extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const a=2*e;return this.float32[a+0]=r,this.float32[a+1]=n,e}}fu.prototype.bytesPerElement=8,Ye("StructArrayLayout2f8",fu);class Nh extends Ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,n,a)}emplace(e,r,n,a,l){const h=4*e;return this.float32[h+0]=r,this.float32[h+1]=n,this.float32[h+2]=a,this.float32[h+3]=l,e}}Nh.prototype.bytesPerElement=16,Ye("StructArrayLayout4f16",Nh);class Rp extends Xl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Rp.prototype.size=40;class jh extends Lh{get(e){return new Rp(this,e)}}Ye("CollisionBoxArray",jh);class Fp extends Xl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Fp.prototype.size=60;class Op extends Fh{get(e){return new Fp(this,e)}}Ye("PlacedSymbolArray",Op);class Up extends Xl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Up.prototype.size=76;class Vp extends Oh{get(e){return new Up(this,e)}}Ye("SymbolInstanceArray",Vp);class Np extends du{getoffsetX(e){return this.float32[1*e+0]}}Ye("GlyphOffsetArray",Np);class jp extends Uh{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ye("SymbolLineVertexArray",jp);class Gp extends Xl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Gp.prototype.size=12;class $p extends Vh{get(e){return new Gp(this,e)}}Ye("FeatureIndexArray",$p);class Zp extends Xl{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Zp.prototype.size=4;class qp extends Xo{get(e){return new Zp(this,e)}}Ye("FillExtrusionCentroidArray",qp);const dg=xi([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),pg=xi([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Wp=Bo(function(t){t.exports=function(e,r){var n,a,l,h,p,m,y,v;for(a=e.length-(n=3&e.length),l=r,p=3432918353,m=461845907,v=0;v<a;)y=255&e.charCodeAt(v)|(255&e.charCodeAt(++v))<<8|(255&e.charCodeAt(++v))<<16|(255&e.charCodeAt(++v))<<24,++v,l=27492+(65535&(h=5*(65535&(l=(l^=y=(65535&(y=(y=(65535&y)*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*m+(((y>>>16)*m&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(y=0,n){case 3:y^=(255&e.charCodeAt(v+2))<<16;case 2:y^=(255&e.charCodeAt(v+1))<<8;case 1:l^=y=(65535&(y=(y=(65535&(y^=255&e.charCodeAt(v)))*p+(((y>>>16)*p&65535)<<16)&4294967295)<<15|y>>>17))*m+(((y>>>16)*m&65535)<<16)&4294967295}return l^=e.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0}}),fg=Bo(function(t){t.exports=function(e,r){for(var n,a=e.length,l=r^a,h=0;a>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(h)|(255&e.charCodeAt(++h))<<8|(255&e.charCodeAt(++h))<<16|(255&e.charCodeAt(++h))<<24))+((1540483477*(n>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++h;switch(a){case 3:l^=(255&e.charCodeAt(h+2))<<16;case 2:l^=(255&e.charCodeAt(h+1))<<8;case 1:l=1540483477*(65535&(l^=255&e.charCodeAt(h)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0}}),Kl=Wp,mg=fg;Kl.murmur3=Wp,Kl.murmur2=mg;class mu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,n,a){this.ids.push(Xp(e)),this.positions.push(r,n,a)}getPositions(e){const r=Xp(e);let n=0,a=this.ids.length-1;for(;n<a;){const h=n+a>>1;this.ids[h]>=r?a=h:n=h+1}const l=[];for(;this.ids[n]===r;)l.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return l}static serialize(e,r){const n=new Float64Array(e.ids),a=new Uint32Array(e.positions);return Gh(n,a,0,n.length-1),r&&r.push(n.buffer,a.buffer),{ids:n,positions:a}}static deserialize(e){const r=new mu;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Xp(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Kl(String(t))}function Gh(t,e,r,n){for(;r<n;){const a=t[r+n>>1];let l=r-1,h=n+1;for(;;){do l++;while(t[l]<a);do h--;while(t[h]>a);if(l>=h)break;_u(t,l,h),_u(e,3*l,3*h),_u(e,3*l+1,3*h+1),_u(e,3*l+2,3*h+2)}h-r<n-h?(Gh(t,e,r,h),r=h+1):(Gh(t,e,h+1,n),n=h)}}function _u(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}Ye("FeaturePositionMap",mu);class go{constructor(e,r){this.gl=e.gl,this.location=r}}class gu extends go{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Hp extends go{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Kp extends go{constructor(e,r){super(e,r),this.current=Ft.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const _g=new Float32Array(16),gg=new Float32Array(9),yg=new Float32Array(4);function $h(t){return[Lp(255*t.r,255*t.g),Lp(255*t.b,255*t.a)]}class Yl{constructor(e,r,n){this.value=e,this.uniformNames=r.map(a=>`u_${a}`),this.type=n}setUniform(e,r,n){e.set(n.constantOr(this.value))}getBinding(e,r,n){return this.type==="color"?new Kp(e,r):new gu(e,r)}}class Ga{constructor(e,r){this.uniformNames=r.map(n=>`u_${n}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tl.concat(r.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,r,n,a){const l=a==="u_pattern_to"||a==="u_dash_to"?this.patternTo:a==="u_pattern_from"||a==="u_dash_from"?this.patternFrom:a==="u_pixel_ratio_to"?this.pixelRatioTo:a==="u_pixel_ratio_from"?this.pixelRatioFrom:null;l&&e.set(l)}getBinding(e,r,n){return n==="u_pattern_from"||n==="u_pattern_to"||n==="u_dash_from"||n==="u_dash_to"?new Hp(e,r):new gu(e,r)}}class yo{constructor(e,r,n,a){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=r.map(l=>({name:`a_${l}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,r,n,a,l,h){const p=this.paintVertexArray.length,m=this.expression.evaluate(new _t(0),r,{},l,a,h);this.paintVertexArray.resize(e),this._setPaintValue(p,e,m)}updatePaintArray(e,r,n,a,l){const h=this.expression.evaluate({zoom:0},n,a,void 0,l);this._setPaintValue(e,r,h)}_setPaintValue(e,r,n){if(this.type==="color"){const a=$h(n);for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,a[0],a[1])}else{for(let a=e;a<r;a++)this.paintVertexArray.emplace(a,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class An{constructor(e,r,n,a,l,h){this.expression=e,this.uniformNames=r.map(p=>`u_${p}_t`),this.type=n,this.useIntegerZoom=a,this.zoom=l,this.maxValue=0,this.paintVertexAttributes=r.map(p=>({name:`a_${p}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,r,n,a,l,h){const p=this.expression.evaluate(new _t(this.zoom),r,{},l,a,h),m=this.expression.evaluate(new _t(this.zoom+1),r,{},l,a,h),y=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(y,e,p,m)}updatePaintArray(e,r,n,a,l){const h=this.expression.evaluate({zoom:this.zoom},n,a,void 0,l),p=this.expression.evaluate({zoom:this.zoom+1},n,a,void 0,l);this._setPaintValue(e,r,h,p)}_setPaintValue(e,r,n,a){if(this.type==="color"){const l=$h(n),h=$h(a);for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,l[0],l[1],h[0],h[1])}else{for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,n,a);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const n=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,a=ze(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(a)}getBinding(e,r,n){return new gu(e,r)}}class Ho{constructor(e,r,n,a,l,h,p){this.expression=e,this.type=n,this.useIntegerZoom=a,this.zoom=l,this.layerId=p,this.paintVertexAttributes=(n==="array"?pg:dg).members;for(let m=0;m<r.length;++m);this.zoomInPaintVertexArray=new h,this.zoomOutPaintVertexArray=new h}populatePaintArray(e,r,n){const a=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(a,e,r.patterns&&r.patterns[this.layerId],n)}updatePaintArray(e,r,n,a,l,h){this._setPaintValues(e,r,n.patterns&&n.patterns[this.layerId],h)}_setPaintValues(e,r,n,a){if(!a||!n)return;const{min:l,mid:h,max:p}=n,m=a[l],y=a[h],v=a[p];if(m&&y&&v)for(let w=e;w<r;w++)this._setPaintValue(this.zoomInPaintVertexArray,w,y,m),this._setPaintValue(this.zoomOutPaintVertexArray,w,y,v)}_setPaintValue(e,r,n,a){e.emplace(r,n.tl[0],n.tl[1],n.br[0],n.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],n.pixelRatio,a.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class xo{constructor(e,r,n=()=>!0){this.binders={},this._buffers=[];const a=[];for(const l in e.paint._values){if(!n(l))continue;const h=e.paint.get(l);if(!(h instanceof mr&&Oo(h.property.specification)))continue;const p=vg(l,e.type),m=h.value,y=h.property.specification.type,v=h.property.useIntegerZoom,w=h.property.specification["property-type"],T=w==="cross-faded"||w==="cross-faded-data-driven",C=String(l)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(m.kind!=="constant"||C)if(m.kind==="source"||C||T){const P=Yp(l,y,"source");this.binders[l]=T?new Ho(m,p,y,v,r,P,e.id):new yo(m,p,y,P),a.push(`/a_${l}`)}else{const P=Yp(l,y,"composite");this.binders[l]=new An(m,p,y,v,r,P),a.push(`/z_${l}`)}else this.binders[l]=T?new Ga(m.value,p):new Yl(m.value,p,y),a.push(`/u_${l}`)}this.cacheKey=a.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof yo||r instanceof An?r.maxValue:0}populatePaintArrays(e,r,n,a,l,h){for(const p in this.binders){const m=this.binders[p];(m instanceof yo||m instanceof An||m instanceof Ho)&&m.populatePaintArray(e,r,n,a,l,h)}}setConstantPatternPositions(e,r){for(const n in this.binders){const a=this.binders[n];a instanceof Ga&&a.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,n,a,l,h){let p=!1;for(const m in e){const y=r.getPositions(m);for(const v of y){const w=n.feature(v.index);for(const T in this.binders){const C=this.binders[T];if((C instanceof yo||C instanceof An||C instanceof Ho)&&C.expression.isStateDependent===!0){const P=a.paint.get(T);C.expression=P.value,C.updatePaintArray(v.start,v.end,w,e[m],l,h),p=!0}}}}return p}defines(){const e=[];for(const r in this.binders){const n=this.binders[r];(n instanceof Yl||n instanceof Ga)&&e.push(...n.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof yo||n instanceof An||n instanceof Ho)for(let a=0;a<n.paintVertexAttributes.length;a++)e.push(n.paintVertexAttributes[a].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof Yl||n instanceof Ga||n instanceof An)for(const a of n.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const n=[];for(const a in this.binders){const l=this.binders[a];if(l instanceof Yl||l instanceof Ga||l instanceof An){for(const h of l.uniformNames)if(r[h]){const p=l.getBinding(e,r[h],h);n.push({name:h,property:a,binding:p})}}}return n}setUniforms(e,r,n,a){for(const{name:l,property:h,binding:p}of r)this.binders[h].setUniform(p,a,n.get(h),l)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const n=this.binders[r];if(e&&n instanceof Ho){const a=e.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;a&&this._buffers.push(a)}else(n instanceof yo||n instanceof An)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const r in this.binders){const n=this.binders[r];(n instanceof yo||n instanceof An||n instanceof Ho)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof yo||r instanceof An||r instanceof Ho)&&r.destroy()}}}class js{constructor(e,r,n=()=>!0){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new xo(a,r,n);this.needsUpload=!1,this._featureMap=new mu,this._bufferOffset=0}populatePaintArrays(e,r,n,a,l,h,p){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(e,r,a,l,h,p);r.id!==void 0&&this._featureMap.add(r.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,n,a,l){for(const h of n)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(e,this._featureMap,r,h,a,l)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const xg={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function vg(t,e){return xg[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const bg={"line-pattern":{source:Wo,composite:Wo},"fill-pattern":{source:Wo,composite:Wo},"fill-extrusion-pattern":{source:Wo,composite:Wo},"line-dasharray":{source:uu,composite:uu}},wg={color:{source:fu,composite:Nh},number:{source:du,composite:fu}};function Yp(t,e,r){const n=bg[t];return n&&n[r]||wg[e][r]}Ye("ConstantBinder",Yl),Ye("CrossFadedConstantBinder",Ga),Ye("SourceExpressionBinder",yo),Ye("CrossFadedCompositeBinder",Ho),Ye("CompositeExpressionBinder",An),Ye("ProgramConfiguration",xo,{omit:["_buffers"]}),Ye("ProgramConfigurationSet",js);const yu="-transition";class Cn extends Vn{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Ns(r.layout)),r.paint)){this._transitionablePaint=new Sr(r.paint);for(const n in e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(const n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new mo(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,n={}){r!=null&&this._validate(zh,`layers.${this.id}.layout.${e}`,e,r,n)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return wr(e,yu)?this._transitionablePaint.getTransition(e.slice(0,-yu.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,n={}){if(r!=null&&this._validate(Wl,`layers.${this.id}.paint.${e}`,e,r,n))return!1;if(wr(e,yu))return this._transitionablePaint.setTransition(e.slice(0,-yu.length),r||void 0),!1;{const a=this._transitionablePaint._values[e],l=a.property.specification["property-type"]==="cross-faded-data-driven",h=a.value.isDataDriven(),p=a.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const m=this._transitionablePaint._values[e].value;return m.isDataDriven()||h||l||this._handleOverridablePaintPropertyUpdate(e,p,m)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),kr(e,(r,n)=>!(r===void 0||n==="layout"&&!Object.keys(r).length||n==="paint"&&!Object.keys(r).length))}_validate(e,r,n,a,l={}){return(!l||l.validate!==!1)&&lu(this,e.call(Go,{key:r,layerType:this.type,objectKey:n,value:a,styleSpec:xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof mr&&Oo(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ra(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Tg=xi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Eg}=Tg;class Ci{constructor(e=[]){this.segments=e}prepareSegment(e,r,n,a){let l=this.segments[this.segments.length-1];return e>Ci.MAX_VERTEX_ARRAY_LENGTH&&jt(`Max vertices per segment is ${Ci.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!l||l.vertexLength+e>Ci.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==a)&&(l={vertexOffset:r.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},a!==void 0&&(l.sortKey=a),this.segments.push(l)),l}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,n,a){return new Ci([{vertexOffset:e,primitiveOffset:r,vertexLength:n,primitiveLength:a,vaos:{},sortKey:0}])}}Ci.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ye("SegmentVector",Ci);var At=8192;class Gs{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Qt?new Qt(e.lng,e.lat):Qt.convert(e),this}setSouthWest(e){return this._sw=e instanceof Qt?new Qt(e.lng,e.lat):Qt.convert(e),this}extend(e){const r=this._sw,n=this._ne;let a,l;if(e instanceof Qt)a=e,l=e;else{if(!(e instanceof Gs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Gs.convert(e)):this.extend(Qt.convert(e)):this;if(a=e._sw,l=e._ne,!a||!l)return this}return r||n?(r.lng=Math.min(a.lng,r.lng),r.lat=Math.min(a.lat,r.lat),n.lng=Math.max(l.lng,n.lng),n.lat=Math.max(l.lat,n.lat)):(this._sw=new Qt(a.lng,a.lat),this._ne=new Qt(l.lng,l.lat)),this}getCenter(){return new Qt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Qt(this.getWest(),this.getNorth())}getSouthEast(){return new Qt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:n}=Qt.convert(e);let a=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&a}static convert(e){return!e||e instanceof Gs?e:new Gs(e)}}const Jp=63710088e-1;class Qt{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Qt(Ne(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,n=this.lat*r,a=e.lat*r,l=Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.cos((e.lng-this.lng)*r);return Jp*Math.acos(Math.min(l,1))}toBounds(e=0){const r=360*e/40075017,n=r/Math.cos(Math.PI/180*this.lat);return new Gs(new Qt(this.lng-n,this.lat-r),new Qt(this.lng+n,this.lat+r))}static convert(e){if(e instanceof Qt)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Qt(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Qt(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Qp=2*Math.PI*Jp;function ef(t){return Qp*Math.cos(t*Math.PI/180)}function $a(t){return(180+t)/360}function Za(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function zn(t,e){return t/ef(e)}function vo(t){return 360*t-180}function mn(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function tf(t,e){return t*ef(mn(e))}const Yn=85.051129;class xu{constructor(e,r,n=0){this.x=+e,this.y=+r,this.z=+n}static fromLngLat(e,r=0){const n=Qt.convert(e);return new xu($a(n.lng),Za(n.lat),zn(r,n.lat))}toLngLat(){return new Qt(vo(this.x),mn(this.y))}toAltitude(){return tf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Qp*(e=mn(this.y),1/Math.cos(e*Math.PI/180));var e}}function Zh(t,e,r,n,a,l,h,p,m){const y=(e+n)/2,v=(r+a)/2,w=new _e(y,v);p(w),function(T,C,P,B,O,Z){const Y=P-O,ie=B-Z;return Math.abs((B-C)*Y-(P-T)*ie)/Math.hypot(Y,ie)}(w.x,w.y,l.x,l.y,h.x,h.y)>=m?(Zh(t,e,r,y,v,l,w,p,m),Zh(t,y,v,n,a,w,h,p,m)):t.push(h)}function Sg(t,e,r){const n=[];let a,l,h;for(const p of t){const{x:m,y}=p;e(p),h?Zh(n,a,l,m,y,h,p,e,r):n.push(p),a=m,l=y,h=p}return n}const qh=Math.pow(2,14)-1,rf=-qh-1;function Ig(t,e){const r=Math.round(t.x*e),n=Math.round(t.y*e);return t.x=ze(r,rf,qh),t.y=ze(n,rf,qh),(r<t.x||r>t.x+1||n<t.y||n>t.y+1)&&jt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function bo(t,e,r){const n=t.loadGeometry(),a=t.extent,l=At/a;if(e&&r&&r.projection.isReprojectedInTileSpace){const h=1<<e.z,{scale:p,x:m,y,projection:v}=r,w=T=>{const C=vo((e.x+T.x/a)/h),P=mn((e.y+T.y/a)/h),B=v.project(C,P);T.x=(B.x*p-m)*a,T.y=(B.y*p-y)*a};for(let T=0;T<n.length;T++)if(t.type!==1)n[T]=Sg(n[T],w,1);else{const C=[];for(const P of n[T])P.x<0||P.x>=a||P.y<0||P.y>=a||(w(P),C.push(P));n[T]=C}}for(const h of n)for(const p of h)Ig(p,l);return n}function $s(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?bo(t):[]}}function vu(t,e,r,n,a){t.emplaceBack(2*e+(n+1)/2,2*r+(a+1)/2)}class Wh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Va,this.indexArray=new Jr,this.segments=new Ci,this.programConfigurations=new js(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n,a){const l=this.layers[0],h=[];let p=null;l.type==="circle"&&(p=l.layout.get("circle-sort-key"));for(const{feature:m,id:y,index:v,sourceLayerIndex:w}of e){const T=this.layers[0]._featureFilter.needGeometry,C=$s(m,T);if(!this.layers[0]._featureFilter.filter(new _t(this.zoom),C,n))continue;const P=p?p.evaluate(C,{},n):void 0,B={id:y,properties:m.properties,type:m.type,sourceLayerIndex:w,index:v,geometry:T?C.geometry:bo(m,n,a),patterns:{},sortKey:P};h.push(B)}p&&h.sort((m,y)=>m.sortKey-y.sortKey);for(const m of h){const{geometry:y,index:v,sourceLayerIndex:w}=m,T=e[v].feature;this.addFeature(m,y,v,r.availableImages,n),r.featureIndex.insert(T,y,v,w,this.index)}}update(e,r,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Eg),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,n,a,l){for(const h of r)for(const p of h){const m=p.x,y=p.y;if(m<0||m>=At||y<0||y>=At)continue;const v=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),w=v.vertexLength;vu(this.layoutVertexArray,m,y,-1,-1),vu(this.layoutVertexArray,m,y,1,-1),vu(this.layoutVertexArray,m,y,1,1),vu(this.layoutVertexArray,m,y,-1,1),this.indexArray.emplaceBack(w,w+1,w+2),this.indexArray.emplaceBack(w,w+3,w+2),v.vertexLength+=4,v.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},a,l)}}function nf(t,e){for(let r=0;r<t.length;r++)if(qa(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(qa(t,e[r]))return!0;return!!Xh(t,e)}function Mg(t,e,r){return!!qa(t,e)||!!Hh(e,t,r)}function of(t,e){if(t.length===1)return af(e,t[0]);for(let r=0;r<e.length;r++){const n=e[r];for(let a=0;a<n.length;a++)if(qa(t,n[a]))return!0}for(let r=0;r<t.length;r++)if(af(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(Xh(t,e[r]))return!0;return!1}function Ag(t,e,r){if(t.length>1){if(Xh(t,e))return!0;for(let n=0;n<e.length;n++)if(Hh(e[n],t,r))return!0}for(let n=0;n<t.length;n++)if(Hh(t[n],e,r))return!0;return!1}function Xh(t,e){if(t.length===0||e.length===0)return!1;for(let r=0;r<t.length-1;r++){const n=t[r],a=t[r+1];for(let l=0;l<e.length-1;l++)if(Cg(n,a,e[l],e[l+1]))return!0}return!1}function Cg(t,e,r,n){return sr(t,r,n)!==sr(e,r,n)&&sr(t,e,r)!==sr(t,e,n)}function Hh(t,e,r){const n=r*r;if(e.length===1)return t.distSqr(e[0])<n;for(let a=1;a<e.length;a++)if(sf(t,e[a-1],e[a])<n)return!0;return!1}function sf(t,e,r){const n=e.distSqr(r);if(n===0)return t.distSqr(e);const a=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/n;return t.distSqr(a<0?e:a>1?r:r.sub(e)._mult(a)._add(e))}function af(t,e){let r,n,a,l=!1;for(let h=0;h<t.length;h++){r=t[h];for(let p=0,m=r.length-1;p<r.length;m=p++)n=r[p],a=r[m],n.y>e.y!=a.y>e.y&&e.x<(a.x-n.x)*(e.y-n.y)/(a.y-n.y)+n.x&&(l=!l)}return l}function qa(t,e){let r=!1;for(let n=0,a=t.length-1;n<t.length;a=n++){const l=t[n],h=t[a];l.y>e.y!=h.y>e.y&&e.x<(h.x-l.x)*(e.y-l.y)/(h.y-l.y)+l.x&&(r=!r)}return r}function lf(t,e,r,n,a){for(const h of t)if(e<=h.x&&r<=h.y&&n>=h.x&&a>=h.y)return!0;const l=[new _e(e,r),new _e(e,a),new _e(n,a),new _e(n,r)];if(t.length>2){for(const h of l)if(qa(t,h))return!0}for(let h=0;h<t.length-1;h++)if(zg(t[h],t[h+1],l))return!0;return!1}function zg(t,e,r){const n=r[0],a=r[2];if(t.x<n.x&&e.x<n.x||t.x>a.x&&e.x>a.x||t.y<n.y&&e.y<n.y||t.y>a.y&&e.y>a.y)return!1;const l=sr(t,e,r[0]);return l!==sr(t,e,r[1])||l!==sr(t,e,r[2])||l!==sr(t,e,r[3])}function Wa(t,e,r){const n=e.paint.get(t).value;return n.kind==="constant"?n.value:r.programConfigurations.get(e.id).getMaxValue(t)}function bu(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function cf(t,e,r,n,a){if(!e[0]&&!e[1])return t;const l=_e.convert(e)._mult(a);r==="viewport"&&l._rotate(-n);const h=[];for(let p=0;p<t.length;p++)h.push(t[p].sub(l));return h}function uf(t,e,r,n){const a=_e.convert(t)._mult(n);return e==="viewport"&&a._rotate(-r),a}Ye("CircleBucket",Wh,{omit:["layers"]});const Pg=new Qi({"circle-sort-key":new st(xe.layout_circle["circle-sort-key"])});var kg={paint:new Qi({"circle-radius":new st(xe.paint_circle["circle-radius"]),"circle-color":new st(xe.paint_circle["circle-color"]),"circle-blur":new st(xe.paint_circle["circle-blur"]),"circle-opacity":new st(xe.paint_circle["circle-opacity"]),"circle-translate":new et(xe.paint_circle["circle-translate"]),"circle-translate-anchor":new et(xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new et(xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new et(xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new st(xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new st(xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new st(xe.paint_circle["circle-stroke-opacity"])}),layout:Pg};class Kh{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,n,a){const l=Math.pow(2,n),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(m=>{const y=Bi([],m,e),v=1/y[3]/r*l;return function(w,T,C){return w[0]=T[0]*C[0],w[1]=T[1]*C[1],w[2]=T[2]*C[2],w[3]=T[3]*C[3],w}(y,y,[v,v,a?1/y[3]:v,v])}),p=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(m=>{const y=Ht([],nn([],on([],h[m[0]],h[m[1]]),on([],h[m[2]],h[m[1]]))),v=-Li(y,h[m[1]]);return y.concat(v)});return new Kh(h,p)}}class Pn{constructor(e,r){this.min=e,this.max=r,this.center=mi([],Ki([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],n=li(this.min),a=li(this.max);for(let l=0;l<r.length;l++)n[l]=r[l]?this.min[l]:this.center[l],a[l]=r[l]?this.center[l]:this.max[l];return a[2]=this.max[2],new Pn(n,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let n=!0;for(let a=0;a<e.planes.length;a++){const l=e.planes[a];let h=0;for(let p=0;p<r.length;p++)h+=Li(l,r[p])+l[3]>=0;if(h===0)return 0;h!==r.length&&(n=!1)}if(n)return 2;for(let a=0;a<3;a++){let l=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(let p=0;p<e.points.length;p++){const m=e.points[p][a]-this.min[a];l=Math.min(l,m),h=Math.max(h,m)}if(h<0||l>this.max[a]-this.min[a])return 0}return 1}}function hf(t,e,r,n,a,l,h,p,m){if(l&&t.queryGeometry.isAboveHorizon)return!1;l&&(m*=t.pixelToTileUnitsFactor);for(const y of e)for(const v of y){const w=v.add(p),T=a&&r.elevation?r.elevation.exaggeration()*a.getElevationAt(w.x,w.y,!0):0,C=l?w:Dg(w,T,n),P=l?t.tilespaceRays.map(O=>Bg(O,T)):t.queryGeometry.screenGeometry,B=Bi([],[v.x,v.y,T,1],n);if(!h&&l?m*=B[3]/r.cameraToCenterDistance:h&&!l&&(m*=r.cameraToCenterDistance/B[3]),Mg(P,C,m))return!0}return!1}function Dg(t,e,r){const n=Bi([],[t.x,t.y,e,1],r);return new _e(n[0]/n[3],n[1]/n[3])}const df=wi(0,0,0),Lg=wi(0,0,1);function Bg(t,e){const r=bi();return df[2]=e,t.intersectsPlane(df,Lg,r),new _e(r[0],r[1])}class pf extends Wh{}function Yh(t,{width:e,height:r},n,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*r*n)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*r*n);return t.width=e,t.height=r,t.data=a,t}function ff(t,{width:e,height:r},n){if(e===t.width&&r===t.height)return;const a=Yh({},{width:e,height:r},n);Jh(t,a,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,r)},n),t.width=e,t.height=r,t.data=a.data}function Jh(t,e,r,n,a,l){if(a.width===0||a.height===0)return e;if(a.width>t.width||a.height>t.height||r.x>t.width-a.width||r.y>t.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||n.x>e.width-a.width||n.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const h=t.data,p=e.data;for(let m=0;m<a.height;m++){const y=((r.y+m)*t.width+r.x)*l,v=((n.y+m)*e.width+n.x)*l;for(let w=0;w<a.width*l;w++)p[v+w]=h[y+w]}return e}Ye("HeatmapBucket",pf,{omit:["layers"]});class Ko{constructor(e,r){Yh(this,e,1,r)}resize(e){ff(this,e,1)}clone(){return new Ko({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,a,l){Jh(e,r,n,a,l,1)}}class Qr{constructor(e,r){Yh(this,e,4,r)}resize(e){ff(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Qr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,a,l){Jh(e,r,n,a,l,4)}}Ye("AlphaImage",Ko),Ye("RGBAImage",Qr);var Rg={paint:new Qi({"heatmap-radius":new st(xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new st(xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new et(xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Kn(xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new et(xe.paint_heatmap["heatmap-opacity"])})};function Qh(t){const e={},r=t.resolution||256,n=t.clips?t.clips.length:1,a=t.image||new Qr({width:r,height:n}),l=(h,p,m)=>{e[t.evaluationKey]=m;const y=t.expression.evaluate(e);a.data[h+p+0]=Math.floor(255*y.r/y.a),a.data[h+p+1]=Math.floor(255*y.g/y.a),a.data[h+p+2]=Math.floor(255*y.b/y.a),a.data[h+p+3]=Math.floor(255*y.a)};if(t.clips)for(let h=0,p=0;h<n;++h,p+=4*r)for(let m=0,y=0;m<r;m++,y+=4){const v=m/(r-1),{start:w,end:T}=t.clips[h];l(p,y,w*(1-v)+T*v)}else for(let h=0,p=0;h<r;h++,p+=4)l(0,p,h/(r-1));return a}var Fg={paint:new Qi({"hillshade-illumination-direction":new et(xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new et(xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new et(xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new et(xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new et(xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new et(xe.paint_hillshade["hillshade-accent-color"])})};const Og=xi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ug}=Og;var wu=Tu,Vg=Tu;function Tu(t,e,r){r=r||2;var n,a,l,h,p,m,y,v=e&&e.length,w=v?e[0]*r:t.length,T=mf(t,0,w,r,!0),C=[];if(!T||T.next===T.prev)return C;if(v&&(T=function(B,O,Z,Y){var ie,se,ae,le=[];for(ie=0,se=O.length;ie<se;ie++)(ae=mf(B,O[ie]*Y,ie<se-1?O[ie+1]*Y:B.length,Y,!1))===ae.next&&(ae.steiner=!0),le.push(Xg(ae));for(le.sort(Zg),ie=0;ie<le.length;ie++)Z=Yo(Z=qg(le[ie],Z),Z.next);return Z}(t,e,T,r)),t.length>80*r){n=l=t[0],a=h=t[1];for(var P=r;P<w;P+=r)(p=t[P])<n&&(n=p),(m=t[P+1])<a&&(a=m),p>l&&(l=p),m>h&&(h=m);y=(y=Math.max(l-n,h-a))!==0?1/y:0}return Jl(T,C,r,n,a,y),C}function mf(t,e,r,n,a){var l,h;if(a===id(t,e,r,n)>0)for(l=e;l<r;l+=n)h=yf(l,t[l],t[l+1],h);else for(l=r-n;l>=e;l-=n)h=yf(l,t[l],t[l+1],h);return h&&Eu(h,h.next)&&(ec(h),h=h.next),h}function Yo(t,e){if(!t)return t;e||(e=t);var r,n=t;do if(r=!1,n.steiner||!Eu(n,n.next)&&zi(n.prev,n,n.next)!==0)n=n.next;else{if(ec(n),(n=e=n.prev)===n.next)break;r=!0}while(r||n!==e);return e}function Jl(t,e,r,n,a,l,h){if(t){!h&&l&&function(v,w,T,C){var P=v;do P.z===null&&(P.z=ed(P.x,P.y,w,T,C)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==v);P.prevZ.nextZ=null,P.prevZ=null,function(B){var O,Z,Y,ie,se,ae,le,Te,be=1;do{for(Z=B,B=null,se=null,ae=0;Z;){for(ae++,Y=Z,le=0,O=0;O<be&&(le++,Y=Y.nextZ);O++);for(Te=be;le>0||Te>0&&Y;)le!==0&&(Te===0||!Y||Z.z<=Y.z)?(ie=Z,Z=Z.nextZ,le--):(ie=Y,Y=Y.nextZ,Te--),se?se.nextZ=ie:B=ie,ie.prevZ=se,se=ie;Z=Y}se.nextZ=null,be*=2}while(ae>1)}(P)}(t,n,a,l);for(var p,m,y=t;t.prev!==t.next;)if(p=t.prev,m=t.next,l?jg(t,n,a,l):Ng(t))e.push(p.i/r),e.push(t.i/r),e.push(m.i/r),ec(t),t=m.next,y=m.next;else if((t=m)===y){h?h===1?Jl(t=Gg(Yo(t),e,r),e,r,n,a,l,2):h===2&&$g(t,e,r,n,a,l):Jl(Yo(t),e,r,n,a,l,1);break}}}function Ng(t){var e=t.prev,r=t,n=t.next;if(zi(e,r,n)>=0)return!1;for(var a=t.next.next;a!==t.prev;){if(Xa(e.x,e.y,r.x,r.y,n.x,n.y,a.x,a.y)&&zi(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function jg(t,e,r,n){var a=t.prev,l=t,h=t.next;if(zi(a,l,h)>=0)return!1;for(var p=a.x>l.x?a.x>h.x?a.x:h.x:l.x>h.x?l.x:h.x,m=a.y>l.y?a.y>h.y?a.y:h.y:l.y>h.y?l.y:h.y,y=ed(a.x<l.x?a.x<h.x?a.x:h.x:l.x<h.x?l.x:h.x,a.y<l.y?a.y<h.y?a.y:h.y:l.y<h.y?l.y:h.y,e,r,n),v=ed(p,m,e,r,n),w=t.prevZ,T=t.nextZ;w&&w.z>=y&&T&&T.z<=v;){if(w!==t.prev&&w!==t.next&&Xa(a.x,a.y,l.x,l.y,h.x,h.y,w.x,w.y)&&zi(w.prev,w,w.next)>=0||(w=w.prevZ,T!==t.prev&&T!==t.next&&Xa(a.x,a.y,l.x,l.y,h.x,h.y,T.x,T.y)&&zi(T.prev,T,T.next)>=0))return!1;T=T.nextZ}for(;w&&w.z>=y;){if(w!==t.prev&&w!==t.next&&Xa(a.x,a.y,l.x,l.y,h.x,h.y,w.x,w.y)&&zi(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;T&&T.z<=v;){if(T!==t.prev&&T!==t.next&&Xa(a.x,a.y,l.x,l.y,h.x,h.y,T.x,T.y)&&zi(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function Gg(t,e,r){var n=t;do{var a=n.prev,l=n.next.next;!Eu(a,l)&&_f(a,n,n.next,l)&&Ql(a,l)&&Ql(l,a)&&(e.push(a.i/r),e.push(n.i/r),e.push(l.i/r),ec(n),ec(n.next),n=t=l),n=n.next}while(n!==t);return Yo(n)}function $g(t,e,r,n,a,l){var h=t;do{for(var p=h.next.next;p!==h.prev;){if(h.i!==p.i&&Hg(h,p)){var m=gf(h,p);return h=Yo(h,h.next),m=Yo(m,m.next),Jl(h,e,r,n,a,l),void Jl(m,e,r,n,a,l)}p=p.next}h=h.next}while(h!==t)}function Zg(t,e){return t.x-e.x}function qg(t,e){var r=function(l,h){var p,m=h,y=l.x,v=l.y,w=-1/0;do{if(v<=m.y&&v>=m.next.y&&m.next.y!==m.y){var T=m.x+(v-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(T<=y&&T>w){if(w=T,T===y){if(v===m.y)return m;if(v===m.next.y)return m.next}p=m.x<m.next.x?m:m.next}}m=m.next}while(m!==h);if(!p)return null;if(y===w)return p;var C,P=p,B=p.x,O=p.y,Z=1/0;m=p;do y>=m.x&&m.x>=B&&y!==m.x&&Xa(v<O?y:w,v,B,O,v<O?w:y,v,m.x,m.y)&&(C=Math.abs(v-m.y)/(y-m.x),Ql(m,l)&&(C<Z||C===Z&&(m.x>p.x||m.x===p.x&&Wg(p,m)))&&(p=m,Z=C)),m=m.next;while(m!==P);return p}(t,e);if(!r)return e;var n=gf(r,t),a=Yo(r,r.next);return Yo(n,n.next),e===r?a:e}function Wg(t,e){return zi(t.prev,t,e.prev)<0&&zi(e.next,t,t.next)<0}function ed(t,e,r,n,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*a)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*a)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Xg(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function Xa(t,e,r,n,a,l,h,p){return(a-h)*(e-p)-(t-h)*(l-p)>=0&&(t-h)*(n-p)-(r-h)*(e-p)>=0&&(r-h)*(l-p)-(a-h)*(n-p)>=0}function Hg(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(r,n){var a=r;do{if(a.i!==r.i&&a.next.i!==r.i&&a.i!==n.i&&a.next.i!==n.i&&_f(a,a.next,r,n))return!0;a=a.next}while(a!==r);return!1}(t,e)&&(Ql(t,e)&&Ql(e,t)&&function(r,n){var a=r,l=!1,h=(r.x+n.x)/2,p=(r.y+n.y)/2;do a.y>p!=a.next.y>p&&a.next.y!==a.y&&h<(a.next.x-a.x)*(p-a.y)/(a.next.y-a.y)+a.x&&(l=!l),a=a.next;while(a!==r);return l}(t,e)&&(zi(t.prev,t,e.prev)||zi(t,e.prev,e))||Eu(t,e)&&zi(t.prev,t,t.next)>0&&zi(e.prev,e,e.next)>0)}function zi(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Eu(t,e){return t.x===e.x&&t.y===e.y}function _f(t,e,r,n){var a=Iu(zi(t,e,r)),l=Iu(zi(t,e,n)),h=Iu(zi(r,n,t)),p=Iu(zi(r,n,e));return a!==l&&h!==p||!(a!==0||!Su(t,r,e))||!(l!==0||!Su(t,n,e))||!(h!==0||!Su(r,t,n))||!(p!==0||!Su(r,e,n))}function Su(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Iu(t){return t>0?1:t<0?-1:0}function Ql(t,e){return zi(t.prev,t,t.next)<0?zi(t,e,t.next)>=0&&zi(t,t.prev,e)>=0:zi(t,e,t.prev)<0||zi(t,t.next,e)<0}function gf(t,e){var r=new td(t.i,t.x,t.y),n=new td(e.i,e.x,e.y),a=t.next,l=e.prev;return t.next=e,e.prev=t,r.next=a,a.prev=r,n.next=r,r.prev=n,l.next=n,n.prev=l,n}function yf(t,e,r,n){var a=new td(t,e,r);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function ec(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function td(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function id(t,e,r,n){for(var a=0,l=e,h=r-n;l<r;l+=n)a+=(t[h]-t[l])*(t[l+1]+t[h+1]),h=l;return a}function Kg(t,e,r,n,a){xf(t,e,r||0,n||t.length-1,a||Yg)}function xf(t,e,r,n,a){for(;n>r;){if(n-r>600){var l=n-r+1,h=e-r+1,p=Math.log(l),m=.5*Math.exp(2*p/3),y=.5*Math.sqrt(p*m*(l-m)/l)*(h-l/2<0?-1:1);xf(t,e,Math.max(r,Math.floor(e-h*m/l+y)),Math.min(n,Math.floor(e+(l-h)*m/l+y)),a)}var v=t[e],w=r,T=n;for(tc(t,r,e),a(t[n],v)>0&&tc(t,r,n);w<T;){for(tc(t,w,T),w++,T--;a(t[w],v)<0;)w++;for(;a(t[T],v)>0;)T--}a(t[r],v)===0?tc(t,r,T):tc(t,++T,n),T<=e&&(r=T+1),e<=T&&(n=T-1)}}function tc(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function Yg(t,e){return t<e?-1:t>e?1:0}function rd(t,e){const r=t.length;if(r<=1)return[t];const n=[];let a,l;for(let h=0;h<r;h++){const p=Ao(t[h]);p!==0&&(t[h].area=Math.abs(p),l===void 0&&(l=p<0),l===p<0?(a&&n.push(a),a=[t[h]]):a.push(t[h]))}if(a&&n.push(a),e>1)for(let h=0;h<n.length;h++)n[h].length<=e||(Kg(n[h],e,1,n[h].length-1,Jg),n[h]=n[h].slice(0,e));return n}function Jg(t,e){return e.area-t.area}function nd(t,e,r){const n=r.patternDependencies;let a=!1;for(const l of e){const h=l.paint.get(`${t}-pattern`);h.isConstant()||(a=!0);const p=h.constantOr(null);p&&(a=!0,n[p.to]=!0,n[p.from]=!0)}return a}function od(t,e,r,n,a){const l=a.patternDependencies;for(const h of e){const p=h.paint.get(`${t}-pattern`).value;if(p.kind!=="constant"){let m=p.evaluate({zoom:n-1},r,{},a.availableImages),y=p.evaluate({zoom:n},r,{},a.availableImages),v=p.evaluate({zoom:n+1},r,{},a.availableImages);m=m&&m.name?m.name:m,y=y&&y.name?y.name:y,v=v&&v.name?v.name:v,l[m]=!0,l[y]=!0,l[v]=!0,r.patterns[h.id]={min:m,mid:y,max:v}}}return r}Tu.deviation=function(t,e,r,n){var a=e&&e.length,l=Math.abs(id(t,0,a?e[0]*r:t.length,r));if(a)for(var h=0,p=e.length;h<p;h++)l-=Math.abs(id(t,e[h]*r,h<p-1?e[h+1]*r:t.length,r));var m=0;for(h=0;h<n.length;h+=3){var y=n[h]*r,v=n[h+1]*r,w=n[h+2]*r;m+=Math.abs((t[y]-t[w])*(t[v+1]-t[y+1])-(t[y]-t[v])*(t[w+1]-t[y+1]))}return l===0&&m===0?0:Math.abs((m-l)/l)},Tu.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,a=0;a<t.length;a++){for(var l=0;l<t[a].length;l++)for(var h=0;h<e;h++)r.vertices.push(t[a][l][h]);a>0&&r.holes.push(n+=t[a-1].length)}return r},wu.default=Vg;class Mu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Va,this.indexArray=new Jr,this.indexArray2=new Xo,this.programConfigurations=new js(e.layers,e.zoom),this.segments=new Ci,this.segments2=new Ci,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n,a){this.hasPattern=nd("fill",this.layers,r);const l=this.layers[0].layout.get("fill-sort-key"),h=[];for(const{feature:p,id:m,index:y,sourceLayerIndex:v}of e){const w=this.layers[0]._featureFilter.needGeometry,T=$s(p,w);if(!this.layers[0]._featureFilter.filter(new _t(this.zoom),T,n))continue;const C=l?l.evaluate(T,{},n,r.availableImages):void 0,P={id:m,properties:p.properties,type:p.type,sourceLayerIndex:v,index:y,geometry:w?T.geometry:bo(p,n,a),patterns:{},sortKey:C};h.push(P)}l&&h.sort((p,m)=>p.sortKey-m.sortKey);for(const p of h){const{geometry:m,index:y,sourceLayerIndex:v}=p;if(this.hasPattern){const w=od("fill",this.layers,p,this.zoom,r);this.patternFeatures.push(w)}else this.addFeature(p,m,y,n,{},r.availableImages);r.featureIndex.insert(e[y].feature,m,y,v,this.index)}}update(e,r,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,a)}addFeatures(e,r,n,a){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ug),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,n,a,l,h=[]){for(const p of rd(r,500)){let m=0;for(const P of p)m+=P.length;const y=this.segments.prepareSegment(m,this.layoutVertexArray,this.indexArray),v=y.vertexLength,w=[],T=[];for(const P of p){if(P.length===0)continue;P!==p[0]&&T.push(w.length/2);const B=this.segments2.prepareSegment(P.length,this.layoutVertexArray,this.indexArray2),O=B.vertexLength;this.layoutVertexArray.emplaceBack(P[0].x,P[0].y),this.indexArray2.emplaceBack(O+P.length-1,O),w.push(P[0].x),w.push(P[0].y);for(let Z=1;Z<P.length;Z++)this.layoutVertexArray.emplaceBack(P[Z].x,P[Z].y),this.indexArray2.emplaceBack(O+Z-1,O+Z),w.push(P[Z].x),w.push(P[Z].y);B.vertexLength+=P.length,B.primitiveLength+=P.length}const C=wu(w,T);for(let P=0;P<C.length;P+=3)this.indexArray.emplaceBack(v+C[P],v+C[P+1],v+C[P+2]);y.vertexLength+=m,y.primitiveLength+=C.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,l,h,a)}}Ye("FillBucket",Mu,{omit:["layers","patternFeatures"]});const Qg=new Qi({"fill-sort-key":new st(xe.layout_fill["fill-sort-key"])});var ey={paint:new Qi({"fill-antialias":new et(xe.paint_fill["fill-antialias"]),"fill-opacity":new st(xe.paint_fill["fill-opacity"]),"fill-color":new st(xe.paint_fill["fill-color"]),"fill-outline-color":new st(xe.paint_fill["fill-outline-color"]),"fill-translate":new et(xe.paint_fill["fill-translate"]),"fill-translate-anchor":new et(xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Zi(xe.paint_fill["fill-pattern"])}),layout:Qg};const ty=xi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),iy=xi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:ry}=ty;var vf=Ha;function Ha(t,e,r,n,a){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=a,t.readFields(ny,this,e)}function ny(t,e,r){t==1?e.id=r.readVarint():t==2?function(n,a){for(var l=n.readVarint()+n.pos;n.pos<l;){var h=a._keys[n.readVarint()],p=a._values[n.readVarint()];a.properties[h]=p}}(r,e):t==3?e.type=r.readVarint():t==4&&(e._geometry=r.pos)}function oy(t){for(var e,r,n=0,a=0,l=t.length,h=l-1;a<l;h=a++)n+=((r=t[h]).x-(e=t[a]).x)*(e.y+r.y);return n}Ha.types=["Unknown","Point","LineString","Polygon"],Ha.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,n=1,a=0,l=0,h=0,p=[];t.pos<r;){if(a<=0){var m=t.readVarint();n=7&m,a=m>>3}if(a--,n===1||n===2)l+=t.readSVarint(),h+=t.readSVarint(),n===1&&(e&&p.push(e),e=[]),e.push(new _e(l,h));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&p.push(e),p},Ha.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,n=0,a=0,l=0,h=1/0,p=-1/0,m=1/0,y=-1/0;t.pos<e;){if(n<=0){var v=t.readVarint();r=7&v,n=v>>3}if(n--,r===1||r===2)(a+=t.readSVarint())<h&&(h=a),a>p&&(p=a),(l+=t.readSVarint())<m&&(m=l),l>y&&(y=l);else if(r!==7)throw new Error("unknown command "+r)}return[h,m,p,y]},Ha.prototype.toGeoJSON=function(t,e,r){var n,a,l=this.extent*Math.pow(2,r),h=this.extent*t,p=this.extent*e,m=this.loadGeometry(),y=Ha.types[this.type];function v(C){for(var P=0;P<C.length;P++){var B=C[P];C[P]=[360*(B.x+h)/l-180,360/Math.PI*Math.atan(Math.exp((180-360*(B.y+p)/l)*Math.PI/180))-90]}}switch(this.type){case 1:var w=[];for(n=0;n<m.length;n++)w[n]=m[n][0];v(m=w);break;case 2:for(n=0;n<m.length;n++)v(m[n]);break;case 3:for(m=function(C){var P=C.length;if(P<=1)return[C];for(var B,O,Z=[],Y=0;Y<P;Y++){var ie=oy(C[Y]);ie!==0&&(O===void 0&&(O=ie<0),O===ie<0?(B&&Z.push(B),B=[C[Y]]):B.push(C[Y]))}return B&&Z.push(B),Z}(m),n=0;n<m.length;n++)for(a=0;a<m[n].length;a++)v(m[n][a])}m.length===1?m=m[0]:y="Multi"+y;var T={type:"Feature",geometry:{type:y,coordinates:m},properties:this.properties};return"id"in this&&(T.id=this.id),T};var bf=wf;function wf(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(sy,this,e),this.length=this._features.length}function sy(t,e,r){t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push(function(n){for(var a=null,l=n.readVarint()+n.pos;n.pos<l;){var h=n.readVarint()>>3;a=h===1?n.readString():h===2?n.readFloat():h===3?n.readDouble():h===4?n.readVarint64():h===5?n.readVarint():h===6?n.readSVarint():h===7?n.readBoolean():null}return a}(r))}function ay(t,e,r){if(t===3){var n=new bf(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}wf.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new vf(this._pbf,e,this.extent,this._keys,this._values)};var Zs={VectorTile:function(t,e){this.layers=t.readFields(ay,{},e)},VectorTileFeature:vf,VectorTileLayer:bf};const ly=Zs.VectorTileFeature.types,cy=Math.pow(2,13);function ic(t,e,r,n,a,l,h,p){t.emplaceBack((e<<1)+h,(r<<1)+l,(Math.floor(n*cy)<<1)+a,Math.round(p))}class Tf{constructor(){this.acc=new _e(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new _e(e.x,e.y),this.max=new _e(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);let n=!!this.borders;const a=this.min,l=this.max;e.x<a.x?(a.x=e.x,n=!0):e.x>l.x&&(l.x=e.x,n=!0),e.y<a.y?(a.y=e.y,n=!0):e.y>l.y&&(l.y=e.y,n=!0),((e.x===0||e.x===At)&&e.x===r.x)!=((e.y===0||e.y===At)&&e.y===r.y)&&this.processBorderOverlap(e,r),n&&this.checkBorderIntersection(e,r)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,Xt(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>At!=e.x>At&&this.addBorderIntersection(1,Xt(r.y,e.y,(At-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,Xt(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>At!=e.y>At&&this.addBorderIntersection(3,Xt(r.x,e.x,(At-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];r<n[0]&&(n[0]=r),r>n[1]&&(n[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const n=e.x===0?0:1;this.addBorderIntersection(n,r.y),this.addBorderIntersection(n,e.y)}else{const n=e.y===0?2:3;this.addBorderIntersection(n,r.x),this.addBorderIntersection(n,e.x)}}centroid(){const e=this.polyCount.reduce((r,n)=>r+n.edges,0);return e!==0?this.acc.div(e)._round():new _e(0,0)}span(){return new _e(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class sd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Na,this.centroidVertexArray=new qp,this.indexArray=new Jr,this.programConfigurations=new js(e.layers,e.zoom),this.segments=new Ci,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,n,a){this.features=[],this.hasPattern=nd("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(l){const h=Math.exp(Math.PI*(1-l.y/(1<<l.z)*2));return 80150034*h/(h*h+1)/At/(1<<l.z)}(n);for(const{feature:l,id:h,index:p,sourceLayerIndex:m}of e){const y=this.layers[0]._featureFilter.needGeometry,v=$s(l,y);if(!this.layers[0]._featureFilter.filter(new _t(this.zoom),v,n))continue;const w={id:h,sourceLayerIndex:m,index:p,geometry:y?v.geometry:bo(l,n,a),properties:l.properties,type:l.type,patterns:{}},T=this.layoutVertexArray.length;this.hasPattern?this.features.push(od("fill-extrusion",this.layers,w,this.zoom,r)):this.addFeature(w,w.geometry,p,n,{},r.availableImages),r.featureIndex.insert(l,w.geometry,p,m,this.index,T)}this.sortBorders()}addFeatures(e,r,n,a){for(const l of this.features){const{geometry:h}=l;this.addFeature(l,h,l.index,r,n,a)}this.sortBorders()}update(e,r,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ry),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,iy.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,n,a,l,h){const p=this.enableTerrain?new Tf:null;for(const y of rd(r,500)){let v=0,w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(y.length===0||(m=y[0]).every(O=>O.x<=0)||m.every(O=>O.x>=At)||m.every(O=>O.y<=0)||m.every(O=>O.y>=At))continue;for(let O=0;O<y.length;O++){const Z=y[O];if(Z.length===0)continue;v+=Z.length;let Y=0;p&&p.startRing(Z[0]);for(let ie=0;ie<Z.length;ie++){const se=Z[ie];if(ie>=1){const ae=Z[ie-1];if(!uy(se,ae)){p&&p.append(se,ae),w.vertexLength+4>Ci.MAX_VERTEX_ARRAY_LENGTH&&(w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const le=se.sub(ae)._perp(),Te=le.x/(Math.abs(le.x)+Math.abs(le.y)),be=le.y>0?1:0,$e=ae.dist(se);Y+$e>32768&&(Y=0),ic(this.layoutVertexArray,se.x,se.y,Te,be,0,0,Y),ic(this.layoutVertexArray,se.x,se.y,Te,be,0,1,Y),Y+=$e,ic(this.layoutVertexArray,ae.x,ae.y,Te,be,0,0,Y),ic(this.layoutVertexArray,ae.x,ae.y,Te,be,0,1,Y);const Oe=w.vertexLength;this.indexArray.emplaceBack(Oe,Oe+2,Oe+1),this.indexArray.emplaceBack(Oe+1,Oe+2,Oe+3),w.vertexLength+=4,w.primitiveLength+=2}}}}if(w.vertexLength+v>Ci.MAX_VERTEX_ARRAY_LENGTH&&(w=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray)),ly[e.type]!=="Polygon")continue;const T=[],C=[],P=w.vertexLength;for(let O=0;O<y.length;O++){const Z=y[O];if(Z.length!==0){Z!==y[0]&&C.push(T.length/2);for(let Y=0;Y<Z.length;Y++){const ie=Z[Y];ic(this.layoutVertexArray,ie.x,ie.y,0,0,1,1,0),T.push(ie.x),T.push(ie.y),p&&p.currentPolyCount.top++}}}const B=wu(T,C);for(let O=0;O<B.length;O+=3)this.indexArray.emplaceBack(P+B[O],P+B[O+2],P+B[O+1]);w.primitiveLength+=B.length/3,w.vertexLength+=v}var m;if(p&&p.polyCount.length>0){if(p.borders){p.vertexArrayOffset=this.centroidVertexArray.length;const y=p.borders,v=this.featuresOnBorder.push(p)-1;for(let w=0;w<4;w++)y[w][0]!==Number.MAX_VALUE&&this.borders[w].push(v)}this.encodeCentroid(p.borders?void 0:p.centroid(),p)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,l,h,a)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,n)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}encodeCentroid(e,r,n=!0){let a,l;if(e)if(e.y!==0){const p=r.span()._mult(this.tileToMeter);a=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(p.x/10)),l=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(p.y/10))}else a=Math.ceil(7*(e.x+450)),l=0;else a=0,l=+n;let h=n?this.centroidVertexArray.length:r.vertexArrayOffset;for(const p of r.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*p.edges+p.top);for(let m=0;m<2*p.edges;m++)this.centroidVertexArray.emplace(h++,0,l),this.centroidVertexArray.emplace(h++,a,l);for(let m=0;m<p.top;m++)this.centroidVertexArray.emplace(h++,a,l)}}}function uy(t,e){return t.x===e.x&&(t.x<0||t.x>At)||t.y===e.y&&(t.y<0||t.y>At)}Ye("FillExtrusionBucket",sd,{omit:["layers","features"]}),Ye("PartMetadata",Tf);var hy={paint:new Qi({"fill-extrusion-opacity":new et(xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new st(xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new et(xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new et(xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Zi(xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new st(xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new st(xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new et(xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function rc(t,e){return t.x*e.x+t.y*e.y}function Ef(t,e){if(t.length===1){let r=0;const n=e[r++];let a;for(;!a||n.equals(a);)if(a=e[r++],!a)return 1/0;for(;r<e.length;r++){const l=e[r],h=t[0],p=a.sub(n),m=l.sub(n),y=h.sub(n),v=rc(p,p),w=rc(p,m),T=rc(m,m),C=rc(y,p),P=rc(y,m),B=v*T-w*w,O=(T*C-w*P)/B,Z=(v*P-w*C)/B,Y=n.z*(1-O-Z)+a.z*O+l.z*Z;if(isFinite(Y))return Y}return 1/0}{let r=1/0;for(const n of e)r=Math.min(r,n.z);return r}}function Sf(t){const e=new _e(t[0],t[1]);return e.z=t[2],e}function dy(t,e,r,n,a,l,h,p){const m=h*a.getElevationAt(t,e,!0,!0),y=l[0]!==0,v=y?l[1]===0?h*(l[0]/7-450):h*function(w,T,C){const P=Math.floor(T[0]/8),B=Math.floor(T[1]/8),O=10*(T[0]-8*P),Z=10*(T[1]-8*B),Y=w.getElevationAt(P,B,!0,!0),ie=w.getMeterToDEM(C),se=Math.floor(.5*(O*ie-1)),ae=Math.floor(.5*(Z*ie-1)),le=w.tileCoordToPixel(P,B),Te=2*se+1,be=2*ae+1,$e=function(Ke,tt,Dt,oi,Bt){return[Ke.getElevationAtPixel(tt,Dt,!0),Ke.getElevationAtPixel(tt+Bt,Dt,!0),Ke.getElevationAtPixel(tt,Dt+Bt,!0),Ke.getElevationAtPixel(tt+oi,Dt+Bt,!0)]}(w,le.x-se,le.y-ae,Te,be),Oe=Math.abs($e[0]-$e[1]),we=Math.abs($e[2]-$e[3]),Ve=Math.abs($e[0]-$e[2])+Math.abs($e[1]-$e[3]),Ze=Math.min(.25,.5*ie*(Oe+we)/Te),Ce=Math.min(.25,.5*ie*Ve/be);return Y+Math.max(Ze*O,Ce*Z)}(a,l,p):m;return{base:m+(r===0)?-1:r,top:y?Math.max(v+n,m+r+2):m+n}}const py=xi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:fy}=py,my=xi([{name:"a_packed",components:3,type:"Float32"}]),{members:_y}=my,gy=Zs.VectorTileFeature.types,yy=Math.cos(Math.PI/180*37.5);class Au{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Ph,this.layoutVertexArray2=new ja,this.indexArray=new Jr,this.programConfigurations=new js(e.layers,e.zoom),this.segments=new Ci,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n,a){this.hasPattern=nd("line",this.layers,r);const l=this.layers[0].layout.get("line-sort-key"),h=[];for(const{feature:v,id:w,index:T,sourceLayerIndex:C}of e){const P=this.layers[0]._featureFilter.needGeometry,B=$s(v,P);if(!this.layers[0]._featureFilter.filter(new _t(this.zoom),B,n))continue;const O=l?l.evaluate(B,{},n):void 0,Z={id:w,properties:v.properties,type:v.type,sourceLayerIndex:C,index:T,geometry:P?B.geometry:bo(v,n,a),patterns:{},sortKey:O};h.push(Z)}l&&h.sort((v,w)=>v.sortKey-w.sortKey);const{lineAtlas:p,featureIndex:m}=r,y=this.addConstantDashes(p);for(const v of h){const{geometry:w,index:T,sourceLayerIndex:C}=v;if(y&&this.addFeatureDashes(v,p),this.hasPattern){const P=od("line",this.layers,v,this.zoom,r);this.patternFeatures.push(P)}else this.addFeature(v,w,T,n,p.positions,r.availableImages);m.insert(e[T].feature,w,T,C,this.index)}}addConstantDashes(e){let r=!1;for(const n of this.layers){const a=n.paint.get("line-dasharray").value,l=n.layout.get("line-cap").value;if(a.kind!=="constant"||l.kind!=="constant")r=!0;else{const h=l.value,p=a.value;if(!p)continue;e.addDash(p.from,h),e.addDash(p.to,h),p.other&&e.addDash(p.other,h)}}return r}addFeatureDashes(e,r){const n=this.zoom;for(const a of this.layers){const l=a.paint.get("line-dasharray").value,h=a.layout.get("line-cap").value;if(l.kind==="constant"&&h.kind==="constant")continue;let p,m,y,v,w,T;if(l.kind==="constant"){const O=l.value;if(!O)continue;p=O.other||O.to,m=O.to,y=O.from}else p=l.evaluate({zoom:n-1},e),m=l.evaluate({zoom:n},e),y=l.evaluate({zoom:n+1},e);h.kind==="constant"?v=w=T=h.value:(v=h.evaluate({zoom:n-1},e),w=h.evaluate({zoom:n},e),T=h.evaluate({zoom:n+1},e)),r.addDash(p,v),r.addDash(m,w),r.addDash(y,T);const C=r.getKey(p,v),P=r.getKey(m,w),B=r.getKey(y,T);e.patterns[a.id]={min:C,mid:P,max:B}}}update(e,r,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,a)}addFeatures(e,r,n,a){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,_y)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fy),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,n,a,l,h){const p=this.layers[0].layout,m=p.get("line-join").evaluate(e,{}),y=p.get("line-cap").evaluate(e,{}),v=p.get("line-miter-limit"),w=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const T of r)this.addLine(T,e,m,y,v,w);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,l,h,a)}addLine(e,r,n,a,l,h){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Z=0;Z<e.length-1;Z++)this.totalDistance+=e[Z].dist(e[Z+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const p=gy[r.type]==="Polygon";let m=e.length;for(;m>=2&&e[m-1].equals(e[m-2]);)m--;let y=0;for(;y<m-1&&e[y].equals(e[y+1]);)y++;if(m<(p?3:2))return;n==="bevel"&&(l=1.05);const v=this.overscaling<=16?122880/(512*this.overscaling):0,w=this.segments.prepareSegment(10*m,this.layoutVertexArray,this.indexArray);let T,C,P,B,O;this.e1=this.e2=-1,p&&(T=e[m-2],O=e[y].sub(T)._unit()._perp());for(let Z=y;Z<m;Z++){if(P=Z===m-1?p?e[y+1]:void 0:e[Z+1],P&&e[Z].equals(P))continue;O&&(B=O),T&&(C=T),T=e[Z],O=P?P.sub(T)._unit()._perp():B,B=B||O;let Y=B.add(O);Y.x===0&&Y.y===0||Y._unit();const ie=B.x*O.x+B.y*O.y,se=Y.x*O.x+Y.y*O.y,ae=se!==0?1/se:1/0,le=2*Math.sqrt(2-2*se),Te=se<yy&&C&&P,be=B.x*O.y-B.y*O.x>0;if(Te&&Z>y){const we=T.dist(C);if(we>2*v){const Ve=T.sub(T.sub(C)._mult(v/we)._round());this.updateDistance(C,Ve),this.addCurrentVertex(Ve,B,0,0,w),C=Ve}}const $e=C&&P;let Oe=$e?n:p?"butt":a;if($e&&Oe==="round"&&(ae<h?Oe="miter":ae<=2&&(Oe="fakeround")),Oe==="miter"&&ae>l&&(Oe="bevel"),Oe==="bevel"&&(ae>2&&(Oe="flipbevel"),ae<l&&(Oe="miter")),C&&this.updateDistance(C,T),Oe==="miter")Y._mult(ae),this.addCurrentVertex(T,Y,0,0,w);else if(Oe==="flipbevel"){if(ae>100)Y=O.mult(-1);else{const we=ae*B.add(O).mag()/B.sub(O).mag();Y._perp()._mult(we*(be?-1:1))}this.addCurrentVertex(T,Y,0,0,w),this.addCurrentVertex(T,Y.mult(-1),0,0,w)}else if(Oe==="bevel"||Oe==="fakeround"){const we=-Math.sqrt(ae*ae-1),Ve=be?we:0,Ze=be?0:we;if(C&&this.addCurrentVertex(T,B,Ve,Ze,w),Oe==="fakeround"){const Ce=Math.round(180*le/Math.PI/20);for(let Ke=1;Ke<Ce;Ke++){let tt=Ke/Ce;if(tt!==.5){const oi=tt-.5;tt+=tt*oi*(tt-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*oi*oi+(.848013+ie*(.215638*ie-1.06021)))}const Dt=O.sub(B)._mult(tt)._add(B)._unit()._mult(be?-1:1);this.addHalfVertex(T,Dt.x,Dt.y,!1,be,0,w)}}P&&this.addCurrentVertex(T,O,-Ve,-Ze,w)}else if(Oe==="butt")this.addCurrentVertex(T,Y,0,0,w);else if(Oe==="square"){const we=C?1:-1;C||this.addCurrentVertex(T,Y,we,we,w),this.addCurrentVertex(T,Y,0,0,w),C&&this.addCurrentVertex(T,Y,we,we,w)}else Oe==="round"&&(C&&(this.addCurrentVertex(T,B,0,0,w),this.addCurrentVertex(T,B,1,1,w,!0)),P&&(this.addCurrentVertex(T,O,-1,-1,w,!0),this.addCurrentVertex(T,O,0,0,w)));if(Te&&Z<m-1){const we=T.dist(P);if(we>2*v){const Ve=T.add(P.sub(T)._mult(v/we)._round());this.updateDistance(T,Ve),this.addCurrentVertex(Ve,O,0,0,w),T=Ve}}}}addCurrentVertex(e,r,n,a,l,h=!1){const p=r.y*a-r.x,m=-r.y-r.x*a;this.addHalfVertex(e,r.x+r.y*n,r.y-r.x*n,h,!1,n,l),this.addHalfVertex(e,p,m,h,!0,-a,l)}addHalfVertex({x:e,y:r},n,a,l,h,p,m){this.layoutVertexArray.emplaceBack((e<<1)+(l?1:0),(r<<1)+(h?1:0),Math.round(63*n)+128,Math.round(63*a)+128,1+(p===0?0:p<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const y=m.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,y),m.primitiveLength++),h?this.e2=y:this.e1=y}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Ye("LineBucket",Au,{omit:["layers","patternFeatures"]});const xy=new Qi({"line-cap":new st(xe.layout_line["line-cap"]),"line-join":new st(xe.layout_line["line-join"]),"line-miter-limit":new et(xe.layout_line["line-miter-limit"]),"line-round-limit":new et(xe.layout_line["line-round-limit"]),"line-sort-key":new st(xe.layout_line["line-sort-key"])});var If={paint:new Qi({"line-opacity":new st(xe.paint_line["line-opacity"]),"line-color":new st(xe.paint_line["line-color"]),"line-translate":new et(xe.paint_line["line-translate"]),"line-translate-anchor":new et(xe.paint_line["line-translate-anchor"]),"line-width":new st(xe.paint_line["line-width"]),"line-gap-width":new st(xe.paint_line["line-gap-width"]),"line-offset":new st(xe.paint_line["line-offset"]),"line-blur":new st(xe.paint_line["line-blur"]),"line-dasharray":new Zi(xe.paint_line["line-dasharray"]),"line-pattern":new Zi(xe.paint_line["line-pattern"]),"line-gradient":new Kn(xe.paint_line["line-gradient"])}),layout:xy};const Mf=new class extends st{possiblyEvaluate(t,e){return e=new _t(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,r,n){return e=Je({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,r,n)}}(If.paint.properties["line-width"].specification);function Af(t,e){return e>0?e+2*t:t}Mf.useIntegerZoom=!0;const vy=xi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),by=xi([{name:"a_projected_pos",components:3,type:"Float32"}],4);xi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const wy=xi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Ty=xi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);xi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Cf=xi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ey=xi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);xi([{name:"triangle",components:3,type:"Uint16"}]),xi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),xi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),xi([{type:"Float32",name:"offsetX"}]),xi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var rr=24;const Jn=128;function ad(t,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new _t(t+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:a}=r;let l=0;for(;l<n.length&&n[l]<=t;)l++;l=Math.max(0,l-1);let h=l;for(;h<n.length&&n[h]<t+1;)h++;h=Math.min(n.length-1,h);const p=n[l],m=n[h];return r.kind==="composite"?{kind:"composite",minZoom:p,maxZoom:m,interpolationType:a}:{kind:"camera",minZoom:p,maxZoom:m,minSize:r.evaluate(new _t(p)),maxSize:r.evaluate(new _t(m)),interpolationType:a}}}function Cu(t,{uSize:e,uSizeT:r},{lowerSize:n,upperSize:a}){return t.kind==="source"?n/Jn:t.kind==="composite"?Xt(n/Jn,a/Jn,r):e}function Ka(t,e){let r=0,n=0;if(t.kind==="constant")n=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:a,minZoom:l,maxZoom:h}=t,p=a?ze(pr.interpolationFactor(a,e,l,h),0,1):0;t.kind==="camera"?n=Xt(t.minSize,t.maxSize,p):r=p}return{uSizeT:r,uSize:n}}var Sy=Object.freeze({__proto__:null,getSizeData:ad,evaluateSizeForFeature:Cu,evaluateSizeForZoom:Ka,SIZE_PACK_FACTOR:Jn});function Iy(t,e,r){return t.sections.forEach(n=>{n.text=function(a,l,h){const p=l.layout.get("text-transform").evaluate(h,{});return p==="uppercase"?a=a.toLocaleUpperCase():p==="lowercase"&&(a=a.toLocaleLowerCase()),Lt.applyArabicShaping&&(a=Lt.applyArabicShaping(a)),a}(n.text,e,r)}),t}const nc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function My(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function Ay(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}var zf=function(t,e,r,n,a){var l,h,p=8*a-n-1,m=(1<<p)-1,y=m>>1,v=-7,w=r?a-1:0,T=r?-1:1,C=t[e+w];for(w+=T,l=C&(1<<-v)-1,C>>=-v,v+=p;v>0;l=256*l+t[e+w],w+=T,v-=8);for(h=l&(1<<-v)-1,l>>=-v,v+=n;v>0;h=256*h+t[e+w],w+=T,v-=8);if(l===0)l=1-y;else{if(l===m)return h?NaN:1/0*(C?-1:1);h+=Math.pow(2,n),l-=y}return(C?-1:1)*h*Math.pow(2,l-n)},Pf=function(t,e,r,n,a,l){var h,p,m,y=8*l-a-1,v=(1<<y)-1,w=v>>1,T=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,C=n?0:l-1,P=n?1:-1,B=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(p=isNaN(e)?1:0,h=v):(h=Math.floor(Math.log(e)/Math.LN2),e*(m=Math.pow(2,-h))<1&&(h--,m*=2),(e+=h+w>=1?T/m:T*Math.pow(2,1-w))*m>=2&&(h++,m/=2),h+w>=v?(p=0,h=v):h+w>=1?(p=(e*m-1)*Math.pow(2,a),h+=w):(p=e*Math.pow(2,w-1)*Math.pow(2,a),h=0));a>=8;t[r+C]=255&p,C+=P,p/=256,a-=8);for(h=h<<a|p,y+=a;y>0;t[r+C]=255&h,C+=P,h/=256,y-=8);t[r+C-P]|=128*B},oc=ni;function ni(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ni.Varint=0,ni.Fixed64=1,ni.Bytes=2,ni.Fixed32=5;var ld=4294967296,kf=1/ld,Df=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function wo(t){return t.type===ni.Bytes?t.readVarint()+t.pos:t.pos+1}function Ya(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Lf(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var a=r.pos-1;a>=t;a--)r.buf[a+n]=r.buf[a]}function Cy(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function zy(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function Py(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function ky(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function Dy(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function Ly(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function By(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function Ry(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function Fy(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function zu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Ja(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function Bf(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Oy(t,e,r){e.glyphs=[],t===1&&r.readMessage(Uy,e)}function Uy(t,e,r){if(t===3){const{id:n,bitmap:a,width:l,height:h,left:p,top:m,advance:y}=r.readMessage(Vy,{});e.glyphs.push({id:n,bitmap:new Ko({width:l+6,height:h+6},a),metrics:{width:l,height:h,left:p,top:m,advance:y}})}else t===4?e.ascender=r.readSVarint():t===5&&(e.descender=r.readSVarint())}function Vy(t,e,r){t===1?e.id=r.readVarint():t===2?e.bitmap=r.readBytes():t===3?e.width=r.readVarint():t===4?e.height=r.readVarint():t===5?e.left=r.readSVarint():t===6?e.top=r.readSVarint():t===7&&(e.advance=r.readVarint())}function cd(t){let e=0,r=0;for(const h of t)e+=h.w*h.h,r=Math.max(r,h.w);t.sort((h,p)=>p.h-h.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let a=0,l=0;for(const h of t)for(let p=n.length-1;p>=0;p--){const m=n[p];if(!(h.w>m.w||h.h>m.h)){if(h.x=m.x,h.y=m.y,l=Math.max(l,h.y+h.h),a=Math.max(a,h.x+h.w),h.w===m.w&&h.h===m.h){const y=n.pop();p<n.length&&(n[p]=y)}else h.h===m.h?(m.x+=h.w,m.w-=h.w):h.w===m.w?(m.y+=h.h,m.h-=h.h):(n.push({x:m.x+h.w,y:m.y,w:m.w-h.w,h:h.h}),m.y+=h.h,m.h-=h.h);break}}return{w:a,h:l,fill:e/(a*l)||0}}ni.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),a=n>>3,l=this.pos;this.type=7&n,t(a,e,this),this.pos===l&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=zu(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Bf(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=zu(this.buf,this.pos)+zu(this.buf,this.pos+4)*ld;return this.pos+=8,t},readSFixed64:function(){var t=zu(this.buf,this.pos)+Bf(this.buf,this.pos+4)*ld;return this.pos+=8,t},readFloat:function(){var t=zf(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=zf(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(a,l,h){var p,m,y=h.buf;if(p=(112&(m=y[h.pos++]))>>4,m<128||(p|=(127&(m=y[h.pos++]))<<3,m<128)||(p|=(127&(m=y[h.pos++]))<<10,m<128)||(p|=(127&(m=y[h.pos++]))<<17,m<128)||(p|=(127&(m=y[h.pos++]))<<24,m<128)||(p|=(1&(m=y[h.pos++]))<<31,m<128))return Ya(a,p,l);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Df?function(r,n,a){return Df.decode(r.subarray(n,a))}(this.buf,e,t):function(r,n,a){for(var l="",h=n;h<a;){var p,m,y,v=r[h],w=null,T=v>239?4:v>223?3:v>191?2:1;if(h+T>a)break;T===1?v<128&&(w=v):T===2?(192&(p=r[h+1]))==128&&(w=(31&v)<<6|63&p)<=127&&(w=null):T===3?(m=r[h+2],(192&(p=r[h+1]))==128&&(192&m)==128&&((w=(15&v)<<12|(63&p)<<6|63&m)<=2047||w>=55296&&w<=57343)&&(w=null)):T===4&&(m=r[h+2],y=r[h+3],(192&(p=r[h+1]))==128&&(192&m)==128&&(192&y)==128&&((w=(15&v)<<18|(63&p)<<12|(63&m)<<6|63&y)<=65535||w>=1114112)&&(w=null)),w===null?(w=65533,T=1):w>65535&&(w-=65536,l+=String.fromCharCode(w>>>10&1023|55296),w=56320|1023&w),l+=String.fromCharCode(w),h+=T}return l}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==ni.Bytes)return t.push(this.readVarint(e));var r=wo(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==ni.Bytes)return t.push(this.readSVarint());var e=wo(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ni.Bytes)return t.push(this.readBoolean());var e=wo(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ni.Bytes)return t.push(this.readFloat());var e=wo(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ni.Bytes)return t.push(this.readDouble());var e=wo(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ni.Bytes)return t.push(this.readFixed32());var e=wo(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ni.Bytes)return t.push(this.readSFixed32());var e=wo(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ni.Bytes)return t.push(this.readFixed64());var e=wo(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ni.Bytes)return t.push(this.readSFixed64());var e=wo(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===ni.Varint)for(;this.buf[this.pos++]>127;);else if(e===ni.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ni.Fixed32)this.pos+=4;else{if(e!==ni.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Ja(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Ja(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Ja(this.buf,-1&t,this.pos),Ja(this.buf,Math.floor(t*kf),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Ja(this.buf,-1&t,this.pos),Ja(this.buf,Math.floor(t*kf),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,r){var n,a;if(e>=0?(n=e%4294967296|0,a=e/4294967296|0):(a=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(l,h,p){p.buf[p.pos++]=127&l|128,l>>>=7,p.buf[p.pos++]=127&l|128,l>>>=7,p.buf[p.pos++]=127&l|128,l>>>=7,p.buf[p.pos++]=127&l|128,p.buf[p.pos]=127&(l>>>=7)}(n,0,r),function(l,h){var p=(7&l)<<4;h.buf[h.pos++]|=p|((l>>>=3)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l|((l>>>=7)?128:0),l&&(h.buf[h.pos++]=127&l)))))}(a,r)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(n,a,l){for(var h,p,m=0;m<a.length;m++){if((h=a.charCodeAt(m))>55295&&h<57344){if(!p){h>56319||m+1===a.length?(n[l++]=239,n[l++]=191,n[l++]=189):p=h;continue}if(h<56320){n[l++]=239,n[l++]=191,n[l++]=189,p=h;continue}h=p-55296<<10|h-56320|65536,p=null}else p&&(n[l++]=239,n[l++]=191,n[l++]=189,p=null);h<128?n[l++]=h:(h<2048?n[l++]=h>>6|192:(h<65536?n[l++]=h>>12|224:(n[l++]=h>>18|240,n[l++]=h>>12&63|128),n[l++]=h>>6&63|128),n[l++]=63&h|128)}return l}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&Lf(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),Pf(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Pf(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&Lf(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,ni.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Cy,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,zy,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Dy,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Py,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,ky,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Ly,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,By,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Ry,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Fy,e)},writeBytesField:function(t,e){this.writeTag(t,ni.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,ni.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,ni.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,ni.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,ni.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,ni.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,ni.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,ni.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,ni.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,ni.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class ud{constructor(e,{pixelRatio:r,version:n,stretchX:a,stretchY:l,content:h}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=a,this.stretchY=l,this.content=h,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Rf{constructor(e,r){const n={},a={};this.haveRenderCallbacks=[];const l=[];this.addImages(e,n,l),this.addImages(r,a,l);const{w:h,h:p}=cd(l),m=new Qr({width:h||1,height:p||1});for(const y in e){const v=e[y],w=n[y].paddedRect;Qr.copy(v.data,m,{x:0,y:0},{x:w.x+1,y:w.y+1},v.data)}for(const y in r){const v=r[y],w=a[y].paddedRect,T=w.x+1,C=w.y+1,P=v.data.width,B=v.data.height;Qr.copy(v.data,m,{x:0,y:0},{x:T,y:C},v.data),Qr.copy(v.data,m,{x:0,y:B-1},{x:T,y:C-1},{width:P,height:1}),Qr.copy(v.data,m,{x:0,y:0},{x:T,y:C+B},{width:P,height:1}),Qr.copy(v.data,m,{x:P-1,y:0},{x:T-1,y:C},{width:1,height:B}),Qr.copy(v.data,m,{x:0,y:0},{x:T+P,y:C},{width:1,height:B})}this.image=m,this.iconPositions=n,this.patternPositions=a}addImages(e,r,n){for(const a in e){const l=e[a],h={x:0,y:0,w:l.data.width+2,h:l.data.height+2};n.push(h),r[a]=new ud(h,l),l.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),r),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),r)}patchUpdatedImage(e,r,n){if(!e||!r||e.version===r.version)return;e.version=r.version;const[a,l]=e.tl;n.update(r.data,void 0,{x:a,y:l})}}Ye("ImagePosition",ud),Ye("ImageAtlas",Rf);const en={horizontal:1,vertical:2,horizontalOnly:3};class sc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const n=new sc;return n.scale=e||1,n.fontStack=r,n}static forImage(e){const r=new sc;return r.imageName=e,r}}class Qa{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const n=new Qa;for(let a=0;a<e.sections.length;a++){const l=e.sections[a];l.image?n.addImageSection(l):n.addTextSection(l,r)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,n){let a="";for(let l=0;l<r.length;l++){const h=r.charCodeAt(l+1)||null,p=r.charCodeAt(l-1)||null;a+=!n&&(h&&rt(h)&&!nc[r[l+1]]||p&&rt(p)&&!nc[r[l-1]])||!nc[r[l]]?r[l]:nc[r[l]]}return a}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&Pu[this.text.charCodeAt(n)];n++)e++;let r=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&Pu[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const n=new Qa;return n.text=this.text.substring(e,r),n.sectionIndex=this.sectionIndex.slice(e,r),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(sc.forText(e.scale,e.fontStack||r));const n=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(n)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void jt("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(sc.forImage(r)),this.sectionIndex.push(this.sections.length-1)):jt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hd(t,e,r,n,a,l,h,p,m,y,v,w,T,C,P,B){const O=Qa.fromFeature(t,a);let Z;w===en.vertical&&O.verticalizePunctuation(T);const{processBidirectionalText:Y,processStyledBidirectionalText:ie}=Lt;if(Y&&O.sections.length===1){Z=[];const le=Y(O.toString(),dd(O,y,l,e,n,C,P));for(const Te of le){const be=new Qa;be.text=Te,be.sections=O.sections;for(let $e=0;$e<Te.length;$e++)be.sectionIndex.push(0);Z.push(be)}}else if(ie){Z=[];const le=ie(O.text,O.sectionIndex,dd(O,y,l,e,n,C,P));for(const Te of le){const be=new Qa;be.text=Te[0],be.sectionIndex=Te[1],be.sections=O.sections,Z.push(be)}}else Z=function(le,Te){const be=[],$e=le.text;let Oe=0;for(const we of Te)be.push(le.substring(Oe,we)),Oe=we;return Oe<$e.length&&be.push(le.substring(Oe,$e.length)),be}(O,dd(O,y,l,e,n,C,P));const se=[],ae={positionedLines:se,text:O.toString(),top:v[1],bottom:v[1],left:v[0],right:v[0],writingMode:w,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(le,Te,be,$e,Oe,we,Ve,Ze,Ce,Ke,tt,Dt){let oi=0,Bt=0,Rt=0;const Be=Ze==="right"?1:Ze==="left"?0:.5;let $t=!1;for(const Zt of Oe){const kt=Zt.getSections();for(const _i of kt){if(_i.imageName)continue;const ki=Te[_i.fontStack];if(ki&&($t=ki.ascender!==void 0&&ki.descender!==void 0,!$t))break}if(!$t)break}let Ot=0;for(const Zt of Oe){Zt.trim();const kt=Zt.getMaxScale(),_i=(kt-1)*rr,ki={positionedGlyphs:[],lineOffset:0};le.positionedLines[Ot]=ki;const Ii=ki.positionedGlyphs;let Fi=0;if(!Zt.length()){Bt+=we,++Ot;continue}let nr=0,Ar=0;for(let fi=0;fi<Zt.length();fi++){const Wi=Zt.getSection(fi),gn=Zt.getSectionIndex(fi),er=Zt.getCharCode(fi);let ei=Wi.scale,Xi=null,gi=null,cr=null,Oi=rr,ur=0;const _r=!(Ce===en.horizontal||!tt&&!Se(er)||tt&&(Pu[er]||(Pi=er,i(Pi)||o(Pi)||u(Pi)||Q(Pi)||De(Pi))));if(Wi.imageName){const gr=$e[Wi.imageName];if(!gr)continue;cr=Wi.imageName,le.iconsInText=le.iconsInText||!0,gi=gr.paddedRect;const Hi=gr.displaySize;ei=ei*rr/Dt,Xi={width:Hi[0],height:Hi[1],left:1,top:-3,advance:_r?Hi[1]:Hi[0],localGlyph:!1},ur=$t?-Xi.height*ei:kt*rr-17-Hi[1]*ei,Oi=Xi.advance;const Dn=(_r?Hi[0]:Hi[1])*ei-rr*kt;Dn>0&&Dn>Fi&&(Fi=Dn)}else{const gr=be[Wi.fontStack];if(!gr)continue;gr[er]&&(gi=gr[er]);const Hi=Te[Wi.fontStack];if(!Hi)continue;const Dn=Hi.glyphs[er];if(!Dn)continue;if(Xi=Dn.metrics,Oi=er!==8203?rr:0,$t){const ol=Hi.ascender!==void 0?Math.abs(Hi.ascender):0,pc=Hi.descender!==void 0?Math.abs(Hi.descender):0,fc=(ol+pc)*ei;nr<fc&&(nr=fc,Ar=(ol-pc)/2*ei),ur=-ol*ei}else ur=(kt-ei)*rr-17}_r?(le.verticalizable=!0,Ii.push({glyph:er,imageName:cr,x:oi,y:Bt+ur,vertical:_r,scale:ei,localGlyph:Xi.localGlyph,fontStack:Wi.fontStack,sectionIndex:gn,metrics:Xi,rect:gi}),oi+=Oi*ei+Ke):(Ii.push({glyph:er,imageName:cr,x:oi,y:Bt+ur,vertical:_r,scale:ei,localGlyph:Xi.localGlyph,fontStack:Wi.fontStack,sectionIndex:gn,metrics:Xi,rect:gi}),oi+=Xi.advance*ei+Ke)}Ii.length!==0&&(Rt=Math.max(oi-Ke,Rt),$t?Nf(Ii,Be,Fi,Ar,we*kt/2):Nf(Ii,Be,Fi,0,we/2)),oi=0;const Cr=we*kt+Fi;ki.lineOffset=Math.max(Fi,_i),Bt+=Cr,++Ot}var Pi;const Ei=Bt,{horizontalAlign:qi,verticalAlign:lr}=pd(Ve);(function(Zt,kt,_i,ki,Ii,Fi){const nr=(kt-_i)*Ii,Ar=-Fi*ki;for(const Cr of Zt)for(const fi of Cr.positionedGlyphs)fi.x+=nr,fi.y+=Ar})(le.positionedLines,Be,qi,lr,Rt,Ei),le.top+=-lr*Ei,le.bottom=le.top+Ei,le.left+=-qi*Rt,le.right=le.left+Rt,le.hasBaseline=$t}(ae,e,r,n,Z,h,p,m,w,y,T,B),!function(le){for(const Te of le)if(Te.positionedGlyphs.length!==0)return!1;return!0}(se)&&ae}const Pu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ny={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ff(t,e,r,n,a,l){if(e.imageName){const h=n[e.imageName];return h?h.displaySize[0]*e.scale*rr/l+a:0}{const h=r[e.fontStack],p=h&&h.glyphs[t];return p?p.metrics.advance*e.scale+a:0}}function Of(t,e,r,n){const a=Math.pow(t-e,2);return n?t<e?a/2:2*a:a+Math.abs(r)*r}function jy(t,e,r){let n=0;return t===10&&(n-=1e4),r&&(n+=150),t!==40&&t!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function Uf(t,e,r,n,a,l){let h=null,p=Of(e,r,a,l);for(const m of n){const y=Of(e-m.x,r,a,l)+m.badness;y<=p&&(h=m,p=y)}return{index:t,x:e,priorBreak:h,badness:p}}function Vf(t){return t?Vf(t.priorBreak).concat(t.index):[]}function dd(t,e,r,n,a,l,h){if(l!=="point")return[];if(!t)return[];const p=[],m=function(T,C,P,B,O,Z){let Y=0;for(let ie=0;ie<T.length();ie++){const se=T.getSection(ie);Y+=Ff(T.getCharCode(ie),se,B,O,C,Z)}return Y/Math.max(1,Math.ceil(Y/P))}(t,e,r,n,a,h),y=t.text.indexOf("\u200B")>=0;let v=0;for(let T=0;T<t.length();T++){const C=t.getSection(T),P=t.getCharCode(T);if(Pu[P]||(v+=Ff(P,C,n,a,e,h)),T<t.length()-1){const B=!((w=P)<11904||!(z(w)||I(w)||ge(w)||X(w)||N(w)||d(w)||L(w)||x(w)||J(w)||U(w)||F(w)||Pe(w)||E(w)||g(w)||f(w)||V(w)||S(w)||he(w)||K(w)||H(w)));(Ny[P]||B||C.imageName)&&p.push(Uf(T+1,v,m,p,jy(P,t.getCharCode(T+1),B&&y),!1))}}var w;return Vf(Uf(t.length(),v,m,p,0,!0))}function pd(t){let e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Nf(t,e,r,n,a){if(!(e||r||n||a))return;const l=t.length-1,h=t[l],p=(h.x+h.metrics.advance*h.scale)*e;for(let m=0;m<=l;m++)t[m].x-=p,t[m].y+=r+n+a}function Gy(t,e,r){const{horizontalAlign:n,verticalAlign:a}=pd(r),l=e[0]-t.displaySize[0]*n,h=e[1]-t.displaySize[1]*a;return{image:t,top:h,bottom:h+t.displaySize[1],left:l,right:l+t.displaySize[0]}}function jf(t,e,r,n,a,l){const h=t.image;let p;if(h.content){const O=h.content,Z=h.pixelRatio||1;p=[O[0]/Z,O[1]/Z,h.displaySize[0]-O[2]/Z,h.displaySize[1]-O[3]/Z]}const m=e.left*l,y=e.right*l;let v,w,T,C;r==="width"||r==="both"?(C=a[0]+m-n[3],w=a[0]+y+n[1]):(C=a[0]+(m+y-h.displaySize[0])/2,w=C+h.displaySize[0]);const P=e.top*l,B=e.bottom*l;return r==="height"||r==="both"?(v=a[1]+P-n[0],T=a[1]+B+n[2]):(v=a[1]+(P+B-h.displaySize[1])/2,T=v+h.displaySize[1]),{image:h,top:v,right:w,bottom:T,left:C,collisionPadding:p}}class To extends _e{constructor(e,r,n,a,l){super(e,r),this.angle=a,this.z=n,l!==void 0&&(this.segment=l)}clone(){return new To(this.x,this.y,this.z,this.angle,this.segment)}}function Gf(t,e,r,n,a){if(e.segment===void 0)return!0;let l=e,h=e.segment+1,p=0;for(;p>-r/2;){if(h--,h<0)return!1;p-=t[h].dist(l),l=t[h]}p+=t[h].dist(t[h+1]),h++;const m=[];let y=0;for(;p<r/2;){const v=t[h],w=t[h+1];if(!w)return!1;let T=t[h-1].angleTo(v)-v.angleTo(w);for(T=Math.abs((T+3*Math.PI)%(2*Math.PI)-Math.PI),m.push({distance:p,angleDelta:T}),y+=T;p-m[0].distance>n;)y-=m.shift().angleDelta;if(y>a)return!1;h++,p+=v.dist(w)}return!0}function $f(t){let e=0;for(let r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function Zf(t,e,r){return t?.6*e*r:0}function qf(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function $y(t,e,r,n,a,l){const h=Zf(r,a,l),p=qf(r,n)*l;let m=0;const y=$f(t)/2;for(let v=0;v<t.length-1;v++){const w=t[v],T=t[v+1],C=w.dist(T);if(m+C>y){const P=(y-m)/C,B=Xt(w.x,T.x,P),O=Xt(w.y,T.y,P),Z=new To(B,O,0,T.angleTo(w),v);return!h||Gf(t,Z,p,h,e)?Z:void 0}m+=C}}function Zy(t,e,r,n,a,l,h,p,m){const y=Zf(n,l,h),v=qf(n,a),w=v*h,T=t[0].x===0||t[0].x===m||t[0].y===0||t[0].y===m;return e-w<e/4&&(e=w+e/4),Wf(t,T?e/2*p%e:(v/2+2*l)*h*p%e,e,y,r,w,T,!1,m)}function Wf(t,e,r,n,a,l,h,p,m){const y=l/2,v=$f(t);let w=0,T=e-r,C=[];for(let P=0;P<t.length-1;P++){const B=t[P],O=t[P+1],Z=B.dist(O),Y=O.angleTo(B);for(;T+r<w+Z;){T+=r;const ie=(T-w)/Z,se=Xt(B.x,O.x,ie),ae=Xt(B.y,O.y,ie);if(se>=0&&se<m&&ae>=0&&ae<m&&T-y>=0&&T+y<=v){const le=new To(se,ae,0,Y,P);le._round(),n&&!Gf(t,le,l,n,a)||C.push(le)}}w+=Z}return p||C.length||h||(C=Wf(t,w/2,r,n,a,l,h,!0,m)),C}function Xf(t,e,r,n,a){const l=[];for(let h=0;h<t.length;h++){const p=t[h];let m;for(let y=0;y<p.length-1;y++){let v=p[y],w=p[y+1];v.x<e&&w.x<e||(v.x<e?v=new _e(e,v.y+(e-v.x)/(w.x-v.x)*(w.y-v.y))._round():w.x<e&&(w=new _e(e,v.y+(e-v.x)/(w.x-v.x)*(w.y-v.y))._round()),v.y<r&&w.y<r||(v.y<r?v=new _e(v.x+(r-v.y)/(w.y-v.y)*(w.x-v.x),r)._round():w.y<r&&(w=new _e(v.x+(r-v.y)/(w.y-v.y)*(w.x-v.x),r)._round()),v.x>=n&&w.x>=n||(v.x>=n?v=new _e(n,v.y+(n-v.x)/(w.x-v.x)*(w.y-v.y))._round():w.x>=n&&(w=new _e(n,v.y+(n-v.x)/(w.x-v.x)*(w.y-v.y))._round()),v.y>=a&&w.y>=a||(v.y>=a?v=new _e(v.x+(a-v.y)/(w.y-v.y)*(w.x-v.x),a)._round():w.y>=a&&(w=new _e(v.x+(a-v.y)/(w.y-v.y)*(w.x-v.x),a)._round()),m&&v.equals(m[m.length-1])||(m=[v],l.push(m)),m.push(w)))))}}return l}Ye("Anchor",To);const ac=1e20;function Hf(t,e,r,n,a,l,h,p,m){for(let y=e;y<e+n;y++)Kf(t,r*l+y,l,a,h,p,m);for(let y=r;y<r+a;y++)Kf(t,y*l+e,1,n,h,p,m)}function Kf(t,e,r,n,a,l,h){l[0]=0,h[0]=-ac,h[1]=ac,a[0]=t[e];for(let p=1,m=0,y=0;p<n;p++){a[p]=t[e+p*r];const v=p*p;do{const w=l[m];y=(a[p]-a[w]+v-w*w)/(p-w)/2}while(y<=h[m]&&--m>-1);m++,l[m]=p,h[m]=y,h[m+1]=ac}for(let p=0,m=0;p<n;p++){for(;h[m+1]<p;)m++;const y=l[m],v=p-y;t[e+p*r]=a[y]+v*v}}const fd={none:0,ideographs:1,all:2};class el{constructor(e,r,n){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=n,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const n=[];for(const a in e)for(const l of e[a])n.push({stack:a,id:l});at(n,({stack:a,id:l},h)=>{let p=this.entries[a];p||(p=this.entries[a]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let m=p.glyphs[l];if(m!==void 0)return void h(null,{stack:a,id:l,glyph:m});if(m=this._tinySDF(p,a,l),m)return p.glyphs[l]=m,void h(null,{stack:a,id:l,glyph:m});const y=Math.floor(l/256);if(256*y>65535)return void h(new Error("glyphs > 65535 not supported"));if(p.ranges[y])return void h(null,{stack:a,id:l,glyph:m});let v=p.requests[y];v||(v=p.requests[y]=[],el.loadGlyphRange(a,y,this.url,this.requestManager,(w,T)=>{if(T){p.ascender=T.ascender,p.descender=T.descender;for(const C in T.glyphs)this._doesCharSupportLocalGlyph(+C)||(p.glyphs[+C]=T.glyphs[+C]);p.ranges[y]=!0}for(const C of v)C(w,T);delete p.requests[y]})),v.push((w,T)=>{w?h(w):T&&h(null,{stack:a,id:l,glyph:T.glyphs[l]||null})})},(a,l)=>{if(a)r(a);else if(l){const h={};for(const{stack:p,id:m,glyph:y}of l)h[p]===void 0&&(h[p]={}),h[p].glyphs===void 0&&(h[p].glyphs={}),h[p].glyphs[m]=y&&{id:y.id,bitmap:y.bitmap.clone(),metrics:y.metrics},h[p].ascender=this.entries[p].ascender,h[p].descender=this.entries[p].descender;r(null,h)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==fd.none&&(this.localGlyphMode===fd.all?!!this.localFontFamily:!!this.localFontFamily&&(U(e)||W(e)||E(e)||S(e))||x(e))}_tinySDF(e,r,n){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(n))return;let l=e.tinySDF;if(!l){let B="400";/bold/i.test(r)?B="900":/medium/i.test(r)?B="500":/light/i.test(r)&&(B="200"),l=e.tinySDF=new el.TinySDF({fontFamily:a,fontWeight:B,fontSize:48,buffer:6,radius:16}),l.fontWeight=B}if(this.localGlyphs[l.fontWeight][n])return this.localGlyphs[l.fontWeight][n];const h=String.fromCharCode(n),{data:p,width:m,height:y,glyphWidth:v,glyphHeight:w,glyphLeft:T,glyphTop:C,glyphAdvance:P}=l.draw(h);return this.localGlyphs[l.fontWeight][n]={id:n,bitmap:new Ko({width:m,height:y},p),metrics:{width:v/2,height:w/2,left:T/2,top:C/2-27,advance:P/2,localGlyph:!0}}}}function Yf(t,e,r,n){const a=[],l=t.image,h=l.pixelRatio,p=l.paddedRect.w-2,m=l.paddedRect.h-2,y=t.right-t.left,v=t.bottom-t.top,w=l.stretchX||[[0,p]],T=l.stretchY||[[0,m]],C=(we,Ve)=>we+Ve[1]-Ve[0],P=w.reduce(C,0),B=T.reduce(C,0),O=p-P,Z=m-B;let Y=0,ie=P,se=0,ae=B,le=0,Te=O,be=0,$e=Z;if(l.content&&n){const we=l.content;Y=ku(w,0,we[0]),se=ku(T,0,we[1]),ie=ku(w,we[0],we[2]),ae=ku(T,we[1],we[3]),le=we[0]-Y,be=we[1]-se,Te=we[2]-we[0]-ie,$e=we[3]-we[1]-ae}const Oe=(we,Ve,Ze,Ce)=>{const Ke=Du(we.stretch-Y,ie,y,t.left),tt=Lu(we.fixed-le,Te,we.stretch,P),Dt=Du(Ve.stretch-se,ae,v,t.top),oi=Lu(Ve.fixed-be,$e,Ve.stretch,B),Bt=Du(Ze.stretch-Y,ie,y,t.left),Rt=Lu(Ze.fixed-le,Te,Ze.stretch,P),Be=Du(Ce.stretch-se,ae,v,t.top),$t=Lu(Ce.fixed-be,$e,Ce.stretch,B),Ot=new _e(Ke,Dt),Pi=new _e(Bt,Dt),Ei=new _e(Bt,Be),qi=new _e(Ke,Be),lr=new _e(tt/h,oi/h),Zt=new _e(Rt/h,$t/h),kt=e*Math.PI/180;if(kt){const Ii=Math.sin(kt),Fi=Math.cos(kt),nr=[Fi,-Ii,Ii,Fi];Ot._matMult(nr),Pi._matMult(nr),qi._matMult(nr),Ei._matMult(nr)}const _i=we.stretch+we.fixed,ki=Ve.stretch+Ve.fixed;return{tl:Ot,tr:Pi,bl:qi,br:Ei,tex:{x:l.paddedRect.x+1+_i,y:l.paddedRect.y+1+ki,w:Ze.stretch+Ze.fixed-_i,h:Ce.stretch+Ce.fixed-ki},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:lr,pixelOffsetBR:Zt,minFontScaleX:Te/h/y,minFontScaleY:$e/h/v,isSDF:r}};if(n&&(l.stretchX||l.stretchY)){const we=Jf(w,O,P),Ve=Jf(T,Z,B);for(let Ze=0;Ze<we.length-1;Ze++){const Ce=we[Ze],Ke=we[Ze+1];for(let tt=0;tt<Ve.length-1;tt++)a.push(Oe(Ce,Ve[tt],Ke,Ve[tt+1]))}}else a.push(Oe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:p+1},{fixed:0,stretch:m+1}));return a}function ku(t,e,r){let n=0;for(const a of t)n+=Math.max(e,Math.min(r,a[1]))-Math.max(e,Math.min(r,a[0]));return n}function Jf(t,e,r){const n=[{fixed:-1,stretch:0}];for(const[a,l]of t){const h=n[n.length-1];n.push({fixed:a-h.stretch,stretch:h.stretch}),n.push({fixed:a-h.stretch,stretch:h.stretch+(l-a)})}return n.push({fixed:e+1,stretch:r}),n}function Du(t,e,r,n){return t/e*r+n}function Lu(t,e,r,n){return t-e*r/n}function qy(t,e,r,n){const a=e+t.positionedLines[n].lineOffset;return n===0?r+a/2:r+(a+(e+t.positionedLines[n-1].lineOffset))/2}el.loadGlyphRange=function(t,e,r,n,a){const l=256*e,h=l+255,p=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",`${l}-${h}`),sa.Glyphs);ms(p,(m,y)=>{if(m)a(m);else if(y){const v={},w=function(T){return new oc(T).readFields(Oy,{})}(y);for(const T of w.glyphs)v[T.id]=T;a(null,{glyphs:v,ascender:w.ascender,descender:w.descender})}})},el.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:r=8,cutoff:n=.25,fontFamily:a="sans-serif",fontWeight:l="normal",fontStyle:h="normal"}){this.buffer=e,this.cutoff=n,this.radius=r;const p=this.size=t+4*e,m=this._createCanvas(p),y=this.ctx=m.getContext("2d",{willReadFrequently:!0});y.font=`${h} ${l} ${t}px ${a}`,y.textBaseline="alphabetic",y.textAlign="left",y.fillStyle="black",this.gridOuter=new Float64Array(p*p),this.gridInner=new Float64Array(p*p),this.f=new Float64Array(p),this.z=new Float64Array(p+1),this.v=new Uint16Array(p)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:n,actualBoundingBoxLeft:a,actualBoundingBoxRight:l}=this.ctx.measureText(t),h=Math.floor(r),p=Math.min(this.size-this.buffer,Math.ceil(l-a)),m=Math.min(this.size-this.buffer,Math.ceil(r)+Math.ceil(n)),y=p+2*this.buffer,v=m+2*this.buffer,w=y*v,T=new Uint8ClampedArray(w),C={data:T,width:y,height:v,glyphWidth:p,glyphHeight:m,glyphTop:h,glyphLeft:0,glyphAdvance:e};if(p===0||m===0)return C;const{ctx:P,buffer:B,gridInner:O,gridOuter:Z}=this;P.clearRect(B,B,p,m),P.fillText(t,B,B+h+1);const Y=P.getImageData(B,B,p,m);Z.fill(ac,0,w),O.fill(0,0,w);for(let ie=0;ie<m;ie++)for(let se=0;se<p;se++){const ae=Y.data[4*(ie*p+se)+3]/255;if(ae===0)continue;const le=(ie+B)*y+se+B;if(ae===1)Z[le]=0,O[le]=ac;else{const Te=.5-ae;Z[le]=Te>0?Te*Te:0,O[le]=Te<0?Te*Te:0}}Hf(Z,0,0,y,v,y,this.f,this.v,this.z),Hf(O,B,B,p,m,y,this.f,this.v,this.z);for(let ie=0;ie<w;ie++){const se=Math.sqrt(Z[ie])-Math.sqrt(O[ie]);T[ie]=Math.round(255-255*(se/this.radius+this.cutoff))}return C}};class Wy{constructor(e=[],r=Xy){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:n}=this,a=r[e];for(;e>0;){const l=e-1>>1,h=r[l];if(n(a,h)>=0)break;r[e]=h,e=l}r[e]=a}_down(e){const{data:r,compare:n}=this,a=this.length>>1,l=r[e];for(;e<a;){let h=1+(e<<1),p=r[h];const m=h+1;if(m<this.length&&n(r[m],p)<0&&(h=m,p=r[m]),n(p,l)>=0)break;r[e]=p,e=h}r[e]=l}}function Xy(t,e){return t<e?-1:t>e?1:0}function Hy(t,e=1,r=!1){let n=1/0,a=1/0,l=-1/0,h=-1/0;const p=t[0];for(let C=0;C<p.length;C++){const P=p[C];(!C||P.x<n)&&(n=P.x),(!C||P.y<a)&&(a=P.y),(!C||P.x>l)&&(l=P.x),(!C||P.y>h)&&(h=P.y)}const m=Math.min(l-n,h-a);let y=m/2;const v=new Wy([],Ky);if(m===0)return new _e(n,a);for(let C=n;C<l;C+=m)for(let P=a;P<h;P+=m)v.push(new tl(C+y,P+y,y,t));let w=function(C){let P=0,B=0,O=0;const Z=C[0];for(let Y=0,ie=Z.length,se=ie-1;Y<ie;se=Y++){const ae=Z[Y],le=Z[se],Te=ae.x*le.y-le.x*ae.y;B+=(ae.x+le.x)*Te,O+=(ae.y+le.y)*Te,P+=3*Te}return new tl(B/P,O/P,0,C)}(t),T=v.length;for(;v.length;){const C=v.pop();(C.d>w.d||!w.d)&&(w=C,r&&console.log("found best %d after %d probes",Math.round(1e4*C.d)/1e4,T)),C.max-w.d<=e||(y=C.h/2,v.push(new tl(C.p.x-y,C.p.y-y,y,t)),v.push(new tl(C.p.x+y,C.p.y-y,y,t)),v.push(new tl(C.p.x-y,C.p.y+y,y,t)),v.push(new tl(C.p.x+y,C.p.y+y,y,t)),T+=4)}return r&&(console.log(`num probes: ${T}`),console.log(`best distance: ${w.d}`)),w.p}function Ky(t,e){return e.max-t.max}function tl(t,e,r,n){this.p=new _e(t,e),this.h=r,this.d=function(a,l){let h=!1,p=1/0;for(let m=0;m<l.length;m++){const y=l[m];for(let v=0,w=y.length,T=w-1;v<w;T=v++){const C=y[v],P=y[T];C.y>a.y!=P.y>a.y&&a.x<(P.x-C.x)*(a.y-C.y)/(P.y-C.y)+C.x&&(h=!h),p=Math.min(p,sf(a,C,P))}}return(h?1:-1)*Math.sqrt(p)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const md=Number.POSITIVE_INFINITY,Yy=Math.sqrt(2);function Qf(t,e){return e[1]!==md?function(r,n,a){let l=0,h=0;switch(n=Math.abs(n),a=Math.abs(a),r){case"top-right":case"top-left":case"top":h=a-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-a}switch(r){case"top-right":case"bottom-right":case"right":l=-n;break;case"top-left":case"bottom-left":case"left":l=n}return[l,h]}(t,e[0],e[1]):function(r,n){let a=0,l=0;n<0&&(n=0);const h=n/Yy;switch(r){case"top-right":case"top-left":l=h-7;break;case"bottom-right":case"bottom-left":l=7-h;break;case"bottom":l=7-n;break;case"top":l=n-7}switch(r){case"top-right":case"bottom-right":a=-h;break;case"top-left":case"bottom-left":a=h;break;case"left":a=n;break;case"right":a=-n}return[a,l]}(t,e[0])}function Jy(t,e,r,n,a,l,h,p,m,y){t.createArrays(),t.tilePixelRatio=At/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const v=t.layers[0].layout,w=t.layers[0]._unevaluatedLayout._values,T={};if(t.textSizeData.kind==="composite"){const{minZoom:B,maxZoom:O}=t.textSizeData;T.compositeTextSizes=[w["text-size"].possiblyEvaluate(new _t(B),p),w["text-size"].possiblyEvaluate(new _t(O),p)]}if(t.iconSizeData.kind==="composite"){const{minZoom:B,maxZoom:O}=t.iconSizeData;T.compositeIconSizes=[w["icon-size"].possiblyEvaluate(new _t(B),p),w["icon-size"].possiblyEvaluate(new _t(O),p)]}T.layoutTextSize=w["text-size"].possiblyEvaluate(new _t(m+1),p),T.layoutIconSize=w["icon-size"].possiblyEvaluate(new _t(m+1),p),T.textMaxSize=w["text-size"].possiblyEvaluate(new _t(18),p);const C=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point",P=v.get("text-size");for(const B of t.features){const O=v.get("text-font").evaluate(B,{},p).join(","),Z=P.evaluate(B,{},p),Y=T.layoutTextSize.evaluate(B,{},p),ie=(T.layoutIconSize.evaluate(B,{},p),{horizontal:{},vertical:void 0}),se=B.text;let ae,le=[0,0];if(se){const $e=se.toString(),Oe=v.get("text-letter-spacing").evaluate(B,{},p)*rr,we=v.get("text-line-height").evaluate(B,{},p)*rr,Ve=me($e)?Oe:0,Ze=v.get("text-anchor").evaluate(B,{},p),Ce=v.get("text-variable-anchor");if(!Ce){const Rt=v.get("text-radial-offset").evaluate(B,{},p);le=Rt?Qf(Ze,[Rt*rr,md]):v.get("text-offset").evaluate(B,{},p).map(Be=>Be*rr)}let Ke=C?"center":v.get("text-justify").evaluate(B,{},p);const tt=v.get("symbol-placement"),Dt=tt==="point",oi=tt==="point"?v.get("text-max-width").evaluate(B,{},p)*rr:0,Bt=Rt=>{t.allowVerticalPlacement&&ve($e)&&(ie.vertical=hd(se,e,r,a,O,oi,we,Ze,Rt,Ve,le,en.vertical,!0,tt,Y,Z))};if(!C&&Ce){const Rt=Ke==="auto"?Ce.map($t=>_d($t)):[Ke];let Be=!1;for(let $t=0;$t<Rt.length;$t++){const Ot=Rt[$t];if(!ie.horizontal[Ot])if(Be)ie.horizontal[Ot]=ie.horizontal[0];else{const Pi=hd(se,e,r,a,O,oi,we,"center",Ot,Ve,le,en.horizontal,!1,tt,Y,Z);Pi&&(ie.horizontal[Ot]=Pi,Be=Pi.positionedLines.length===1)}}Bt("left")}else{if(Ke==="auto"&&(Ke=_d(Ze)),Dt||v.get("text-writing-mode").indexOf("horizontal")>=0||!ve($e)){const Rt=hd(se,e,r,a,O,oi,we,Ze,Ke,Ve,le,en.horizontal,!1,tt,Y,Z);Rt&&(ie.horizontal[Ke]=Rt)}Bt(tt==="point"?"left":Ke)}}let Te=!1;if(B.icon&&B.icon.name){const $e=n[B.icon.name];$e&&(ae=Gy(a[B.icon.name],v.get("icon-offset").evaluate(B,{},p),v.get("icon-anchor").evaluate(B,{},p)),Te=$e.sdf,t.sdfIcons===void 0?t.sdfIcons=$e.sdf:t.sdfIcons!==$e.sdf&&jt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),($e.pixelRatio!==t.pixelRatio||v.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const be=tm(ie.horizontal)||ie.vertical;t.iconsInText||(t.iconsInText=!!be&&be.iconsInText),(be||ae)&&Qy(t,B,ie,ae,n,T,Y,0,le,Te,h,p,y)}l&&t.generateCollisionDebugBuffers(m,t.collisionBoxArray)}function _d(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Qy(t,e,r,n,a,l,h,p,m,y,v,w,T){let C=l.textMaxSize.evaluate(e,{},w);C===void 0&&(C=h);const P=t.layers[0].layout,B=P.get("icon-offset").evaluate(e,{},w),O=tm(r.horizontal)||r.vertical,Z=h/24,Y=t.tilePixelRatio*C/24,ie=t.tilePixelRatio*P.get("symbol-spacing"),se=P.get("text-padding")*t.tilePixelRatio,ae=P.get("icon-padding")*t.tilePixelRatio,le=re(P.get("text-max-angle")),Te=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",be=P.get("icon-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",$e=P.get("symbol-placement"),Oe=ie/2,we=P.get("icon-text-fit");let Ve;n&&we!=="none"&&(t.allowVerticalPlacement&&r.vertical&&(Ve=jf(n,r.vertical,we,P.get("icon-text-fit-padding"),B,Z)),O&&(n=jf(n,O,we,P.get("icon-text-fit-padding"),B,Z)));const Ze=(Ce,Ke,tt)=>{if(Ke.x<0||Ke.x>=At||Ke.y<0||Ke.y>=At)return;const{x:Dt,y:oi,z:Bt}=T.projectTilePoint(Ke.x,Ke.y,tt),Rt=new To(Dt,oi,Bt,0,void 0);(function(Be,$t,Ot,Pi,Ei,qi,lr,Zt,kt,_i,ki,Ii,Fi,nr,Ar,Cr,fi,Wi,gn,er,ei,Xi,gi,cr,Oi){const ur=Be.addToLineVertexArray($t,Pi);let _r,gr,Hi,Dn,ol,pc,fc,Rm=0,Fm=0,Om=0,Um=0,Bd=-1,Rd=-1;const io={};let Vm=Kl(""),Fd=0,Od=0;if(kt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Fd,Od]=kt.layout.get("text-offset").evaluate(ei,{},Oi).map(Vr=>Vr*rr):(Fd=kt.layout.get("text-radial-offset").evaluate(ei,{},Oi)*rr,Od=md),Be.allowVerticalPlacement&&Ei.vertical){const Vr=Ei.vertical;if(Ar)pc=gd(Vr),Zt&&(fc=gd(Zt));else{const Nr=kt.layout.get("text-rotate").evaluate(ei,{},Oi)+90;Hi=Bu(_i,Ot,$t,ki,Ii,Fi,Vr,nr,Nr,Cr),Zt&&(Dn=Bu(_i,Ot,$t,ki,Ii,Fi,Zt,Wi,Nr))}}if(qi){const Vr=kt.layout.get("icon-rotate").evaluate(ei,{},Oi),Nr=kt.layout.get("icon-text-fit")!=="none",mc=Yf(qi,Vr,gi,Nr),Vd=Zt?Yf(Zt,Vr,gi,Nr):void 0;gr=Bu(_i,Ot,$t,ki,Ii,Fi,qi,Wi,Vr),Rm=4*mc.length;const Nm=Be.iconSizeData;let Hs=null;Nm.kind==="source"?(Hs=[Jn*kt.layout.get("icon-size").evaluate(ei,{},Oi)],Hs[0]>Jo&&jt(`${Be.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Nm.kind==="composite"&&(Hs=[Jn*Xi.compositeIconSizes[0].evaluate(ei,{},Oi),Jn*Xi.compositeIconSizes[1].evaluate(ei,{},Oi)],(Hs[0]>Jo||Hs[1]>Jo)&&jt(`${Be.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Be.addSymbols(Be.icon,mc,Hs,er,gn,ei,!1,Ot,$t,ur.lineStartIndex,ur.lineLength,-1,cr,Oi),Bd=Be.icon.placedSymbolArray.length-1,Vd&&(Fm=4*Vd.length,Be.addSymbols(Be.icon,Vd,Hs,er,gn,ei,en.vertical,Ot,$t,ur.lineStartIndex,ur.lineLength,-1,cr,Oi),Rd=Be.icon.placedSymbolArray.length-1)}for(const Vr in Ei.horizontal){const Nr=Ei.horizontal[Vr];_r||(Vm=Kl(Nr.text),Ar?ol=gd(Nr):_r=Bu(_i,Ot,$t,ki,Ii,Fi,Nr,nr,kt.layout.get("text-rotate").evaluate(ei,{},Oi),Cr));const mc=Nr.positionedLines.length===1;if(Om+=em(Be,Ot,$t,Nr,lr,kt,Ar,ei,Cr,ur,Ei.vertical?en.horizontal:en.horizontalOnly,mc?Object.keys(Ei.horizontal):[Vr],io,Bd,Xi,cr,Oi),mc)break}Ei.vertical&&(Um+=em(Be,Ot,$t,Ei.vertical,lr,kt,Ar,ei,Cr,ur,en.vertical,["vertical"],io,Rd,Xi,cr,Oi));let rs=-1;const Ud=(Vr,Nr)=>Vr?Math.max(Vr,Nr):Nr;rs=Ud(ol,rs),rs=Ud(pc,rs),rs=Ud(fc,rs);const Ax=rs>-1?1:0;Be.glyphOffsetArray.length>=Qo.MAX_GLYPHS&&jt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ei.sortKey!==void 0&&Be.addToSortKeyRanges(Be.symbolInstances.length,ei.sortKey),Be.symbolInstances.emplaceBack(Ot.x,Ot.y,Ot.z,$t.x,$t.y,io.right>=0?io.right:-1,io.center>=0?io.center:-1,io.left>=0?io.left:-1,io.vertical>=0?io.vertical:-1,Bd,Rd,Vm,_r!==void 0?_r:Be.collisionBoxArray.length,_r!==void 0?_r+1:Be.collisionBoxArray.length,Hi!==void 0?Hi:Be.collisionBoxArray.length,Hi!==void 0?Hi+1:Be.collisionBoxArray.length,gr!==void 0?gr:Be.collisionBoxArray.length,gr!==void 0?gr+1:Be.collisionBoxArray.length,Dn||Be.collisionBoxArray.length,Dn?Dn+1:Be.collisionBoxArray.length,ki,Om,Um,Rm,Fm,Ax,0,Fd,Od,rs)})(t,Ke,Rt,Ce,r,n,a,Ve,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,se,Te,m,0,ae,be,B,e,l,y,v,w)};if($e==="line")for(const Ce of Xf(e.geometry,0,0,At,At)){const Ke=Zy(Ce,ie,le,r.vertical||O,n,24,Y,t.overscaling,At);for(const tt of Ke){const Dt=O;Dt&&ex(t,Dt.text,Oe,tt)||Ze(Ce,tt,w)}}else if($e==="line-center"){for(const Ce of e.geometry)if(Ce.length>1){const Ke=$y(Ce,le,r.vertical||O,n,24,Y);Ke&&Ze(Ce,Ke,w)}}else if(e.type==="Polygon")for(const Ce of rd(e.geometry,0)){const Ke=Hy(Ce,16);Ze(Ce[0],new To(Ke.x,Ke.y,0,0,void 0),w)}else if(e.type==="LineString")for(const Ce of e.geometry)Ze(Ce,new To(Ce[0].x,Ce[0].y,0,0,void 0),w);else if(e.type==="Point")for(const Ce of e.geometry)for(const Ke of Ce)Ze([Ke],new To(Ke.x,Ke.y,0,0,void 0),w)}const Jo=32640;function em(t,e,r,n,a,l,h,p,m,y,v,w,T,C,P,B,O){const Z=function(se,ae,le,Te,be,$e,Oe,we){const Ve=[];if(ae.positionedLines.length===0)return Ve;const Ze=Te.layout.get("text-rotate").evaluate($e,{})*Math.PI/180,Ce=function(Bt){const Rt=Bt[0],Be=Bt[1],$t=Rt*Be;return $t>0?[Rt,-Be]:$t<0?[-Rt,Be]:Rt===0?[Be,Rt]:[Be,-Rt]}(le);let Ke=Math.abs(ae.top-ae.bottom);for(const Bt of ae.positionedLines)Ke-=Bt.lineOffset;const tt=ae.positionedLines.length,Dt=Ke/tt;let oi=ae.top-le[1];for(let Bt=0;Bt<tt;++Bt){const Rt=ae.positionedLines[Bt];oi=qy(ae,Dt,oi,Bt);for(const Be of Rt.positionedGlyphs){if(!Be.rect)continue;const $t=Be.rect||{};let Ot=4,Pi=!0,Ei=1,qi=0;if(Be.imageName){const gi=Oe[Be.imageName];if(!gi)continue;if(gi.sdf){jt("SDF images are not supported in formatted text and will be ignored.");continue}Pi=!1,Ei=gi.pixelRatio,Ot=1/Ei}const lr=(be||we)&&Be.vertical,Zt=Be.metrics.advance*Be.scale/2,kt=Be.metrics,_i=Be.rect;if(_i===null)continue;we&&ae.verticalizable&&(qi=Be.imageName?Zt-Be.metrics.width*Be.scale/2:0);const ki=be?[Be.x+Zt,Be.y]:[0,0];let Ii=[0,0],Fi=[0,0],nr=!1;be||(lr?(Fi=[Be.x+Zt+Ce[0],Be.y+Ce[1]-qi],nr=!0):Ii=[Be.x+Zt+le[0],Be.y+le[1]-qi]);const Ar=_i.w*Be.scale/(Ei*(Be.localGlyph?2:1)),Cr=_i.h*Be.scale/(Ei*(Be.localGlyph?2:1));let fi,Wi,gn,er;if(lr){const gi=Be.y-oi,cr=new _e(-Zt,Zt-gi),Oi=-Math.PI/2,ur=new _e(...Fi);fi=new _e(-Zt+Ii[0],Ii[1]),fi._rotateAround(Oi,cr)._add(ur),fi.x+=-gi+Zt,fi.y-=(kt.left-Ot)*Be.scale;const _r=Be.imageName?kt.advance*Be.scale:rr*Be.scale,gr=String.fromCharCode(Be.glyph);My(gr)?fi.x+=(1-Ot)*Be.scale:Ay(gr)?fi.x+=_r-kt.height*Be.scale+(-Ot-1)*Be.scale:fi.x+=Be.imageName||kt.width+2*Ot===_i.w&&kt.height+2*Ot===_i.h?(_r-Cr)/2:(_r-(kt.height+2*Ot)*Be.scale)/2,Wi=new _e(fi.x,fi.y-Ar),gn=new _e(fi.x+Cr,fi.y),er=new _e(fi.x+Cr,fi.y-Ar)}else{const gi=(kt.left-Ot)*Be.scale-Zt+Ii[0],cr=(-kt.top-Ot)*Be.scale+Ii[1],Oi=gi+Ar,ur=cr+Cr;fi=new _e(gi,cr),Wi=new _e(Oi,cr),gn=new _e(gi,ur),er=new _e(Oi,ur)}if(Ze){let gi;gi=be?new _e(0,0):nr?new _e(Ce[0],Ce[1]):new _e(le[0],le[1]),fi._rotateAround(Ze,gi),Wi._rotateAround(Ze,gi),gn._rotateAround(Ze,gi),er._rotateAround(Ze,gi)}const ei=new _e(0,0),Xi=new _e(0,0);Ve.push({tl:fi,tr:Wi,bl:gn,br:er,tex:$t,writingMode:ae.writingMode,glyphOffset:ki,sectionIndex:Be.sectionIndex,isSDF:Pi,pixelOffsetTL:ei,pixelOffsetBR:Xi,minFontScaleX:0,minFontScaleY:0})}}return Ve}(0,n,m,l,h,p,a,t.allowVerticalPlacement),Y=t.textSizeData;let ie=null;Y.kind==="source"?(ie=[Jn*l.layout.get("text-size").evaluate(p,{},O)],ie[0]>Jo&&jt(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Y.kind==="composite"&&(ie=[Jn*P.compositeTextSizes[0].evaluate(p,{},O),Jn*P.compositeTextSizes[1].evaluate(p,{},O)],(ie[0]>Jo||ie[1]>Jo)&&jt(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,Z,ie,m,h,p,v,e,r,y.lineStartIndex,y.lineLength,C,B,O);for(const se of w)T[se]=t.text.placedSymbolArray.length-1;return 4*Z.length}function tm(t){for(const e in t)return t[e];return null}function Bu(t,e,r,n,a,l,h,p,m,y){let v=h.top,w=h.bottom,T=h.left,C=h.right;const P=h.collisionPadding;if(P&&(T-=P[0],v-=P[1],C+=P[2],w+=P[3]),m){const B=new _e(T,v),O=new _e(C,v),Z=new _e(T,w),Y=new _e(C,w),ie=re(m);let se=new _e(0,0);y&&(se=new _e(y[0],y[1])),B._rotateAround(ie,se),O._rotateAround(ie,se),Z._rotateAround(ie,se),Y._rotateAround(ie,se),T=Math.min(B.x,O.x,Z.x,Y.x),C=Math.max(B.x,O.x,Z.x,Y.x),v=Math.min(B.y,O.y,Z.y,Y.y),w=Math.max(B.y,O.y,Z.y,Y.y)}return t.emplaceBack(e.x,e.y,e.z,r.x,r.y,T,v,C,w,p,n,a,l),t.length-1}function gd(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function ex(t,e,r,n){const a=t.compareText;if(e in a){const l=a[e];for(let h=l.length-1;h>=0;h--)if(n.dist(l[h])<r)return!0}else a[e]=[];return a[e].push(n),!1}const tx=Zs.VectorTileFeature.types,ix=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ru(t,e,r,n,a,l,h,p,m,y,v,w,T,C,P,B){const O=v?Math.min(Jo,Math.round(v[0])):0,Z=v?Math.min(Jo,Math.round(v[1])):0;t.emplaceBack(e,r,Math.round(32*h),Math.round(32*p),m,y,(O<<1)+(w?1:0),Z,16*T,16*C,256*P,256*B,n,a,l,0)}function yd(t,e,r){t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r)}function rx(t){for(const e of t.sections)if(je(e.text))return!0;return!1}class xd{constructor(e){this.layoutVertexArray=new kh,this.indexArray=new Jr,this.programConfigurations=e,this.segments=new Ci,this.dynamicLayoutVertexArray=new ja,this.opacityVertexArray=new Dh,this.placedSymbolArray=new Op}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,n,a){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vy.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,by.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ix,!0),this.opacityVertexBuffer.itemSize=1),(n||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ye("SymbolBuffers",xd);class vd{constructor(e,r,n){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new n,this.segments=new Ci,this.collisionVertexArray=new Rh,this.collisionVertexArrayExt=new ja}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,wy.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Ty.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ye("CollisionBuffers",vd);class Qo{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(h=>h.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=yt([]),this.placementViewportMatrix=yt([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ad(this.zoom,r["text-size"]),this.iconSizeData=ad(this.zoom,r["icon-size"]);const n=this.layers[0].layout,a=n.get("symbol-sort-key"),l=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=l!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(l==="viewport-y"||l==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(h=>en[h]),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.sourceID=e.sourceID}createArrays(){this.text=new xd(new js(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new xd(new js(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Np,this.lineVertexArray=new jp,this.symbolInstances=new Vp}calculateGlyphDependencies(e,r,n,a,l){for(let h=0;h<e.length;h++)if(r[e.charCodeAt(h)]=!0,a&&l){const p=nc[e.charAt(h)];p&&(r[p.charCodeAt(0)]=!0)}}populate(e,r,n,a){const l=this.layers[0],h=l.layout,p=h.get("text-font"),m=h.get("text-field"),y=h.get("icon-image"),v=(m.value.kind!=="constant"||m.value.value instanceof gt&&!m.value.value.isEmpty()||m.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),w=y.value.kind!=="constant"||!!y.value.value||Object.keys(y.parameters).length>0,T=h.get("symbol-sort-key");if(this.features=[],!v&&!w)return;const C=r.iconDependencies,P=r.glyphDependencies,B=r.availableImages,O=new _t(this.zoom);for(const{feature:Z,id:Y,index:ie,sourceLayerIndex:se}of e){const ae=l._featureFilter.needGeometry,le=$s(Z,ae);if(!l._featureFilter.filter(O,le,n))continue;let Te,be;if(ae||(le.geometry=bo(Z,n,a)),v){const Oe=l.getValueAndResolveTokens("text-field",le,n,B),we=gt.factory(Oe);rx(we)&&(this.hasRTLText=!0),(!this.hasRTLText||Fr()==="unavailable"||this.hasRTLText&&Lt.isParsed())&&(Te=Iy(we,l,le))}if(w){const Oe=l.getValueAndResolveTokens("icon-image",le,n,B);be=Oe instanceof Lr?Oe:Lr.fromString(Oe)}if(!Te&&!be)continue;const $e=this.sortFeaturesByKey?T.evaluate(le,{},n):void 0;if(this.features.push({id:Y,text:Te,icon:be,index:ie,sourceLayerIndex:se,geometry:le.geometry,properties:Z.properties,type:tx[Z.type],sortKey:$e}),be&&(C[be.name]=!0),Te){const Oe=p.evaluate(le,{},n).join(","),we=h.get("text-rotation-alignment")==="map"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(en.vertical)>=0;for(const Ve of Te.sections)if(Ve.image)C[Ve.image.name]=!0;else{const Ze=ve(Te.toString()),Ce=Ve.fontStack||Oe,Ke=P[Ce]=P[Ce]||{};this.calculateGlyphDependencies(Ve.text,Ke,we,this.allowVerticalPlacement,Ze)}}}h.get("symbol-placement")==="line"&&(this.features=function(Z){const Y={},ie={},se=[];let ae=0;function le(Oe){se.push(Z[Oe]),ae++}function Te(Oe,we,Ve){const Ze=ie[Oe];return delete ie[Oe],ie[we]=Ze,se[Ze].geometry[0].pop(),se[Ze].geometry[0]=se[Ze].geometry[0].concat(Ve[0]),Ze}function be(Oe,we,Ve){const Ze=Y[we];return delete Y[we],Y[Oe]=Ze,se[Ze].geometry[0].shift(),se[Ze].geometry[0]=Ve[0].concat(se[Ze].geometry[0]),Ze}function $e(Oe,we,Ve){const Ze=Ve?we[0][we[0].length-1]:we[0][0];return`${Oe}:${Ze.x}:${Ze.y}`}for(let Oe=0;Oe<Z.length;Oe++){const we=Z[Oe],Ve=we.geometry,Ze=we.text?we.text.toString():null;if(!Ze){le(Oe);continue}const Ce=$e(Ze,Ve),Ke=$e(Ze,Ve,!0);if(Ce in ie&&Ke in Y&&ie[Ce]!==Y[Ke]){const tt=be(Ce,Ke,Ve),Dt=Te(Ce,Ke,se[tt].geometry);delete Y[Ce],delete ie[Ke],ie[$e(Ze,se[Dt].geometry,!0)]=Dt,se[tt].geometry=null}else Ce in ie?Te(Ce,Ke,Ve):Ke in Y?be(Ce,Ke,Ve):(le(Oe),Y[Ce]=ae-1,ie[Ke]=ae-1)}return se.filter(Oe=>Oe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Z,Y)=>Z.sortKey-Y.sortKey)}update(e,r,n,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,n,a),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,n,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const n=this.lineVertexArray.length;if(e.segment!==void 0){let a=e.dist(r[e.segment+1]),l=e.dist(r[e.segment]);const h={};for(let p=e.segment+1;p<r.length;p++)h[p]={x:r[p].x,y:r[p].y,tileUnitDistanceFromAnchor:a},p<r.length-1&&(a+=r[p+1].dist(r[p]));for(let p=e.segment||0;p>=0;p--)h[p]={x:r[p].x,y:r[p].y,tileUnitDistanceFromAnchor:l},p>0&&(l+=r[p-1].dist(r[p]));for(let p=0;p<r.length;p++){const m=h[p];this.lineVertexArray.emplaceBack(m.x,m.y,m.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,r,n,a,l,h,p,m,y,v,w,T,C,P){const B=e.indexArray,O=e.layoutVertexArray,Z=e.segments.prepareSegment(4*r.length,O,B,this.canOverlap?h.sortKey:void 0),Y=this.glyphOffsetArray.length,ie=Z.vertexLength,se=this.allowVerticalPlacement&&p===en.vertical?Math.PI/2:0,ae=h.text&&h.text.sections;for(let le=0;le<r.length;le++){const{tl:Te,tr:be,bl:$e,br:Oe,tex:we,pixelOffsetTL:Ve,pixelOffsetBR:Ze,minFontScaleX:Ce,minFontScaleY:Ke,glyphOffset:tt,isSDF:Dt,sectionIndex:oi}=r[le],Bt=Z.vertexLength,Rt=tt[1];Ru(O,m.x,m.y,m.z,y.x,y.y,Te.x,Rt+Te.y,we.x,we.y,n,Dt,Ve.x,Ve.y,Ce,Ke),Ru(O,m.x,m.y,m.z,y.x,y.y,be.x,Rt+be.y,we.x+we.w,we.y,n,Dt,Ze.x,Ve.y,Ce,Ke),Ru(O,m.x,m.y,m.z,y.x,y.y,$e.x,Rt+$e.y,we.x,we.y+we.h,n,Dt,Ve.x,Ze.y,Ce,Ke),Ru(O,m.x,m.y,m.z,y.x,y.y,Oe.x,Rt+Oe.y,we.x+we.w,we.y+we.h,n,Dt,Ze.x,Ze.y,Ce,Ke),yd(e.dynamicLayoutVertexArray,m,se),B.emplaceBack(Bt,Bt+1,Bt+2),B.emplaceBack(Bt+1,Bt+2,Bt+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(tt[0]),le!==r.length-1&&oi===r[le+1].sectionIndex||e.programConfigurations.populatePaintArrays(O.length,h,h.index,{},C,P,ae&&ae[oi])}e.placedSymbolArray.emplaceBack(m.x,m.y,m.z,y.x,y.y,Y,this.glyphOffsetArray.length-Y,ie,v,w,y.segment,n?n[0]:0,n?n[1]:0,a[0],a[1],p,0,!1,0,T,0)}_commitLayoutVertex(e,r,n,a,l,h,p){e.emplaceBack(r,n,a,l,h,Math.round(p.x),Math.round(p.y))}_addCollisionDebugVertices(e,r,n,a,l,h,p){const m=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),y=m.vertexLength,v=p.tileAnchorX,w=p.tileAnchorY;for(let C=0;C<4;C++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,a,l,h,v,w,new _e(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,l,h,v,w,new _e(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,l,h,v,w,new _e(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,a,l,h,v,w,new _e(e.x1,e.y2)),m.vertexLength+=4;const T=n.indexArray;T.emplaceBack(y,y+1),T.emplaceBack(y+1,y+2),T.emplaceBack(y+2,y+3),T.emplaceBack(y+3,y),m.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,n,a,l,h){for(let p=a;p<l;p++){const m=n.get(p),y=this.getSymbolInstanceTextSize(e,h,r,p);this._addCollisionDebugVertices(m,y,this.textCollisionBox,m.projectedAnchorX,m.projectedAnchorY,m.projectedAnchorZ,h)}}_addIconDebugCollisionBoxes(e,r,n,a,l,h){for(let p=a;p<l;p++){const m=n.get(p),y=this.getSymbolInstanceIconSize(e,r,p);this._addCollisionDebugVertices(m,y,this.iconCollisionBox,m.projectedAnchorX,m.projectedAnchorY,m.projectedAnchorZ,h)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vd(hu,Cf.members,Xo),this.iconCollisionBox=new vd(hu,Cf.members,Xo);const n=Ka(this.iconSizeData,e),a=Ka(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this._addTextDebugCollisionBoxes(a,e,r,h.textBoxStartIndex,h.textBoxEndIndex,h),this._addTextDebugCollisionBoxes(a,e,r,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._addIconDebugCollisionBoxes(n,e,r,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._addIconDebugCollisionBoxes(n,e,r,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}}getSymbolInstanceTextSize(e,r,n,a){const l=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:a),h=Cu(this.textSizeData,e,l)/rr;return this.tilePixelRatio*h}getSymbolInstanceIconSize(e,r,n){const a=this.icon.placedSymbolArray.get(n),l=Cu(this.iconSizeData,e,a);return this.tilePixelRatio*l}_commitDebugCollisionVertexUpdate(e,r,n){e.emplaceBack(r,-n,-n),e.emplaceBack(r,n,-n),e.emplaceBack(r,n,n),e.emplaceBack(r,-n,n)}_updateTextDebugCollisionBoxes(e,r,n,a,l,h){for(let p=a;p<l;p++){const m=n.get(p),y=this.getSymbolInstanceTextSize(e,h,r,p);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,y,m.padding)}}_updateIconDebugCollisionBoxes(e,r,n,a,l){for(let h=a;h<l;h++){const p=n.get(h),m=this.getSymbolInstanceIconSize(e,r,h);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,m,p.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=Ka(this.iconSizeData,e),a=Ka(this.textSizeData,e);for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this._updateTextDebugCollisionBoxes(a,e,r,h.textBoxStartIndex,h.textBoxEndIndex,h),this._updateTextDebugCollisionBoxes(a,e,r,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._updateIconDebugCollisionBoxes(n,e,r,h.iconBoxStartIndex,h.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(n,e,r,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,n,a,l,h,p,m,y){const v={};for(let w=r;w<n;w++){const T=e.get(w);v.textBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,padding:T.padding,projectedAnchorX:T.projectedAnchorX,projectedAnchorY:T.projectedAnchorY,projectedAnchorZ:T.projectedAnchorZ,tileAnchorX:T.tileAnchorX,tileAnchorY:T.tileAnchorY},v.textFeatureIndex=T.featureIndex;break}for(let w=a;w<l;w++){const T=e.get(w);v.verticalTextBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,padding:T.padding,projectedAnchorX:T.projectedAnchorX,projectedAnchorY:T.projectedAnchorY,projectedAnchorZ:T.projectedAnchorZ,tileAnchorX:T.tileAnchorX,tileAnchorY:T.tileAnchorY},v.verticalTextFeatureIndex=T.featureIndex;break}for(let w=h;w<p;w++){const T=e.get(w);v.iconBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,padding:T.padding,projectedAnchorX:T.projectedAnchorX,projectedAnchorY:T.projectedAnchorY,projectedAnchorZ:T.projectedAnchorZ,tileAnchorX:T.tileAnchorX,tileAnchorY:T.tileAnchorY},v.iconFeatureIndex=T.featureIndex;break}for(let w=m;w<y;w++){const T=e.get(w);v.verticalIconBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,padding:T.padding,projectedAnchorX:T.projectedAnchorX,projectedAnchorY:T.projectedAnchorY,projectedAnchorZ:T.projectedAnchorZ,tileAnchorX:T.tileAnchorX,tileAnchorY:T.tileAnchorY},v.verticalIconFeatureIndex=T.featureIndex;break}return v}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const n=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const n=e.placedSymbolArray.get(r),a=n.vertexStartIndex+4*n.numGlyphs;for(let l=n.vertexStartIndex;l<a;l+=4)e.indexArray.emplaceBack(l,l+1,l+2),e.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),n=Math.cos(e),a=[],l=[],h=[];for(let p=0;p<this.symbolInstances.length;++p){h.push(p);const m=this.symbolInstances.get(p);a.push(0|Math.round(r*m.tileAnchorX+n*m.tileAnchorY)),l.push(m.featureIndex)}return h.sort((p,m)=>a[p]-a[m]||l[m]-l[p]),h}addToSortKeyRanges(e,r){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===r?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const n=this.symbolInstances.get(r);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((a,l,h)=>{a>=0&&h.indexOf(a)===l&&this.addIndicesForPlacedSymbol(this.text,a)}),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ye("SymbolBucket",Qo,{omit:["layers","collisionBoxArray","features","compareText"]}),Qo.MAX_GLYPHS=65535,Qo.addDynamicAttributes=yd;const nx=new Qi({"symbol-placement":new et(xe.layout_symbol["symbol-placement"]),"symbol-spacing":new et(xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new et(xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new st(xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new et(xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new et(xe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new et(xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new et(xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new et(xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new st(xe.layout_symbol["icon-size"]),"icon-text-fit":new et(xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new et(xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new st(xe.layout_symbol["icon-image"]),"icon-rotate":new st(xe.layout_symbol["icon-rotate"]),"icon-padding":new et(xe.layout_symbol["icon-padding"]),"icon-keep-upright":new et(xe.layout_symbol["icon-keep-upright"]),"icon-offset":new st(xe.layout_symbol["icon-offset"]),"icon-anchor":new st(xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new et(xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new et(xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new et(xe.layout_symbol["text-rotation-alignment"]),"text-field":new st(xe.layout_symbol["text-field"]),"text-font":new st(xe.layout_symbol["text-font"]),"text-size":new st(xe.layout_symbol["text-size"]),"text-max-width":new st(xe.layout_symbol["text-max-width"]),"text-line-height":new st(xe.layout_symbol["text-line-height"]),"text-letter-spacing":new st(xe.layout_symbol["text-letter-spacing"]),"text-justify":new st(xe.layout_symbol["text-justify"]),"text-radial-offset":new st(xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new et(xe.layout_symbol["text-variable-anchor"]),"text-anchor":new st(xe.layout_symbol["text-anchor"]),"text-max-angle":new et(xe.layout_symbol["text-max-angle"]),"text-writing-mode":new et(xe.layout_symbol["text-writing-mode"]),"text-rotate":new st(xe.layout_symbol["text-rotate"]),"text-padding":new et(xe.layout_symbol["text-padding"]),"text-keep-upright":new et(xe.layout_symbol["text-keep-upright"]),"text-transform":new st(xe.layout_symbol["text-transform"]),"text-offset":new st(xe.layout_symbol["text-offset"]),"text-allow-overlap":new et(xe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new et(xe.layout_symbol["text-ignore-placement"]),"text-optional":new et(xe.layout_symbol["text-optional"])});var bd={paint:new Qi({"icon-opacity":new st(xe.paint_symbol["icon-opacity"]),"icon-color":new st(xe.paint_symbol["icon-color"]),"icon-halo-color":new st(xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new st(xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new st(xe.paint_symbol["icon-halo-blur"]),"icon-translate":new et(xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new et(xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new st(xe.paint_symbol["text-opacity"]),"text-color":new st(xe.paint_symbol["text-color"],{runtimeType:dn,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new st(xe.paint_symbol["text-halo-color"]),"text-halo-width":new st(xe.paint_symbol["text-halo-width"]),"text-halo-blur":new st(xe.paint_symbol["text-halo-blur"]),"text-translate":new et(xe.paint_symbol["text-translate"]),"text-translate-anchor":new et(xe.paint_symbol["text-translate-anchor"])}),layout:nx};class im{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:jn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ye("FormatSectionOverride",im,{omit:["defaultValue"]});class Fu extends Cn{constructor(e){super(e,bd)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const a=[];for(const l of n)a.indexOf(l)<0&&a.push(l);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,n,a){const l=this.layout.get(e).evaluate(r,{},n,a),h=this._unevaluatedLayout._values[e];return h.isDataDriven()||Uo(h.value)||!l?l:function(p,m){return m.replace(/{([^{}]+)}/g,(y,v)=>v in p?String(p[v]):"")}(r.properties,l)}createBucket(e){return new Qo(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of bd.paint.overridableProperties){if(!Fu.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),n=new im(r),a=new Ll(n,r.property.specification);let l=null;l=r.value.kind==="constant"||r.value.kind==="source"?new Ls("source",a):new Bl("composite",a,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new mr(r.property,l,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,n){return!(!this.layout||r.isDataDriven()||n.isDataDriven())&&Fu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const n=e.get("text-field"),a=bd.paint.properties[r];let l=!1;const h=p=>{for(const m of p)if(a.overrides&&a.overrides.hasOverride(m))return void(l=!0)};if(n.value.kind==="constant"&&n.value.value instanceof gt)h(n.value.value.sections);else if(n.value.kind==="source"){const p=y=>{l||(y instanceof $n&&Mi(y.value)===Gn?h(y.value.sections):y instanceof pn?h(y.sections):y.eachChild(p))},m=n.value;m._styleExpression&&p(m._styleExpression.expression)}return l}getProgramConfiguration(e){return new xo(this,e)}}var ox={paint:new Qi({"background-color":new et(xe.paint_background["background-color"]),"background-pattern":new _o(xe.paint_background["background-pattern"]),"background-opacity":new et(xe.paint_background["background-opacity"])})},sx={paint:new Qi({"raster-opacity":new et(xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new et(xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new et(xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new et(xe.paint_raster["raster-brightness-max"]),"raster-saturation":new et(xe.paint_raster["raster-saturation"]),"raster-contrast":new et(xe.paint_raster["raster-contrast"]),"raster-resampling":new et(xe.paint_raster["raster-resampling"]),"raster-fade-duration":new et(xe.paint_raster["raster-fade-duration"])})};class ax extends Cn{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var lx={paint:new Qi({"sky-type":new et(xe.paint_sky["sky-type"]),"sky-atmosphere-sun":new et(xe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new et(xe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new et(xe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new et(xe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Kn(xe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new et(xe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new et(xe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new et(xe.paint_sky["sky-opacity"])})};function wd(t,e,r){const n=wi(0,0,1),a=co(sn());return function(l,h,p){p*=.5;var m=h[0],y=h[1],v=h[2],w=h[3],T=Math.sin(p),C=Math.cos(p);l[0]=m*C-v*T,l[1]=y*C+w*T,l[2]=v*C+m*T,l[3]=w*C-y*T}(a,a,r?-re(t)+Math.PI:re(t)),$r(a,a,-re(e)),Gr(n,n,a),Ht(n,n)}const cx={circle:class extends Cn{constructor(t){super(t,kg)}createBucket(t){return new Wh(t)}queryRadius(t){const e=t;return Wa("circle-radius",this,e)+Wa("circle-stroke-width",this,e)+bu(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,r,n,a,l,h,p){const m=uf(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),y=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return hf(t,n,l,h,p,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",m,y)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new xo(this,t)}},heatmap:class extends Cn{createBucket(t){return new pf(t)}constructor(t){super(t,Rg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Qh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Wa("heatmap-radius",this,t)}queryIntersectsFeature(t,e,r,n,a,l,h,p){const m=this.paint.get("heatmap-radius").evaluate(e,r);return hf(t,n,l,h,p,!0,!0,new _e(0,0),m)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new xo(this,t)}},hillshade:class extends Cn{constructor(t){super(t,Fg)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(t){return new xo(this,t)}},fill:class extends Cn{constructor(t){super(t,ey)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(t){return new xo(this,t)}recalculate(t,e){super.recalculate(t,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Mu(t)}queryRadius(){return bu(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,r,n,a,l){return!t.queryGeometry.isAboveHorizon&&of(cf(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends Cn{constructor(t){super(t,hy)}createBucket(t){return new sd(t)}queryRadius(){return bu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new xo(this,t)}queryIntersectsFeature(t,e,r,n,a,l,h,p,m){const y=uf(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),v=this.paint.get("fill-extrusion-height").evaluate(e,r),w=this.paint.get("fill-extrusion-base").evaluate(e,r),T=[0,0],C=p&&l.elevation,P=l.elevation?l.elevation.exaggeration():1;if(C){const Z=t.tile.getBucket(this).centroidVertexArray,Y=m+1;if(Y<Z.length){const ie=Z.get(Y);T[0]=ie.a_centroid_pos0,T[1]=ie.a_centroid_pos1}}if(T[0]===0&&T[1]===1)return!1;const B=function(Z,Y,ie,se,ae,le,Te,be,$e){return le?function(Oe,we,Ve,Ze,Ce,Ke,tt,Dt,oi){const Bt=[],Rt=[],Be=[0,0,0,1];for(const $t of Oe){const Ot=[],Pi=[];for(const Ei of $t){const qi=Ei.x+Ze.x,lr=Ei.y+Ze.y,Zt=dy(qi,lr,we,Ve,Ke,tt,Dt,oi);Be[0]=qi,Be[1]=lr,Be[2]=Zt.base,Be[3]=1,Bi(Be,Be,Ce),Be[3]=Math.max(Be[3],1e-5);const kt=Sf([Be[0]/Be[3],Be[1]/Be[3],Be[2]/Be[3]]);Be[0]=qi,Be[1]=lr,Be[2]=Zt.top,Be[3]=1,Bi(Be,Be,Ce),Be[3]=Math.max(Be[3],1e-5);const _i=Sf([Be[0]/Be[3],Be[1]/Be[3],Be[2]/Be[3]]);Ot.push(kt),Pi.push(_i)}Bt.push(Ot),Rt.push(Pi)}return[Bt,Rt]}(Z,Y,ie,se,ae,le,Te,be,$e):function(Oe,we,Ve,Ze,Ce){const Ke=[],tt=[],Dt=Ce[8]*we,oi=Ce[9]*we,Bt=Ce[10]*we,Rt=Ce[11]*we,Be=Ce[8]*Ve,$t=Ce[9]*Ve,Ot=Ce[10]*Ve,Pi=Ce[11]*Ve;for(const Ei of Oe){const qi=[],lr=[];for(const Zt of Ei){const kt=Zt.x+Ze.x,_i=Zt.y+Ze.y,ki=Ce[0]*kt+Ce[4]*_i+Ce[12],Ii=Ce[1]*kt+Ce[5]*_i+Ce[13],Fi=Ce[2]*kt+Ce[6]*_i+Ce[14],nr=Ce[3]*kt+Ce[7]*_i+Ce[15],Ar=ki+Dt,Cr=Ii+oi,fi=Fi+Bt,Wi=Math.max(nr+Rt,1e-5),gn=ki+Be,er=Ii+$t,ei=Fi+Ot,Xi=Math.max(nr+Pi,1e-5),gi=new _e(Ar/Wi,Cr/Wi);gi.z=fi/Wi,qi.push(gi);const cr=new _e(gn/Xi,er/Xi);cr.z=ei/Xi,lr.push(cr)}Ke.push(qi),tt.push(lr)}return[Ke,tt]}(Z,Y,ie,se,ae)}(n,w,v,y,h,C?p:null,T,P,l.center.lat),O=t.queryGeometry;return function(Z,Y,ie){let se=1/0;of(ie,Y)&&(se=Ef(ie,Y[0]));for(let ae=0;ae<Y.length;ae++){const le=Y[ae],Te=Z[ae];for(let be=0;be<le.length-1;be++){const $e=le[be],Oe=[$e,le[be+1],Te[be+1],Te[be],$e];nf(ie,Oe)&&(se=Math.min(se,Ef(ie,Oe)))}}return se!==1/0&&se}(B[0],B[1],O.isPointQuery()?O.screenBounds:O.screenGeometry)}},line:class extends Cn{constructor(t){super(t,If),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ss,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Mf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Au(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new xo(this,t)}queryRadius(t){const e=t,r=Af(Wa("line-width",this,e),Wa("line-gap-width",this,e)),n=Wa("line-offset",this,e);return r/2+Math.abs(n)+bu(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,r,n,a,l){if(t.queryGeometry.isAboveHorizon)return!1;const h=cf(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),l.angle,t.pixelToTileUnitsFactor),p=t.pixelToTileUnitsFactor/2*Af(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),m=this.paint.get("line-offset").evaluate(e,r);return m&&(n=function(y,v){const w=[],T=new _e(0,0);for(let C=0;C<y.length;C++){const P=y[C],B=[];for(let O=0;O<P.length;O++){const Z=P[O-1],Y=P[O],ie=P[O+1],se=O===0?T:Y.sub(Z)._unit()._perp(),ae=O===P.length-1?T:ie.sub(Y)._unit()._perp(),le=se._add(ae)._unit();le._mult(1/(le.x*ae.x+le.y*ae.y)),B.push(le._mult(v)._add(Y))}w.push(B)}return w}(n,m*t.pixelToTileUnitsFactor)),function(y,v,w){for(let T=0;T<v.length;T++){const C=v[T];if(y.length>=3){for(let P=0;P<C.length;P++)if(qa(y,C[P]))return!0}if(Ag(y,C,w))return!0}return!1}(h,n,p)}isTileClipped(){return!0}},symbol:Fu,background:class extends Cn{constructor(t){super(t,ox)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Cn{constructor(t){super(t,sx)}getProgramIds(){return["raster"]}},sky:class extends Cn{constructor(t){super(t,lx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Qh({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(t,e){const r=this.paint.get("sky-type");if(r==="atmosphere"){const n=this.paint.get("sky-atmosphere-sun"),a=!n,l=t.style.light,h=l.properties.get("position");return a&&l.properties.get("anchor")==="viewport"&&jt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?wd(h.azimuthal,90-h.polar,e):wd(n[0],90-n[1],e)}if(r==="gradient"){const n=this.paint.get("sky-gradient-center");return wd(n[0],90-n[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}},{HTMLImageElement:rm,HTMLCanvasElement:nm,HTMLVideoElement:om,ImageData:sm,ImageBitmap:Ou}=fe;class Uu{constructor(e,r,n,a){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(r,a)}update(e,r,n){const{width:a,height:l}=e,{context:h}=this,{gl:p}=h;if(p.bindTexture(p.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA&&(!r||r.premultiply!==!1)),n||this.size&&this.size[0]===a&&this.size[1]===l){const{x:m,y}=n||{x:0,y:0};e instanceof rm||e instanceof nm||e instanceof om||e instanceof sm||Ou&&e instanceof Ou?p.texSubImage2D(p.TEXTURE_2D,0,m,y,p.RGBA,p.UNSIGNED_BYTE,e):p.texSubImage2D(p.TEXTURE_2D,0,m,y,a,l,p.RGBA,p.UNSIGNED_BYTE,e.data)}else this.size=[a,l],e instanceof rm||e instanceof nm||e instanceof om||e instanceof sm||Ou&&e instanceof Ou?p.texImage2D(p.TEXTURE_2D,0,this.format,this.format,p.UNSIGNED_BYTE,e):p.texImage2D(p.TEXTURE_2D,0,this.format,a,l,0,this.format,p.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(e,r){const{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.filter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,r),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Td{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Ko({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const n=this.getKey(e,r);return this.positions[n]}trim(){const e=this.width,r=this.height=Mt(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,n){const a=[];let l=e.length%2==1?-e[e.length-1]*n:0,h=e[0]*n,p=!0;a.push({left:l,right:h,isDash:p,zeroLength:e[0]===0});let m=e[0];for(let y=1;y<e.length;y++){p=!p;const v=e[y];l=m*n,m+=v,h=m*n,a.push({left:l,right:h,isDash:p,zeroLength:v===0})}return a}addRoundDash(e,r,n){const a=r/2;for(let l=-n;l<=n;l++){const h=this.width*(this.nextRow+n+l);let p=0,m=e[p];for(let y=0;y<this.width;y++){y/m.right>1&&(m=e[++p]);const v=Math.abs(y-m.left),w=Math.abs(y-m.right),T=Math.min(v,w);let C;const P=l/n*(a+1);if(m.isDash){const B=a-Math.abs(P);C=Math.sqrt(T*T+B*B)}else C=a-Math.sqrt(T*T+P*P);this.image.data[h+y]=Math.max(0,Math.min(255,C+128))}}}addRegularDash(e,r){for(let m=e.length-1;m>=0;--m){const y=e[m],v=e[m+1];y.zeroLength?e.splice(m,1):v&&v.isDash===y.isDash&&(v.left=y.left,e.splice(m,1))}const n=e[0],a=e[e.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const l=this.width*this.nextRow;let h=0,p=e[h];for(let m=0;m<this.width;m++){m/p.right>1&&(p=e[++h]);const y=Math.abs(m-p.left),v=Math.abs(m-p.right),w=Math.min(y,v);this.image.data[l+m]=Math.max(0,Math.min(255,(p.isDash?w:-w)+r+128))}}addDash(e,r){const n=this.getKey(e,r);if(this.positions[n])return this.positions[n];const a=r==="round",l=a?7:0,h=2*l+1;if(this.nextRow+h>this.height)return jt("LineAtlas out of space"),null;e.length===0&&e.push(1);let p=0;for(let v=0;v<e.length;v++)e[v]<0&&(jt("Negative value is found in line dasharray, replacing values with 0"),e[v]=0),p+=e[v];if(p!==0){const v=this.width/p,w=this.getDashRanges(e,this.width,v);a?this.addRoundDash(w,v,l):this.addRegularDash(w,r==="square"?.5*v:0)}const m=this.nextRow+l;this.nextRow+=h;const y={tl:[m,l],br:[p,0]};return this.positions[n]=y,y}}Ye("LineAtlas",Td);class ux{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const hx=fe.performance;function am(t){const e=t?t.url.toString():void 0;return hx.getEntriesByName(e)}class dx{constructor(){this.tasks={},this.taskQueue=[],Ni(["process"],this),this.invoker=new ux(this.process),this.nextId=0}add(e,r){const n=this.nextId++,a=function({type:l,isSymbolTile:h,zoom:p}){return p=p||0,l==="message"?0:l!=="maybePrepare"||h?l!=="parseTile"||h?l==="parseTile"&&h?300-p:l==="maybePrepare"&&h?400-p:500:200-p:100-p}(r);if(a===0){an();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:e,metadata:r,priority:a,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){an();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let a=0;a<this.taskQueue.length;a++){const l=this.tasks[this.taskQueue[a]];l.priority<r&&(r=l.priority,e=a)}if(e===null)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}function lm(t,e,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class Vu{constructor(e,r,n){this.z=e,this.x=r,this.y=n,this.key=lc(0,e,e,r,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const n=function(l,h,p){var m=lm(256*l,256*(h=Math.pow(2,p)-h-1),p),y=lm(256*(l+1),256*(h+1),p);return m[0]+","+m[1]+","+y[0]+","+y[1]}(this.x,this.y,this.z),a=function(l,h,p){let m,y="";for(let v=l;v>0;v--)m=1<<v-1,y+=(h&m?1:0)+(p&m?2:0);return y}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ed{constructor(e,r){this.wrap=e,this.canonical=r,this.key=lc(e,r.z,r.z,r.x,r.y)}}class Mr{constructor(e,r,n,a,l){this.overscaledZ=e,this.wrap=r,this.canonical=new Vu(n,+a,+l),this.key=r===0&&e===n?this.canonical.key:lc(r,e,n,a,l)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new Mr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Mr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return lc(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return lc(this.wrap*+r,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Mr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,n=2*this.canonical.x,a=2*this.canonical.y;return[new Mr(r,this.wrap,r,n,a),new Mr(r,this.wrap,r,n+1,a),new Mr(r,this.wrap,r,n,a+1),new Mr(r,this.wrap,r,n+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Mr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Mr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ed(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function lc(t,e,r,n,a){const l=1<<Math.min(r,22);let h=l*(a%l)+n%l;return t&&r<22&&(h+=l*l*((t<0?-2*t-1:2*t)%(1<<2*(22-r)))),16*(32*h+r)+(e-r)}Ye("CanonicalTileID",Vu),Ye("OverscaledTileID",Mr,{omit:["projMatrix"]});class il{constructor(e,r,n){this.func=e,this.mask=r,this.range=n}}il.ReadOnly=!1,il.ReadWrite=!0,il.disabled=new il(519,il.ReadOnly,[0,1]);const Sd=7680;class Id{constructor(e,r,n,a,l,h){this.test=e,this.ref=r,this.mask=n,this.fail=a,this.depthFail=l,this.pass=h}}Id.disabled=new Id({func:519,mask:0},0,0,Sd,Sd,Sd);class Qn{constructor(e,r,n){this.blendFunction=e,this.blendColor=r,this.mask=n}}Qn.Replace=[1,0],Qn.disabled=new Qn(Qn.Replace,Ft.transparent,[!1,!1,!1,!1]),Qn.unblended=new Qn(Qn.Replace,Ft.transparent,[!0,!0,!0,!0]),Qn.alphaBlended=new Qn([1,771],Ft.transparent,[!0,!0,!0,!0]);const Md=1029,Ad=2305;class kn{constructor(e,r,n){this.enable=e,this.mode=r,this.frontFace=n}}kn.disabled=new kn(!1,Md,Ad),kn.backCCW=new kn(!0,Md,Ad),kn.backCW=new kn(!0,Md,2304),kn.frontCW=new kn(!0,1028,2304),kn.frontCCW=new kn(!0,1028,Ad);class cm{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const n=e[r];this._stringToNumber[n]=r,this._numberToString[r]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class um{constructor(e,r,n,a,l){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=n,e._y=a,this.properties=e.properties,this.id=l}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class px{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,n){const a=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][a]=this.stateChanges[e][a]||{},Je(this.stateChanges[e][a],n),this.deletedStates[e]===null){this.deletedStates[e]={};for(const l in this.state[e])l!==a&&(this.deletedStates[e][l]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][a]===null){this.deletedStates[e][a]={};for(const l in this.state[e][a])n[l]||(this.deletedStates[e][a][l]=null)}else for(const l in n)this.deletedStates[e]&&this.deletedStates[e][a]&&this.deletedStates[e][a][l]===null&&delete this.deletedStates[e][a][l]}removeFeatureState(e,r,n){if(this.deletedStates[e]===null)return;const a=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&r!==void 0)this.deletedStates[e][a]!==null&&(this.deletedStates[e][a]=this.deletedStates[e][a]||{},this.deletedStates[e][a][n]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][a])for(n in this.deletedStates[e][a]={},this.stateChanges[e][a])this.deletedStates[e][a][n]=null;else this.deletedStates[e][a]=null;else this.deletedStates[e]=null}getState(e,r){const n=String(r),a=Je({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const l=this.deletedStates[e][r];if(l===null)return{};for(const h in l)delete a[h]}return a}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const n={};for(const a in this.stateChanges){this.state[a]=this.state[a]||{};const l={};for(const h in this.stateChanges[a])this.state[a][h]||(this.state[a][h]={}),Je(this.state[a][h],this.stateChanges[a][h]),l[h]=this.state[a][h];n[a]=l}for(const a in this.deletedStates){this.state[a]=this.state[a]||{};const l={};if(this.deletedStates[a]===null)for(const h in this.state[a])l[h]={},this.state[a][h]={};else for(const h in this.deletedStates[a]){if(this.deletedStates[a][h]===null)this.state[a][h]={};else for(const p of Object.keys(this.deletedStates[a][h]))delete this.state[a][h][p];l[h]=this.state[a][h]}n[a]=n[a]||{},Je(n[a],l)}if(this.stateChanges={},this.deletedStates={},Object.keys(n).length!==0)for(const a in e)e[a].setFeatureState(n,r)}}class hm{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const n=this.toIdx(e,r);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function dm(t,e,r,n){let a=0,l=Number.MAX_VALUE;for(let h=0;h<3;h++)if(Math.abs(n[h])<1e-15){if(r[h]<t[h]||r[h]>e[h])return null}else{const p=1/n[h];let m=(t[h]-r[h])*p,y=(e[h]-r[h])*p;if(m>y){const v=m;m=y,y=v}if(m>a&&(a=m),y<l&&(l=y),a>l)return null}return a}function pm(t,e,r,n,a,l,h,p,m,y,v){const w=n-t,T=a-e,C=l-r,P=h-t,B=p-e,O=m-r,Z=v[1]*O-v[2]*B,Y=v[2]*P-v[0]*O,ie=v[0]*B-v[1]*P,se=w*Z+T*Y+C*ie;if(Math.abs(se)<1e-15)return null;const ae=1/se,le=y[0]-t,Te=y[1]-e,be=y[2]-r,$e=(le*Z+Te*Y+be*ie)*ae;if($e<0||$e>1)return null;const Oe=Te*C-be*T,we=be*w-le*C,Ve=le*T-Te*w,Ze=(v[0]*Oe+v[1]*we+v[2]*Ve)*ae;return Ze<0||$e+Ze>1?null:(P*Oe+B*we+O*Ve)*ae}function fm(t,e,r){return(t-e)/(r-e)}function mm(t,e,r,n,a,l,h,p,m){const y=1<<r,v=l-n,w=h-a,T=(t+1)/y*v+n,C=(e+0)/y*w+a,P=(e+1)/y*w+a;p[0]=(t+0)/y*v+n,p[1]=C,m[0]=T,m[1]=P}class _m{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(l){const h=Math.ceil(Math.log2(l.dim/8)),p=[];let m=Math.ceil(Math.pow(2,h));const y=1/m,v=(C,P,B,O,Z)=>{const Y=O?1:0,ie=(C+1)*B-Y,se=P*B,ae=(P+1)*B-Y;Z[0]=C*B,Z[1]=se,Z[2]=ie,Z[3]=ae};let w=new hm(m);const T=[];for(let C=0;C<m*m;C++){v(C%m,Math.floor(C/m),y,!1,T);const P=es(T[0],T[1],l),B=es(T[2],T[1],l),O=es(T[2],T[3],l),Z=es(T[0],T[3],l);w.minimums.push(Math.min(P,B,O,Z)),w.maximums.push(Math.max(P,B,O,Z)),w.leaves.push(1)}for(p.push(w),m/=2;m>=1;m/=2){const C=p[p.length-1];w=new hm(m);for(let P=0;P<m*m;P++){v(P%m,Math.floor(P/m),2,!0,T);const B=C.getElevation(T[0],T[1]),O=C.getElevation(T[2],T[1]),Z=C.getElevation(T[2],T[3]),Y=C.getElevation(T[0],T[3]),ie=C.isLeaf(T[0],T[1]),se=C.isLeaf(T[2],T[1]),ae=C.isLeaf(T[2],T[3]),le=C.isLeaf(T[0],T[3]),Te=Math.min(B.min,O.min,Z.min,Y.min),be=Math.max(B.max,O.max,Z.max,Y.max),$e=ie&&se&&ae&&le;w.maximums.push(be),w.minimums.push(Te),w.leaves.push(be-Te<=5&&$e?1:0)}p.push(w)}return p}(this.dem),n=r.length-1,a=r[n];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(r,0,0,n,0)}raycastRoot(e,r,n,a,l,h,p=1){return dm([e,r,-100],[n,a,this.maximums[0]*p],l,h)}raycast(e,r,n,a,l,h,p=1){if(!this.nodeCount)return null;const m=this.raycastRoot(e,r,n,a,l,h,p);if(m==null)return null;const y=[],v=[],w=[],T=[],C=[{idx:0,t:m,nodex:0,nodey:0,depth:0}];for(;C.length>0;){const{idx:P,t:B,nodex:O,nodey:Z,depth:Y}=C.pop();if(this.leaves[P]){mm(O,Z,Y,e,r,n,a,w,T);const se=1<<Y,ae=(O+0)/se,le=(O+1)/se,Te=(Z+0)/se,be=(Z+1)/se,$e=es(ae,Te,this.dem)*p,Oe=es(le,Te,this.dem)*p,we=es(le,be,this.dem)*p,Ve=es(ae,be,this.dem)*p,Ze=pm(w[0],w[1],$e,T[0],w[1],Oe,T[0],T[1],we,l,h),Ce=pm(T[0],T[1],we,w[0],T[1],Ve,w[0],w[1],$e,l,h),Ke=Math.min(Ze!==null?Ze:Number.MAX_VALUE,Ce!==null?Ce:Number.MAX_VALUE);if(Ke!==Number.MAX_VALUE)return Ke;{const tt=Nt([],l,h,B);if(gm($e,Oe,Ve,we,fm(tt[0],w[0],T[0]),fm(tt[1],w[1],T[1]))>=tt[2])return B}continue}let ie=0;for(let se=0;se<this._siblingOffset.length;se++){mm((O<<1)+this._siblingOffset[se][0],(Z<<1)+this._siblingOffset[se][1],Y+1,e,r,n,a,w,T),w[2]=-100,T[2]=this.maximums[this.childOffsets[P]+se]*p;const ae=dm(w,T,l,h);if(ae!=null){const le=ae;y[se]=le;let Te=!1;for(let be=0;be<ie&&!Te;be++)le>=y[v[be]]&&(v.splice(be,0,se),Te=!0);Te||(v[ie]=se),ie++}}for(let se=0;se<ie;se++){const ae=v[se];C.push({idx:this.childOffsets[P]+ae,t:y[ae],nodex:(O<<1)+this._siblingOffset[ae][0],nodey:(Z<<1)+this._siblingOffset[ae][1],depth:Y+1})}}return null}_addNode(e,r,n){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,n,a,l){if(e[a].isLeaf(r,n)===1)return;this.childOffsets[l]||(this.childOffsets[l]=this.nodeCount);const h=a-1,p=e[h];let m,y=0;for(let v=0;v<this._siblingOffset.length;v++){const w=2*r+this._siblingOffset[v][0],T=2*n+this._siblingOffset[v][1],C=p.getElevation(w,T),P=p.isLeaf(w,T),B=this._addNode(C.min,C.max,P);P&&(y|=1<<v),m||(m=B)}for(let v=0;v<this._siblingOffset.length;v++)y&1<<v||this._construct(e,2*r+this._siblingOffset[v][0],2*n+this._siblingOffset[v][1],h,m+v)}}function gm(t,e,r,n,a,l){return Xt(Xt(t,r,l),Xt(e,n,l),a)}function es(t,e,r){const n=r.dim,a=ze(t*n-.5,0,n-1),l=ze(e*n-.5,0,n-1),h=Math.floor(a),p=Math.floor(l),m=Math.min(h+1,n-1),y=Math.min(p+1,n-1);return gm(r.get(h,p),r.get(m,p),r.get(h,y),r.get(m,y),a-h,l-p)}const ym={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Nu{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,n,a=!1,l=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return jt(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const h=this.dim=r.height-2;if(this.data=new Uint32Array(r.data.buffer),this.encoding=n||"mapbox",this.borderReady=a,!a){for(let p=0;p<h;p++)this.data[this._idx(-1,p)]=this.data[this._idx(0,p)],this.data[this._idx(h,p)]=this.data[this._idx(h-1,p)],this.data[this._idx(p,-1)]=this.data[this._idx(p,0)],this.data[this._idx(p,h)]=this.data[this._idx(p,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)],l&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new _m(this)}get(e,r,n=!1){const a=new Uint8Array(this.data.buffer);n&&(e=ze(e,-1,this.dim),r=ze(r,-1,this.dim));const l=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(a[l],a[l+1],a[l+2])}static getUnpackVector(e){return ym[e]}get unpackVector(){return ym[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,n){return(256*e*256+256*r+n)/10-1e4}_unpackTerrarium(e,r,n){return 256*e+r+n/256-32768}static pack(e,r){const n=[0,0,0,0],a=Nu.getUnpackVector(r);let l=Math.floor((e+a[3])/a[2]);return n[2]=l%256,l=Math.floor(l/256),n[1]=l%256,l=Math.floor(l/256),n[0]=l,n}getPixels(){return new Qr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=r*this.dim,l=r*this.dim+this.dim,h=n*this.dim,p=n*this.dim+this.dim;switch(r){case-1:a=l-1;break;case 1:l=a+1}switch(n){case-1:h=p-1;break;case 1:p=h+1}const m=-r*this.dim,y=-n*this.dim;for(let v=h;v<p;v++)for(let w=a;w<l;w++)this.data[this._idx(w,v)]=e.data[this._idx(w+m,v+y)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ye("DEMData",Nu),Ye("DemMinMaxQuadTree",_m,{omit:["dem"]});class fx{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,n){const a=e.wrapped().key;this.data[a]===void 0&&(this.data[a]=[]);const l={value:r,timeout:void 0};if(n!==void 0&&(l.timeout=setTimeout(()=>{this.remove(e,l)},n)),this.data[a].push(l),this.order.push(a),this.order.length>this.max){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const n=e.wrapped().key,a=r===void 0?0:this.data[n].indexOf(r),l=this.data[n][a];return this.data[n].splice(a,1),l.timeout&&clearTimeout(l.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(l.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const n in this.data)for(const a of this.data[n])e(a.value)||r.push(a);for(const n of r)this.remove(n.value.tileID,n)}}class qs extends Vn{constructor(e,r,n){super(),this.id=e,this._onlySymbols=n,r.on("data",a=>{a.dataType==="source"&&a.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&a.dataType==="source"&&a.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new fx(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new px}onAdd(e){this.map=e,this._minTileCacheSize=e?e._minTileCacheSize:null,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const n=this._tiles[r];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return nt(this._tiles).map(e=>e.tileID).sort(xm).map(e=>e.key)}getRenderableIds(e){const r=[];for(const n in this._tiles)this._isIdRenderable(+n,e)&&r.push(this._tiles[n]);return e?r.sort((n,a)=>{const l=n.tileID,h=a.tileID,p=new _e(l.canonical.x,l.canonical.y)._rotate(this.transform.angle),m=new _e(h.canonical.x,h.canonical.y)._rotate(this.transform.angle);return l.overscaledZ-h.overscaledZ||m.y-p.y||m.x-p.x}).map(n=>n.tileID.key):r.map(n=>n.tileID).sort(xm).map(n=>n.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const n=this._tiles[e];n&&(n.state!=="loading"&&(n.state=r),this._loadTile(n,this._tileLoaded.bind(this,n,e,r)))}_tileLoaded(e,r,n,a){if(a)if(e.state="errored",a.status!==404)this._source.fire(new la(a,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const l=this.map.painter.terrain;this.update(this.transform,l.getScaledDemTileSize(),!0),l.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Tr.now(),n==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Un("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let a=0;a<r.length;a++){const l=r[a];if(e.neighboringTiles&&e.neighboringTiles[l]){const h=this.getTileByID(l);n(e,h),n(h,e)}}function n(a,l){if(!a.dem||a.dem.borderReady)return;a.needsHillshadePrepare=!0,a.needsDEMTextureUpload=!0;let h=l.tileID.canonical.x-a.tileID.canonical.x;const p=l.tileID.canonical.y-a.tileID.canonical.y,m=Math.pow(2,a.tileID.canonical.z),y=l.tileID.key;h===0&&p===0||Math.abs(p)>1||(Math.abs(h)>1&&(Math.abs(h+m)===1?h+=m:Math.abs(h-m)===1&&(h-=m)),l.dem&&a.dem&&(a.dem.backfillBorder(l.dem,h,p),a.neighboringTiles&&a.neighboringTiles[y]&&(a.neighboringTiles[y].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,n,a){for(const l in this._tiles){let h=this._tiles[l];if(a[l]||!h.hasData()||h.tileID.overscaledZ<=r||h.tileID.overscaledZ>n)continue;let p=h.tileID;for(;h&&h.tileID.overscaledZ>r+1;){const y=h.tileID.scaledTo(h.tileID.overscaledZ-1);h=this._tiles[y.key],h&&h.hasData()&&(p=y)}let m=p;for(;m.overscaledZ>r;)if(m=m.scaledTo(m.overscaledZ-1),e[m.key]){a[p.key]=p;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=r?n:null}for(let n=e.overscaledZ-1;n>=r;n--){const a=e.scaledTo(n),l=this._getLoadedTile(a);if(l)return l}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const n=Math.ceil(e.width/r)+1,a=Math.ceil(e.height/r)+1,l=Math.floor(n*a*5),h=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,l):l,p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(p)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const n={};for(const a in this._tiles){const l=this._tiles[a];l.tileID=l.tileID.unwrapTo(l.tileID.wrap+r),n[l.tileID.key]=l}this._tiles=n;for(const a in this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(const a in this._tiles)this._setTileReloadTimer(+a,this._tiles[a])}}update(e,r,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!n)return;let a;this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(p=>new Mr(p.canonical.z,p.wrap,p.canonical.z,p.canonical.x,p.canonical.y)):(a=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(a=a.filter(p=>this._source.hasTile(p)))):a=[];const l=this._updateRetainedTiles(a);if(vm(this._source.type)&&a.length!==0){const p={},m={},y=Object.keys(l);for(const w of y){const T=l[w],C=this._tiles[w];if(!C||C.fadeEndTime&&C.fadeEndTime<=Tr.now())continue;const P=this.findLoadedParent(T,Math.max(T.overscaledZ-qs.maxOverzooming,this._source.minzoom));P&&(this._addTile(P.tileID),p[P.tileID.key]=P.tileID),m[w]=T}const v=a[a.length-1].overscaledZ;for(const w in this._tiles){const T=this._tiles[w];if(l[w]||!T.hasData())continue;let C=T.tileID;for(;C.overscaledZ>v;){C=C.scaledTo(C.overscaledZ-1);const P=this._tiles[C.key];if(P&&P.hasData()&&m[C.key]){l[w]=T.tileID;break}}}for(const w in p)l[w]||(this._coveredTiles[w]=!0,l[w]=p[w])}for(const p in l)this._tiles[p].clearFadeHold();const h=function(p,m){const y=[];for(const v in p)v in m||y.push(v);return y}(this._tiles,l);for(const p of h){const m=this._tiles[p];m.hasSymbolBuckets&&!m.holdingForFade()?m.setHoldDuration(this.map._fadeDuration):m.hasSymbolBuckets&&!m.symbolFadeFinished()||this._removeTile(+p)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const n={},a=e.reduce((y,v)=>Math.min(y,v.overscaledZ),1/0),l=e[0].overscaledZ,h=Math.max(l-qs.maxOverzooming,this._source.minzoom),p=Math.max(l+qs.maxUnderzooming,this._source.minzoom),m={};for(const y of e){const v=this._addTile(y);r[y.key]=y,v.hasData()||a<this._source.maxzoom&&(m[y.key]=y)}this._retainLoadedChildren(m,a,p,r);for(const y of e){let v=this._tiles[y.key];if(v.hasData())continue;if(y.canonical.z>=this._source.maxzoom){const T=y.children(this._source.maxzoom)[0],C=this.getTile(T);if(C&&C.hasData()){r[T.key]=T;continue}}else{const T=y.children(this._source.maxzoom);if(r[T[0].key]&&r[T[1].key]&&r[T[2].key]&&r[T[3].key])continue}let w=v.wasRequested();for(let T=y.overscaledZ-1;T>=h;--T){const C=y.scaledTo(T);if(n[C.key]||(n[C.key]=!0,v=this.getTile(C),!v&&w&&(v=this._addTile(C)),v&&(r[C.key]=C,w=v.wasRequested(),v.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let n,a=this._tiles[e].tileID;for(;a.overscaledZ>0;){if(a.key in this._loadedParentTiles){n=this._loadedParentTiles[a.key];break}r.push(a.key);const l=a.scaledTo(a.overscaledZ-1);if(n=this._getLoadedTile(l),n)break;a=l}for(const l of r)this._loadedParentTiles[l]=n}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const n=Boolean(r);if(!n){const a=this.map?this.map.painter:null,l=this._source.type==="raster"||this._source.type==="raster-dem";r=new zd(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,a,l),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,n||this._source.fire(new Un("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=r.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,r,n){const a=[],l=this.transform;if(!l)return a;for(const h in this._tiles){const p=this._tiles[h];if(n&&p.clearQueryDebugViz(),p.holdingForFade())continue;const m=e.containsTile(p,l,r);m&&a.push(m)}return a}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(n=>this._tiles[n].tileID);for(const n of r)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(vm(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=Tr.now())return!0}return!1}setFeatureState(e,r,n){this._state.updateState(e=e||"_geojsonTileLayer",r,n)}removeFeatureState(e,r,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,n)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,n){const a=this._tiles[e];a&&a.setDependencies(r,n)}reloadTilesForDependencies(e,r){for(const n in this._tiles)this._tiles[n].hasDependency(e,r)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(e,r))}_preloadTiles(e,r){const n=new Map,a=Array.isArray(e)?e:[e],l=this.map.painter.terrain,h=this.usedForTerrain&&l?l.getScaledDemTileSize():this._source.tileSize;for(const y of a){const v=y.coveringTiles({tileSize:h,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const w of v)n.set(w.key,w);this.usedForTerrain&&y.updateElevation(!1)}const p=Array.from(n.values()),m=this._source.type==="raster"||this._source.type==="raster-dem";at(p,(y,v)=>{const w=new zd(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,m);this._loadTile(w,T=>{this._source.type==="raster-dem"&&w.dem&&this._backfillDEM(w),v(T,w)})},r)}}function xm(t,e){const r=Math.abs(2*t.wrap)-+(t.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||n-r||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function vm(t){return t==="raster"||t==="image"||t==="video"}qs.maxOverzooming=10,qs.maxUnderzooming=3;class ju{constructor(e,r,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=n}static create(e,r,n){const a=n||e.findDEMTileFor(r);if(!a||!a.dem)return;const l=a.dem,h=a.tileID,p=1<<r.canonical.z-h.canonical.z;return new ju(a,a.tileSize/At/p,[(r.canonical.x/p-h.canonical.x)*l.dim,(r.canonical.y/p-h.canonical.y)*l.dim])}tileCoordToPixel(e,r){const n=r*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),l=Math.floor(n);return new _e(a,l)}getElevationAt(e,r,n,a){const l=e*this._scale+this._offset[0],h=r*this._scale+this._offset[1],p=Math.floor(l),m=Math.floor(h),y=this._dem;return a=!!a,n?Xt(Xt(y.get(p,m,a),y.get(p,m+1,a),h-m),Xt(y.get(p+1,m,a),y.get(p+1,m+1,a),h-m),l-p):y.get(p,m,a)}getElevationAtPixel(e,r,n){return this._dem.get(e,r,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*zn(1,e)*this._dem.stride}}class bm{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Fs(At,16,0),this.featureIndexArray=new $p,this.promoteId=r}insert(e,r,n,a,l,h=0){const p=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,a,l,h);const m=this.grid;for(let y=0;y<r.length;y++){const v=r[y],w=[1/0,1/0,-1/0,-1/0];for(let T=0;T<v.length;T++){const C=v[T];w[0]=Math.min(w[0],C.x),w[1]=Math.min(w[1],C.y),w[2]=Math.max(w[2],C.x),w[3]=Math.max(w[3],C.y)}w[0]<At&&w[1]<At&&w[2]>=0&&w[3]>=0&&m.insert(p,w[0],w[1],w[2],w[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Zs.VectorTile(new oc(this.rawTileData)).layers,this.sourceLayerCoder=new cm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,n,a){this.loadVTLayers();const l=e.params||{},h=Ra(l.filter),p=e.tileResult,m=e.transform,y=p.bufferedTilespaceBounds,v=this.grid.query(y.min.x,y.min.y,y.max.x,y.max.y,(P,B,O,Z)=>lf(p.bufferedTilespaceGeometry,P,B,O,Z));v.sort(mx);let w=null;m.elevation&&v.length>0&&(w=ju.create(m.elevation,this.tileID));const T={};let C;for(let P=0;P<v.length;P++){const B=v[P];if(B===C)continue;C=B;const O=this.featureIndexArray.get(B);let Z=null;this.loadMatchingFeature(T,O,h,l.layers,l.availableImages,r,n,a,(Y,ie,se,ae=0)=>(Z||(Z=bo(Y,this.tileID.canonical,e.tileTransform)),ie.queryIntersectsFeature(p,Y,se,Z,this.z,e.transform,e.pixelPosMatrix,w,ae)))}return T}loadMatchingFeature(e,r,n,a,l,h,p,m,y){const{featureIndex:v,bucketIndex:w,sourceLayerIndex:T,layoutVertexArrayOffset:C}=r,P=this.bucketLayerIDs[w];if(a&&!function(Y,ie){for(let se=0;se<Y.length;se++)if(ie.indexOf(Y[se])>=0)return!0;return!1}(a,P))return;const B=this.sourceLayerCoder.decode(T),O=this.vtLayers[B].feature(v);if(n.needGeometry){const Y=$s(O,!0);if(!n.filter(new _t(this.tileID.overscaledZ),Y,this.tileID.canonical))return}else if(!n.filter(new _t(this.tileID.overscaledZ),O))return;const Z=this.getId(O,B);for(let Y=0;Y<P.length;Y++){const ie=P[Y];if(a&&a.indexOf(ie)<0)continue;const se=h[ie];if(!se)continue;let ae={};Z!==void 0&&m&&(ae=m.getState(se.sourceLayer||"_geojsonTileLayer",Z));const le=Je({},p[ie]);le.paint=wm(le.paint,se.paint,O,ae,l),le.layout=wm(le.layout,se.layout,O,ae,l);const Te=!y||y(O,se,ae,C);if(!Te)continue;const be=new um(O,this.z,this.x,this.y,Z);be.layer=le;let $e=e[ie];$e===void 0&&($e=e[ie]=[]),$e.push({featureIndex:v,feature:be,intersectionZ:Te})}}lookupSymbolFeatures(e,r,n,a,l,h,p,m){const y={};this.loadVTLayers();const v=Ra(l);for(const w of e)this.loadMatchingFeature(y,{bucketIndex:n,sourceLayerIndex:a,featureIndex:w,layoutVertexArrayOffset:0},v,h,p,m,r);return y}loadFeature(e){const{featureIndex:r,sourceLayerIndex:n}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(n),l=this.vtFeatures[a];if(l[r])return l[r];const h=this.vtLayers[a].feature(r);return l[r]=h,h}hasLayer(e){for(const r of this.bucketLayerIDs)for(const n of r)if(e===n)return!0;return!1}getId(e,r){let n=e.id;return this.promoteId&&(n=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof n=="boolean"&&(n=Number(n))),n}}function wm(t,e,r,n,a){return Zr(t,(l,h)=>{const p=e instanceof mo?e.get(h):null;return p&&p.evaluate?p.evaluate(r,n,a):p})}function mx(t,e){return e-t}Ye("FeatureIndex",bm,{omit:["rawTileData","sourceLayerCoder"]});var _x=xi([{name:"a_pos",type:"Int16",components:2}]);const _n=32,eo=33,ts=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,r=0,n=0,a=0,l=0,h=0,p=0;for(1&e?a=l=h=_n:r=n=p=_n;(e>>=1)>1;){const y=r+a>>1,v=n+l>>1;1&e?(a=r,l=n,r=h,n=p):(r=a,n=l,a=h,l=p),h=y,p=v}const m=4*t;ts[m+0]=r,ts[m+1]=n,ts[m+2]=a,ts[m+3]=l}const to=new Uint16Array(2178),is=new Uint8Array(1089),Gu=new Uint16Array(1089);function Tm(t){return t===0?-.03125:t===32?.03125:0}var Cd=xi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Em={type:2,extent:At,loadGeometry:()=>[[new _e(0,0),new _e(8193,0),new _e(8193,8193),new _e(0,8193),new _e(0,0)]]};class zd{constructor(e,r,n,a,l){this.tileID=e,this.uid=Ct(),this.uses=0,this.tileSize=r,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=l,this.expiredRequestCount=0,this.state="loading",a&&a.transform&&(this.projection=a.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<Tr.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=rl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,n){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(a,l){const h={};if(!l)return h;for(const p of a){const m=p.layerIds.map(y=>l.getLayer(y)).filter(Boolean);if(m.length!==0){p.layers=m,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(y=>m.filter(v=>v.id===y)[0]));for(const y of m)h[y.id]=p}}return h}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const a in this.buckets){const l=this.buckets[a];if(l instanceof Qo){if(this.hasSymbolBuckets=!0,!n)break;l.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const a in this.buckets){const l=this.buckets[a];if(l instanceof Qo&&l.hasRTLText){this.hasRTLText=!0,Lt.isLoading()||Lt.isLoaded()||Fr()!=="deferred"||Yr();break}}this.queryPadding=0;for(const a in this.buckets){const l=this.buckets[a];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(a).queryRadius(l))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new jh}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const n in this.buckets){const a=this.buckets[n];a.uploadPending()&&a.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Uu(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Uu(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Uu(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,n,a,l,h,p,m){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:a,pixelPosMatrix:p,transform:h,params:l,tileTransform:this.tileTransform},e,r,n):{}}querySourceFeatures(e,r){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const a=n.loadVTLayers(),l=r?r.sourceLayer:"",h=a._geojsonTileLayer||a[l];if(!h)return;const p=Ra(r&&r.filter),{z:m,x:y,y:v}=this.tileID.canonical,w={z:m,x:y,y:v};for(let T=0;T<h.length;T++){const C=h.feature(T);if(p.needGeometry){const O=$s(C,!0);if(!p.filter(new _t(this.tileID.overscaledZ),O,this.tileID.canonical))continue}else if(!p.filter(new _t(this.tileID.overscaledZ),C))continue;const P=n.getId(C,l),B=new um(C,m,y,v,P);B.tile=w,e.push(B)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const n=Co(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const n=Date.now();let a=!1;if(this.expirationTime>n)a=!1;else if(r)if(this.expirationTime<r)a=!0;else{const l=this.expirationTime-r;l?this.expirationTime=n+Math.max(l,3e4):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;const n=this.latestFeatureIndex.loadVTLayers(),a=r.style.listImages();for(const l in this.buckets){if(!r.style.hasLayer(l))continue;const h=this.buckets[l],p=h.layers[0].sourceLayer||"_geojsonTileLayer",m=n[p],y=e[p];if(!m||!y||Object.keys(y).length===0)continue;if(h.update(y,m,a,this.imageAtlas&&this.imageAtlas.patternPositions||{}),h instanceof Au||h instanceof Mu){const w=r.style._getSourceCache(h.layers[0].source);r._terrain&&r._terrain.enabled&&w&&h.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(w.id,this.tileID)}const v=r&&r.style&&r.style.getLayer(l);v&&(this.queryPadding=Math.max(this.queryPadding,v.queryRadius(h)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Tr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Tr.now()+e}setDependencies(e,r){const n={};for(const a of r)n[a]=!0;this.dependencies[e]=n}hasDependency(e,r){for(const n of e){const a=this.dependencies[n];if(a){for(const l of r)if(a[l])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const n=bo(Em,this.tileID.canonical,this.tileTransform)[0],a=new Va,l=new pu;for(let h=0;h<n.length;h++){const{x:p,y:m}=n[h];a.emplaceBack(p,m),l.emplaceBack(h)}l.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(l),this._tileDebugBuffer=e.createVertexBuffer(a,Cd.members),this._tileDebugSegments=Ci.simpleSegment(0,0,a.length,l.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const n=bo(Em,this.tileID.canonical,this.tileTransform)[0];let a,l;if(this.isRaster){const h=function(p,m){const y=rl(p,m),v=Math.pow(2,p.z);for(let O=0;O<eo;O++)for(let Z=0;Z<eo;Z++){const Y=vo((p.x+(Z+Tm(Z))/_n)/v),ie=mn((p.y+(O+Tm(O))/_n)/v),se=m.project(Y,ie),ae=O*eo+Z;to[2*ae+0]=Math.round((se.x*y.scale-y.x)*At),to[2*ae+1]=Math.round((se.y*y.scale-y.y)*At)}is.fill(0),Gu.fill(0);for(let O=2045;O>=0;O--){const Z=4*O,Y=ts[Z+0],ie=ts[Z+1],se=ts[Z+2],ae=ts[Z+3],le=Y+se>>1,Te=ie+ae>>1,be=le+Te-ie,$e=Te+Y-le,Oe=ie*eo+Y,we=ae*eo+se,Ve=Te*eo+le,Ze=Math.hypot((to[2*Oe+0]+to[2*we+0])/2-to[2*Ve+0],(to[2*Oe+1]+to[2*we+1])/2-to[2*Ve+1])>=16;if(is[Ve]=is[Ve]||(Ze?1:0),O<1022){const Ce=(ie+$e>>1)*eo+(Y+be>>1),Ke=(ae+$e>>1)*eo+(se+be>>1);is[Ve]=is[Ve]||is[Ce]||is[Ke]}}const w=new Na,T=new Jr;let C=0;function P(O,Z){const Y=Z*eo+O;return Gu[Y]===0&&(w.emplaceBack(to[2*Y+0],to[2*Y+1],O*At/_n,Z*At/_n),Gu[Y]=++C),Gu[Y]-1}function B(O,Z,Y,ie,se,ae){const le=O+Y>>1,Te=Z+ie>>1;if(Math.abs(O-se)+Math.abs(Z-ae)>1&&is[Te*eo+le])B(se,ae,O,Z,le,Te),B(Y,ie,se,ae,le,Te);else{const be=P(O,Z),$e=P(Y,ie),Oe=P(se,ae);T.emplaceBack(be,$e,Oe)}}return B(0,0,_n,_n,_n,0),B(_n,_n,0,0,0,_n),{vertices:w,indices:T}}(this.tileID.canonical,r);a=h.vertices,l=h.indices}else{a=new Na,l=new Jr;for(const{x:p,y:m}of n)a.emplaceBack(p,m,0,0);const h=wu(a.int16,void 0,4);for(let p=0;p<h.length;p+=3)l.emplaceBack(h[p],h[p+1],h[p+2])}this._tileBoundsBuffer=e.createVertexBuffer(a,Cd.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(l),this._tileBoundsSegments=Ci.simpleSegment(0,0,a.length,l.length)}}const gx=xi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),yx=xi([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Sm}=gx;function Ws(t,e){const r=t.fovAboveCenter,n=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,a=(t._camera.position[2]*t.worldSize-n)/Math.cos(t._pitch),l=Math.sin(r)*a/Math.sin(Math.max(Math.PI/2-t._pitch-r,.01)),h=Math.sin(t._pitch)*l+a;return Math.min(1.01*h,a*(1/t._horizonShift))}const Pd=At/Math.PI/2,Or=-Pd,Ur=Pd,xx=[new Pn([Or,Or,Or],[Ur,Ur,Ur]),new Pn([Or,Or,Or],[0,0,Ur]),new Pn([0,Or,Or],[Ur,0,Ur]),new Pn([Or,0,Or],[0,Ur,Ur]),new Pn([0,0,Or],[Ur,Ur,Ur])];function $u(t){if(t.z<=1)return xx[t.z+2*t.y+t.x];const[e,r]=Im(t),n=[Zu(e[0],e[1]),Zu(e[0],r[1]),Zu(r[0],e[1]),Zu(r[0],r[1])],a=[Ur,Ur,Ur],l=[Or,Or,Or];for(const h of n)a[0]=Math.min(a[0],h[0]),a[1]=Math.min(a[1],h[1]),a[2]=Math.min(a[2],h[2]),l[0]=Math.max(l[0],h[0]),l[1]=Math.max(l[1],h[1]),l[2]=Math.max(l[2],h[2]);return new Pn(a,l)}function Im(t){const e=Math.pow(2,t.z),r=t.x/e,n=(t.x+1)/e,a=(t.y+1)/e;return[[mn(t.y/e),vo(r)],[mn(a),vo(n)]]}function kd(t,e,r,n){return r=re(r),n||(n=Pd),[t*Math.sin(r)*n,-e*n,t*Math.cos(r)*n]}function Zu(t,e,r){return kd(Math.cos(re(t)),Math.sin(re(t)),e,r)}function Mm(t){return 16383/Math.max(...on([],t.max,t.min))}function Am(t){const e=yt(new Float64Array(16)),r=1/Mm(t);return ai(e,e,t.min),Wt(e,e,[r,r,r]),e}function Cm(t,e,r){const n=e/(2*Math.PI),a=function(h){const p=At/(2*Math.PI);return h/(2*Math.PI)/p}(e);if(!r){const h=ze(t.center.lat,-85.051129,Yn);r=[$a(t.center.lng)*e,Za(h)*e]}const l=yt(new Float64Array(16));return ai(l,l,[r[0],r[1],-n]),Wt(l,l,[a,a,a]),Di(l,l,re(-t._center.lat)),Vi(l,l,re(-t._center.lng)),l}class Dd{constructor(e){const r=this._createGridIndices();this.gridIndexBuffer=e.createIndexBuffer(r,!0),this.gridSegments=Ci.simpleSegment(0,0,4225,8192);const n=this._createPoleTriangleIndices();this.poleIndexBuffer=e.createIndexBuffer(n,!0),this.poleSegments=Ci.simpleSegment(0,0,66,64);const a=new Hl;a.emplaceBack(-1,1,1,0,0,0,0),a.emplaceBack(1,1,1,0,0,1,0),a.emplaceBack(1,-1,1,0,0,1,1),a.emplaceBack(-1,-1,1,0,0,0,1);const l=new Jr;l.emplaceBack(0,1,2),l.emplaceBack(2,3,0),this.atmosphereVertexBuffer=e.createVertexBuffer(a,yx.members),this.atmosphereIndexBuffer=e.createIndexBuffer(l),this.atmosphereSegments=Ci.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(e,r,n){const a=new Hl,l=r/Math.PI/2;a.emplaceBack(0,-l,0,0,0,.5,n?0:1);const h=360/e,p=Math.cos(re(85)),m=Math.sin(re(85));for(let v=0;v<=64;v++){const w=v/64,T=kd(p,m,0*(1-(y=w))+h*y,l);a.emplaceBack(T[0],T[1],T[2],0,0,w,n?0:1)}var y;return a}_createPoleTriangleIndices(){const e=new Jr;for(let r=0;r<=64;r++)e.emplaceBack(0,r+1,r+2);return e}static createGridVertices(e){const r=Math.pow(2,e.z),n=(m,y,v)=>m*(1-v)+y*v,[a,l]=Im(e),h=new Hl,p=function(m){const y=yt(new Float64Array(16)),v=Mm(m);var w,T;return Wt(y,y,[v,v,v]),ai(y,y,((w=[])[0]=-(T=m.min)[0],w[1]=-T[1],w[2]=-T[2],w)),y}($u(e));h.reserve(4096);for(let m=0;m<65;m++){const y=n(a[0],l[0],m/64),v=Za(y),w=v*r-e.y,T=Math.sin(re(y)),C=Math.cos(re(y));for(let P=0;P<65;P++){const B=P/64,O=n(a[1],l[1],B),Z=kd(C,T,O);vt(Z,Z,p);const Y=$a(O);h.emplaceBack(Z[0],Z[1],Z[2],Y,v,B,w)}}return h}_createGridIndices(){const e=new Jr,r=(n,a)=>{const l=65*a+n;e.emplaceBack(l+1,l,l+65),e.emplaceBack(l+65,l+65+1,l+1)};for(let n=0;n<64;n++)for(let a=0;a<64;a++)r(a,n);return e}getWirefameBuffer(e){if(!this.wireframeSegments){const r=this._createWireframeGrid();this.wireframeIndexBuffer=e.createIndexBuffer(r),this.wireframeSegments=Ci.simpleSegment(0,0,4096,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const e=new Xo,r=(n,a)=>{const l=65*a+n;e.emplaceBack(l,l+1),e.emplaceBack(l,l+65),e.emplaceBack(l,l+65+1)};for(let n=0;n<64;n++)for(let a=0;a<64;a++)r(a,n);return e}}function rl(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const r=Math.pow(2,-t.z),n=t.x*r,a=(t.x+1)*r,l=t.y*r,h=(t.y+1)*r,p=vo(n),m=vo(a),y=mn(l),v=mn(h),w=e.project(p,y),T=e.project(m,y),C=e.project(m,v),P=e.project(p,v);let B=Math.min(w.x,T.x,C.x,P.x),O=Math.min(w.y,T.y,C.y,P.y),Z=Math.max(w.x,T.x,C.x,P.x),Y=Math.max(w.y,T.y,C.y,P.y);const ie=r/16;function se(le,Te,be,$e,Oe,we){const Ve=(be+Oe)/2,Ze=($e+we)/2,Ce=e.project(vo(Ve),mn(Ze)),Ke=Math.max(0,B-Ce.x,O-Ce.y,Ce.x-Z,Ce.y-Y);B=Math.min(B,Ce.x),Z=Math.max(Z,Ce.x),O=Math.min(O,Ce.y),Y=Math.max(Y,Ce.y),Ke>ie&&(se(le,Ce,be,$e,Ve,Ze),se(Ce,Te,Ve,Ze,Oe,we))}se(w,T,n,l,a,l),se(T,C,a,l,a,h),se(C,P,a,h,n,h),se(P,w,n,h,n,l),B-=ie,O-=ie,Z+=ie,Y+=ie;const ae=1/Math.max(Z-B,Y-O);return{scale:ae,x:B*ae,y:O*ae,x2:Z*ae,y2:Y*ae,projection:e}}class zm{constructor(e){const r={},n=[];for(const p in e){const m=e[p],y=r[p]={};for(const v in m.glyphs){const w=m.glyphs[+v];if(!w||w.bitmap.width===0||w.bitmap.height===0)continue;const T=w.metrics.localGlyph?2:1,C={x:0,y:0,w:w.bitmap.width+2*T,h:w.bitmap.height+2*T};n.push(C),y[v]=C}}const{w:a,h:l}=cd(n),h=new Ko({width:a||1,height:l||1});for(const p in e){const m=e[p];for(const y in m.glyphs){const v=m.glyphs[+y];if(!v||v.bitmap.width===0||v.bitmap.height===0)continue;const w=r[p][y],T=v.metrics.localGlyph?2:1;Ko.copy(v.bitmap,h,{x:0,y:0},{x:w.x+T,y:w.y+T},v.bitmap)}}this.image=h,this.positions=r}}Ye("GlyphAtlas",zm);class vx{constructor(e){this.tileID=new Mr(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=rl(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,n,a,l){this.status="parsing",this.data=e,this.collisionBoxArray=new jh;const h=new cm(Object.keys(e.layers).sort()),p=new bm(this.tileID,this.promoteId);p.bucketLayerIDs=[];const m={},y=new Td(256,256),v={featureIndex:p,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:y,availableImages:n},w=r.familiesBySource[this.source];for(const ae in w){const le=e.layers[ae];if(!le)continue;let Te=!1,be=!1;for(const we of w[ae])we[0].type==="symbol"?Te=!0:be=!0;if(this.isSymbolTile===!0&&!Te||this.isSymbolTile===!1&&!be)continue;le.version===1&&jt(`Vector tile source "${this.source}" layer "${ae}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const $e=h.encode(ae),Oe=[];for(let we=0;we<le.length;we++){const Ve=le.feature(we),Ze=p.getId(Ve,ae);Oe.push({feature:Ve,id:Ze,index:we,sourceLayerIndex:$e})}for(const we of w[ae]){const Ve=we[0];this.isSymbolTile!==void 0&&Ve.type==="symbol"!==this.isSymbolTile||Ve.minzoom&&this.zoom<Math.floor(Ve.minzoom)||Ve.maxzoom&&this.zoom>=Ve.maxzoom||Ve.visibility!=="none"&&(Ld(we,this.zoom,n),(m[Ve.id]=Ve.createBucket({index:p.bucketLayerIDs.length,layers:we,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:$e,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:n})).populate(Oe,v,this.tileID.canonical,this.tileTransform),p.bucketLayerIDs.push(we.map(Ze=>Ze.id)))}}let T,C,P,B;y.trim();const O={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Z=Zr(v.glyphDependencies,ae=>Object.keys(ae).map(Number));Object.keys(Z).length?a.send("getGlyphs",{uid:this.uid,stacks:Z},(ae,le)=>{T||(T=ae,C=le,se.call(this))},void 0,!1,O):C={};const Y=Object.keys(v.iconDependencies);Y.length?a.send("getImages",{icons:Y,source:this.source,tileID:this.tileID,type:"icons"},(ae,le)=>{T||(T=ae,P=le,se.call(this))},void 0,!1,O):P={};const ie=Object.keys(v.patternDependencies);function se(){if(T)return l(T);if(C&&P&&B){const ae=new zm(C),le=new Rf(P,B);for(const Te in m){const be=m[Te];be instanceof Qo?(Ld(be.layers,this.zoom,n),Jy(be,C,ae.positions,P,le.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection),be.projection=this.projection.name):be.hasPattern&&(be instanceof Au||be instanceof Mu||be instanceof sd)&&(Ld(be.layers,this.zoom,n),be.addFeatures(v,this.tileID.canonical,le.patternPositions,n))}this.status="done",l(null,{buckets:nt(m).filter(Te=>!Te.isEmpty()),featureIndex:p,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ae.image,lineAtlas:y,imageAtlas:le,glyphMap:this.returnDependencies?C:null,iconMap:this.returnDependencies?P:null,glyphPositions:this.returnDependencies?ae.positions:null})}}ie.length?a.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"patterns"},(ae,le)=>{T||(T=ae,B=le,se.call(this))},void 0,!1,O):B={},se.call(this)}}function Ld(t,e,r){const n=new _t(e);for(const a of t)a.recalculate(n,r)}class Pm{constructor(e){this.entries={},this.scheduler=e}request(e,r,n,a){const l=this.entries[e]=this.entries[e]||{callbacks:[]};if(l.result){const[h,p]=l.result;return this.scheduler?this.scheduler.add(()=>{a(h,p)},r):a(h,p),()=>{}}return l.callbacks.push(a),l.cancel||(l.cancel=n((h,p)=>{l.result=[h,p];for(const m of l.callbacks)this.scheduler?this.scheduler.add(()=>{m(h,p)},r):m(h,p);setTimeout(()=>delete this.entries[e],3e3)})),()=>{l.result||(l.callbacks=l.callbacks.filter(h=>h!==a),l.callbacks.length||(l.cancel(),delete this.entries[e]))}}}function km(t,e,r){const n=JSON.stringify(t.request);return t.data&&(this.deduped.entries[n]={result:[null,t.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},a=>{const l=ms(t.request,(h,p,m,y)=>{h?a(h):p&&a(null,{vectorTile:r?void 0:new Zs.VectorTile(new oc(p)),rawData:p,cacheControl:m,expires:y})});return()=>{l.cancel(),a()}},e)}const bx=yt(new Float64Array(16));class Xs{constructor(e,r){this._tr=e,this._worldSize=r}createInversionMatrix(){return bx}createTileMatrix(e){let r,n,a;const l=e.canonical,h=yt(new Float64Array(16)),p=this._tr.projection;if(p.isReprojectedInTileSpace){const m=rl(l,p);r=1,n=m.x+e.wrap*m.scale,a=m.y,Wt(h,h,[r/m.scale,r/m.scale,this._tr.pixelsPerMeter/this._worldSize])}else r=this._worldSize/this._tr.zoomScale(l.z),n=(l.x+Math.pow(2,l.z)*e.wrap)*r,a=l.y*r;return ai(h,h,[n,a,0]),Wt(h,h,[r/At,r/At,1]),h}pointCoordinate(e,r,n){const a=this._tr.horizonLineFromTop(!1),l=new _e(e,Math.max(a,r));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(l,n))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var wx={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&bn(this.parallels,this.constants.parallels))return;const t=Math.sin(re(this.parallels[0])),e=(t+Math.sin(re(this.parallels[1])))/2,r=1+t*(2*e-t),n=Math.sqrt(r)/e;this.constants={n:e,c:r,r0:n,parallels:this.parallels}},project(t,e){this.initializeConstants();const r=re(t-this.center[0]),n=re(e),{n:a,c:l,r0:h}=this.constants,p=Math.sqrt(l-2*a*Math.sin(n))/a;return{x:p*Math.sin(r*a),y:p*Math.cos(r*a)-h,z:0}},unproject(t,e){this.initializeConstants();const{n:r,c:n,r0:a}=this.constants,l=a+e;let h=Math.atan2(t,Math.abs(l))*Math.sign(l);l*r<0&&(h-=Math.PI*Math.sign(t)*Math.sign(l));const p=re(this.center[0])*r;h=Ne(h,-Math.PI-p,Math.PI-p);const m=ye(h/r)+this.center[0],y=Math.asin(ze((n-(t*t+l*l)*r*r)/(2*r),-1,1)),v=ze(ye(y),-85.051129,Yn);return new Qt(m,v)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>zn(1,t)*e,farthestPixelDistance(t){return Ws(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Xs(t,e)};const cc=1.340264,uc=-.081106,hc=893e-6,dc=.003796,qu=Math.sqrt(3)/2;var Tx={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const r=Math.asin(qu*Math.sin(e)),n=r*r,a=n*n*n;return{x:.5*(t*Math.cos(r)/(qu*(cc+3*uc*n+a*(7*hc+9*dc*n)))/Math.PI+.5),y:1-.5*(r*(cc+uc*n+a*(hc+dc*n))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,n=r*r,a=n*n*n;for(let y,v,w,T=0;T<12&&(v=r*(cc+uc*n+a*(hc+dc*n))-e,w=cc+3*uc*n+a*(7*hc+9*dc*n),y=v/w,r=ze(r-y,-Math.PI/3,Math.PI/3),n=r*r,a=n*n*n,!(Math.abs(y)<1e-12));++T);const l=qu*t*(cc+3*uc*n+a*(7*hc+9*dc*n))/Math.cos(r),h=Math.asin(Math.sin(r)/qu),p=ze(180*l/Math.PI,-180,180),m=ze(180*h/Math.PI,-85.051129,Yn);return new Qt(p,m)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>zn(1,t)*e,farthestPixelDistance(t){return Ws(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Xs(t,e)},Ex={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(t,e)=>({x:.5+t/360,y:.5-e/360,z:0}),unproject(t,e){const r=360*(t-.5),n=ze(360*(.5-e),-85.051129,Yn);return new Qt(r,n)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>zn(1,t)*e,farthestPixelDistance(t){return Ws(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Xs(t,e)};const nl=Math.PI/2;function Wu(t){return Math.tan((nl+t)/2)}var Sx={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&bn(this.parallels,this.constants.parallels))return;const t=re(this.parallels[0]),e=re(this.parallels[1]),r=Math.cos(t),n=t===e?Math.sin(t):Math.log(r/Math.cos(e))/Math.log(Wu(e)/Wu(t)),a=r*Math.pow(Wu(t),n)/n;this.constants={n,f:a,parallels:this.parallels}},project(t,e){this.initializeConstants(),e=re(e),t=re(t-this.center[0]);const r=1e-6,{n,f:a}=this.constants;a>0?e<-nl+r&&(e=-nl+r):e>nl-r&&(e=nl-r);const l=a/Math.pow(Wu(e),n),h=l*Math.sin(n*t),p=a-l*Math.cos(n*t);return{x:.5*(h/Math.PI+.5),y:1-.5*(p/Math.PI+.5),z:0}},unproject(t,e){this.initializeConstants(),t=(2*t-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:r,f:n}=this.constants,a=n-e,l=Math.sign(a),h=Math.sign(r)*Math.sqrt(t*t+a*a);let p=Math.atan2(t,Math.abs(a))*l;a*r<0&&(p-=Math.PI*Math.sign(t)*l);const m=ze(ye(p/r)+this.center[0],-180,180),y=ze(ye(2*Math.atan(Math.pow(n/h,1/r))-nl),-85.051129,Yn);return new Qt(m,y)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>zn(1,t)*e,farthestPixelDistance(t){return Ws(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Xs(t,e)},Ix={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(t,e)=>({x:$a(t),y:Za(e),z:0}),unproject(t,e){const r=vo(t),n=mn(e);return new Qt(r,n)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>zn(1,t)*e,farthestPixelDistance(t){return Ws(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Xs(t,e)};const Dm=re(Yn);var Mx={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(t,e){const r=(e=re(e))*e,n=r*r;return{x:.5*((t=re(t))*(.8707-.131979*r+n*(n*(.003971*r-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+r*(.015085+n*(.028874*r-.044475-.005916*n)))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,n=25,a=0,l=r*r;do{l=r*r;const m=l*l;a=(r*(1.007226+l*(.015085+m*(.028874*l-.044475-.005916*m)))-e)/(1.007226+l*(.045255+m*(.259866*l-.311325-.005916*11*m))),r=ze(r-a,-Dm,Dm)}while(Math.abs(a)>1e-6&&--n>0);l=r*r;const h=ze(ye(t/(.8707+l*(l*(l*l*l*(.003971-.001529*l)-.013791)-.131979))),-180,180),p=ye(r);return new Qt(h,p)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>zn(1,t)*e,farthestPixelDistance(t){return Ws(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Xs(t,e)};const Lm=re(Yn),Bm={albers:wx,equalEarth:Tx,equirectangular:Ex,lambertConformalConic:Sx,mercator:Ix,naturalEarth:Mx,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=re(e),t=re(t);const r=Math.cos(e),n=2/Math.PI,a=Math.acos(r*Math.cos(t/2)),l=Math.sin(a)/a,h=.5*(t*n+2*r*Math.sin(t/2)/l)||0,p=.5*(e+Math.sin(e)/l)||0;return{x:.5*(h/Math.PI+.5),y:1-.5*(p/Math.PI+1),z:0}},unproject(t,e){let r=t=(2*t-.5)*Math.PI,n=e=(2*(1-e)-1)*Math.PI,a=25;const l=1e-6;let h=0,p=0;do{const m=Math.cos(n),y=Math.sin(n),v=2*y*m,w=y*y,T=m*m,C=Math.cos(r/2),P=Math.sin(r/2),B=2*C*P,O=P*P,Z=1-T*C*C,Y=Z?1/Z:0,ie=Z?Math.acos(m*C)*Math.sqrt(1/Z):0,se=.5*(2*ie*m*P+2*r/Math.PI)-t,ae=.5*(ie*y+n)-e,le=.5*Y*(T*O+ie*m*C*w)+1/Math.PI,Te=Y*(B*v/4-ie*y*P),be=.125*Y*(v*P-ie*y*T*B),$e=.5*Y*(w*C+ie*O*m)+.5,Oe=Te*be-$e*le;h=(ae*Te-se*$e)/Oe,p=(se*be-ae*le)/Oe,r=ze(r-h,-Math.PI,Math.PI),n=ze(n-p,-Lm,Lm)}while((Math.abs(h)>l||Math.abs(p)>l)&&--a>0);return new Qt(ye(r),ye(n))},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>zn(1,t)*e,farthestPixelDistance(t){return Ws(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Xs(t,e)}};s.ARRAY_TYPE=dt,s.AUTH_ERR_MSG=de,s.Aabb=Pn,s.Actor=class{constructor(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},Ni(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=an()?t:fe,this.scheduler=new dx}send(t,e,r,n,a=!1,l){const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=l,this.callbacks[h]=r);const p=ln(this.globalScope)?void 0:[];return this.target.postMessage({id:h,type:t,hasCallback:!!r,targetMapId:n,mustQueue:a,sourceMapId:this.mapId,data:Vs(e,p)},p),{cancel:()=>{r&&delete this.callbacks[h],this.target.postMessage({id:h,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(t){const e=t.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const n=this.cancelCallbacks[r];delete this.cancelCallbacks[r],n&&n.cancel()}else if(e.mustQueue||an()){const n=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),n&&n.metadata||{type:"message"})}else this.processTask(r,e)}processTask(t,e){if(e.type==="<response>"){const r=this.callbacks[t];delete this.callbacks[t],r&&(e.error?r(Hn(e.error)):r(null,Hn(e.data)))}else{const r=ln(this.globalScope)?void 0:[],n=e.hasCallback?(l,h)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:l?Vs(l):null,data:Vs(h,r)},r)}:l=>{},a=Hn(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,a,n);else if(this.parent.getWorkerSource){const l=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,l[0],a.source)[l[1]](a,n)}else n(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=Vu,s.Color=Ft,s.ColorMode=Qn,s.CullFaceMode=kn,s.DEMData=Nu,s.DataConstantProperty=et,s.DedupedRequest=Pm,s.DepthMode=il,s.EXTENT=At,s.Elevation=class{getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,r=!0){e==null&&(e=null);const n=this._source();if(!n||t.y<0||t.y>1)return e;const a=n.getSource().maxzoom,l=1<<a,h=Math.floor(t.x),p=t.x-h,m=new Mr(a,h,a,Math.floor(p*l),Math.floor(t.y*l)),y=this.findDEMTileFor(m);if(!y||!y.dem)return e;const v=y.dem,w=1<<y.tileID.canonical.z,T=(p*w-y.tileID.canonical.x)*v.dim,C=(t.y*w-y.tileID.canonical.y)*v.dim,P=Math.floor(T),B=Math.floor(C);return(r?this.exaggeration():1)*Xt(Xt(v.get(P,B),v.get(P,B+1),C-B),Xt(v.get(P+1,B),v.get(P+1,B+1),C-B),T-P)}getAtTileOffset(t,e,r){const n=1<<t.canonical.z;return this.getAtPointOrZero(new xu(t.wrap+(t.canonical.x+e/At)/n,(t.canonical.y+r/At)/n))}getAtTileOffsetFunc(t,e){return r=>{const n=this.getAtTileOffset(t,r.x,r.y),a=e.upVector(t.canonical,r.x,r.y);return mi(a,a,n*e.upVectorScale(t.canonical)),a}}getForTilePoints(t,e,r,n){const a=ju.create(this,t,n);return!!a&&(e.forEach(l=>{l[2]=this.exaggeration()*a.getElevationAt(l[0],l[1],r)}),!0)}getMinMaxForTile(t){const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const r=e.dem.tree,n=e.tileID,a=1<<t.canonical.z-n.canonical.z;let l=t.canonical.x/a-n.canonical.x,h=t.canonical.y/a-n.canonical.y,p=0;for(let m=0;m<t.canonical.z-n.canonical.z&&!r.leaves[p];m++){l*=2,h*=2;const y=2*Math.floor(h)+Math.floor(l);p=r.childOffsets[p]+y,l%=1,h%=1}return{min:this.exaggeration()*r.minimums[p],max:this.exaggeration()*r.maximums[p]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=la,s.EvaluationParameters=_t,s.Event=Un,s.Evented=Vn,s.Frustum=Kh,s.GLOBE_ZOOM_THRESHOLD_MAX=6,s.GlobeSharedBuffers=Dd,s.GlyphManager=el,s.ImagePosition=ud,s.LineAtlas=Td,s.LngLat=Qt,s.LngLatBounds=Gs,s.LocalGlyphMode=fd,s.MAX_MERCATOR_LATITUDE=Yn,s.MercatorCoordinate=xu,s.ONE_EM=rr,s.OverscaledTileID=Mr,s.Properties=Qi,s.RGBAImage=Qr,s.Ray=class{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(t,e,r){const n=Li(e,this.dir);if(Math.abs(n)<1e-6)return!1;const a=((t[0]-this.pos[0])*e[0]+(t[1]-this.pos[1])*e[1]+(t[2]-this.pos[2])*e[2])/n;return r[0]=this.pos[0]+this.dir[0]*a,r[1]=this.pos[1]+this.dir[1]*a,r[2]=this.pos[2]+this.dir[2]*a,!0}closestPointOnSphere(t,e,r){if(function(T,C){var P=T[0],B=T[1],O=T[2],Z=C[0],Y=C[1],ie=C[2];return Math.abs(P-Z)<=wt*Math.max(1,Math.abs(P),Math.abs(Z))&&Math.abs(B-Y)<=wt*Math.max(1,Math.abs(B),Math.abs(Y))&&Math.abs(O-ie)<=wt*Math.max(1,Math.abs(O),Math.abs(ie))}(this.pos,t)||e===0)return r[0]=r[1]=r[2]=0,!1;const[n,a,l]=this.dir,h=this.pos[0]-t[0],p=this.pos[1]-t[1],m=this.pos[2]-t[2],y=n*n+a*a+l*l,v=2*(h*n+p*a+m*l),w=v*v-4*y*(h*h+p*p+m*m-e*e);if(w<0){const T=Math.max(-v/2,0),C=h+n*T,P=p+a*T,B=m+l*T,O=Math.hypot(C,P,B);return r[0]=C*e/O,r[1]=P*e/O,r[2]=B*e/O,!1}{const T=(-v-Math.sqrt(w))/(2*y);if(T<0){const C=Math.hypot(h,p,m);return r[0]=h*e/C,r[1]=p*e/C,r[2]=m*e/C,!1}return r[0]=h+n*T,r[1]=p+a*T,r[2]=m+l*T,!0}}},s.RequestManager=class{constructor(t,e,r){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ne,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Ee(t))return t;const r=it(t);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Ee(t))return t;const r=it(t);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(t,e){if(!Ee(t))return t;const r=it(t);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||e)}normalizeSpriteURL(t,e,r,n){const a=it(t);return Ee(t)?(a.path=`/styles/v1${a.path}/sprite${e}${r}`,this._makeAPIURL(a,this._customAccessToken||n)):(a.path+=`${e}${r}`,lt(a))}normalizeTileURL(t,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ee(t))return t;const n=it(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&n.authority!=="raster"&&r===512?"@2x":""}${k.supported?".webp":"$1"}`),n.authority==="raster"?n.path=`/${M.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${M.TILE_URL_VERSION}${n.path}`);const a=this._customAccessToken||function(l){for(const h of l){const p=h.match(/^access_token=(.*)$/);if(p)return p[1]}return null}(n.params)||M.ACCESS_TOKEN;return M.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,a)}canonicalizeTileURL(t,e){const r=it(t);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return t;let n="mapbox://";r.path.match(/^\/raster\/v1\//)?n+=`raster/${r.path.replace(`/${M.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${r.path.replace(`/${M.TILE_URL_VERSION}/`,"")}`;let a=r.params;return e&&(a=a.filter(l=>!l.match(/^access_token=/))),a.length&&(n+=`?${a.join("&")}`),n}canonicalizeTileset(t,e){const r=!!e&&Ee(e),n=[];for(const a of t.tiles||[])Me(a)?n.push(this.canonicalizeTileURL(a,r)):n.push(a);return n}_makeAPIURL(t,e){const r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=it(M.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,t.protocol==="http"){const a=t.params.indexOf("secure");a>=0&&t.params.splice(a,1)}if(n.path!=="/"&&(t.path=`${n.path}${t.path}`),!M.REQUIRE_ACCESS_TOKEN)return lt(t);if(e=e||M.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return t.params=t.params.filter(a=>a.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),lt(t)}},s.ResourceType=sa,s.SegmentVector=Ci,s.SourceCache=qs,s.StencilMode=Id,s.StructArrayLayout1ui2=pu,s.StructArrayLayout2f1f2i16=Bh,s.StructArrayLayout2i4=Va,s.StructArrayLayout2ui4=Xo,s.StructArrayLayout3f12=ja,s.StructArrayLayout3ui6=Jr,s.StructArrayLayout4i8=Na,s.Texture=Uu,s.Tile=zd,s.Transitionable=Sr,s.Uniform1f=gu,s.Uniform1i=class extends go{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},s.Uniform2f=class extends go{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},s.Uniform3f=class extends go{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},s.Uniform4f=Hp,s.UniformColor=Kp,s.UniformMatrix2f=class extends go{constructor(t,e){super(t,e),this.current=yg}set(t){for(let e=0;e<4;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}},s.UniformMatrix3f=class extends go{constructor(t,e){super(t,e),this.current=gg}set(t){for(let e=0;e<9;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}},s.UniformMatrix4f=class extends go{constructor(t,e){super(t,e),this.current=_g}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},s.UnwrappedTileID=Ed,s.ValidationError=He,s.VectorTileWorkerSource=class extends Vn{constructor(t,e,r,n,a){super(),this.actor=t,this.layerIndex=e,this.availableImages=r,this.loadVectorData=a||km,this.loading={},this.loaded={},this.deduped=new Pm(t.scheduler),this.isSpriteLoaded=n,this.scheduler=t.scheduler}loadTile(t,e){const r=t.uid,n=t&&t.request,a=n&&n.collectResourceTiming,l=this.loading[r]=new vx(t);l.abort=this.loadVectorData(t,(h,p)=>{const m=!this.loading[r];if(delete this.loading[r],m||h||!p)return l.status="done",m||(this.loaded[r]=l),e(h);const y=p.rawData,v={};p.expires&&(v.expires=p.expires),p.cacheControl&&(v.cacheControl=p.cacheControl),l.vectorTile=p.vectorTile||new Zs.VectorTile(new oc(y));const w=()=>{l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,(T,C)=>{if(T||!C)return e(T);const P={};if(a){const B=am(n);B.length>0&&(P.resourceTiming=JSON.parse(JSON.stringify(B)))}e(null,Je({rawTileData:y.slice(0)},C,v,P))})};this.isSpriteLoaded?w():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(w,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):w()}),this.loaded=this.loaded||{},this.loaded[r]=l})}reloadTile(t,e){const r=this.loaded,n=t.uid,a=this;if(r&&r[n]){const l=r[n];l.showCollisionBoxes=t.showCollisionBoxes,l.enableTerrain=!!t.enableTerrain,l.projection=t.projection;const h=(p,m)=>{const y=l.reloadCallback;y&&(delete l.reloadCallback,l.parse(l.vectorTile,a.layerIndex,this.availableImages,a.actor,y)),e(p,m)};l.status==="parsing"?l.reloadCallback=h:l.status==="done"&&(l.vectorTile?l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,h):h())}}abortTile(t,e){const r=t.uid,n=this.loading[r];n&&(n.abort&&n.abort(),delete this.loading[r]),e()}removeTile(t,e){const r=this.loaded,n=t.uid;r&&r[n]&&delete r[n],e()}},s.WritingMode=en,s.ZoomHistory=c,s.add=Ki,s.addDynamicAttributes=yd,s.adjoint=function(t,e){var r=e[0],n=e[1],a=e[2],l=e[3],h=e[4],p=e[5],m=e[6],y=e[7],v=e[8];return t[0]=h*v-p*y,t[1]=a*y-n*v,t[2]=n*p-a*h,t[3]=p*m-l*v,t[4]=r*v-a*m,t[5]=a*l-r*p,t[6]=l*y-h*m,t[7]=n*m-r*y,t[8]=r*h-n*l,t},s.asyncAll=at,s.bezier=qe,s.bindAll=Ni,s.boundsAttributes=Cd,s.bufferConvexPolygon=function(t,e){const r=[];for(let n=0;n<t.length;n++){const a=Ne(n-1,-1,t.length-1),l=Ne(n+1,-1,t.length-1),h=t[n],p=t[l],m=t[a].sub(h).unit(),y=p.sub(h).unit(),v=y.angleWithSep(m.x,m.y),w=m.add(y).unit().mult(-1*e/Math.sin(v/2));r.push(h.add(w))}return r},s.cacheEntryPossiblyAdded=function(t){oa++,oa>gl&&(t.getActor().send("enforceCacheSizeLimit",Sc),oa=0)},s.calculateGlobeMatrix=Cm,s.calculateGlobeMercatorMatrix=function(t){const e=t.worldSize,r=ze(t.center.lat,-85.051129,Yn),n=new _e($a(t.center.lng)*e,Za(r)*e),a=zn(1,t.center.lat)*e,l=t.pixelsPerMeter,h=e/(a/t.pixelsPerMeter),p=yt(new Float64Array(16));return ai(p,p,[n.x,n.y,0]),Wt(p,p,[h,h,l]),p},s.clamp=ze,s.clearTileCache=function(t){const e=fe.caches.delete(Yi);t&&e.catch(t).then(()=>t())},s.clipLine=Xf,s.clone=function(t){var e=new dt(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},s.clone$1=or,s.collisionCircleLayout=Ey,s.config=M,s.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},s.create=function(){var t=new dt(16);return dt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},s.create$1=xt,s.createExpression=Ds,s.createLayout=xi,s.createStyleLayer=function(t){return t.type==="custom"?new ax(t):new cx[t.type](t)},s.cross=nn,s.degToRad=re,s.div=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},s.dot=Li,s.ease=Qe,s.easeCubicInOut=Fe,s.emitValidationErrors=lu,s.endsWith=wr,s.enforceCacheSizeLimit=function(t){ps(),cn&&cn.then(e=>{e.keys().then(r=>{for(let n=0;n<r.length-t;n++)e.delete(r[n])})})},s.evaluateSizeForFeature=Cu,s.evaluateSizeForZoom=Ka,s.evaluateVariableOffset=Qf,s.evented=fr,s.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},s.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},s.exported=Tr,s.exported$1=k,s.extend=Je,s.extend$1=Nn,s.filterObject=kr,s.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},s.fromQuat=function(t,e){var r=e[0],n=e[1],a=e[2],l=e[3],h=r+r,p=n+n,m=a+a,y=r*h,v=n*h,w=n*p,T=a*h,C=a*p,P=a*m,B=l*h,O=l*p,Z=l*m;return t[0]=1-w-P,t[1]=v+Z,t[2]=T-O,t[3]=0,t[4]=v-Z,t[5]=1-y-P,t[6]=C+B,t[7]=0,t[8]=T+O,t[9]=C-B,t[10]=1-y-w,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},s.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},s.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},s.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return Re[e]},s.getAABBPointSquareDist=function(t,e,r){let n=0;for(let a=0;a<2;++a){const l=r?r[a]:0;t[a]>l&&(n+=(t[a]-l)*(t[a]-l)),e[a]<l&&(n+=(l-e[a])*(l-e[a]))}return n},s.getAnchorAlignment=pd,s.getAnchorJustification=_d,s.getBounds=function(t){let e=1/0,r=1/0,n=-1/0,a=-1/0;for(const l of t)e=Math.min(e,l.x),r=Math.min(r,l.y),n=Math.max(n,l.x),a=Math.max(a,l.y);return{min:new _e(e,r),max:new _e(n,a)}},s.getColumn=function(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]},s.getImage=Mc,s.getJSON=function(t,e){return Wr(Je(t,{type:"json"}),e)},s.getMapSessionAPI=On,s.getPerformanceMeasurement=am,s.getProjection=function(t){const e=Bm[t.name];if(!e)throw new Error(`Invalid projection name: ${t.name}`);return e.conic?function(r,n){if(n.parallels&&Math.abs(n.parallels[0]+n.parallels[1])<.01){let a=function(l){const h=Math.max(.01,Math.cos(re(l))),p=1/(2*Math.max(Math.PI*h,1/h));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(m,y){const v=re(m)*h,w=Math.sin(re(y))/h;return{x:v*p+.5,y:-w*p+.5,z:0}},unproject(m,y){const v=-(y-.5)/p,w=ze(ye((m-.5)/p)/h,-180,180),T=Math.asin(ze(v*h,-1,1)),C=ze(ye(T),-85.051129,Yn);return new Qt(w,C)}}}(n.parallels[0]);if(n.name==="lambertConformalConic"){const{project:l,unproject:h}=Bm.mercator;a={wrap:!0,supportsWorldCopies:!0,project:l,unproject:h}}return Je({},r,n,a)}return Je({},r,n)}(e,t):e},s.getRTLTextPluginStatus=Fr,s.getReferrer=xl,s.getTilePoint=function(t,{x:e,y:r},n=0){return new _e(((e-n)*t.scale-t.x)*At,(r*t.scale-t.y)*At)},s.getTileVec3=function(t,e,r=0){return wi(((e.x-r)*t.scale-t.x)*At,(e.y*t.scale-t.y)*At,tf(e.z,e.y))},s.getVideo=function(t,e){const r=fe.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let n=0;n<t.length;n++){const a=fe.document.createElement("source");Ic(t[n])||(r.crossOrigin="Anonymous"),a.src=t[n],r.appendChild(a)}return{cancel:()=>{}}},s.globeBuffersForTileMesh=function(t,e,r,n){const a=t.context,l=t.transform;let h=e.globeGridBuffer,p=e.globePoleBuffer;if(!h){const m=Dd.createGridVertices(r.canonical);h=e.globeGridBuffer=a.createVertexBuffer(m,Sm,!1)}if(!p){const m=Dd.createPoleTriangleVertices(n,l.tileSize*n,r.canonical.y===0);p=e.globePoleBuffer=a.createVertexBuffer(m,Sm,!1)}return[h,p]},s.globeDenormalizeECEF=Am,s.globeMatrixForTile=function(t,e){const r=Am($u(t)),n=((a=new Float64Array(16))[0]=(l=e)[0],a[1]=l[1],a[2]=l[2],a[3]=l[3],a[4]=l[4],a[5]=l[5],a[6]=l[6],a[7]=l[7],a[8]=l[8],a[9]=l[9],a[10]=l[10],a[11]=l[11],a[12]=l[12],a[13]=l[13],a[14]=l[14],a[15]=l[15],a);var a,l;return Vt(n,n,r),n},s.globePoleMatrixForTile=function(t,e,r){const n=yt(new Float64Array(16)),a=Math.pow(2,t.z),l=(t.x-a/2)/a*Math.PI*2,h=r.point,p=r.worldSize/(r.tileSize*a);return ai(n,n,[h.x,h.y,-r.worldSize/Math.PI/2]),Wt(n,n,[p,p,p]),Di(n,n,re(-r._center.lat)),Vi(n,n,re(-r._center.lng)),Vi(n,n,l),e&&Wt(n,n,[1,-1,1]),n},s.globeTileBounds=$u,s.globeToMercatorTransition=function(t){return We(5,6,t)},s.identity=yt,s.identity$1=co,s.invert=function(t,e){var r=e[0],n=e[1],a=e[2],l=e[3],h=e[4],p=e[5],m=e[6],y=e[7],v=e[8],w=e[9],T=e[10],C=e[11],P=e[12],B=e[13],O=e[14],Z=e[15],Y=r*p-n*h,ie=r*m-a*h,se=r*y-l*h,ae=n*m-a*p,le=n*y-l*p,Te=a*y-l*m,be=v*B-w*P,$e=v*O-T*P,Oe=v*Z-C*P,we=w*O-T*B,Ve=w*Z-C*B,Ze=T*Z-C*O,Ce=Y*Ze-ie*Ve+se*we+ae*Oe-le*$e+Te*be;return Ce?(t[0]=(p*Ze-m*Ve+y*we)*(Ce=1/Ce),t[1]=(a*Ve-n*Ze-l*we)*Ce,t[2]=(B*Te-O*le+Z*ae)*Ce,t[3]=(T*le-w*Te-C*ae)*Ce,t[4]=(m*Oe-h*Ze-y*$e)*Ce,t[5]=(r*Ze-a*Oe+l*$e)*Ce,t[6]=(O*se-P*Te-Z*ie)*Ce,t[7]=(v*Te-T*se+C*ie)*Ce,t[8]=(h*Ve-p*Oe+y*be)*Ce,t[9]=(n*Oe-r*Ve-l*be)*Ce,t[10]=(P*le-B*se+Z*Y)*Ce,t[11]=(w*se-v*le-C*Y)*Ce,t[12]=(p*$e-h*we-m*be)*Ce,t[13]=(r*we-n*$e+a*be)*Ce,t[14]=(B*ie-P*ae-O*Y)*Ce,t[15]=(v*ae-w*ie+T*Y)*Ce,t):null},s.isMapAuthenticated=function(t){return Tn.has(t)},s.isMapboxURL=Ee,s.latFromMercatorY=mn,s.len=Bn,s.length=tr,s.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},s.loadVectorTile=km,s.makeRequest=Wr,s.mercatorXfromLng=$a,s.mercatorYfromLat=Za,s.mercatorZfromAltitude=zn,s.mul=Vt,s.mul$1=ds,s.multiply=function(t,e,r){var n=e[0],a=e[1],l=e[2],h=e[3],p=e[4],m=e[5],y=e[6],v=e[7],w=e[8],T=r[0],C=r[1],P=r[2],B=r[3],O=r[4],Z=r[5],Y=r[6],ie=r[7],se=r[8];return t[0]=T*n+C*h+P*y,t[1]=T*a+C*p+P*v,t[2]=T*l+C*m+P*w,t[3]=B*n+O*h+Z*y,t[4]=B*a+O*p+Z*v,t[5]=B*l+O*m+Z*w,t[6]=Y*n+ie*h+se*y,t[7]=Y*a+ie*p+se*v,t[8]=Y*l+ie*m+se*w,t},s.multiply$1=Ui,s.multiply$2=vn,s.nextPowerOfTwo=Mt,s.normalize=Ht,s.normalize$1=function(t,e){var r=e[0],n=e[1],a=e[2],l=e[3],h=r*r+n*n+a*a+l*l;return h>0&&(h=1/Math.sqrt(h)),t[0]=r*h,t[1]=n*h,t[2]=a*h,t[3]=l*h,t},s.number=Xt,s.ortho=function(t,e,r,n,a,l,h){var p=1/(e-r),m=1/(n-a),y=1/(l-h);return t[0]=-2*p,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*y,t[11]=0,t[12]=(e+r)*p,t[13]=(a+n)*m,t[14]=(h+l)*y,t[15]=1,t},s.pbf=oc,s.perspective=function(t,e,r,n,a){var l,h=1/Math.tan(e/2);return t[0]=h/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(t[10]=(a+n)*(l=1/(n-a)),t[14]=2*a*n*l):(t[10]=-1,t[14]=-2*n),t},s.pick=function(t,e){const r={};for(let n=0;n<e.length;n++){const a=e[n];a in t&&(r[a]=t[a])}return r},s.plugin=Lt,s.pointGeometry=_e,s.polygonIntersectsBox=lf,s.polygonIntersectsPolygon=nf,s.polygonizeBounds=function(t,e,r=0,n=!0){const a=new _e(r,r),l=t.sub(a),h=e.add(a),p=[l,new _e(h.x,l.y),h,new _e(l.x,h.y)];return n&&p.push(l),p},s.posAttributes=_x,s.postMapLoadEvent=ii,s.postTurnstileEvent=si,s.potpack=cd,s.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},s.radToDeg=ye,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(t){return t({pluginStatus:pt,pluginURL:It}),fr.on("pluginStateChange",t),t},s.removeAuthState=function(t){Tn.delete(t)},s.renderColorRamp=Qh,s.rotateX=Di,s.rotateX$1=$r,s.rotateY=Vi,s.rotateZ=function(t,e,r){var n=Math.sin(r),a=Math.cos(r),l=e[0],h=e[1],p=e[2],m=e[3],y=e[4],v=e[5],w=e[6],T=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=l*a+y*n,t[1]=h*a+v*n,t[2]=p*a+w*n,t[3]=m*a+T*n,t[4]=y*a-l*n,t[5]=v*a-h*n,t[6]=w*a-p*n,t[7]=T*a-m*n,t},s.rotateZ$1=function(t,e,r){r*=.5;var n=e[0],a=e[1],l=e[2],h=e[3],p=Math.sin(r),m=Math.cos(r);return t[0]=n*m+a*p,t[1]=a*m-n*p,t[2]=l*m+h*p,t[3]=h*m-l*p,t},s.scale=Wt,s.scale$1=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},s.scale$2=mi,s.scaleAndAdd=Nt,s.setCacheLimits=function(t,e){Sc=t,gl=e},s.setColumn=function(t,e,r){t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},s.setRTLTextPlugin=function(t,e,r=!1){if(pt===ot||pt===mt||pt===Kt)throw new Error("setRTLTextPlugin cannot be called multiple times.");It=Tr.resolveURL(t),pt=ot,ri=e,Ri(),r||Yr()},s.smoothstep=We,s.spec=xe,s.storeAuthState=function(t,e){e?Tn.add(t):Tn.delete(t)},s.sub=on,s.subtract=br,s.symbolSize=Sy,s.tileAABB=function(t,e,r,n,a,l,h,p,m){if(m.name==="globe"){const C=$u(new Ed(l,new Vu(r,n,a)).canonical).getCorners(),P=Number.MAX_VALUE,B=[-P,-P,-P],O=[P,P,P],Z=Cm(t,e);for(let Y=0;Y<C.length;Y++)vt(C[Y],C[Y],Z),v=O,w=C[Y],(y=O)[0]=Math.min(v[0],w[0]),y[1]=Math.min(v[1],w[1]),y[2]=Math.min(v[2],w[2]),lo(B,B,C[Y]);return new Pn(O,B)}var y,v,w;const T=rl({z:r,x:n,y:a},m);return new Pn([(l+T.x/T.scale)*e,e*(T.y/T.scale),h],[(l+T.x2/T.scale)*e,e*(T.y2/T.scale),p])},s.tileTransform=rl,s.transformMat3=function(t,e,r){var n=e[0],a=e[1],l=e[2];return t[0]=n*r[0]+a*r[3]+l*r[6],t[1]=n*r[1]+a*r[4]+l*r[7],t[2]=n*r[2]+a*r[5]+l*r[8],t},s.transformMat4=vt,s.transformMat4$1=Bi,s.transformQuat=Gr,s.translate=ai,s.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},s.triggerPluginCompletionEvent=pi,s.uniqueId=Ct,s.validateCustomStyleLayer=function(t){const e=[],r=t.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},s.validateFog=Ch,s.validateLight=$o,s.validateStyle=Go,s.values=nt,s.vectorTile=Zs,s.version=pe,s.warnOnce=jt,s.window=fe,s.wrap=Ne}),j(["./shared"],function(s){function pe($){const M=typeof $;if(M==="number"||M==="boolean"||M==="string"||$==null)return JSON.stringify($);if(Array.isArray($)){let q="[";for(const te of $)q+=`${pe(te)},`;return`${q}]`}const k=Object.keys($).sort();let G="{";for(let q=0;q<k.length;q++)G+=`${JSON.stringify(k[q])}:${pe($[k[q]])},`;return`${G}}`}function Ie($){let M="";for(const k of s.refProperties)M+=`/${pe($[k])}`;return M}class Ue{constructor(M){this.keyCache={},M&&this.replace(M)}replace(M){this._layerConfigs={},this._layers={},this.update(M,[])}update(M,k){for(const q of M)this._layerConfigs[q.id]=q,(this._layers[q.id]=s.createStyleLayer(q)).compileFilter(),this.keyCache[q.id]&&delete this.keyCache[q.id];for(const q of k)delete this.keyCache[q],delete this._layerConfigs[q],delete this._layers[q];this.familiesBySource={};const G=function(q,te){const ce={};for(let ne=0;ne<q.length;ne++){const de=te&&te[q[ne].id]||Ie(q[ne]);te&&(te[q[ne].id]=de);let Ee=ce[de];Ee||(Ee=ce[de]=[]),Ee.push(q[ne])}const ue=[];for(const ne in ce)ue.push(ce[ne]);return ue}(s.values(this._layerConfigs),this.keyCache);for(const q of G){const te=q.map(Me=>this._layers[Me.id]),ce=te[0];if(ce.visibility==="none")continue;const ue=ce.source||"";let ne=this.familiesBySource[ue];ne||(ne=this.familiesBySource[ue]={});const de=ce.sourceLayer||"_geojsonTileLayer";let Ee=ne[de];Ee||(Ee=ne[de]=[]),Ee.push(te)}}}const{ImageBitmap:_e}=s.window;class Le{loadTile(M,k){const{uid:G,encoding:q,rawImageData:te,padding:ce,buildQuadTree:ue}=M,ne=_e&&te instanceof _e?this.getImageData(te,ce):te;k(null,new s.DEMData(G,ne,q,ce<1,ue))}getImageData(M,k){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(M.width,M.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=M.width,this.offscreenCanvas.height=M.height,this.offscreenCanvasContext.drawImage(M,0,0,M.width,M.height);const G=this.offscreenCanvasContext.getImageData(-k,-k,M.width+2*k,M.height+2*k);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new s.RGBAImage({width:G.width,height:G.height},G.data)}}var fe=function $(M,k){var G,q=M&&M.type;if(q==="FeatureCollection")for(G=0;G<M.features.length;G++)$(M.features[G],k);else if(q==="GeometryCollection")for(G=0;G<M.geometries.length;G++)$(M.geometries[G],k);else if(q==="Feature")$(M.geometry,k);else if(q==="Polygon")wt(M.coordinates,k);else if(q==="MultiPolygon")for(G=0;G<M.coordinates.length;G++)wt(M.coordinates[G],k);return M};function wt($,M){if($.length!==0){dt($[0],M);for(var k=1;k<$.length;k++)dt($[k],!M)}}function dt($,M){for(var k=0,G=0,q=0,te=$.length,ce=te-1;q<te;ce=q++){var ue=($[q][0]-$[ce][0])*($[ce][1]+$[q][1]),ne=k+ue;G+=Math.abs(k)>=Math.abs(ue)?k-ne+ue:ue-ne+k,k=ne}k+G>=0!=!!M&&$.reverse()}const xt=s.vectorTile.VectorTileFeature.prototype.toGeoJSON;class yt{constructor(M){this._feature=M,this.extent=s.EXTENT,this.type=M.type,this.properties=M.tags,"id"in M&&!isNaN(M.id)&&(this.id=parseInt(M.id,10))}loadGeometry(){if(this._feature.type===1){const M=[];for(const k of this._feature.geometry)M.push([new s.pointGeometry(k[0],k[1])]);return M}{const M=[];for(const k of this._feature.geometry){const G=[];for(const q of k)G.push(new s.pointGeometry(q[0],q[1]));M.push(G)}return M}}toGeoJSON(M,k,G){return xt.call(this,M,k,G)}}class Ui{constructor(M){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=M.length,this._features=M}feature(M){return new yt(this._features[M])}}var ai=s.vectorTile.VectorTileFeature,Wt=Di;function Di($,M){this.options=M||{},this.features=$,this.length=$.length}function Vi($,M){this.id=typeof $.id=="number"?$.id:void 0,this.type=$.type,this.rawGeometry=$.type===1?[$.geometry]:$.geometry,this.properties=$.tags,this.extent=M||4096}Di.prototype.feature=function($){return new Vi(this.features[$],this.options.extent)},Vi.prototype.loadGeometry=function(){var $=this.rawGeometry;this.geometry=[];for(var M=0;M<$.length;M++){for(var k=$[M],G=[],q=0;q<k.length;q++)G.push(new s.pointGeometry(k[q][0],k[q][1]));this.geometry.push(G)}return this.geometry},Vi.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var $=this.geometry,M=1/0,k=-1/0,G=1/0,q=-1/0,te=0;te<$.length;te++)for(var ce=$[te],ue=0;ue<ce.length;ue++){var ne=ce[ue];M=Math.min(M,ne.x),k=Math.max(k,ne.x),G=Math.min(G,ne.y),q=Math.max(q,ne.y)}return[M,G,k,q]},Vi.prototype.toGeoJSON=ai.prototype.toGeoJSON;var Vt=li,bi=Wt;function li($){var M=new s.pbf;return function(k,G){for(var q in k.layers)G.writeMessage(3,tr,k.layers[q])}($,M),M.finish()}function tr($,M){var k;M.writeVarintField(15,$.version||1),M.writeStringField(1,$.name||""),M.writeVarintField(5,$.extent||4096);var G={keys:[],values:[],keycache:{},valuecache:{}};for(k=0;k<$.length;k++)G.feature=$.feature(k),M.writeMessage(2,wi,G);var q=G.keys;for(k=0;k<q.length;k++)M.writeStringField(3,q[k]);var te=G.values;for(k=0;k<te.length;k++)M.writeMessage(4,mi,te[k])}function wi($,M){var k=$.feature;k.id!==void 0&&M.writeVarintField(1,k.id),M.writeMessage(2,Ki,$),M.writeVarintField(3,k.type),M.writeMessage(4,lo,k)}function Ki($,M){var k=$.feature,G=$.keys,q=$.values,te=$.keycache,ce=$.valuecache;for(var ue in k.properties){var ne=k.properties[ue],de=te[ue];if(ne!==null){de===void 0&&(G.push(ue),te[ue]=de=G.length-1),M.writeVarint(de);var Ee=typeof ne;Ee!=="string"&&Ee!=="boolean"&&Ee!=="number"&&(ne=JSON.stringify(ne));var Me=Ee+":"+ne,ke=ce[Me];ke===void 0&&(q.push(ne),ce[Me]=ke=q.length-1),M.writeVarint(ke)}}}function br($,M){return(M<<3)+(7&$)}function vn($){return $<<1^$>>31}function lo($,M){for(var k=$.loadGeometry(),G=$.type,q=0,te=0,ce=k.length,ue=0;ue<ce;ue++){var ne=k[ue],de=1;G===1&&(de=ne.length),M.writeVarint(br(1,de));for(var Ee=G===3?ne.length-1:ne.length,Me=0;Me<Ee;Me++){Me===1&&G!==1&&M.writeVarint(br(2,Ee-1));var ke=ne[Me].x-q,it=ne[Me].y-te;M.writeVarint(vn(ke)),M.writeVarint(vn(it)),q+=ke,te+=it}G===3&&M.writeVarint(br(7,1))}}function mi($,M){var k=typeof $;k==="string"?M.writeStringField(1,$):k==="boolean"?M.writeBooleanField(7,$):k==="number"&&($%1!=0?M.writeDoubleField(3,$):$<0?M.writeSVarintField(6,$):M.writeVarintField(5,$))}function Nt($,M,k,G,q,te){if(q-G<=k)return;const ce=G+q>>1;Ht($,M,ce,G,q,te%2),Nt($,M,k,G,ce-1,te+1),Nt($,M,k,ce+1,q,te+1)}function Ht($,M,k,G,q,te){for(;q>G;){if(q-G>600){const de=q-G+1,Ee=k-G+1,Me=Math.log(de),ke=.5*Math.exp(2*Me/3),it=.5*Math.sqrt(Me*ke*(de-ke)/de)*(Ee-de/2<0?-1:1);Ht($,M,k,Math.max(G,Math.floor(k-Ee*ke/de+it)),Math.min(q,Math.floor(k+(de-Ee)*ke/de+it)),te)}const ce=M[2*k+te];let ue=G,ne=q;for(Li($,M,G,k),M[2*q+te]>ce&&Li($,M,G,q);ue<ne;){for(Li($,M,ue,ne),ue++,ne--;M[2*ue+te]<ce;)ue++;for(;M[2*ne+te]>ce;)ne--}M[2*G+te]===ce?Li($,M,G,ne):(ne++,Li($,M,ne,q)),ne<=k&&(G=ne+1),k<=ne&&(q=ne-1)}}function Li($,M,k,G){nn($,k,G),nn(M,2*k,2*G),nn(M,2*k+1,2*G+1)}function nn($,M,k){const G=$[M];$[M]=$[k],$[k]=G}function vt($,M,k,G){const q=$-k,te=M-G;return q*q+te*te}Vt.fromVectorTileJs=li,Vt.fromGeojsonVt=function($,M){M=M||{};var k={};for(var G in $)k[G]=new Wt($[G].features,M),k[G].name=G,k[G].version=M.version,k[G].extent=M.extent;return li({layers:k})},Vt.GeoJSONWrapper=bi;const Gr=$=>$[0],ir=$=>$[1];class on{constructor(M,k=Gr,G=ir,q=64,te=Float64Array){this.nodeSize=q,this.points=M;const ce=M.length<65536?Uint16Array:Uint32Array,ue=this.ids=new ce(M.length),ne=this.coords=new te(2*M.length);for(let de=0;de<M.length;de++)ue[de]=de,ne[2*de]=k(M[de]),ne[2*de+1]=G(M[de]);Nt(ue,ne,q,0,ue.length-1,0)}range(M,k,G,q){return function(te,ce,ue,ne,de,Ee,Me){const ke=[0,te.length-1,0],it=[];let lt,ct;for(;ke.length;){const ht=ke.pop(),St=ke.pop(),si=ke.pop();if(St-si<=Me){for(let di=si;di<=St;di++)lt=ce[2*di],ct=ce[2*di+1],lt>=ue&&lt<=de&&ct>=ne&&ct<=Ee&&it.push(te[di]);continue}const hi=Math.floor((si+St)/2);lt=ce[2*hi],ct=ce[2*hi+1],lt>=ue&&lt<=de&&ct>=ne&&ct<=Ee&&it.push(te[hi]);const ii=(ht+1)%2;(ht===0?ue<=lt:ne<=ct)&&(ke.push(si),ke.push(hi-1),ke.push(ii)),(ht===0?de>=lt:Ee>=ct)&&(ke.push(hi+1),ke.push(St),ke.push(ii))}return it}(this.ids,this.coords,M,k,G,q,this.nodeSize)}within(M,k,G){return function(q,te,ce,ue,ne,de){const Ee=[0,q.length-1,0],Me=[],ke=ne*ne;for(;Ee.length;){const it=Ee.pop(),lt=Ee.pop(),ct=Ee.pop();if(lt-ct<=de){for(let ii=ct;ii<=lt;ii++)vt(te[2*ii],te[2*ii+1],ce,ue)<=ke&&Me.push(q[ii]);continue}const ht=Math.floor((ct+lt)/2),St=te[2*ht],si=te[2*ht+1];vt(St,si,ce,ue)<=ke&&Me.push(q[ht]);const hi=(it+1)%2;(it===0?ce-ne<=St:ue-ne<=si)&&(Ee.push(ct),Ee.push(ht-1),Ee.push(hi)),(it===0?ce+ne>=St:ue+ne>=si)&&(Ee.push(ht+1),Ee.push(lt),Ee.push(hi))}return Me}(this.ids,this.coords,M,k,G,this.nodeSize)}}const ds={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:$=>$},Bn=Math.fround||(Bi=new Float32Array(1),$=>(Bi[0]=+$,Bi[0]));var Bi;class sn{constructor(M){this.options=Re(Object.create(ds),M),this.trees=new Array(this.options.maxZoom+1)}load(M){const{log:k,minZoom:G,maxZoom:q,nodeSize:te}=this.options;k&&console.time("total time");const ce=`prepare ${M.length} points`;k&&console.time(ce),this.points=M;let ue=[];for(let ne=0;ne<M.length;ne++)M[ne].geometry&&ue.push($r(M[ne],ne));this.trees[q+1]=new on(ue,Fe,qe,te,Float32Array),k&&console.timeEnd(ce);for(let ne=q;ne>=G;ne--){const de=+Date.now();ue=this._cluster(ue,ne),this.trees[ne]=new on(ue,Fe,qe,te,Float32Array),k&&console.log("z%d: %d clusters in %dms",ne,ue.length,+Date.now()-de)}return k&&console.timeEnd("total time"),this}getClusters(M,k){let G=((M[0]+180)%360+360)%360-180;const q=Math.max(-90,Math.min(90,M[1]));let te=M[2]===180?180:((M[2]+180)%360+360)%360-180;const ce=Math.max(-90,Math.min(90,M[3]));if(M[2]-M[0]>=360)G=-180,te=180;else if(G>te){const Ee=this.getClusters([G,q,180,ce],k),Me=this.getClusters([-180,q,te,ce],k);return Ee.concat(Me)}const ue=this.trees[this._limitZoom(k)],ne=ue.range(ee(G),re(ce),ee(te),re(q)),de=[];for(const Ee of ne){const Me=ue.points[Ee];de.push(Me.numPoints?bn(Me):this.points[Me.index])}return de}getChildren(M){const k=this._getOriginId(M),G=this._getOriginZoom(M),q="No cluster with the specified id.",te=this.trees[G];if(!te)throw new Error(q);const ce=te.points[k];if(!ce)throw new Error(q);const ue=this.options.radius/(this.options.extent*Math.pow(2,G-1)),ne=te.within(ce.x,ce.y,ue),de=[];for(const Ee of ne){const Me=te.points[Ee];Me.parentId===M&&de.push(Me.numPoints?bn(Me):this.points[Me.index])}if(de.length===0)throw new Error(q);return de}getLeaves(M,k,G){const q=[];return this._appendLeaves(q,M,k=k||10,G=G||0,0),q}getTile(M,k,G){const q=this.trees[this._limitZoom(M)],te=Math.pow(2,M),{extent:ce,radius:ue}=this.options,ne=ue/ce,de=(G-ne)/te,Ee=(G+1+ne)/te,Me={features:[]};return this._addTileFeatures(q.range((k-ne)/te,de,(k+1+ne)/te,Ee),q.points,k,G,te,Me),k===0&&this._addTileFeatures(q.range(1-ne/te,de,1,Ee),q.points,te,G,te,Me),k===te-1&&this._addTileFeatures(q.range(0,de,ne/te,Ee),q.points,-1,G,te,Me),Me.features.length?Me:null}getClusterExpansionZoom(M){let k=this._getOriginZoom(M)-1;for(;k<=this.options.maxZoom;){const G=this.getChildren(M);if(k++,G.length!==1)break;M=G[0].properties.cluster_id}return k}_appendLeaves(M,k,G,q,te){const ce=this.getChildren(k);for(const ue of ce){const ne=ue.properties;if(ne&&ne.cluster?te+ne.point_count<=q?te+=ne.point_count:te=this._appendLeaves(M,ne.cluster_id,G,q,te):te<q?te++:M.push(ue),M.length===G)break}return te}_addTileFeatures(M,k,G,q,te,ce){for(const ue of M){const ne=k[ue],de=ne.numPoints;let Ee,Me,ke;if(de)Ee=Rn(ne),Me=ne.x,ke=ne.y;else{const ct=this.points[ne.index];Ee=ct.properties,Me=ee(ct.geometry.coordinates[0]),ke=re(ct.geometry.coordinates[1])}const it={type:1,geometry:[[Math.round(this.options.extent*(Me*te-G)),Math.round(this.options.extent*(ke*te-q))]],tags:Ee};let lt;de?lt=ne.id:this.options.generateId?lt=ne.index:this.points[ne.index].id&&(lt=this.points[ne.index].id),lt!==void 0&&(it.id=lt),ce.features.push(it)}}_limitZoom(M){return Math.max(this.options.minZoom,Math.min(+M,this.options.maxZoom+1))}_cluster(M,k){const G=[],{radius:q,extent:te,reduce:ce,minPoints:ue}=this.options,ne=q/(te*Math.pow(2,k));for(let de=0;de<M.length;de++){const Ee=M[de];if(Ee.zoom<=k)continue;Ee.zoom=k;const Me=this.trees[k+1],ke=Me.within(Ee.x,Ee.y,ne),it=Ee.numPoints||1;let lt=it;for(const ct of ke){const ht=Me.points[ct];ht.zoom>k&&(lt+=ht.numPoints||1)}if(lt>it&&lt>=ue){let ct=Ee.x*it,ht=Ee.y*it,St=ce&&it>1?this._map(Ee,!0):null;const si=(de<<5)+(k+1)+this.points.length;for(const hi of ke){const ii=Me.points[hi];if(ii.zoom<=k)continue;ii.zoom=k;const di=ii.numPoints||1;ct+=ii.x*di,ht+=ii.y*di,ii.parentId=si,ce&&(St||(St=this._map(Ee,!0)),ce(St,this._map(ii)))}Ee.parentId=si,G.push(co(ct/lt,ht/lt,si,lt,St))}else if(G.push(Ee),lt>1)for(const ct of ke){const ht=Me.points[ct];ht.zoom<=k||(ht.zoom=k,G.push(ht))}}return G}_getOriginId(M){return M-this.points.length>>5}_getOriginZoom(M){return(M-this.points.length)%32}_map(M,k){if(M.numPoints)return k?Re({},M.properties):M.properties;const G=this.points[M.index].properties,q=this.options.map(G);return k&&q===G?Re({},q):q}}function co($,M,k,G,q){return{x:Bn($),y:Bn(M),zoom:1/0,id:k,parentId:-1,numPoints:G,properties:q}}function $r($,M){const[k,G]=$.geometry.coordinates;return{x:Bn(ee(k)),y:Bn(re(G)),zoom:1/0,index:M,parentId:-1}}function bn($){return{type:"Feature",id:$.id,properties:Rn($),geometry:{type:"Point",coordinates:[(M=$.x,360*(M-.5)),ye($.y)]}};var M}function Rn($){const M=$.numPoints,k=M>=1e4?`${Math.round(M/1e3)}k`:M>=1e3?Math.round(M/100)/10+"k":M;return Re(Re({},$.properties),{cluster:!0,cluster_id:$.id,point_count:M,point_count_abbreviated:k})}function ee($){return $/360+.5}function re($){const M=Math.sin($*Math.PI/180),k=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return k<0?0:k>1?1:k}function ye($){const M=(180-360*$)*Math.PI/180;return 360*Math.atan(Math.exp(M))/Math.PI-90}function Re($,M){for(const k in M)$[k]=M[k];return $}function Fe($){return $.x}function qe($){return $.y}function Qe($,M,k,G){for(var q,te=G,ce=k-M>>1,ue=k-M,ne=$[M],de=$[M+1],Ee=$[k],Me=$[k+1],ke=M+3;ke<k;ke+=3){var it=ze($[ke],$[ke+1],ne,de,Ee,Me);if(it>te)q=ke,te=it;else if(it===te){var lt=Math.abs(ke-ce);lt<ue&&(q=ke,ue=lt)}}te>G&&(q-M>3&&Qe($,M,q,G),$[q+2]=te,k-q>3&&Qe($,q,k,G))}function ze($,M,k,G,q,te){var ce=q-k,ue=te-G;if(ce!==0||ue!==0){var ne=(($-k)*ce+(M-G)*ue)/(ce*ce+ue*ue);ne>1?(k=q,G=te):ne>0&&(k+=ce*ne,G+=ue*ne)}return(ce=$-k)*ce+(ue=M-G)*ue}function We($,M,k,G){var q={id:$===void 0?null:$,type:M,geometry:k,tags:G,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(te){var ce=te.geometry,ue=te.type;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")Ne(te,ce);else if(ue==="Polygon"||ue==="MultiLineString")for(var ne=0;ne<ce.length;ne++)Ne(te,ce[ne]);else if(ue==="MultiPolygon")for(ne=0;ne<ce.length;ne++)for(var de=0;de<ce[ne].length;de++)Ne(te,ce[ne][de])}(q),q}function Ne($,M){for(var k=0;k<M.length;k+=3)$.minX=Math.min($.minX,M[k]),$.minY=Math.min($.minY,M[k+1]),$.maxX=Math.max($.maxX,M[k]),$.maxY=Math.max($.maxY,M[k+1])}function at($,M,k,G){if(M.geometry){var q=M.geometry.coordinates,te=M.geometry.type,ce=Math.pow(k.tolerance/((1<<k.maxZoom)*k.extent),2),ue=[],ne=M.id;if(k.promoteId?ne=M.properties[k.promoteId]:k.generateId&&(ne=G||0),te==="Point")nt(q,ue);else if(te==="MultiPoint")for(var de=0;de<q.length;de++)nt(q[de],ue);else if(te==="LineString")Je(q,ue,ce,!1);else if(te==="MultiLineString"){if(k.lineMetrics){for(de=0;de<q.length;de++)Je(q[de],ue=[],ce,!1),$.push(We(ne,"LineString",ue,M.properties));return}ft(q,ue,ce,!1)}else if(te==="Polygon")ft(q,ue,ce,!0);else{if(te!=="MultiPolygon"){if(te==="GeometryCollection"){for(de=0;de<M.geometry.geometries.length;de++)at($,{id:ne,geometry:M.geometry.geometries[de],properties:M.properties},k,G);return}throw new Error("Input data is not a valid GeoJSON object.")}for(de=0;de<q.length;de++){var Ee=[];ft(q[de],Ee,ce,!0),ue.push(Ee)}}$.push(We(ne,te,ue,M.properties))}}function nt($,M){M.push(Ct($[0])),M.push(Yt($[1])),M.push(0)}function Je($,M,k,G){for(var q,te,ce=0,ue=0;ue<$.length;ue++){var ne=Ct($[ue][0]),de=Yt($[ue][1]);M.push(ne),M.push(de),M.push(0),ue>0&&(ce+=G?(q*de-ne*te)/2:Math.sqrt(Math.pow(ne-q,2)+Math.pow(de-te,2))),q=ne,te=de}var Ee=M.length-3;M[2]=1,Qe(M,0,Ee,k),M[Ee+2]=1,M.size=Math.abs(ce),M.start=0,M.end=M.size}function ft($,M,k,G){for(var q=0;q<$.length;q++){var te=[];Je($[q],te,k,G),M.push(te)}}function Ct($){return $/360+.5}function Yt($){var M=Math.sin($*Math.PI/180),k=.5-.25*Math.log((1+M)/(1-M))/Math.PI;return k<0?0:k>1?1:k}function Mt($,M,k,G,q,te,ce,ue){if(G/=M,te>=(k/=M)&&ce<G)return $;if(ce<k||te>=G)return null;for(var ne=[],de=0;de<$.length;de++){var Ee=$[de],Me=Ee.geometry,ke=Ee.type,it=q===0?Ee.minX:Ee.minY,lt=q===0?Ee.maxX:Ee.maxY;if(it>=k&&lt<G)ne.push(Ee);else if(!(lt<k||it>=G)){var ct=[];if(ke==="Point"||ke==="MultiPoint")Jt(Me,ct,k,G,q);else if(ke==="LineString")Ni(Me,ct,k,G,q,!1,ue.lineMetrics);else if(ke==="MultiLineString")Zr(Me,ct,k,G,q,!1);else if(ke==="Polygon")Zr(Me,ct,k,G,q,!0);else if(ke==="MultiPolygon")for(var ht=0;ht<Me.length;ht++){var St=[];Zr(Me[ht],St,k,G,q,!0),St.length&&ct.push(St)}if(ct.length){if(ue.lineMetrics&&ke==="LineString"){for(ht=0;ht<ct.length;ht++)ne.push(We(Ee.id,ke,ct[ht],Ee.tags));continue}ke!=="LineString"&&ke!=="MultiLineString"||(ct.length===1?(ke="LineString",ct=ct[0]):ke="MultiLineString"),ke!=="Point"&&ke!=="MultiPoint"||(ke=ct.length===3?"Point":"MultiPoint"),ne.push(We(Ee.id,ke,ct,Ee.tags))}}}return ne.length?ne:null}function Jt($,M,k,G,q){for(var te=0;te<$.length;te+=3){var ce=$[te+q];ce>=k&&ce<=G&&(M.push($[te]),M.push($[te+1]),M.push($[te+2]))}}function Ni($,M,k,G,q,te,ce){for(var ue,ne,de=wr($),Ee=q===0?or:ji,Me=$.start,ke=0;ke<$.length-3;ke+=3){var it=$[ke],lt=$[ke+1],ct=$[ke+2],ht=$[ke+3],St=$[ke+4],si=q===0?it:lt,hi=q===0?ht:St,ii=!1;ce&&(ue=Math.sqrt(Math.pow(it-ht,2)+Math.pow(lt-St,2))),si<k?hi>k&&(ne=Ee(de,it,lt,ht,St,k),ce&&(de.start=Me+ue*ne)):si>G?hi<G&&(ne=Ee(de,it,lt,ht,St,G),ce&&(de.start=Me+ue*ne)):kr(de,it,lt,ct),hi<k&&si>=k&&(ne=Ee(de,it,lt,ht,St,k),ii=!0),hi>G&&si<=G&&(ne=Ee(de,it,lt,ht,St,G),ii=!0),!te&&ii&&(ce&&(de.end=Me+ue*ne),M.push(de),de=wr($)),ce&&(Me+=ue)}var di=$.length-3;it=$[di],lt=$[di+1],ct=$[di+2],(si=q===0?it:lt)>=k&&si<=G&&kr(de,it,lt,ct),di=de.length-3,te&&di>=3&&(de[di]!==de[0]||de[di+1]!==de[1])&&kr(de,de[0],de[1],de[2]),de.length&&M.push(de)}function wr($){var M=[];return M.size=$.size,M.start=$.start,M.end=$.end,M}function Zr($,M,k,G,q,te){for(var ce=0;ce<$.length;ce++)Ni($[ce],M,k,G,q,te,!1)}function kr($,M,k,G){$.push(M),$.push(k),$.push(G)}function or($,M,k,G,q,te){var ce=(te-M)/(G-M);return $.push(te),$.push(k+(q-k)*ce),$.push(1),ce}function ji($,M,k,G,q,te){var ce=(te-k)/(q-k);return $.push(M+(G-M)*ce),$.push(te),$.push(1),ce}function jt($,M){for(var k=[],G=0;G<$.length;G++){var q,te=$[G],ce=te.type;if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")q=sr(te.geometry,M);else if(ce==="MultiLineString"||ce==="Polygon"){q=[];for(var ue=0;ue<te.geometry.length;ue++)q.push(sr(te.geometry[ue],M))}else if(ce==="MultiPolygon")for(q=[],ue=0;ue<te.geometry.length;ue++){for(var ne=[],de=0;de<te.geometry[ue].length;de++)ne.push(sr(te.geometry[ue][de],M));q.push(ne)}k.push(We(te.id,ce,q,te.tags))}return k}function sr($,M){var k=[];k.size=$.size,$.start!==void 0&&(k.start=$.start,k.end=$.end);for(var G=0;G<$.length;G+=3)k.push($[G]+M,$[G+1],$[G+2]);return k}function Ao($,M){if($.transformed)return $;var k,G,q,te=1<<$.z,ce=$.x,ue=$.y;for(k=0;k<$.features.length;k++){var ne=$.features[k],de=ne.geometry,Ee=ne.type;if(ne.geometry=[],Ee===1)for(G=0;G<de.length;G+=2)ne.geometry.push(an(de[G],de[G+1],M,te,ce,ue));else for(G=0;G<de.length;G++){var Me=[];for(q=0;q<de[G].length;q+=2)Me.push(an(de[G][q],de[G][q+1],M,te,ce,ue));ne.geometry.push(Me)}}return $.transformed=!0,$}function an($,M,k,G,q,te){return[Math.round(k*($*G-q)),Math.round(k*(M*G-te))]}function Co($,M,k,G,q){for(var te=M===q.maxZoom?0:q.tolerance/((1<<M)*q.extent),ce={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:k,y:G,z:M,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ue=0;ue<$.length;ue++){ce.numFeatures++,uo(ce,$[ue],te,q);var ne=$[ue].minX,de=$[ue].minY,Ee=$[ue].maxX,Me=$[ue].maxY;ne<ce.minX&&(ce.minX=ne),de<ce.minY&&(ce.minY=de),Ee>ce.maxX&&(ce.maxX=Ee),Me>ce.maxY&&(ce.maxY=Me)}return ce}function uo($,M,k,G){var q=M.geometry,te=M.type,ce=[];if(te==="Point"||te==="MultiPoint")for(var ue=0;ue<q.length;ue+=3)ce.push(q[ue]),ce.push(q[ue+1]),$.numPoints++,$.numSimplified++;else if(te==="LineString")wn(ce,q,$,k,!1,!1);else if(te==="MultiLineString"||te==="Polygon")for(ue=0;ue<q.length;ue++)wn(ce,q[ue],$,k,te==="Polygon",ue===0);else if(te==="MultiPolygon")for(var ne=0;ne<q.length;ne++){var de=q[ne];for(ue=0;ue<de.length;ue++)wn(ce,de[ue],$,k,!0,ue===0)}if(ce.length){var Ee=M.tags||null;if(te==="LineString"&&G.lineMetrics){for(var Me in Ee={},M.tags)Ee[Me]=M.tags[Me];Ee.mapbox_clip_start=q.start/q.size,Ee.mapbox_clip_end=q.end/q.size}var ke={geometry:ce,type:te==="Polygon"||te==="MultiPolygon"?3:te==="LineString"||te==="MultiLineString"?2:1,tags:Ee};M.id!==null&&(ke.id=M.id),$.features.push(ke)}}function wn($,M,k,G,q,te){var ce=G*G;if(G>0&&M.size<(q?ce:G))k.numPoints+=M.length/3;else{for(var ue=[],ne=0;ne<M.length;ne+=3)(G===0||M[ne+2]>ce)&&(k.numSimplified++,ue.push(M[ne]),ue.push(M[ne+1])),k.numPoints++;q&&function(de,Ee){for(var Me=0,ke=0,it=de.length,lt=it-2;ke<it;lt=ke,ke+=2)Me+=(de[ke]-de[lt])*(de[ke+1]+de[lt+1]);if(Me>0===Ee)for(ke=0,it=de.length;ke<it/2;ke+=2){var ct=de[ke],ht=de[ke+1];de[ke]=de[it-2-ke],de[ke+1]=de[it-1-ke],de[it-2-ke]=ct,de[it-1-ke]=ht}}(ue,te),$.push(ue)}}function qr($,M){var k=(M=this.options=function(q,te){for(var ce in te)q[ce]=te[ce];return q}(Object.create(this.options),M)).debug;if(k&&console.time("preprocess data"),M.maxZoom<0||M.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(M.promoteId&&M.generateId)throw new Error("promoteId and generateId cannot be used together.");var G=function(q,te){var ce=[];if(q.type==="FeatureCollection")for(var ue=0;ue<q.features.length;ue++)at(ce,q.features[ue],te,ue);else at(ce,q.type==="Feature"?q:{geometry:q},te);return ce}($,M);this.tiles={},this.tileCoords=[],k&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",M.indexMaxZoom,M.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(G=function(q,te){var ce=te.buffer/te.extent,ue=q,ne=Mt(q,1,-1-ce,ce,0,-1,2,te),de=Mt(q,1,1-ce,2+ce,0,-1,2,te);return(ne||de)&&(ue=Mt(q,1,-ce,1+ce,0,-1,2,te)||[],ne&&(ue=jt(ne,1).concat(ue)),de&&(ue=ue.concat(jt(de,-1)))),ue}(G,M)).length&&this.splitTile(G,0,0,0),k&&(G.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Fn($,M,k){return 32*((1<<$)*k+M)+$}function ln($,M){const k=$.tileID.canonical;if(!this._geoJSONIndex)return M(null,null);const G=this._geoJSONIndex.getTile(k.z,k.x,k.y);if(!G)return M(null,null);const q=new Ui(G.features);let te=Vt(q);te.byteOffset===0&&te.byteLength===te.buffer.byteLength||(te=new Uint8Array(te)),M(null,{vectorTile:q,rawData:te.buffer})}qr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},qr.prototype.splitTile=function($,M,k,G,q,te,ce){for(var ue=[$,M,k,G],ne=this.options,de=ne.debug;ue.length;){G=ue.pop(),k=ue.pop(),M=ue.pop(),$=ue.pop();var Ee=1<<M,Me=Fn(M,k,G),ke=this.tiles[Me];if(!ke&&(de>1&&console.time("creation"),ke=this.tiles[Me]=Co($,M,k,G,ne),this.tileCoords.push({z:M,x:k,y:G}),de)){de>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",M,k,G,ke.numFeatures,ke.numPoints,ke.numSimplified),console.timeEnd("creation"));var it="z"+M;this.stats[it]=(this.stats[it]||0)+1,this.total++}if(ke.source=$,q){if(M===ne.maxZoom||M===q)continue;var lt=1<<q-M;if(k!==Math.floor(te/lt)||G!==Math.floor(ce/lt))continue}else if(M===ne.indexMaxZoom||ke.numPoints<=ne.indexMaxPoints)continue;if(ke.source=null,$.length!==0){de>1&&console.time("clipping");var ct,ht,St,si,hi,ii,di=.5*ne.buffer/ne.extent,On=.5-di,Tn=.5+di,Yi=1+di;ct=ht=St=si=null,hi=Mt($,Ee,k-di,k+Tn,0,ke.minX,ke.maxX,ne),ii=Mt($,Ee,k+On,k+Yi,0,ke.minX,ke.maxX,ne),$=null,hi&&(ct=Mt(hi,Ee,G-di,G+Tn,1,ke.minY,ke.maxY,ne),ht=Mt(hi,Ee,G+On,G+Yi,1,ke.minY,ke.maxY,ne),hi=null),ii&&(St=Mt(ii,Ee,G-di,G+Tn,1,ke.minY,ke.maxY,ne),si=Mt(ii,Ee,G+On,G+Yi,1,ke.minY,ke.maxY,ne),ii=null),de>1&&console.timeEnd("clipping"),ue.push(ct||[],M+1,2*k,2*G),ue.push(ht||[],M+1,2*k,2*G+1),ue.push(St||[],M+1,2*k+1,2*G),ue.push(si||[],M+1,2*k+1,2*G+1)}}},qr.prototype.getTile=function($,M,k){var G=this.options,q=G.extent,te=G.debug;if($<0||$>24)return null;var ce=1<<$,ue=Fn($,M=(M%ce+ce)%ce,k);if(this.tiles[ue])return Ao(this.tiles[ue],q);te>1&&console.log("drilling down to z%d-%d-%d",$,M,k);for(var ne,de=$,Ee=M,Me=k;!ne&&de>0;)de--,Ee=Math.floor(Ee/2),Me=Math.floor(Me/2),ne=this.tiles[Fn(de,Ee,Me)];return ne&&ne.source?(te>1&&console.log("found parent tile z%d-%d-%d",de,Ee,Me),te>1&&console.time("drilling down"),this.splitTile(ne.source,de,Ee,Me,$,M,k),te>1&&console.timeEnd("drilling down"),this.tiles[ue]?Ao(this.tiles[ue],q):null):null};class zo extends s.VectorTileWorkerSource{constructor(M,k,G,q,te){super(M,k,G,q,ln),te&&(this.loadGeoJSON=te)}loadData(M,k){const G=M&&M.request,q=G&&G.collectResourceTiming;this.loadGeoJSON(M,(te,ce)=>{if(te||!ce)return k(te);if(typeof ce!="object")return k(new Error(`Input data given to '${M.source}' is not a valid GeoJSON object.`));{fe(ce,!0);try{if(M.filter){const ne=s.createExpression(M.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ne.result==="error")throw new Error(ne.value.map(Ee=>`${Ee.key}: ${Ee.message}`).join(", "));const de=ce.features.filter(Ee=>ne.value.evaluate({zoom:0},Ee));ce={type:"FeatureCollection",features:de}}this._geoJSONIndex=M.cluster?new sn(function({superclusterOptions:ne,clusterProperties:de}){if(!de||!ne)return ne;const Ee={},Me={},ke={accumulated:null,zoom:0},it={properties:null},lt=Object.keys(de);for(const ct of lt){const[ht,St]=de[ct],si=s.createExpression(St),hi=s.createExpression(typeof ht=="string"?[ht,["accumulated"],["get",ct]]:ht);Ee[ct]=si.value,Me[ct]=hi.value}return ne.map=ct=>{it.properties=ct;const ht={};for(const St of lt)ht[St]=Ee[St].evaluate(ke,it);return ht},ne.reduce=(ct,ht)=>{it.properties=ht;for(const St of lt)ke.accumulated=ct[St],ct[St]=Me[St].evaluate(ke,it)},ne}(M)).load(ce.features):function(ne,de){return new qr(ne,de)}(ce,M.geojsonVtOptions)}catch(ne){return k(ne)}this.loaded={};const ue={};if(q){const ne=s.getPerformanceMeasurement(G);ne&&(ue.resourceTiming={},ue.resourceTiming[M.source]=JSON.parse(JSON.stringify(ne)))}k(null,ue)}})}reloadTile(M,k){const G=this.loaded;return G&&G[M.uid]?super.reloadTile(M,k):this.loadTile(M,k)}loadGeoJSON(M,k){if(M.request)s.getJSON(M.request,k);else{if(typeof M.data!="string")return k(new Error(`Input data given to '${M.source}' is not a valid GeoJSON object.`));try{return k(null,JSON.parse(M.data))}catch{return k(new Error(`Input data given to '${M.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(M,k){try{k(null,this._geoJSONIndex.getClusterExpansionZoom(M.clusterId))}catch(G){k(G)}}getClusterChildren(M,k){try{k(null,this._geoJSONIndex.getChildren(M.clusterId))}catch(G){k(G)}}getClusterLeaves(M,k){try{k(null,this._geoJSONIndex.getLeaves(M.clusterId,M.limit,M.offset))}catch(G){k(G)}}}class Tr{constructor(M){this.self=M,this.actor=new s.Actor(M,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:zo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(k,G)=>{if(this.workerSourceTypes[k])throw new Error(`Worker source with name "${k}" already registered.`);this.workerSourceTypes[k]=G},this.self.registerRTLTextPlugin=k=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=k.applyArabicShaping,s.plugin.processBidirectionalText=k.processBidirectionalText,s.plugin.processStyledBidirectionalText=k.processStyledBidirectionalText}}clearCaches(M,k,G){delete this.layerIndexes[M],delete this.availableImages[M],delete this.workerSources[M],delete this.demWorkerSources[M],G()}checkIfReady(M,k,G){G()}setReferrer(M,k){this.referrer=k}spriteLoaded(M,k){this.isSpriteLoaded[M]=k;for(const G in this.workerSources[M]){const q=this.workerSources[M][G];for(const te in q)q[te]instanceof s.VectorTileWorkerSource&&(q[te].isSpriteLoaded=k,q[te].fire(new s.Event("isSpriteLoaded")))}}setImages(M,k,G){this.availableImages[M]=k;for(const q in this.workerSources[M]){const te=this.workerSources[M][q];for(const ce in te)te[ce].availableImages=k}G()}enableTerrain(M,k,G){this.terrain=k,G()}setProjection(M,k){this.projections[M]=s.getProjection(k)}setLayers(M,k,G){this.getLayerIndex(M).replace(k),G()}updateLayers(M,k,G){this.getLayerIndex(M).update(k.layers,k.removedIds),G()}loadTile(M,k,G){const q=this.enableTerrain?s.extend({enableTerrain:this.terrain},k):k;q.projection=this.projections[M]||this.defaultProjection,this.getWorkerSource(M,k.type,k.source).loadTile(q,G)}loadDEMTile(M,k,G){const q=this.enableTerrain?s.extend({buildQuadTree:this.terrain},k):k;this.getDEMWorkerSource(M,k.source).loadTile(q,G)}reloadTile(M,k,G){const q=this.enableTerrain?s.extend({enableTerrain:this.terrain},k):k;q.projection=this.projections[M]||this.defaultProjection,this.getWorkerSource(M,k.type,k.source).reloadTile(q,G)}abortTile(M,k,G){this.getWorkerSource(M,k.type,k.source).abortTile(k,G)}removeTile(M,k,G){this.getWorkerSource(M,k.type,k.source).removeTile(k,G)}removeSource(M,k,G){if(!this.workerSources[M]||!this.workerSources[M][k.type]||!this.workerSources[M][k.type][k.source])return;const q=this.workerSources[M][k.type][k.source];delete this.workerSources[M][k.type][k.source],q.removeSource!==void 0?q.removeSource(k,G):G()}loadWorkerSource(M,k,G){try{this.self.importScripts(k.url),G()}catch(q){G(q.toString())}}syncRTLPluginState(M,k,G){try{s.plugin.setState(k);const q=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&q!=null){this.self.importScripts(q);const te=s.plugin.isParsed();G(te?void 0:new Error(`RTL Text Plugin failed to import scripts from ${q}`),te)}}catch(q){G(q.toString())}}getAvailableImages(M){let k=this.availableImages[M];return k||(k=[]),k}getLayerIndex(M){let k=this.layerIndexes[M];return k||(k=this.layerIndexes[M]=new Ue),k}getWorkerSource(M,k,G){return this.workerSources[M]||(this.workerSources[M]={}),this.workerSources[M][k]||(this.workerSources[M][k]={}),this.workerSources[M][k][G]||(this.workerSources[M][k][G]=new this.workerSourceTypes[k]({send:(q,te,ce,ue,ne,de)=>{this.actor.send(q,te,ce,M,ne,de)},scheduler:this.actor.scheduler},this.getLayerIndex(M),this.getAvailableImages(M),this.isSpriteLoaded[M])),this.workerSources[M][k][G]}getDEMWorkerSource(M,k){return this.demWorkerSources[M]||(this.demWorkerSources[M]={}),this.demWorkerSources[M][k]||(this.demWorkerSources[M][k]=new Le),this.demWorkerSources[M][k]}enforceCacheSizeLimit(M,k){s.enforceCacheSizeLimit(k)}getWorkerPerformanceMetrics(M,k,G){G(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Tr(self)),Tr}),j(["./shared"],function(s){var pe=Ie;function Ie(c){return!function(i){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var u,d,f=new Blob([""],{type:"text/javascript"}),g=URL.createObjectURL(f);try{d=new Worker(g),u=!0}catch{u=!1}return d&&d.terminate(),URL.revokeObjectURL(g),u}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var u=document.createElement("canvas");u.width=u.height=1;var d=u.getContext("2d");if(!d)return!1;var f=d.getImageData(0,0,1,1);return f&&f.width===u.width}()?(Ue[o=i&&i.failIfMajorPerformanceCaveat]===void 0&&(Ue[o]=function(u){var d,f=function(g){var x=document.createElement("canvas"),E=Object.create(Ie.webGLContextAttributes);return E.failIfMajorPerformanceCaveat=g,x.getContext("webgl",E)||x.getContext("experimental-webgl",E)}(u);if(!f)return!1;try{d=f.createShader(f.VERTEX_SHADER)}catch{return!1}return!(!d||f.isContextLost())&&(f.shaderSource(d,"void main() {}"),f.compileShader(d),f.getShaderParameter(d,f.COMPILE_STATUS)===!0)}(o)),Ue[o]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var o}(c)}var Ue={};function _e(c,i){var o=i[0],u=i[1],d=i[2],f=i[3],g=o*f-d*u;return g?(c[0]=f*(g=1/g),c[1]=-u*g,c[2]=-d*g,c[3]=o*g,c):null}function Le(c,i){if(Array.isArray(c)){if(!Array.isArray(i)||c.length!==i.length)return!1;for(let o=0;o<c.length;o++)if(!Le(c[o],i[o]))return!1;return!0}if(typeof c=="object"&&c!==null&&i!==null){if(typeof i!="object"||Object.keys(c).length!==Object.keys(i).length)return!1;for(const o in c)if(!Le(c[o],i[o]))return!1;return!0}return c===i}Ie.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const fe={create:function(c,i,o){const u=s.window.document.createElement(c);return i!==void 0&&(u.className=i),o&&o.appendChild(u),u},createSVG:function(c,i,o){const u=s.window.document.createElementNS("http://www.w3.org/2000/svg",c);for(const d of Object.keys(i))u.setAttributeNS(null,d,i[d]);return o&&o.appendChild(u),u}},wt=s.window.document&&s.window.document.documentElement.style,dt=wt&&wt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let xt;fe.disableDrag=function(){wt&&dt&&(xt=wt[dt],wt[dt]="none")},fe.enableDrag=function(){wt&&dt&&(wt[dt]=xt)};const yt=function(c){c.preventDefault(),c.stopPropagation(),s.window.removeEventListener("click",yt,!0)};function Ui(c,i,o){const u=c.offsetWidth===i.width?1:c.offsetWidth/i.width;return new s.pointGeometry((o.clientX-i.left)*u,(o.clientY-i.top)*u)}function ai(c){const{userImage:i}=c;return!!(i&&i.render&&i.render())&&(c.data.replace(new Uint8Array(i.data.buffer)),!0)}fe.suppressClick=function(){s.window.addEventListener("click",yt,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",yt,!0)},0)},fe.mousePos=function(c,i){const o=c.getBoundingClientRect();return Ui(c,o,i)},fe.touchPos=function(c,i){const o=c.getBoundingClientRect(),u=[];for(let d=0;d<i.length;d++)u.push(Ui(c,o,i[d]));return u},fe.mouseButton=function(c){return s.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button};class Wt extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:o,callback:u}of this.requestors)this._notify(o,u);this.requestors=[]}}getImage(i){return this.images[i]}addImage(i,o){this._validate(i,o)&&(this.images[i]=o)}_validate(i,o){let u=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),u=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),u=!1),this._validateContent(o.content,o)||(this.fire(new s.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),u=!1),u}_validateStretch(i,o){if(!i)return!0;let u=0;for(const d of i){if(d[0]<u||d[1]<d[0]||o<d[1])return!1;u=d[1]}return!0}_validateContent(i,o){return!(i&&(i.length!==4||i[0]<0||o.data.width<i[0]||i[1]<0||o.data.height<i[1]||i[2]<0||o.data.width<i[2]||i[3]<0||o.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,o){o.version=this.images[i].version+1,this.images[i]=o,this.updatedImages[i]=!0}removeImage(i){const o=this.images[i];delete this.images[i],delete this.patterns[i],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,o){let u=!0;if(!this.isLoaded())for(const d of i)this.images[d]||(u=!1);this.isLoaded()||u?this._notify(i,o):this.requestors.push({ids:i,callback:o})}_notify(i,o){const u={};for(const d of i){this.images[d]||this.fire(new s.Event("styleimagemissing",{id:d}));const f=this.images[d];f?u[d]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,hasRenderCallback:Boolean(f.userImage&&f.userImage.render)}:s.warnOnce(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,u)}getPixelSize(){const{width:i,height:o}=this.atlasImage;return{width:i,height:o}}getPattern(i){const o=this.patterns[i],u=this.getImage(i);if(!u)return null;if(o&&o.position.version===u.version)return o.position;if(o)o.position.version=u.version;else{const d={w:u.data.width+2,h:u.data.height+2,x:0,y:0},f=new s.ImagePosition(d,u);this.patterns[i]={bin:d,position:f}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const o=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(i,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const f in this.patterns)i.push(this.patterns[f].bin);const{w:o,h:u}=s.potpack(i),d=this.atlasImage;d.resize({width:o||1,height:u||1});for(const f in this.patterns){const{bin:g}=this.patterns[f],x=g.x+1,E=g.y+1,S=this.images[f].data,I=S.width,z=S.height;s.RGBAImage.copy(S,d,{x:0,y:0},{x,y:E},{width:I,height:z}),s.RGBAImage.copy(S,d,{x:0,y:z-1},{x,y:E-1},{width:I,height:1}),s.RGBAImage.copy(S,d,{x:0,y:0},{x,y:E+z},{width:I,height:1}),s.RGBAImage.copy(S,d,{x:I-1,y:0},{x:x-1,y:E},{width:1,height:z}),s.RGBAImage.copy(S,d,{x:0,y:0},{x:x+I,y:E},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const o of i){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const u=this.images[o];ai(u)&&this.updateImage(o,u)}}}const Di=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(c,i){return function([o,u,d]){const f=s.degToRad(u+90),g=s.degToRad(d);return{x:o*Math.cos(f)*Math.sin(g),y:o*Math.sin(f)*Math.sin(g),z:o*Math.cos(g),azimuthal:u,polar:d}}(c.expression.evaluate(i))}interpolate(c,i,o){return{x:s.number(c.x,i.x,o),y:s.number(c.y,i.y,o),z:s.number(c.z,i.z,o),azimuthal:s.number(c.azimuthal,i.azimuthal,o),polar:s.number(c.polar,i.polar,o)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)}),Vi="-transition";class Vt extends s.Evented{constructor(i){super(),this._transitionable=new s.Transitionable(Di),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,o={}){if(!this._validate(s.validateLight,i,o))for(const u in i){const d=i[u];s.endsWith(u,Vi)?this._transitionable.setTransition(u.slice(0,-Vi.length),d):this._transitionable.setValue(u,d)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,u){return(!u||u.validate!==!1)&&s.emitValidationErrors(this,i.call(s.validateStyle,s.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const bi=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)}),li="-transition";class tr extends s.Evented{constructor(i,o){super(),this._transitionable=new s.Transitionable(bi),this.set(i),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o}get(){return this._transitionable.serialize()}set(i){for(const o in i){const u=i[o];s.endsWith(o,li)?this._transitionable.setTransition(o.slice(0,-li.length),u):this._transitionable.setValue(o,u)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}}function wi(c,i,o,u){const d=s.smoothstep(45,65,o),[f,g]=Ki(c,u),x=s.length(i);let E=1-Math.min(1,Math.exp((x-f)/(g-f)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*d*c.alpha}function Ki(c,i){const o=.5/Math.tan(.5*i);return[c.range[0]+o,c.range[1]+o]}const br=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"])}),vn="-transition";class lo extends s.Evented{constructor(i,o){super(),this._transitionable=new s.Transitionable(br),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=o}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,o={}){if(!this._validate(s.validateFog,i,o))for(const u in i){const d=i[u];s.endsWith(u,vn)?this._transitionable.setTransition(u.slice(0,-vn.length),d):this._transitionable.setValue(u,d)}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return s.smoothstep(45,65,i)*o.a}getOpacityAtLatLng(i,o){return this._transform.projection.supportsFog?function(u,d,f){const g=s.MercatorCoordinate.fromLngLat(d),x=f.elevation?f.elevation.getAtPointOrZero(g):0,E=[g.x,g.y,x];return s.transformMat4(E,E,f.mercatorFogMatrix),wi(u,E,f.pitch,f._fov)}(this.state,i,o):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?Ki(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,u){return(!u||u.validate!==!1)&&s.emitValidationErrors(this,i.call(s.validateStyle,s.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class mi{constructor(i,o){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const u=this.workerPool.acquire(this.id);for(let d=0;d<u.length;d++){const f=new mi.Actor(u[d],o,this.id);f.name=`Worker ${d}`,this.actors.push(f)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,o,u){s.asyncAll(this.actors,(d,f)=>{d.send(i,o,f)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Nt(c,i,o){return i*(s.EXTENT/(c.tileSize*Math.pow(2,o-c.tileID.overscaledZ)))}mi.Actor=s.Actor;class Ht{constructor(i,o,u){this.context=i;const d=i.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(u),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Li={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class nn{constructor(i,o,u,d){this.length=o.length,this.attributes=u,this.itemSize=o.bytesPerElement,this.dynamicDraw=d,this.context=i;const f=i.gl;this.buffer=f.createBuffer(),i.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,o){for(let u=0;u<this.attributes.length;u++){const d=o.attributes[this.attributes[u].name];d!==void 0&&i.enableVertexAttribArray(d)}}setVertexAttribPointers(i,o,u){for(let d=0;d<this.attributes.length;d++){const f=this.attributes[d],g=o.attributes[f.name];g!==void 0&&i.vertexAttribPointer(g,f.components,i[Li[f.type]],!1,this.itemSize,f.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class vt{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Gr extends vt{getDefault(){return s.Color.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class ir extends vt{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class on extends vt{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class ds extends vt{getDefault(){return[!0,!0,!0,!0]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Bn extends vt{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Bi extends vt{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class sn extends vt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const o=this.current;(i.func!==o.func||i.ref!==o.ref||i.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class co extends vt{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class $r extends vt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=i,this.dirty=!1}}class bn extends vt{getDefault(){return[0,1]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Rn extends vt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=i,this.dirty=!1}}class ee extends vt{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class re extends vt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.BLEND):o.disable(o.BLEND),this.current=i,this.dirty=!1}}class ye extends vt{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class Re extends vt{getDefault(){return s.Color.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Fe extends vt{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class qe extends vt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=i,this.dirty=!1}}class Qe extends vt{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class ze extends vt{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class We extends vt{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class Ne extends vt{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class at extends vt{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class nt extends vt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Je extends vt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class ft extends vt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Ct extends vt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Yt extends vt{getDefault(){return null}set(i){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Mt extends vt{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class Jt extends vt{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class Ni extends vt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class wr extends vt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Zr extends vt{constructor(i,o){super(i),this.context=i,this.parent=o}getDefault(){return null}}class kr extends Zr{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class or extends Zr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class ji extends or{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class jt{constructor(i,o,u,d){this.context=i,this.width=o,this.height=u;const f=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new kr(i,f),d&&(this.depthAttachment=new or(i,f))}destroy(){const i=this.context.gl,o=this.colorAttachment.get();if(o&&i.deleteTexture(o),this.depthAttachment){const u=this.depthAttachment.get();u&&i.deleteRenderbuffer(u)}i.deleteFramebuffer(this.framebuffer)}}class sr{constructor(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Gr(this),this.clearDepth=new ir(this),this.clearStencil=new on(this),this.colorMask=new ds(this),this.depthMask=new Bn(this),this.stencilMask=new Bi(this),this.stencilFunc=new sn(this),this.stencilOp=new co(this),this.stencilTest=new $r(this),this.depthRange=new bn(this),this.depthTest=new Rn(this),this.depthFunc=new ee(this),this.blend=new re(this),this.blendFunc=new ye(this),this.blendColor=new Re(this),this.blendEquation=new Fe(this),this.cullFace=new qe(this),this.cullFaceSide=new Qe(this),this.frontFace=new ze(this),this.program=new We(this),this.activeTexture=new Ne(this),this.viewport=new at(this),this.bindFramebuffer=new nt(this),this.bindRenderbuffer=new Je(this),this.bindTexture=new ft(this),this.bindVertexBuffer=new Ct(this),this.bindElementBuffer=new Yt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Mt(this),this.pixelStoreUnpack=new Jt(this),this.pixelStoreUnpackPremultiplyAlpha=new Ni(this),this.pixelStoreUnpackFlipY=new wr(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,o){return new Ht(this,i,o)}createVertexBuffer(i,o,u){return new nn(this,i,o,u)}createRenderbuffer(i,o,u){const d=this.gl,f=d.createRenderbuffer();return this.bindRenderbuffer.set(f),d.renderbufferStorage(d.RENDERBUFFER,i,o,u),this.bindRenderbuffer.set(null),f}createFramebuffer(i,o,u){return new jt(this,i,o,u)}clear({color:i,depth:o,stencil:u}){const d=this.gl;let f=0;i&&(f|=d.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(f|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),u!==void 0&&(f|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),d.clear(f)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){Le(i.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ao{constructor(i,o,u,d){this.screenBounds=i,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(f=>d.pointCoordinate3D(f)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(i,o){let u,d;if(i instanceof s.pointGeometry||typeof i[0]=="number"){const f=s.pointGeometry.convert(i);u=[s.pointGeometry.convert(i)],d=o.isPointAboveHorizon(f)}else{const f=s.pointGeometry.convert(i[0]),g=s.pointGeometry.convert(i[1]);u=[f,g],d=s.polygonizeBounds(f,g).every(x=>o.isPointAboveHorizon(x))}return new Ao(u,o.getCameraPoint(),d,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const o=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],d=s.polygonizeBounds(o,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<u.x?d.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?d[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(d[3]=this.cameraPoint)),s.bufferConvexPolygon(d,i)}containsTile(i,o,u){const d=i.queryPadding+1,f=i.tileID.wrap,g=u?this._bufferedCameraMercator(d,o).map(F=>s.getTilePoint(i.tileTransform,F,f)):this._bufferedScreenMercator(d,o).map(F=>s.getTilePoint(i.tileTransform,F,f)),x=this.screenGeometryMercator.map(F=>s.getTileVec3(i.tileTransform,F,f)),E=x.map(F=>new s.pointGeometry(F[0],F[1])),S=o.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),I=s.getTileVec3(i.tileTransform,S,f),z=x.map(F=>{const N=s.sub(F,F,I);return s.normalize(N,N),new s.Ray(I,N)}),L=Nt(i,1,o.zoom);if(s.polygonIntersectsBox(g,0,0,s.EXTENT,s.EXTENT))return{queryGeometry:this,tilespaceGeometry:E,tilespaceRays:z,bufferedTilespaceGeometry:g,bufferedTilespaceBounds:(V=s.getBounds(g),V.min.x=s.clamp(V.min.x,0,s.EXTENT),V.min.y=s.clamp(V.min.y,0,s.EXTENT),V.max.x=s.clamp(V.max.x,0,s.EXTENT),V.max.y=s.clamp(V.max.y,0,s.EXTENT),V),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:L};var V}_bufferedScreenMercator(i,o){const u=an(i);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{const d=this.bufferedScreenGeometry(i).map(f=>o.pointCoordinate3D(f));return this._screenRaycastCache[u]=d,d}}_bufferedCameraMercator(i,o){const u=an(i);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{const d=this.bufferedCameraGeometry(i).map(f=>o.pointCoordinate3D(f));return this._cameraRaycastCache[u]=d,d}}}function an(c){return 100*c|0}function Co(c,i,o){const u=function(d,f){if(d)return o(d);if(f){const g=s.pick(s.extend(f,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);f.vector_layers&&(g.vectorLayers=f.vector_layers,g.vectorLayerIds=g.vectorLayers.map(x=>x.id)),g.tiles=i.canonicalizeTileset(g,c.url),o(null,g)}};return c.url?s.getJSON(i.transformRequest(i.normalizeSourceURL(c.url),s.ResourceType.Source),u):s.exported.frame(()=>u(null,c))}class uo{constructor(i,o,u){this.bounds=s.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=o||0,this.maxzoom=u||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const o=Math.pow(2,i.z),u=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*o),d=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*o),f=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*o),g=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*o);return i.x>=u&&i.x<f&&i.y>=d&&i.y<g}}class wn extends s.Evented{constructor(i,o,u,d){super(),this.id=i,this.dispatcher=u,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},o),s.extend(this,s.pick(o,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Co(this._options,this.map._requestManager,(i,o)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new s.ErrorEvent(i)):o&&(s.extend(this,o),o.bounds&&(this.tileBounds=new uo(o.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(o.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,o){const u=s.exported.devicePixelRatio>=2,d=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);i.request=s.getImage(this.map._requestManager.transformRequest(d,s.ResourceType.Tile),(f,g,x,E)=>{if(delete i.request,i.aborted)i.state="unloaded",o(null);else if(f)i.state="errored",o(f);else if(g){this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:x,expires:E});const S=this.map.painter.context,I=S.gl;i.texture=this.map.painter.getTileTexture(g.width),i.texture?i.texture.update(g,{useMipmap:!0}):(i.texture=new s.Texture(S,g,I.RGBA,{useMipmap:!0}),i.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE),S.extTextureFilterAnisotropic&&I.texParameterf(I.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax)),i.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),o(null)}})}abortTile(i,o){i.request&&(i.request.cancel(),delete i.request),o()}unloadTile(i,o){i.texture&&this.map.painter.saveTileTexture(i.texture),o()}hasTransition(){return!1}}let qr;function Fn(c,i,o,u,d,f,g,x){const E=[c,o,d,i,u,f,1,1,1],S=[g,x,1],I=s.adjoint([],E),[z,L,V]=s.transformMat3(S,S,s.transpose(I,I));return s.multiply(E,[z,0,0,0,L,0,0,0,V],E)}class ln extends s.Evented{constructor(i,o,u,d){super(),this.id=i,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=o}load(i,o){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(u,d)=>{this._loaded=!0,u?this.fire(new s.ErrorEvent(u)):d&&(this.image=s.exported.getImageData(d),this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),o&&o(),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this.options.url=i.url,this.load(i.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}setCoordinates(i){this.coordinates=i,delete this._boundsArray;const o=i.map(s.MercatorCoordinate.fromLngLat);return this.tileID=function(u){let d=1/0,f=1/0,g=-1/0,x=-1/0;for(const z of u)d=Math.min(d,z.x),f=Math.min(f,z.y),g=Math.max(g,z.x),x=Math.max(x,z.y);const E=Math.max(g-d,x-f),S=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),I=Math.pow(2,S);return new s.CanonicalTileID(S,Math.floor((d+g)/2*I),Math.floor((f+x)/2*I))}(o),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const i=s.tileTransform(this.tileID,this.map.transform.projection),[o,u,d,f]=this.coordinates.map(g=>{const x=i.projection.project(g[0],g[1]);return s.getTilePoint(i,x)._round()});return this.perspectiveTransform=function(g,x,E,S,I,z,L,V,F,N){const J=Fn(0,0,g,0,0,x,g,x),U=Fn(E,S,I,z,L,V,F,N);return s.multiply(U,s.adjoint(J,J),U),[U[6]/U[8]*g/s.EXTENT,U[7]/U[8]*x/s.EXTENT]}(this.width,this.height,o.x,o.y,u.x,u.y,f.x,f.y,d.x,d.y),this._boundsArray=new s.StructArrayLayout4i8,this._boundsArray.emplaceBack(o.x,o.y,0,0),this._boundsArray.emplaceBack(u.x,u.y,s.EXTENT,0),this._boundsArray.emplaceBack(f.x,f.y,0,s.EXTENT),this._boundsArray.emplaceBack(d.x,d.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,o=i.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,s.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new s.Texture(i,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));for(const u in this.tiles){const d=this.tiles[u];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture)}}loadTile(i,o){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},o(null)):(i.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const zo={vector:class extends s.Evented{constructor(c,i,o,u){if(super(),this.id=c,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(i,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Co(this._options,this.map._requestManager,(c,i)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new s.ErrorEvent(c)):i&&(s.extend(this,i),i.bounds&&(this.tileBounds=new uo(i.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(i.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}setSourceProperty(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c();const i=this.map.style._getSourceCaches(this.id);for(const o of i)o.clearTiles();this.load()}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}loadTile(c,i){const o=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(o,s.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(u.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired")c.state==="loading"?c.reloadCallback=i:c.request=c.actor.send("reloadTile",u,d.bind(this));else if(c.actor=this._tileWorkers[o]=this._tileWorkers[o]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",u,d.bind(this),void 0,!0);else{const f=s.loadVectorTile.call({deduped:this._deduped},u,(g,x)=>{g||!x?d.call(this,g):(u.data={cacheControl:x.cacheControl,expires:x.expires,rawData:x.rawData.slice(0)},c.actor&&c.actor.send("loadTile",u,d.bind(this),void 0,!0))},!0);c.request={cancel:f}}function d(f,g){return delete c.request,c.aborted?i(null):f&&f.status!==404?i(f):(g&&g.resourceTiming&&(c.resourceTiming=g.resourceTiming),this.map._refreshExpiredTiles&&g&&c.setExpiryData(g),c.loadVectorData(g,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:wn,"raster-dem":class extends wn{constructor(c,i,o,u){super(c,i,o,u),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(c,i){const o=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(d,f){d&&(c.state="errored",i(d)),f&&(c.dem=f,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",i(null))}c.request=s.getImage(this.map._requestManager.transformRequest(o,s.ResourceType.Tile),function(d,f,g,x){if(delete c.request,c.aborted)c.state="unloaded",i(null);else if(d)c.state="errored",i(d);else if(f){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:g,expires:x});const E=s.window.ImageBitmap&&f instanceof s.window.ImageBitmap&&(qr==null&&(qr=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),qr),S=1-(f.width-s.prevPowerOfTwo(f.width))/2;S<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const I=E?f:s.exported.getImageData(f,S),z={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:I,encoding:this.encoding,padding:S};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",z,u.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(c){const i=c.canonical,o=Math.pow(2,i.z),u=(i.x-1+o)%o,d=i.x===0?c.wrap-1:c.wrap,f=(i.x+1+o)%o,g=i.x+1===o?c.wrap+1:c.wrap,x={};return x[new s.OverscaledTileID(c.overscaledZ,d,i.z,u,i.y).key]={backfilled:!1},x[new s.OverscaledTileID(c.overscaledZ,g,i.z,f,i.y).key]={backfilled:!1},i.y>0&&(x[new s.OverscaledTileID(c.overscaledZ,d,i.z,u,i.y-1).key]={backfilled:!1},x[new s.OverscaledTileID(c.overscaledZ,c.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},x[new s.OverscaledTileID(c.overscaledZ,g,i.z,f,i.y-1).key]={backfilled:!1}),i.y+1<o&&(x[new s.OverscaledTileID(c.overscaledZ,d,i.z,u,i.y+1).key]={backfilled:!1},x[new s.OverscaledTileID(c.overscaledZ,c.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},x[new s.OverscaledTileID(c.overscaledZ,g,i.z,f,i.y+1).key]={backfilled:!1}),x}unloadTile(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded"}},geojson:class extends s.Evented{constructor(c,i,o,u){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(u),this._data=i.data,this._options=s.extend({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const d=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*d,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*d,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:s.EXTENT,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*d,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}getClusterExpansionZoom(c,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},i),this}getClusterChildren(c,i){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},i),this}getClusterLeaves(c,i,o,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:i,offset:o},u),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const c=s.extend({},this.workerOptions),i=this._data;typeof i=="string"?(c.request=this.map._requestManager.transformRequest(s.exported.resolveURL(i),s.ResourceType.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,c,(o,u)=>{if(this._loaded=!0,this._pendingLoad=null,o)this.fire(new s.ErrorEvent(o));else{const d={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&u&&u.resourceTiming&&u.resourceTiming[this.id]&&(d.resourceTiming=u.resourceTiming[this.id]),this.fire(new s.Event("data",d)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(c,i){const o=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(o,{type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(u,d)=>(delete c.request,c.unloadVectorData(),c.aborted?i(null):u?i(u):(c.loadVectorData(d,this.map.painter,o==="reloadTile"),i(null))),void 0,o==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ln{constructor(c,i,o,u){super(c,i,o,u),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const i of c.urls)this.urls.push(this.map._requestManager.transformRequest(i,s.ResourceType.Source).url);s.getVideo(this.urls,(i,o)=>{this._loaded=!0,i?this.fire(new s.ErrorEvent(i)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const i=this.video.seekable;c<i.start(0)||c>i.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,i=c.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(c,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,s.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2));for(const o in this.tiles){const u=this.tiles[o];u.state!=="loaded"&&(u.state="loaded",u.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ln,canvas:class extends ln{constructor(c,i,o,u){super(c,i,o,u),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(d=>!Array.isArray(d)||d.length!==2||d.some(f=>typeof f!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context,o=i.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,s.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(i,this.canvas,o.RGBA,{premultiply:!0});for(const u in this.tiles){const d=this.tiles[u];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}}},Tr=function(c,i,o,u){const d=new zo[i.type](c,i,o,u);if(d.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${d.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],d),d};function $(c,i){const o=s.identity([]);return s.scale(o,o,[.5*c.width,.5*-c.height,1]),s.translate(o,o,[1,-1,0]),s.multiply$1(o,o,c.calculateProjMatrix(i.toUnwrapped()))}function M(c,i,o,u,d,f,g,x=!1){const E=c.tilesIn(u,g,x);E.sort(G);const S=[];for(const z of E)S.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(i,o,c._state,z,d,f,$(c.transform,z.tile.tileID),x)});const I=function(z){const L={},V={};for(const F of z){const N=F.queryResults,J=F.wrappedTileID,U=V[J]=V[J]||{};for(const H in N){const K=N[H],W=U[H]=U[H]||{},X=L[H]=L[H]||[];for(const Q of K)W[Q.featureIndex]||(W[Q.featureIndex]=!0,X.push(Q))}}return L}(S);for(const z in I)I[z].forEach(L=>{const V=L.feature,F=c.getFeatureState(V.layer["source-layer"],V.id);V.source=V.layer.source,V.layer["source-layer"]&&(V.sourceLayer=V.layer["source-layer"]),V.state=F});return I}function k(c,i){const o=c.getRenderableIds().map(f=>c.getTileByID(f)),u=[],d={};for(let f=0;f<o.length;f++){const g=o[f],x=g.tileID.canonical.key;d[x]||(d[x]=!0,g.querySourceFeatures(u,i))}return u}function G(c,i){const o=c.tileID,u=i.tileID;return o.overscaledZ-u.overscaledZ||o.canonical.y-u.canonical.y||o.wrap-u.wrap||o.canonical.x-u.canonical.x}function q(){return Hn.workerClass!=null?new Hn.workerClass:new s.window.Worker(Hn.workerUrl)}const te="mapboxgl_preloaded_worker_pool";class ce{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<ce.workerCount;)this.workers.push(new q);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[te]}numActive(){return Object.keys(this.active).length}}let ue;function ne(){return ue||(ue=new ce),ue}function de(c,i){const o={};for(const u in c)u!=="ref"&&(o[u]=c[u]);return s.refProperties.forEach(u=>{u in i&&(o[u]=i[u])}),o}function Ee(c){c=c.slice();const i=Object.create(null);for(let o=0;o<c.length;o++)i[c[o].id]=c[o];for(let o=0;o<c.length;o++)"ref"in c[o]&&(c[o]=de(c[o],i[c[o].ref]));return c}ce.workerCount=2;const Me={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function ke(c,i,o){o.push({command:Me.addSource,args:[c,i[c]]})}function it(c,i,o){i.push({command:Me.removeSource,args:[c]}),o[c]=!0}function lt(c,i,o,u){it(c,o,u),ke(c,i,o)}function ct(c,i,o){let u;for(u in c[o])if(c[o].hasOwnProperty(u)&&u!=="data"&&!Le(c[o][u],i[o][u]))return!1;for(u in i[o])if(i[o].hasOwnProperty(u)&&u!=="data"&&!Le(c[o][u],i[o][u]))return!1;return!0}function ht(c,i,o,u,d,f){let g;for(g in i=i||{},c=c||{})c.hasOwnProperty(g)&&(Le(c[g],i[g])||o.push({command:f,args:[u,g,i[g],d]}));for(g in i)i.hasOwnProperty(g)&&!c.hasOwnProperty(g)&&(Le(c[g],i[g])||o.push({command:f,args:[u,g,i[g],d]}))}function St(c){return c.id}function si(c,i){return c[i.id]=i,c}class hi{constructor(i,o){this.reset(i,o)}reset(i,o){this.points=i||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=s.clamp(i,0,1);let o=1,u=this._distances[o];const d=i*this.paddedLength+this.padding;for(;u<d&&o<this._distances.length;)u=this._distances[++o];const f=o-1,g=this._distances[f],x=u-g,E=x>0?(d-g)/x:0;return this.points[f].mult(1-E).add(this.points[o].mult(E))}}class ii{constructor(i,o,u){const d=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(i/u),this.yCellCount=Math.ceil(o/u);for(let g=0;g<this.xCellCount*this.yCellCount;g++)d.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=o,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,o,u,d,f){this._forEachCell(o,u,d,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(f)}insertCircle(i,o,u,d){this._forEachCell(o-d,u-d,o+d,u+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(o),this.circles.push(u),this.circles.push(d)}_insertBoxCell(i,o,u,d,f,g){this.boxCells[f].push(g)}_insertCircleCell(i,o,u,d,f,g){this.circleCells[f].push(g)}_query(i,o,u,d,f,g){if(u<0||i>this.width||d<0||o>this.height)return!f&&[];const x=[];if(i<=0&&o<=0&&this.width<=u&&this.height<=d){if(f)return!0;for(let E=0;E<this.boxKeys.length;E++)x.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const S=this.circles[3*E],I=this.circles[3*E+1],z=this.circles[3*E+2];x.push({key:this.circleKeys[E],x1:S-z,y1:I-z,x2:S+z,y2:I+z})}return g?x.filter(g):x}return this._forEachCell(i,o,u,d,this._queryCell,x,{hitTest:f,seenUids:{box:{},circle:{}}},g),f?x.length>0:x}_queryCircle(i,o,u,d,f){const g=i-u,x=i+u,E=o-u,S=o+u;if(x<0||g>this.width||S<0||E>this.height)return!d&&[];const I=[];return this._forEachCell(g,E,x,S,this._queryCellCircle,I,{hitTest:d,circle:{x:i,y:o,radius:u},seenUids:{box:{},circle:{}}},f),d?I.length>0:I}query(i,o,u,d,f){return this._query(i,o,u,d,!1,f)}hitTest(i,o,u,d,f){return this._query(i,o,u,d,!0,f)}hitTestCircle(i,o,u,d){return this._queryCircle(i,o,u,!0,d)}_queryCell(i,o,u,d,f,g,x,E){const S=x.seenUids,I=this.boxCells[f];if(I!==null){const L=this.bboxes;for(const V of I)if(!S.box[V]){S.box[V]=!0;const F=4*V;if(i<=L[F+2]&&o<=L[F+3]&&u>=L[F+0]&&d>=L[F+1]&&(!E||E(this.boxKeys[V]))){if(x.hitTest)return g.push(!0),!0;g.push({key:this.boxKeys[V],x1:L[F],y1:L[F+1],x2:L[F+2],y2:L[F+3]})}}}const z=this.circleCells[f];if(z!==null){const L=this.circles;for(const V of z)if(!S.circle[V]){S.circle[V]=!0;const F=3*V;if(this._circleAndRectCollide(L[F],L[F+1],L[F+2],i,o,u,d)&&(!E||E(this.circleKeys[V]))){if(x.hitTest)return g.push(!0),!0;{const N=L[F],J=L[F+1],U=L[F+2];g.push({key:this.circleKeys[V],x1:N-U,y1:J-U,x2:N+U,y2:J+U})}}}}}_queryCellCircle(i,o,u,d,f,g,x,E){const S=x.circle,I=x.seenUids,z=this.boxCells[f];if(z!==null){const V=this.bboxes;for(const F of z)if(!I.box[F]){I.box[F]=!0;const N=4*F;if(this._circleAndRectCollide(S.x,S.y,S.radius,V[N+0],V[N+1],V[N+2],V[N+3])&&(!E||E(this.boxKeys[F])))return g.push(!0),!0}}const L=this.circleCells[f];if(L!==null){const V=this.circles;for(const F of L)if(!I.circle[F]){I.circle[F]=!0;const N=3*F;if(this._circlesCollide(V[N],V[N+1],V[N+2],S.x,S.y,S.radius)&&(!E||E(this.circleKeys[F])))return g.push(!0),!0}}}_forEachCell(i,o,u,d,f,g,x,E){const S=this._convertToXCellCoord(i),I=this._convertToYCellCoord(o),z=this._convertToXCellCoord(u),L=this._convertToYCellCoord(d);for(let V=S;V<=z;V++)for(let F=I;F<=L;F++)if(f.call(this,i,o,u,d,this.xCellCount*F+V,g,x,E))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,o,u,d,f,g){const x=d-i,E=f-o,S=u+g;return S*S>x*x+E*E}_circleAndRectCollide(i,o,u,d,f,g,x){const E=(g-d)/2,S=Math.abs(i-(d+E));if(S>E+u)return!1;const I=(x-f)/2,z=Math.abs(o-(f+I));if(z>I+u)return!1;if(S<=E||z<=I)return!0;const L=S-E,V=z-I;return L*L+V*V<=u*u}}const di=Math.tan(85*Math.PI/180);function On(c,i,o,u,d,f){let g=s.create();if(o){if(d.projection.name==="globe")g=s.calculateGlobeMatrix(d,d.worldSize/d._projectionScaler,[0,0]),s.multiply$1(g,g,s.globeDenormalizeECEF(s.globeTileBounds(i)));else{const x=_e([],f);g[0]=x[0],g[1]=x[1],g[4]=x[2],g[5]=x[3]}u||s.rotateZ(g,g,d.angle)}else s.multiply$1(g,d.labelPlaneMatrix,c);return g}function Tn(c,i,o,u,d,f){if(o){if(d.projection.name==="globe"){const g=On(c,i,o,u,d,f);return s.invert(g,g),s.multiply$1(g,c,g),g}{const g=s.clone(c),x=s.identity([]);return x[0]=f[0],x[1]=f[1],x[4]=f[2],x[5]=f[3],s.multiply$1(g,g,x),u||s.rotateZ(g,g,-d.angle),g}}return d.glCoordMatrix}function Yi(c,i,o=0){const u=[c.x,c.y,o,1];o?s.transformMat4$1(u,u,i):ms(u,u,i);const d=u[3];return{point:new s.pointGeometry(u[0]/d,u[1]/d),signedDistanceFromCamera:d}}function cn(c,i){return Math.min(.5+c/i*.5,1.5)}function na(c,i){const o=c[0]/c[3],u=c[1]/c[3];return o>=-i[0]&&o<=i[0]&&u>=-i[1]&&u<=i[1]}function Sc(c,i,o,u,d,f,g,x,E,S){const I=o.transform,z=u?c.textSizeData:c.iconSizeData,L=s.evaluateSizeForZoom(z,o.transform.zoom),V=[256/o.width*2+1,256/o.height*2+1],F=u?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;F.clear();const N=c.lineVertexArray,J=u?c.text.placedSymbolArray:c.icon.placedSymbolArray,U=o.transform.width/o.transform.height;let H=!1;for(let K=0;K<J.length;K++){const W=J.get(K);if(W.writingMode!==s.WritingMode.vertical||H||K!==0&&J.get(K-1).writingMode===s.WritingMode.horizontal||(H=!0),W.hidden||W.writingMode===s.WritingMode.vertical&&!H){Wr(W.numGlyphs,F);continue}H=!1;const X=new s.pointGeometry(W.tileAnchorX,W.tileAnchorY),Q=E?E(X):[0,0,0],he=I.projection.projectTilePoint(X.x,X.y,S.canonical),ge=[he.x+Q[0],he.y+Q[1],he.z+Q[2]],Ge=[...ge,1];if(s.transformMat4$1(Ge,Ge,i),!na(Ge,V)){Wr(W.numGlyphs,F);continue}const De=cn(o.transform.cameraToCenterDistance,Ge[3]),Pe=s.evaluateSizeForFeature(z,L,W),ve=g?Pe/De:Pe*De,me=Yi(new s.pointGeometry(ge[0],ge[1]),d,ge[2]);if(me.signedDistanceFromCamera<=0){Wr(W.numGlyphs,F);continue}let Ae={};const Se=g?null:E,rt=yl(W,ve,!1,x,i,d,f,c.glyphOffsetArray,N,F,me.point,X,Ae,U,Se,I.projection,S);H=rt.useVertical,Se&&rt.needsFlipping&&(Ae={}),(rt.notEnoughRoom||H||rt.needsFlipping&&yl(W,ve,!0,x,i,d,f,c.glyphOffsetArray,N,F,me.point,X,Ae,U,Se,I.projection,S).notEnoughRoom)&&Wr(W.numGlyphs,F)}u?c.text.dynamicLayoutVertexBuffer.updateData(F):c.icon.dynamicLayoutVertexBuffer.updateData(F)}function gl(c,i,o,u,d,f,g,x,E,S,I,z,L,V,F){const N=x.glyphStartIndex+x.numGlyphs,J=x.lineStartIndex,U=x.lineStartIndex+x.lineLength,H=i.getoffsetX(x.glyphStartIndex),K=i.getoffsetX(N-1),W=fs(c*H,o,u,d,f,g,x.segment,J,U,E,S,I,z,L,!0,V,F);if(!W)return null;const X=fs(c*K,o,u,d,f,g,x.segment,J,U,E,S,I,z,L,!0,V,F);return X?{first:W,last:X}:null}function ps(c,i,o,u){return c.writingMode===s.WritingMode.horizontal&&Math.abs(o.y-i.y)>Math.abs(o.x-i.x)*u?{useVertical:!0}:c.writingMode===s.WritingMode.vertical?i.y<o.y?{needsFlipping:!0}:null:c.flipState!==0&&function(d,f,g){const x=(f.x-d.x)*g;return x===0||Math.abs((f.y-d.y)/x)>di}(i,o,u)?c.flipState===1?{needsFlipping:!0}:null:i.x>o.x?{needsFlipping:!0}:null}function yl(c,i,o,u,d,f,g,x,E,S,I,z,L,V,F,N,J){const U=i/24,H=c.lineOffsetX*U,K=c.lineOffsetY*U;let W;if(c.numGlyphs>1){const X=c.glyphStartIndex+c.numGlyphs,Q=c.lineStartIndex,he=c.lineStartIndex+c.lineLength,ge=gl(U,x,H,K,o,I,z,c,E,f,L,F,!1,N,J);if(!ge)return{notEnoughRoom:!0};const Ge=Yi(ge.first.point,g).point,De=Yi(ge.last.point,g).point;if(u&&!o){const Pe=ps(c,Ge,De,V);if(c.flipState=Pe&&Pe.needsFlipping?1:2,Pe)return Pe}W=[ge.first];for(let Pe=c.glyphStartIndex+1;Pe<X-1;Pe++)W.push(fs(U*x.getoffsetX(Pe),H,K,o,I,z,c.segment,Q,he,E,f,L,F,!1,!1,N,J));W.push(ge.last)}else{if(u&&!o){const Q=Yi(z,d).point,he=c.lineStartIndex+c.segment+1,ge=new s.pointGeometry(E.getx(he),E.gety(he)),Ge=Yi(ge,d),De=ps(c,Q,Ge.signedDistanceFromCamera>0?Ge.point:sa(z,ge,Q,1,d,void 0,N,J.canonical),V);if(c.flipState=De&&De.needsFlipping?1:2,De)return De}const X=fs(U*x.getoffsetX(c.glyphStartIndex),H,K,o,I,z,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,E,f,L,F,!1,!1,N,J);if(!X)return{notEnoughRoom:!0};W=[X]}for(const X of W)s.addDynamicAttributes(S,X.point,X.angle);return{}}function oa(c,i,o,u,d){const f=u.projectTilePoint(c.x,c.y,i);if(!d)return Yi(f,o,f.z);const g=d(c);return Yi(new s.pointGeometry(f.x+g[0],f.y+g[1]),o,f.z+g[2])}function sa(c,i,o,u,d,f,g,x){const E=oa(c.add(c.sub(i)._unit()),x,d,g,f).point,S=o.sub(E);return o.add(S._mult(u/S.mag()))}function fs(c,i,o,u,d,f,g,x,E,S,I,z,L,V,F,N,J){const U=u?c-i:c+i;let H=U>0?1:-1,K=0;u&&(H*=-1,K=Math.PI),H<0&&(K+=Math.PI);let W=H>0?x+g:x+g+1,X=d,Q=d,he=0,ge=0;const Ge=Math.abs(U),De=[],Pe=[];let ve=f;const me=()=>{const je=W-H;return he===0?f:new s.pointGeometry(S.getx(je),S.gety(je))},Ae=()=>sa(me(),ve,Q,Ge-he+1,I,L,N,J.canonical);for(;he+ge<=Ge;){if(W+=H,W<x||W>=E)return null;if(Q=X,De.push(X),V&&Pe.push(ve||me()),X=z[W],X===void 0){ve=new s.pointGeometry(S.getx(W),S.gety(W));const je=oa(ve,J.canonical,I,N,L);X=je.signedDistanceFromCamera>0?z[W]=je.point:Ae()}else ve=null;he+=ge,ge=Q.dist(X)}F&&L&&(ve=ve||new s.pointGeometry(S.getx(W),S.gety(W)),z[W]=X=z[W]===void 0?X:Ae(),ge=Q.dist(X));const Se=(Ge-he)/ge,rt=X.sub(Q),ut=rt.mult(Se)._add(Q);o&&ut._add(rt._unit()._perp()._mult(o*H));const bt=K+Math.atan2(X.y-Q.y,X.x-Q.x);return De.push(ut),V&&(ve=ve||new s.pointGeometry(S.getx(W),S.gety(W)),Pe.push(function(je,ot,mt){const Kt=1-mt;return new s.pointGeometry(je.x*Kt+ot.x*mt,je.y*Kt+ot.y*mt)}(Pe.length>0?Pe[Pe.length-1]:ve,ve,Se))),{point:ut,angle:bt,path:De,tilePath:Pe}}const xl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Wr(c,i){for(let o=0;o<c;o++){const u=i.length;i.resize(u+4),i.float32.set(xl,3*u)}}function ms(c,i,o){const u=i[0],d=i[1];return c[0]=o[0]*u+o[4]*d+o[12],c[1]=o[1]*u+o[5]*d+o[13],c[3]=o[3]*u+o[7]*d+o[15],c}const un=100;class gh{constructor(i,o,u=new ii(i.width+200,i.height+200,25),d=new ii(i.width+200,i.height+200,25)){this.transform=i,this.grid=u,this.ignoredGrid=d,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+un,this.screenBottomBoundary=i.height+un,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=o}placeCollisionBox(i,o,u,d,f,g,x){let E=o.projectedAnchorX,S=o.projectedAnchorY,I=o.projectedAnchorZ;const z=o.elevation,L=o.tileID;if(z&&L){const W=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),X=W.upVector(L.canonical,o.tileAnchorX,o.tileAnchorY),Q=W.upVectorScale(L.canonical);E+=X[0]*z*Q,S+=X[1]*z*Q,I+=X[2]*z*Q}const V=this.projectAndGetPerspectiveRatio(g,E,S,I,o.tileID),F=f*V.perspectiveRatio,N=(o.x1*i+u.x-o.padding)*F+V.point.x,J=(o.y1*i+u.y-o.padding)*F+V.point.y,U=(o.x2*i+u.x+o.padding)*F+V.point.x,H=(o.y2*i+u.y+o.padding)*F+V.point.y,K=V.perspectiveRatio<=.55||V.aboveHorizon;return!this.isInsideGrid(N,J,U,H)||!d&&this.grid.hitTest(N,J,U,H,x)||K?{box:[],offscreen:!1}:{box:[N,J,U,H],offscreen:this.isOffscreen(N,J,U,H)}}placeCollisionCircles(i,o,u,d,f,g,x,E,S,I,z,L,V,F){const N=[],J=this.transform.elevation,U=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),H=J?J.getAtTileOffsetFunc(F,U):Se=>[0,0,0],K=new s.pointGeometry(o.tileAnchorX,o.tileAnchorY),W=this.transform.projection.projectTilePoint(o.tileAnchorX,o.tileAnchorY,F.canonical),X=H(K),Q=[W.x+X[0],W.y+X[1],W.z+X[2]],he=this.projectAndGetPerspectiveRatio(g,Q[0],Q[1],Q[2],F),{perspectiveRatio:ge}=he,Ge=(I?f/ge:f*ge)/s.ONE_EM,De=Yi(new s.pointGeometry(Q[0],Q[1]),x,Q[2]).point,Pe=he.signedDistanceFromCamera>0?gl(Ge,d,o.lineOffsetX*Ge,o.lineOffsetY*Ge,!1,De,K,o,u,x,{},J&&!I?H:null,I&&!!J,this.transform.projection,F):null;let ve=!1,me=!1,Ae=!0;if(Pe&&!he.aboveHorizon){const Se=.5*L*ge+V,rt=new s.pointGeometry(-100,-100),ut=new s.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),bt=new hi,je=Pe.first,ot=Pe.last;let mt=[];for(let pt=je.path.length-1;pt>=1;pt--)mt.push(je.path[pt]);for(let pt=1;pt<ot.path.length;pt++)mt.push(ot.path[pt]);const Kt=2.5*Se;if(E){const pt=mt.map(J?(It,pi)=>{const Ri=H(pi<je.path.length-1?je.tilePath[je.path.length-1-pi]:ot.tilePath[pi-je.path.length+2]);return Yi(It,E,Ri[2])}:It=>Yi(It,E));mt=pt.some(It=>It.signedDistanceFromCamera<=0)?[]:pt.map(It=>It.point)}let ri=[];if(mt.length>0){const pt=mt[0].clone(),It=mt[0].clone();for(let pi=1;pi<mt.length;pi++)pt.x=Math.min(pt.x,mt[pi].x),pt.y=Math.min(pt.y,mt[pi].y),It.x=Math.max(It.x,mt[pi].x),It.y=Math.max(It.y,mt[pi].y);ri=pt.x>=rt.x&&It.x<=ut.x&&pt.y>=rt.y&&It.y<=ut.y?[mt]:It.x<rt.x||pt.x>ut.x||It.y<rt.y||pt.y>ut.y?[]:s.clipLine([mt],rt.x,rt.y,ut.x,ut.y)}for(const pt of ri){bt.reset(pt,.25*Se);let It=0;It=bt.length<=.5*Se?1:Math.ceil(bt.paddedLength/Kt)+1;for(let pi=0;pi<It;pi++){const Ri=pi/Math.max(It-1,1),fr=bt.lerp(Ri),Fr=fr.x+un,Yr=fr.y+un;N.push(Fr,Yr,Se,0);const Lt=Fr-Se,_t=Yr-Se,Pt=Fr+Se,Ti=Yr+Se;if(Ae=Ae&&this.isOffscreen(Lt,_t,Pt,Ti),me=me||this.isInsideGrid(Lt,_t,Pt,Ti),!i&&this.grid.hitTestCircle(Fr,Yr,Se,z)&&(ve=!0,!S))return{circles:[],offscreen:!1,collisionDetected:ve}}}}return{circles:!S&&ve||!me?[]:N,offscreen:Ae,collisionDetected:ve}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let u=1/0,d=1/0,f=-1/0,g=-1/0;for(const I of i){const z=new s.pointGeometry(I.x+un,I.y+un);u=Math.min(u,z.x),d=Math.min(d,z.y),f=Math.max(f,z.x),g=Math.max(g,z.y),o.push(z)}const x=this.grid.query(u,d,f,g).concat(this.ignoredGrid.query(u,d,f,g)),E={},S={};for(const I of x){const z=I.key;if(E[z.bucketInstanceId]===void 0&&(E[z.bucketInstanceId]={}),E[z.bucketInstanceId][z.featureIndex])continue;const L=[new s.pointGeometry(I.x1,I.y1),new s.pointGeometry(I.x2,I.y1),new s.pointGeometry(I.x2,I.y2),new s.pointGeometry(I.x1,I.y2)];s.polygonIntersectsPolygon(o,L)&&(E[z.bucketInstanceId][z.featureIndex]=!0,S[z.bucketInstanceId]===void 0&&(S[z.bucketInstanceId]=[]),S[z.bucketInstanceId].push(z.featureIndex))}return S}insertCollisionBox(i,o,u,d,f){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:d,collisionGroupID:f},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,o,u,d,f){const g=o?this.ignoredGrid:this.grid,x={bucketInstanceId:u,featureIndex:d,collisionGroupID:f};for(let E=0;E<i.length;E+=4)g.insertCircle(x,i[E],i[E+1],i[E+2])}projectAndGetPerspectiveRatio(i,o,u,d,f){const g=[o,u,d||0,1];let x=!1;if(d||this.transform.pitch>0){s.transformMat4$1(g,g,i);let E=!1;this.fogState&&f&&(E=function(S,I,z,L,V,F){const N=F.calculateFogTileMatrix(V),J=[I,z,L];return s.transformMat4(J,J,N),wi(S,J,F.pitch,F._fov)}(this.fogState,o,u,d||0,f.toUnwrapped(),this.transform)>.9),x=g[2]>g[3]||E}else ms(g,g,i);return{point:new s.pointGeometry((g[0]/g[3]+1)/2*this.transform.width+un,(-g[1]/g[3]+1)/2*this.transform.height+un),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/g[3]*.5,1.5),signedDistanceFromCamera:g[3],aboveHorizon:x}}isOffscreen(i,o,u,d){return u<un||i>=this.screenRightBoundary||d<un||o>this.screenBottomBoundary}isInsideGrid(i,o,u,d){return u>=0&&i<this.gridRightBoundary&&d>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const i=s.identity([]);return s.translate(i,i,[-100,-100,0]),i}}class Ic{constructor(i,o,u,d){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?o:-o))):d&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Po{constructor(i,o,u,d,f,g=!1){this.text=new Ic(i?i.text:null,o,u,f),this.icon=new Ic(i?i.icon:null,o,d,f),this.clipped=g}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ko{constructor(i,o,u,d=!1){this.text=i,this.icon=o,this.skipFade=u,this.clipped=d}}class _s{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class Mc{constructor(i,o,u,d,f){this.bucketInstanceId=i,this.featureIndex=o,this.sourceLayerIndex=u,this.bucketIndex=d,this.tileID=f}}class Ac{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const o=++this.maxGroupID;this.collisionGroups[i]={ID:o,predicate:u=>u.collisionGroupID===o}}return this.collisionGroups[i]}}function aa(c,i,o,u,d){const{horizontalAlign:f,verticalAlign:g}=s.getAnchorAlignment(c),x=-(f-.5)*i,E=-(g-.5)*o,S=s.evaluateVariableOffset(c,u);return new s.pointGeometry(x+S[0]*d,E+S[1]*d)}function Un(c,i,o,u,d){const f=new s.pointGeometry(c,i);return o&&f._rotate(u?d:-d),f}class la{constructor(i,o,u,d,f){this.transform=i.clone(),this.collisionIndex=new gh(this.transform,f),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Ac(u),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,o,u,d){const f=u.getBucket(o),g=u.latestFeatureIndex;if(!f||!g||o.id!==f.layerIds[0])return;const x=f.layers[0].layout,E=u.collisionBoxArray,S=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),I=u.tileSize/s.EXTENT,z=u.tileID.toUnwrapped(),L=this.transform.calculateProjMatrix(z),V=x.get("text-pitch-alignment")==="map",F=x.get("text-rotation-alignment")==="map";o.compileFilter();const N=o.dynamicFilter(),J=o.dynamicFilterNeedsFeature(),U=this.transform.calculatePixelsToTileUnitsMatrix(u),H=On(L,u.tileID.canonical,V,F,this.transform,U);let K=null;if(V){const Q=Tn(L,u.tileID.canonical,V,F,this.transform,U);K=s.multiply$1([],this.transform.labelPlaneMatrix,Q)}let W=null;N&&u.latestFeatureIndex&&(W={unwrappedTileID:z,dynamicFilter:N,dynamicFilterNeedsFeature:J,featureIndex:u.latestFeatureIndex}),this.retainedQueryData[f.bucketInstanceId]=new Mc(f.bucketInstanceId,g,f.sourceLayerIndex,f.index,u.tileID);const X={bucket:f,layout:x,posMatrix:L,textLabelPlaneMatrix:H,labelToScreenMatrix:K,clippingData:W,scale:S,textPixelRatio:I,holdingForFade:u.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(f.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(f.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(d)for(const Q of f.sortKeyRanges){const{sortKey:he,symbolInstanceStart:ge,symbolInstanceEnd:Ge}=Q;i.push({sortKey:he,symbolInstanceStart:ge,symbolInstanceEnd:Ge,parameters:X})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:X})}attemptAnchorPlacement(i,o,u,d,f,g,x,E,S,I,z,L,V,F,N,J,U,H){const K=[L.textOffset0,L.textOffset1],W=aa(i,u,d,K,f),X=this.collisionIndex.placeCollisionBox(f,o,Un(W.x,W.y,g,x,this.transform.angle),z,E,S,I.predicate);if((!J||this.collisionIndex.placeCollisionBox(F.getSymbolInstanceIconSize(H,this.transform.zoom,V),J,Un(W.x,W.y,g,x,this.transform.angle),z,E,S,I.predicate).box.length!==0)&&X.box.length>0){let Q;return this.prevPlacement&&this.prevPlacement.variableOffsets[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID].text&&(Q=this.prevPlacement.variableOffsets[L.crossTileID].anchor),this.variableOffsets[L.crossTileID]={textOffset:K,width:u,height:d,anchor:i,textScale:f,prevAnchor:Q},this.markUsedJustification(F,i,L,N),F.allowVerticalPlacement&&(this.markUsedOrientation(F,N,L),this.placedOrientations[L.crossTileID]=N),{shift:W,placedGlyphBoxes:X}}}placeLayerBucketPart(i,o,u,d){const{bucket:f,layout:g,posMatrix:x,textLabelPlaneMatrix:E,labelToScreenMatrix:S,clippingData:I,textPixelRatio:z,holdingForFade:L,collisionBoxArray:V,partiallyEvaluatedTextSize:F,partiallyEvaluatedIconSize:N,collisionGroup:J}=i.parameters,U=g.get("text-optional"),H=g.get("icon-optional"),K=g.get("text-allow-overlap"),W=g.get("icon-allow-overlap"),X=g.get("text-rotation-alignment")==="map",Q=g.get("text-pitch-alignment")==="map",he=g.get("icon-text-fit")!=="none",ge=g.get("symbol-z-order")==="viewport-y",Ge=K&&(W||!f.hasIconData()||H),De=W&&(K||!f.hasTextData()||U);!f.collisionArrays&&V&&f.deserializeCollisionBoxes(V),u&&d&&f.updateCollisionDebugBuffers(this.transform.zoom,V);const Pe=(ve,me,Ae)=>{if(I){const Lt={zoom:this.transform.zoom,pitch:this.transform.pitch};let _t=null;if(I.dynamicFilterNeedsFeature){const Pt=this.retainedQueryData[f.bucketInstanceId];_t=I.featureIndex.loadFeature({featureIndex:ve.featureIndex,bucketIndex:Pt.bucketIndex,sourceLayerIndex:Pt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,I.dynamicFilter)(Lt,_t,this.retainedQueryData[f.bucketInstanceId].tileID.canonical,new s.pointGeometry(ve.tileAnchorX,ve.tileAnchorY),this.transform.calculateDistanceTileData(I.unwrappedTileID)))return this.placements[ve.crossTileID]=new ko(!1,!1,!1,!0),void(o[ve.crossTileID]=!0)}if(o[ve.crossTileID])return;if(L)return void(this.placements[ve.crossTileID]=new ko(!1,!1,!1));let Se=!1,rt=!1,ut=!0,bt=null,je={box:null,offscreen:null},ot={box:null,offscreen:null},mt=null,Kt=null,ri=null,pt=0,It=0,pi=0;Ae.textFeatureIndex?pt=Ae.textFeatureIndex:ve.useRuntimeCollisionCircles&&(pt=ve.featureIndex),Ae.verticalTextFeatureIndex&&(It=Ae.verticalTextFeatureIndex);const Ri=Lt=>{Lt.tileID=this.retainedQueryData[f.bucketInstanceId].tileID,(this.transform.elevation||Lt.elevation)&&(Lt.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[f.bucketInstanceId].tileID,Lt.tileAnchorX,Lt.tileAnchorY):0)},fr=Ae.textBox;if(fr){Ri(fr);const Lt=Pt=>{let Ti=s.WritingMode.horizontal;if(f.allowVerticalPlacement&&!Pt&&this.prevPlacement){const Sr=this.prevPlacement.placedOrientations[ve.crossTileID];Sr&&(this.placedOrientations[ve.crossTileID]=Sr,Ti=Sr,this.markUsedOrientation(f,Ti,ve))}return Ti},_t=(Pt,Ti)=>{if(f.allowVerticalPlacement&&ve.numVerticalGlyphVertices>0&&Ae.verticalTextBox){for(const Sr of f.writingModes)if(Sr===s.WritingMode.vertical?(je=Ti(),ot=je):je=Pt(),je&&je.box&&je.box.length)break}else je=Pt()};if(g.get("text-variable-anchor")){let Pt=g.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ve.crossTileID]){const ci=this.prevPlacement.variableOffsets[ve.crossTileID];Pt.indexOf(ci.anchor)>0&&(Pt=Pt.filter(Ir=>Ir!==ci.anchor),Pt.unshift(ci.anchor))}const Ti=(ci,Ir,Ns)=>{const mr=f.getSymbolInstanceTextSize(F,ve,this.transform.zoom,me),mo=(ci.x2-ci.x1)*mr+2*ci.padding,et=(ci.y2-ci.y1)*mr+2*ci.padding,st=he&&!W?Ir:null;st&&Ri(st);let Zi={box:[],offscreen:!1};const _o=K?2*Pt.length:Pt.length;for(let Kn=0;Kn<_o;++Kn){const Qi=this.attemptAnchorPlacement(Pt[Kn%Pt.length],ci,mo,et,mr,X,Q,z,x,J,Kn>=Pt.length,ve,me,f,Ns,st,F,N);if(Qi&&(Zi=Qi.placedGlyphBoxes,Zi&&Zi.box&&Zi.box.length)){Se=!0,bt=Qi.shift;break}}return Zi};_t(()=>Ti(fr,Ae.iconBox,s.WritingMode.horizontal),()=>{const ci=Ae.verticalTextBox;return ci&&Ri(ci),f.allowVerticalPlacement&&!(je&&je.box&&je.box.length)&&ve.numVerticalGlyphVertices>0&&ci?Ti(ci,Ae.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null}}),je&&(Se=je.box,ut=je.offscreen);const Sr=Lt(je&&je.box);if(!Se&&this.prevPlacement){const ci=this.prevPlacement.variableOffsets[ve.crossTileID];ci&&(this.variableOffsets[ve.crossTileID]=ci,this.markUsedJustification(f,ci.anchor,ve,Sr))}}else{const Pt=(Ti,Sr)=>{const ci=f.getSymbolInstanceTextSize(F,ve,this.transform.zoom,me),Ir=this.collisionIndex.placeCollisionBox(ci,Ti,new s.pointGeometry(0,0),K,z,x,J.predicate);return Ir&&Ir.box&&Ir.box.length&&(this.markUsedOrientation(f,Sr,ve),this.placedOrientations[ve.crossTileID]=Sr),Ir};_t(()=>Pt(fr,s.WritingMode.horizontal),()=>{const Ti=Ae.verticalTextBox;return f.allowVerticalPlacement&&ve.numVerticalGlyphVertices>0&&Ti?(Ri(Ti),Pt(Ti,s.WritingMode.vertical)):{box:null,offscreen:null}}),Lt(je&&je.box&&je.box.length)}}if(mt=je,Se=mt&&mt.box&&mt.box.length>0,ut=mt&&mt.offscreen,ve.useRuntimeCollisionCircles){const Lt=f.text.placedSymbolArray.get(ve.centerJustifiedTextSymbolIndex>=0?ve.centerJustifiedTextSymbolIndex:ve.verticalPlacedTextSymbolIndex),_t=s.evaluateSizeForFeature(f.textSizeData,F,Lt),Pt=g.get("text-padding");Kt=this.collisionIndex.placeCollisionCircles(K,Lt,f.lineVertexArray,f.glyphOffsetArray,_t,x,E,S,u,Q,J.predicate,ve.collisionCircleDiameter*_t/s.ONE_EM,Pt,this.retainedQueryData[f.bucketInstanceId].tileID),Se=K||Kt.circles.length>0&&!Kt.collisionDetected,ut=ut&&Kt.offscreen}if(Ae.iconFeatureIndex&&(pi=Ae.iconFeatureIndex),Ae.iconBox){const Lt=_t=>{Ri(_t);const Pt=he&&bt?Un(bt.x,bt.y,X,Q,this.transform.angle):new s.pointGeometry(0,0),Ti=f.getSymbolInstanceIconSize(N,this.transform.zoom,me);return this.collisionIndex.placeCollisionBox(Ti,_t,Pt,W,z,x,J.predicate)};ot&&ot.box&&ot.box.length&&Ae.verticalIconBox?(ri=Lt(Ae.verticalIconBox),rt=ri.box.length>0):(ri=Lt(Ae.iconBox),rt=ri.box.length>0),ut=ut&&ri.offscreen}const Fr=U||ve.numHorizontalGlyphVertices===0&&ve.numVerticalGlyphVertices===0,Yr=H||ve.numIconVertices===0;if(Fr||Yr?Yr?Fr||(rt=rt&&Se):Se=rt&&Se:rt=Se=rt&&Se,Se&&mt&&mt.box&&this.collisionIndex.insertCollisionBox(mt.box,g.get("text-ignore-placement"),f.bucketInstanceId,ot&&ot.box&&It?It:pt,J.ID),rt&&ri&&this.collisionIndex.insertCollisionBox(ri.box,g.get("icon-ignore-placement"),f.bucketInstanceId,pi,J.ID),Kt&&(Se&&this.collisionIndex.insertCollisionCircles(Kt.circles,g.get("text-ignore-placement"),f.bucketInstanceId,pt,J.ID),u)){const Lt=f.bucketInstanceId;let _t=this.collisionCircleArrays[Lt];_t===void 0&&(_t=this.collisionCircleArrays[Lt]=new _s);for(let Pt=0;Pt<Kt.circles.length;Pt+=4)_t.circles.push(Kt.circles[Pt+0]),_t.circles.push(Kt.circles[Pt+1]),_t.circles.push(Kt.circles[Pt+2]),_t.circles.push(Kt.collisionDetected?1:0)}this.placements[ve.crossTileID]=new ko(Se||Ge,rt||De,ut||f.justReloaded),o[ve.crossTileID]=!0};if(ge){const ve=f.getSortedSymbolIndexes(this.transform.angle);for(let me=ve.length-1;me>=0;--me){const Ae=ve[me];Pe(f.symbolInstances.get(Ae),Ae,f.collisionArrays[Ae])}}else for(let ve=i.symbolInstanceStart;ve<i.symbolInstanceEnd;ve++)Pe(f.symbolInstances.get(ve),ve,f.collisionArrays[ve]);if(u&&f.bucketInstanceId in this.collisionCircleArrays){const ve=this.collisionCircleArrays[f.bucketInstanceId];s.invert(ve.invProjMatrix,x),ve.viewportMatrix=this.collisionIndex.getViewportMatrix()}f.justReloaded=!1}markUsedJustification(i,o,u,d){let f;f=d===s.WritingMode.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(o)];const g=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const x of g)x>=0&&(i.text.placedSymbolArray.get(x).crossTileID=f>=0&&x!==f?0:u.crossTileID)}markUsedOrientation(i,o,u){const d=o===s.WritingMode.horizontal||o===s.WritingMode.horizontalOnly?o:0,f=o===s.WritingMode.vertical?o:0,g=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const x of g)i.text.placedSymbolArray.get(x).placedOrientation=d;u.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let u=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const d=o?o.symbolFadeChange(i):1,f=o?o.opacities:{},g=o?o.variableOffsets:{},x=o?o.placedOrientations:{};for(const E in this.placements){const S=this.placements[E],I=f[E];I?(this.opacities[E]=new Po(I,d,S.text,S.icon,null,S.clipped),u=u||S.text!==I.text.placed||S.icon!==I.icon.placed):(this.opacities[E]=new Po(null,d,S.text,S.icon,S.skipFade,S.clipped),u=u||S.text||S.icon)}for(const E in f){const S=f[E];if(!this.opacities[E]){const I=new Po(S,d,!1,!1);I.isHidden()||(this.opacities[E]=I,u=u||S.text.placed||S.icon.placed)}}for(const E in g)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=g[E]);for(const E in x)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=x[E]);u?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:i)}updateLayerOpacities(i,o){const u={};for(const d of o){const f=d.getBucket(i);f&&d.latestFeatureIndex&&i.id===f.layerIds[0]&&this.updateBucketOpacities(f,u,d.collisionBoxArray)}}updateBucketOpacities(i,o,u){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const d=i.layers[0].layout,f=!!i.layers[0].dynamicFilter(),g=new Po(null,0,!1,!1,!0),x=d.get("text-allow-overlap"),E=d.get("icon-allow-overlap"),S=d.get("text-variable-anchor"),I=d.get("text-rotation-alignment")==="map",z=d.get("text-pitch-alignment")==="map",L=d.get("icon-text-fit")!=="none",V=new Po(null,0,x&&(E||!i.hasIconData()||d.get("icon-optional")),E&&(x||!i.hasTextData()||d.get("text-optional")),!0);!i.collisionArrays&&u&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(u);const F=(J,U,H)=>{for(let K=0;K<U/4;K++)J.opacityVertexArray.emplaceBack(H)};let N=0;for(let J=0;J<i.symbolInstances.length;J++){const U=i.symbolInstances.get(J),{numHorizontalGlyphVertices:H,numVerticalGlyphVertices:K,crossTileID:W}=U;let X=this.opacities[W];o[W]?X=g:X||(X=V,this.opacities[W]=X),o[W]=!0;const Q=H>0||K>0,he=U.numIconVertices>0,ge=this.placedOrientations[U.crossTileID],Ge=ge===s.WritingMode.vertical,De=ge===s.WritingMode.horizontal||ge===s.WritingMode.horizontalOnly;if(!Q&&!he||X.isHidden()||N++,Q){const Pe=ca(X.text);F(i.text,H,Ge?jn:Pe),F(i.text,K,De?jn:Pe);const ve=X.text.isHidden();[U.rightJustifiedTextSymbolIndex,U.centerJustifiedTextSymbolIndex,U.leftJustifiedTextSymbolIndex].forEach(Se=>{Se>=0&&(i.text.placedSymbolArray.get(Se).hidden=ve||Ge?1:0)}),U.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(U.verticalPlacedTextSymbolIndex).hidden=ve||De?1:0);const me=this.variableOffsets[U.crossTileID];me&&this.markUsedJustification(i,me.anchor,U,ge);const Ae=this.placedOrientations[U.crossTileID];Ae&&(this.markUsedJustification(i,"left",U,Ae),this.markUsedOrientation(i,Ae,U))}if(he){const Pe=ca(X.icon);U.placedIconSymbolIndex>=0&&(F(i.icon,U.numIconVertices,Ge?jn:Pe),i.icon.placedSymbolArray.get(U.placedIconSymbolIndex).hidden=X.icon.isHidden()),U.verticalPlacedIconSymbolIndex>=0&&(F(i.icon,U.numVerticalIconVertices,De?jn:Pe),i.icon.placedSymbolArray.get(U.verticalPlacedIconSymbolIndex).hidden=X.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Pe=i.collisionArrays[J];if(Pe){let ve=new s.pointGeometry(0,0),me=!0;if(Pe.textBox||Pe.verticalTextBox){if(S){const Se=this.variableOffsets[W];Se?(ve=aa(Se.anchor,Se.width,Se.height,Se.textOffset,Se.textScale),I&&ve._rotate(z?this.transform.angle:-this.transform.angle)):me=!1}f&&(me=!X.clipped),Pe.textBox&&Vn(i.textCollisionBox.collisionVertexArray,X.text.placed,!me||Ge,ve.x,ve.y),Pe.verticalTextBox&&Vn(i.textCollisionBox.collisionVertexArray,X.text.placed,!me||De,ve.x,ve.y)}const Ae=me&&Boolean(!De&&Pe.verticalIconBox);Pe.iconBox&&Vn(i.iconCollisionBox.collisionVertexArray,X.icon.placed,Ae,L?ve.x:0,L?ve.y:0),Pe.verticalIconBox&&Vn(i.iconCollisionBox.collisionVertexArray,X.icon.placed,!Ae,L?ve.x:0,L?ve.y:0)}}}if(i.fullyClipped=N===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=J.invProjMatrix,i.placementViewportMatrix=J.viewportMatrix,i.collisionCircleArray=J.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,o){const u=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*u>i}setStale(){this.stale=!0}}function Vn(c,i,o,u,d){c.emplaceBack(i?1:0,o?1:0,u||0,d||0),c.emplaceBack(i?1:0,o?1:0,u||0,d||0),c.emplaceBack(i?1:0,o?1:0,u||0,d||0),c.emplaceBack(i?1:0,o?1:0,u||0,d||0)}const xe=Math.pow(2,25),He=Math.pow(2,24),Cc=Math.pow(2,17),Nn=Math.pow(2,16),Si=Math.pow(2,9),En=Math.pow(2,8),hn=Math.pow(2,1);function ca(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const i=c.placed?1:0,o=Math.floor(127*c.opacity);return o*xe+i*He+o*Cc+i*Nn+o*Si+i*En+o*hn+i}const jn=0;class Xe{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,o,u,d,f){const g=this._bucketParts;for(;this._currentTileIndex<i.length;)if(o.getBucketParts(g,d,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,g.sort((x,E)=>x.sortKey-E.sortKey));this._currentPartIndex<g.length;){const x=g[this._currentPartIndex];if(o.placeLayerBucketPart(x,this._seenCrossTileIDs,u,x.symbolInstanceStart===0),this._currentPartIndex++,f())return!0}return!1}}class zt{constructor(i,o,u,d,f,g,x,E){this.placement=new la(i,f,g,x,E),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(i,o,u){const d=s.exported.now(),f=()=>{const g=s.exported.now()-d;return!this._forceFullPlacement&&g>2};for(;this._currentPlacementIndex>=0;){const g=o[i[this._currentPlacementIndex]],x=this.placement.collisionIndex.transform.zoom;if(g.type==="symbol"&&(!g.minzoom||g.minzoom<=x)&&(!g.maxzoom||g.maxzoom>x)){if(this._inProgressLayer||(this._inProgressLayer=new Xe(g)),this._inProgressLayer.continuePlacement(u[g.source],this.placement,this._showCollisionBoxes,g,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Tt=512/s.EXTENT/2;class dn{constructor(i,o,u){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=u;for(let d=0;d<o.length;d++){const f=o.get(d),g=f.key;this.indexedSymbolInstances[g]||(this.indexedSymbolInstances[g]=[]),this.indexedSymbolInstances[g].push({crossTileID:f.crossTileID,coord:this.getScaledCoordinates(f,i)})}}getScaledCoordinates(i,o){const u=Tt/Math.pow(2,o.canonical.z-this.tileID.canonical.z);return{x:Math.floor((o.canonical.x*s.EXTENT+i.tileAnchorX)*u),y:Math.floor((o.canonical.y*s.EXTENT+i.tileAnchorY)*u)}}findMatches(i,o,u){const d=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let f=0;f<i.length;f++){const g=i.get(f);if(g.crossTileID)continue;const x=this.indexedSymbolInstances[g.key];if(!x)continue;const E=this.getScaledCoordinates(g,o);for(const S of x)if(Math.abs(S.coord.x-E.x)<=d&&Math.abs(S.coord.y-E.y)<=d&&!u[S.crossTileID]){u[S.crossTileID]=!0,g.crossTileID=S.crossTileID;break}}}}class Do{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Et{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const o=Math.round((i-this.lng)/360);if(o!==0)for(const u in this.indexes){const d=this.indexes[u],f={};for(const g in d){const x=d[g];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+o),f[x.tileID.key]=x}this.indexes[u]=f}this.lng=i}addBucket(i,o,u){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let f=0;f<o.symbolInstances.length;f++)o.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const d=this.usedCrossTileIDs[i.overscaledZ];for(const f in this.indexes){const g=this.indexes[f];if(Number(f)>i.overscaledZ)for(const x in g){const E=g[x];E.tileID.isChildOf(i)&&E.findMatches(o.symbolInstances,i,d)}else{const x=g[i.scaledTo(Number(f)).key];x&&x.findMatches(o.symbolInstances,i,d)}}for(let f=0;f<o.symbolInstances.length;f++){const g=o.symbolInstances.get(f);g.crossTileID||(g.crossTileID=u.generate(),d[g.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new dn(i,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(i,o){for(const u in o.indexedSymbolInstances)for(const d of o.indexedSymbolInstances[u])delete this.usedCrossTileIDs[i][d.crossTileID]}removeStaleBuckets(i){let o=!1;for(const u in this.indexes){const d=this.indexes[u];for(const f in d)i[d[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,d[f]),delete d[f],o=!0)}return o}}class gs{constructor(){this.layerIndexes={},this.crossTileIDs=new Do,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,o,u,d){let f=this.layerIndexes[i.id];f===void 0&&(f=this.layerIndexes[i.id]=new Et);let g=!1;const x={};d.name!=="globe"&&f.handleWrapJump(u);for(const E of o){const S=E.getBucket(i);S&&i.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(E.tileID,S,this.crossTileIDs)&&(g=!0),x[S.bucketInstanceId]=!0)}return f.removeStaleBuckets(x)&&(g=!0),g}pruneUnusedLayers(i){const o={};i.forEach(u=>{o[u]=!0});for(const u in this.layerIndexes)o[u]||delete this.layerIndexes[u]}}const Gn=(c,i)=>s.emitValidationErrors(c,i&&i.filter(o=>o.identifier!=="source.canvas")),ys=s.pick(Me,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Dr=s.pick(Me,["setCenter","setZoom","setBearing","setPitch"]),yi=function(){const c={},i=s.spec.$version;for(const o in s.spec.$root){const u=s.spec.$root[o];if(u.required){let d=null;d=o==="version"?i:u.type==="array"?[]:{},d!=null&&(c[o]=d)}}return c}(),yh={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class dr extends s.Evented{constructor(i,o={}){super(),this.map=i,this.dispatcher=new mi(ne(),this),this.imageManager=new Wt,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(i._requestManager,o.localFontFamily?s.LocalGlyphMode.all:o.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,o.localFontFamily||o.localIdeographFontFamily),this.lineAtlas=new s.LineAtlas(256,512),this.crossTileSymbolIndex=new gs,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const u=this;this._rtlTextPluginCallback=dr.registerForPluginStateChange(d=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:d.pluginStatus,pluginURL:d.pluginURL},(f,g)=>{if(s.triggerPluginCompletionEvent(f),g&&g.every(x=>x))for(const x in u._sourceCaches){const E=u._sourceCaches[x],S=E.getSource().type;S!=="vector"&&S!=="geojson"||E.reload()}})}),this.on("data",d=>{if(d.dataType!=="source"||d.sourceDataType!=="metadata")return;const f=this.getSource(d.sourceId);if(f&&f.vectorLayerIds)for(const g in this._layers){const x=this._layers[g];x.source===f.id&&this._validateLayer(x)}})}loadURL(i,o={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const u=typeof o.validate=="boolean"?o.validate:!s.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,o.accessToken);const d=this.map._requestManager.transformRequest(i,s.ResourceType.Style);this._request=s.getJSON(d,(f,g)=>{this._request=null,f?this.fire(new s.ErrorEvent(f)):g&&this._load(g,u)})}loadJSON(i,o={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(i,o.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(yi,!1)}_updateLayerCount(i,o){const u=o?1:-1;i.is3D()&&(this._num3DLayers+=u),i.type==="circle"&&(this._numCircleLayers+=u),i.type==="symbol"&&(this._numSymbolLayers+=u)}_load(i,o){if(o&&Gn(this,s.validateStyle(i)))return;this._loaded=!0,this.stylesheet=i,this.updateProjection();for(const d in i.sources)this.addSource(d,i.sources[d],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const u=Ee(this.stylesheet.layers);this._order=u.map(d=>d.id),this._layers={},this._serializedLayers={};for(let d of u)d=s.createStyleLayer(d),d.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=d,this._serializedLayers[d.id]=d.serialize(),this._updateLayerCount(d,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Vt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&this.terrain.drapeRenderMode===0}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const i=this.map.transform.projection,o=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),u=this.map.transform.projection;if(this._loaded&&(u.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),o){if(u.isReprojectedInTileSpace||i.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const d in this._sourceCaches)this._sourceCaches[d].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(i){this._spriteRequest=function(o,u,d){let f,g,x;const E=s.exported.devicePixelRatio>1?"@2x":"";let S=s.getJSON(u.transformRequest(u.normalizeSpriteURL(o,E,".json"),s.ResourceType.SpriteJSON),(L,V)=>{S=null,x||(x=L,f=V,z())}),I=s.getImage(u.transformRequest(u.normalizeSpriteURL(o,E,".png"),s.ResourceType.SpriteImage),(L,V)=>{I=null,x||(x=L,g=V,z())});function z(){if(x)d(x);else if(f&&g){const L=s.exported.getImageData(g),V={};for(const F in f){const{width:N,height:J,x:U,y:H,sdf:K,pixelRatio:W,stretchX:X,stretchY:Q,content:he}=f[F],ge=new s.RGBAImage({width:N,height:J});s.RGBAImage.copy(L,ge,{x:U,y:H},{x:0,y:0},{width:N,height:J}),V[F]={data:ge,pixelRatio:W,sdf:K,stretchX:X,stretchY:Q,content:he}}d(null,V)}}return{cancel(){S&&(S.cancel(),S=null),I&&(I.cancel(),I=null)}}}(i,this.map._requestManager,(o,u)=>{if(this._spriteRequest=null,o)this.fire(new s.ErrorEvent(o));else if(u)for(const d in u)this.imageManager.addImage(d,u[d]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(i){const o=this.getSource(i.source);if(!o)return;const u=i.sourceLayer;u&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(u)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${u}" does not exist on source "${o.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const o=[];for(const u of i){const d=this._layers[u];d.type!=="custom"&&o.push(d.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&yh[i.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const o=this._changed;if(this._changed){const d=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(d.length||f.length)&&this._updateWorkerLayers(d,f);for(const g in this._updatedSources){const x=this._updatedSources[g];x==="reload"?this._reloadSource(g):x==="clear"&&this._clearSource(g)}this._updateTilesForChangedImages();for(const g in this._updatedPaintProps)this._layers[g].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const u={};for(const d in this._sourceCaches){const f=this._sourceCaches[d];u[d]=f.used,f.used=!1}for(const d of this._order){const f=this._layers[d];if(f.recalculate(i,this._availableImages),!f.isHidden(i.zoom)){const x=this._getLayerSourceCache(f);x&&(x.used=!0)}const g=this.map.painter;if(g){const x=f.getProgramIds();if(!x)continue;const E=f.getProgramConfiguration(i.zoom);for(const S of x)g.useProgram(S,E)}}for(const d in u){const f=this._sourceCaches[d];u[d]!==f.used&&f.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:f.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),o&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,o){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),Gn(this,s.validateStyle(i)))return!1;(i=s.clone$1(i)).layers=Ee(i.layers);const o=function(d,f){if(!d)return[{command:Me.setStyle,args:[f]}];let g=[];try{if(!Le(d.version,f.version))return[{command:Me.setStyle,args:[f]}];Le(d.center,f.center)||g.push({command:Me.setCenter,args:[f.center]}),Le(d.zoom,f.zoom)||g.push({command:Me.setZoom,args:[f.zoom]}),Le(d.bearing,f.bearing)||g.push({command:Me.setBearing,args:[f.bearing]}),Le(d.pitch,f.pitch)||g.push({command:Me.setPitch,args:[f.pitch]}),Le(d.sprite,f.sprite)||g.push({command:Me.setSprite,args:[f.sprite]}),Le(d.glyphs,f.glyphs)||g.push({command:Me.setGlyphs,args:[f.glyphs]}),Le(d.transition,f.transition)||g.push({command:Me.setTransition,args:[f.transition]}),Le(d.light,f.light)||g.push({command:Me.setLight,args:[f.light]}),Le(d.fog,f.fog)||g.push({command:Me.setFog,args:[f.fog]}),Le(d.projection,f.projection)||g.push({command:Me.setProjection,args:[f.projection]});const x={},E=[];(function(z,L,V,F){let N;for(N in L=L||{},z=z||{})z.hasOwnProperty(N)&&(L.hasOwnProperty(N)||it(N,V,F));for(N in L)L.hasOwnProperty(N)&&(z.hasOwnProperty(N)?Le(z[N],L[N])||(z[N].type==="geojson"&&L[N].type==="geojson"&&ct(z,L,N)?V.push({command:Me.setGeoJSONSourceData,args:[N,L[N].data]}):lt(N,L,V,F)):ke(N,L,V))})(d.sources,f.sources,E,x);const S=[];d.layers&&d.layers.forEach(z=>{x[z.source]?g.push({command:Me.removeLayer,args:[z.id]}):S.push(z)});let I=d.terrain;I&&x[I.source]&&(g.push({command:Me.setTerrain,args:[void 0]}),I=void 0),g=g.concat(E),Le(I,f.terrain)||g.push({command:Me.setTerrain,args:[f.terrain]}),function(z,L,V){L=L||[];const F=(z=z||[]).map(St),N=L.map(St),J=z.reduce(si,{}),U=L.reduce(si,{}),H=F.slice(),K=Object.create(null);let W,X,Q,he,ge,Ge,De;for(W=0,X=0;W<F.length;W++)Q=F[W],U.hasOwnProperty(Q)?X++:(V.push({command:Me.removeLayer,args:[Q]}),H.splice(H.indexOf(Q,X),1));for(W=0,X=0;W<N.length;W++)Q=N[N.length-1-W],H[H.length-1-W]!==Q&&(J.hasOwnProperty(Q)?(V.push({command:Me.removeLayer,args:[Q]}),H.splice(H.lastIndexOf(Q,H.length-X),1)):X++,Ge=H[H.length-W],V.push({command:Me.addLayer,args:[U[Q],Ge]}),H.splice(H.length-W,0,Q),K[Q]=!0);for(W=0;W<N.length;W++)if(Q=N[W],he=J[Q],ge=U[Q],!K[Q]&&!Le(he,ge))if(Le(he.source,ge.source)&&Le(he["source-layer"],ge["source-layer"])&&Le(he.type,ge.type)){for(De in ht(he.layout,ge.layout,V,Q,null,Me.setLayoutProperty),ht(he.paint,ge.paint,V,Q,null,Me.setPaintProperty),Le(he.filter,ge.filter)||V.push({command:Me.setFilter,args:[Q,ge.filter]}),Le(he.minzoom,ge.minzoom)&&Le(he.maxzoom,ge.maxzoom)||V.push({command:Me.setLayerZoomRange,args:[Q,ge.minzoom,ge.maxzoom]}),he)he.hasOwnProperty(De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&(De.indexOf("paint.")===0?ht(he[De],ge[De],V,Q,De.slice(6),Me.setPaintProperty):Le(he[De],ge[De])||V.push({command:Me.setLayerProperty,args:[Q,De,ge[De]]}));for(De in ge)ge.hasOwnProperty(De)&&!he.hasOwnProperty(De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&(De.indexOf("paint.")===0?ht(he[De],ge[De],V,Q,De.slice(6),Me.setPaintProperty):Le(he[De],ge[De])||V.push({command:Me.setLayerProperty,args:[Q,De,ge[De]]}))}else V.push({command:Me.removeLayer,args:[Q]}),Ge=H[H.lastIndexOf(Q)+1],V.push({command:Me.addLayer,args:[ge,Ge]})}(S,f.layers,g)}catch(x){console.warn("Unable to compute style diff:",x),g=[{command:Me.setStyle,args:[f]}]}return g}(this.serialize(),i).filter(d=>!(d.command in Dr));if(o.length===0)return!1;const u=o.filter(d=>!(d.command in ys));if(u.length>0)throw new Error(`Unimplemented: ${u.map(d=>d.command).join(", ")}.`);return o.forEach(d=>{d.command!=="setTransition"&&this[d.command].apply(this,d.args)}),this.stylesheet=i,this.updateProjection(),!0}addImage(i,o){if(this.getImage(i))return this.fire(new s.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(i,o),this._afterImageUpdated(i)}updateImage(i,o){this.imageManager.updateImage(i,o)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new s.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,o,u={}){if(this._checkLoaded(),this.getSource(i)!==void 0)throw new Error("There is already a source with this ID");if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(s.validateStyle.source,`sources.${i}`,o,null,u))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const d=Tr(i,o,this.dispatcher,this);d.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:d.serialize(),sourceId:i}));const f=g=>{const x=(g?"symbol:":"other:")+i,E=this._sourceCaches[x]=new s.SourceCache(x,d,g);(g?this._symbolSourceCaches:this._otherSourceCaches)[i]=E,E.style=this,E.onAdd(this.map)};f(!1),o.type!=="vector"&&o.type!=="geojson"||f(!0),d.onAdd&&d.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const o=this.getSource(i);if(o===void 0)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===i)return this.fire(new s.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${d}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new s.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const u=this._getSourceCaches(i);for(const d of u)delete this._sourceCaches[d.id],delete this._updatedSources[d.id],d.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:d.getSource().id})),d.setEventedParent(null),d.clearTiles();delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,o){this._checkLoaded(),this.getSource(i).setData(o),this._changed=!0}getSource(i){const o=this._getSourceCache(i);return o&&o.getSource()}addLayer(i,o,u={}){this._checkLoaded();const d=i.id;if(this.getLayer(d))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${d}" already exists on this map`)));let f;if(i.type==="custom"){if(Gn(this,s.validateCustomStyleLayer(i)))return;f=s.createStyleLayer(i)}else{if(typeof i.source=="object"&&(this.addSource(d,i.source),i=s.clone$1(i),i=s.extend(i,{source:d})),this._validate(s.validateStyle.layer,`layers.${d}`,i,{arrayIndex:-1},u))return;f=s.createStyleLayer(i),this._validateLayer(f),f.setEventedParent(this,{layer:{id:d}}),this._serializedLayers[f.id]=f.serialize(),this._updateLayerCount(f,!0)}const g=o?this._order.indexOf(o):this._order.length;if(o&&g===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`)));this._order.splice(g,0,d),this._layerOrderChanged=!0,this._layers[d]=f;const x=this._getLayerSourceCache(f);if(this._removedLayers[d]&&f.source&&x&&f.type!=="custom"){const E=this._removedLayers[d];delete this._removedLayers[d],E.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",x.pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,o){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new s.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===o)return;const u=this._order.indexOf(i);this._order.splice(u,1);const d=o?this._order.indexOf(o):this._order.length;o&&d===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`))):(this._order.splice(d,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const o=this._layers[i];if(!o)return void this.fire(new s.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));o.setEventedParent(null),this._updateLayerCount(o,!1);const u=this._order.indexOf(i);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=o,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],o.onRemove&&o.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const o in this._layers)if(this._layers[o].type===i)return!0;return!1}setLayerZoomRange(i,o,u){this._checkLoaded();const d=this.getLayer(i);d?d.minzoom===o&&d.maxzoom===u||(o!=null&&(d.minzoom=o),u!=null&&(d.maxzoom=u),this._updateLayer(d)):this.fire(new s.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,o,u={}){this._checkLoaded();const d=this.getLayer(i);if(d){if(!Le(d.filter,o))return o==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(s.validateStyle.filter,`layers.${d.id}.filter`,o,{layerType:d.type},u)||(d.filter=s.clone$1(o),this._updateLayer(d)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){return s.clone$1(this.getLayer(i).filter)}setLayoutProperty(i,o,u,d={}){this._checkLoaded();const f=this.getLayer(i);f?Le(f.getLayoutProperty(o),u)||(f.setLayoutProperty(o,u,d),this._updateLayer(f)):this.fire(new s.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,o){const u=this.getLayer(i);if(u)return u.getLayoutProperty(o);this.fire(new s.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,o,u,d={}){this._checkLoaded();const f=this.getLayer(i);f?Le(f.getPaintProperty(o),u)||(f.setPaintProperty(o,u,d)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,o){return this.getLayer(i).getPaintProperty(o)}setFeatureState(i,o){this._checkLoaded();const u=i.source,d=i.sourceLayer,f=this.getSource(u);if(f===void 0)return void this.fire(new s.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const g=f.type;if(g==="geojson"&&d)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(g==="vector"&&!d)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const x=this._getSourceCaches(u);for(const E of x)E.setFeatureState(d,i.id,o)}removeFeatureState(i,o){this._checkLoaded();const u=i.source,d=this.getSource(u);if(d===void 0)return void this.fire(new s.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const f=d.type,g=f==="vector"?i.sourceLayer:void 0;if(f==="vector"&&!g)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const x=this._getSourceCaches(u);for(const E of x)E.removeFeatureState(g,i.id,o)}getFeatureState(i){this._checkLoaded();const o=i.source,u=i.sourceLayer,d=this.getSource(o);if(d!==void 0){if(d.type!=="vector"||u)return i.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(o)[0].getFeatureState(u,i.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const o in this._sourceCaches){const u=this._sourceCaches[o].getSource();i[u.id]||(i[u.id]=u.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},o=>o!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0;const o=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&o&&o.getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",o.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const o=g=>this._layers[g].type==="fill-extrusion",u={},d=[];for(let g=this._order.length-1;g>=0;g--){const x=this._order[g];if(o(x)){u[x]=g;for(const E of i){const S=E[x];if(S)for(const I of S)d.push(I)}}}d.sort((g,x)=>x.intersectionZ-g.intersectionZ);const f=[];for(let g=this._order.length-1;g>=0;g--){const x=this._order[g];if(o(x))for(let E=d.length-1;E>=0;E--){const S=d[E].feature;if(u[S.layer.id]<g)break;f.push(S),d.pop()}else for(const E of i){const S=E[x];if(S)for(const I of S)f.push(I.feature)}}return f}queryRenderedFeatures(i,o,u){o&&o.filter&&this._validate(s.validateStyle.filter,"queryRenderedFeatures.filter",o.filter,null,o);const d={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const E of o.layers){const S=this._layers[E];if(!S)return this.fire(new s.ErrorEvent(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];d[S.source]=!0}}const f=[];o.availableImages=this._availableImages;const g=o&&o.layers?o.layers.some(E=>{const S=this.getLayer(E);return S&&S.is3D()}):this.has3DLayers(),x=Ao.createFromScreenPoints(i,u);for(const E in this._sourceCaches){const S=this._sourceCaches[E].getSource().id;o.layers&&!d[S]||f.push(M(this._sourceCaches[E],this._layers,this._serializedLayers,x,o,u,g,!!this.map._showQueryGeometry))}return this.placement&&f.push(function(E,S,I,z,L,V,F){const N={},J=V.queryRenderedSymbols(z),U=[];for(const H of Object.keys(J).map(Number))U.push(F[H]);U.sort(G);for(const H of U){const K=H.featureIndex.lookupSymbolFeatures(J[H.bucketInstanceId],S,H.bucketIndex,H.sourceLayerIndex,L.filter,L.layers,L.availableImages,E);for(const W in K){const X=N[W]=N[W]||[],Q=K[W];Q.sort((he,ge)=>{const Ge=H.featureSortOrder;if(Ge){const De=Ge.indexOf(he.featureIndex);return Ge.indexOf(ge.featureIndex)-De}return ge.featureIndex-he.featureIndex});for(const he of Q)X.push(he)}}for(const H in N)N[H].forEach(K=>{const W=K.feature,X=I(E[H]).getFeatureState(W.layer["source-layer"],W.id);W.source=W.layer.source,W.layer["source-layer"]&&(W.sourceLayer=W.layer["source-layer"]),W.state=X});return N}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),x.screenGeometry,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(i,o){o&&o.filter&&this._validate(s.validateStyle.filter,"querySourceFeatures.filter",o.filter,null,o);const u=this._getSourceCaches(i);let d=[];for(const f of u)d=d.concat(k(f,o));return d}addSourceType(i,o,u){return dr.getSourceType(i)?u(new Error(`A source type called "${i}" already exists.`)):(dr.setSourceType(i,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:o.workerSourceURL},u):u(null,null))}getLight(){return this.light.getLight()}setLight(i,o={}){this._checkLoaded();const u=this.light.getLight();let d=!1;for(const g in i)if(!Le(i[g],u[g])){d=!0;break}if(!d)return;const f={now:s.exported.now(),transition:s.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,o),this.light.updateTransitions(f)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,o=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(o===1){if(typeof i.source=="object"){const u="terrain-dem-src";this.addSource(u,i.source),i=s.clone$1(i),i=s.extend(i,{source:u})}if(this._validate(s.validateStyle.terrain,"terrain",i))return}if(!this.terrain||this.terrain&&o!==this.terrain.drapeRenderMode)this._createTerrain(i,o);else{const u=this.terrain,d=u.get();for(const f in i)if(!Le(i[f],d[f])){u.set(i),this.stylesheet.terrain=i;const g={now:s.exported.now(),transition:s.extend({duration:0},this.stylesheet.transition)};u.updateTransitions(g);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const o=this.fog=new lo(i,this.map.transform);this.stylesheet.fog=i;const u={now:s.exported.now(),transition:s.extend({duration:0},this.stylesheet.transition)};o.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog,u=o.get();for(const d in i)if(!Le(i[d],u[d])){o.set(i),this.stylesheet.fog=i;const f={now:s.exported.now(),transition:s.extend({duration:0},this.stylesheet.transition)};o.updateTransitions(f);break}}else this._createFog(i);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(u=>this.isLayerDraped(this._layers[u])),o=this._order.filter(u=>!this.isLayerDraped(this._layers[u]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...o)}_createTerrain(i,o){const u=this.terrain=new tr(i,o);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const d={now:s.exported.now(),transition:s.extend({duration:0},this.stylesheet.transition)};u.updateTransitions(d)}_force3DLayerUpdate(){for(const i in this._layers){const o=this._layers[i];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const o=this._layers[i];o.type==="symbol"&&this._updateLayer(o)}}_validate(i,o,u,d,f={}){return(!f||f.validate!==!1)&&Gn(this,i.call(s.validateStyle,s.extend({key:o,style:this.serialize(),value:u,styleSpec:s.spec},d)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const o=this._getSourceCaches(i);for(const u of o)u.clearTiles()}_reloadSource(i){const o=this._getSourceCaches(i);for(const u of o)u.resume(),u.reload()}_updateSources(i){for(const o in this._sourceCaches)this._sourceCaches[o].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const o=this._sourceCaches[i];o.resume(),o.reload()}}_updatePlacement(i,o,u,d,f=!1){let g=!1,x=!1;const E={};for(const S of this._order){const I=this._layers[S];if(I.type!=="symbol")continue;if(!E[I.source]){const L=this._getLayerSourceCache(I);if(!L)continue;E[I.source]=L.getRenderableIds(!0).map(V=>L.getTileByID(V)).sort((V,F)=>F.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan(F.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(I,E[I.source],i.center.lng,i.projection);g=g||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),f=f||this._layerOrderChanged||u===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(f||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),i.zoom))&&(this.pauseablePlacement=new zt(i,this._order,f,o,u,d,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),x=!0),g&&this.pauseablePlacement.placement.setStale()),x||g)for(const S of this._order){const I=this._layers[S];I.type==="symbol"&&this.placement.updateLayerOpacities(I,E[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,o,u){this.imageManager.getImages(o.icons,u),this._updateTilesForChangedImages();const d=f=>{f&&f.setDependencies(o.tileID.key,o.type,o.icons)};d(this._otherSourceCaches[o.source]),d(this._symbolSourceCaches[o.source])}getGlyphs(i,o,u){this.glyphManager.getGlyphs(o.stacks,u)}getResource(i,o,u){return s.makeRequest(o,u)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const o=[];return this._otherSourceCaches[i]&&o.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&o.push(this._symbolSourceCaches[i]),o}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}dr.getSourceType=function(c){return zo[c]},dr.setSourceType=function(c,i){zo[c]=i},dr.registerForPluginStateChange=s.registerForPluginStateChange;var ua=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,Lo="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Bo={},Ro={};Bo=gt("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),Ro=gt(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const Ft=gt(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
return mix(globe,mercator,t);
#else
return globe;
#endif
}
#ifdef PROJECTION_GLOBE_VIEW
mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),ha=ua;var vl={background:gt(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:gt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:gt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)
view_scale*=a_scale;
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:gt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:gt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:gt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:gt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:gt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:gt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:gt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:gt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:gt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:gt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:gt(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:gt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:gt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:gt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:gt(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:gt(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:gt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:gt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:gt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:gt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:gt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:gt(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:gt(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Lo),skyboxGradient:gt(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Lo),skyboxCapture:gt(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:gt(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}`),globeAtmosphere:gt(`uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)
discard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function gt(c,i,o){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,f=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),g=c.match(d),x=i.match(d),E=ua.match(d);let S=x?x.concat(g):g;o||(Bo.staticUniforms&&(S=Bo.staticUniforms.concat(S)),Ro.staticUniforms&&(S=Ro.staticUniforms.concat(S))),S&&(S=S.concat(E));const I={};return{fragmentSource:c=c.replace(u,(z,L,V,F,N)=>(I[N]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${N}
varying ${V} ${F} ${N};
#else
uniform ${V} ${F} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${V} ${F} ${N} = u_${N};
#endif
`)),vertexSource:i=i.replace(u,(z,L,V,F,N)=>{const J=F==="float"?"vec2":"vec4",U=N.match(/color/)?"color":J;return I[N]?L==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${V} ${J} a_${N};
varying ${V} ${F} ${N};
#else
uniform ${V} ${F} u_${N};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${V} ${F} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${U}(a_${N}, u_${N}_t);
#else
    ${V} ${F} ${N} = u_${N};
#endif
`:L==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${V} ${J} a_${N};
#else
uniform ${V} ${F} u_${N};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${V} ${F} ${N} = a_${N};
#else
    ${V} ${F} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${V} ${F} ${N} = unpack_mix_${U}(a_${N}, u_${N}_t);
#else
    ${V} ${F} ${N} = u_${N};
#endif
`}),staticAttributes:f,staticUniforms:S}}class Lr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,o,u,d,f,g,x,E){this.context=i;let S=this.boundPaintVertexBuffers.length!==d.length;for(let I=0;!S&&I<d.length;I++)this.boundPaintVertexBuffers[I]!==d[I]&&(S=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===o&&this.boundLayoutVertexBuffer===u&&!S&&this.boundIndexBuffer===f&&this.boundVertexOffset===g&&this.boundDynamicVertexBuffer===x&&this.boundDynamicVertexBuffer2===E?(i.bindVertexArrayOES.set(this.vao),x&&x.bind(),f&&f.dynamicDraw&&f.bind(),E&&E.bind()):this.freshBind(o,u,d,f,g,x,E)}freshBind(i,o,u,d,f,g,x){let E;const S=i.numAttributes,I=this.context,z=I.gl;if(I.extVertexArrayObject)this.vao&&this.destroy(),this.vao=I.extVertexArrayObject.createVertexArrayOES(),I.bindVertexArrayOES.set(this.vao),E=0,this.boundProgram=i,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=d,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=g,this.boundDynamicVertexBuffer2=x;else{E=I.currentNumAttributes||0;for(let L=S;L<E;L++)z.disableVertexAttribArray(L)}o.enableAttributes(z,i);for(const L of u)L.enableAttributes(z,i);g&&g.enableAttributes(z,i),x&&x.enableAttributes(z,i),o.bind(),o.setVertexAttribPointers(z,i,f);for(const L of u)L.bind(),L.setVertexAttribPointers(z,i,f);g&&(g.bind(),g.setVertexAttribPointers(z,i,f)),d&&d.bind(),x&&(x.bind(),x.setVertexAttribPointers(z,i,f)),I.currentNumAttributes=S}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function zc(c,i){const o=Math.pow(2,i.canonical.z),u=i.canonical.y;return[new s.MercatorCoordinate(0,u/o).toLngLat().lat,new s.MercatorCoordinate(0,(u+1)/o).toLngLat().lat]}function da(c,i,o,u,d,f,g){const x=c.context,E=x.gl,S=o.fbo;if(!S)return;c.prepareDrawTile(i);const I=c.useProgram("hillshade");x.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,S.colorAttachment.get());const z=((N,J,U,H)=>{const K=U.paint.get("hillshade-shadow-color"),W=U.paint.get("hillshade-highlight-color"),X=U.paint.get("hillshade-accent-color");let Q=U.paint.get("hillshade-illumination-direction")*(Math.PI/180);U.paint.get("hillshade-illumination-anchor")==="viewport"&&(Q-=N.transform.angle);const he=!N.options.moving;return{u_matrix:H||N.transform.calculateProjMatrix(J.tileID.toUnwrapped(),he),u_image:0,u_latrange:zc(0,J.tileID),u_light:[U.paint.get("hillshade-exaggeration"),Q],u_shadow:K,u_highlight:W,u_accent:X}})(c,o,u,c.terrain?i.projMatrix:null);c.prepareDrawProgram(x,I,i.toUnwrapped());const{tileBoundsBuffer:L,tileBoundsIndexBuffer:V,tileBoundsSegments:F}=c.getTileBoundsBuffers(o);I.draw(x,E.TRIANGLES,d,f,g,s.CullFaceMode.disabled,z,u.id,L,V,F)}function Mi(c,i,o){if(!i.needsDEMTextureUpload)return;const u=c.context,d=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||c.getTileTexture(o.stride);const f=o.getPixels();i.demTexture?i.demTexture.update(f,{premultiply:!1}):i.demTexture=new s.Texture(u,f,d.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function xs(c,i,o,u,d,f){const g=c.context,x=g.gl;if(!i.dem)return;const E=i.dem;if(g.activeTexture.set(x.TEXTURE1),Mi(c,i,E),!i.demTexture)return;i.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const S=E.dim;g.activeTexture.set(x.TEXTURE0);let I=i.fbo;if(!I){const F=new s.Texture(g,{width:S,height:S,data:null},x.RGBA);F.bind(x.LINEAR,x.CLAMP_TO_EDGE),I=i.fbo=g.createFramebuffer(S,S,!0),I.colorAttachment.set(F.texture)}g.bindFramebuffer.set(I.framebuffer),g.viewport.set([0,0,S,S]);const{tileBoundsBuffer:z,tileBoundsIndexBuffer:L,tileBoundsSegments:V}=c.getMercatorTileBoundsBuffers();c.useProgram("hillshadePrepare").draw(g,x.TRIANGLES,u,d,f,s.CullFaceMode.disabled,((F,N)=>{const J=N.stride,U=s.create();return s.ortho(U,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(U,U,[0,-s.EXTENT,0]),{u_matrix:U,u_image:1,u_dimension:[J,J],u_zoom:F.overscaledZ,u_unpack:N.unpackVector}})(i.tileID,E),o.id,z,L,V),i.needsHillshadePrepare=!1}const $n=(c,i)=>({u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_image0:new s.Uniform1i(c,i.u_image0),u_skirt_height:new s.Uniform1f(c,i.u_skirt_height)}),Gi=(c,i)=>({u_matrix:c,u_image0:0,u_skirt_height:i}),pa=(c,i,o,u,d)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:i,u_merc_matrix:o,u_zoom_transition:u,u_merc_center:d,u_image0:0});function Br(c,i){return c!=null&&i!=null&&!(!c.hasData()||!i.hasData())&&c.demTexture!=null&&i.demTexture!=null&&c.tileID.key!==i.tileID.key}const pn=new class{constructor(){this.operations={}}newMorphing(c,i,o,u,d){if(c in this.operations){const f=this.operations[c];f.to.tileID.key!==o.tileID.key&&(f.queued=o)}else this.operations[c]={startTime:u,phase:0,duration:d,from:i,to:o,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const i=this.operations[c];return{from:i.from,to:i.to,phase:i.phase}}update(c){for(const i in this.operations){const o=this.operations[i];for(o.phase=(c-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,c)){delete this.operations[i];break}}}_nextOp(c,i){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=i,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},ho={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function xh(c,i){const o=1<<c.z;return!i&&(c.x===0||c.x===o-1)||c.y===0||c.y===o-1}const fn=c=>({u_matrix:c});function Pc(c,i,o,u,d){if(d>0){const f=s.exported.now(),g=(f-c.timeAdded)/d,x=i?(f-i.timeAdded)/d:-1,E=o.getSource(),S=u.coveringZoomLevel({tileSize:E.tileSize,roundZoom:E.roundZoom}),I=!i||Math.abs(i.tileID.overscaledZ-S)>Math.abs(c.tileID.overscaledZ-S),z=I&&c.refreshedUponExpiration?1:s.clamp(I?g:1-x,0,1);return c.refreshedUponExpiration&&g>=1&&(c.refreshedUponExpiration=!1),i?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}class kc extends s.SourceCache{constructor(i){const o={type:"raster-dem",maxzoom:i.transform.maxZoom},u=new mi(ne(),null),d=Tr("mock-dem",o,u,i.style);super("mock-dem",d,!1),d.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,o){i.state="loaded",o(null)}}class Er extends s.SourceCache{constructor(i){const o=Tr("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new mi(ne(),null),i.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,o,u){if(i.freezeTileCoverage)return;this.transform=i;const d=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((f,g)=>{if(f[g.key]="",!this._tiles[g.key]){const x=new s.Tile(g,this._source.tileSize*g.overscaleFactor(),i.tileZoom);x.state="loaded",this._tiles[g.key]=x}return f},{});for(const f in this._tiles)f in d||(this.freeFBO(f),this._tiles[f].unloadVectorData(),delete this._tiles[f])}freeFBO(i){const o=this.proxyCachedFBO[i];if(o!==void 0){const u=Object.values(o);this.renderCachePool.push(...u),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class vs extends s.OverscaledTileID{constructor(i,o,u){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=o,this.projMatrix=u}}class Zn extends s.Elevation{constructor(i,o){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,d,f]=function(E){const S=new s.StructArrayLayout4i8,I=new s.StructArrayLayout3ui6,z=131;S.reserve(17161),I.reserve(33800);const L=s.EXTENT/128,V=s.EXTENT+L/2,F=V+L;for(let J=-L;J<F;J+=L)for(let U=-L;U<F;U+=L){const H=U<0||U>V||J<0||J>V?24575:0,K=s.clamp(Math.round(U),0,s.EXTENT),W=s.clamp(Math.round(J),0,s.EXTENT);S.emplaceBack(K+H,W,K,W)}const N=(J,U)=>{const H=U*z+J;I.emplaceBack(H+1,H,H+z),I.emplaceBack(H+z,H+z+1,H+1)};for(let J=1;J<129;J++)for(let U=1;U<129;U++)N(U,J);return[0,129].forEach(J=>{for(let U=0;U<130;U++)N(U,J),N(J,U)}),[S,I,32768]}(),g=i.context;this.gridBuffer=g.createVertexBuffer(u,s.boundsAttributes.members),this.gridIndexBuffer=g.createIndexBuffer(d),this.gridSegments=s.SegmentVector.simpleSegment(0,0,u.length,d.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,u.length,f),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Er(o.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,0,s.EXTENT,0,s.EXTENT,0,1);const x=g.gl;this._overlapStencilMode=new s.StencilMode({func:x.GEQUAL,mask:255},0,255,x.KEEP,x.KEEP,x.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new kc(o.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency()}update(i,o,u){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const d=i.terrain.properties;this.sourceCache=i.terrain.drapeRenderMode===0?this._mockSourceCache:i._getSourceCache(d.get("source")),this._exaggeration=d.get("exaggeration");const f=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const g=this.getScaledDemTileSize();this.sourceCache.update(o,g,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,f(),this._initializing=!0),f(),o.updateElevation(!u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||i.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const d=this.proxyCoords=o.getIds().map(E=>{const S=o.getTileByID(E).tileID;return S.projMatrix=u.calculateProjMatrix(S.toUnwrapped()),S});(function(E,S){const I=S.transform.pointCoordinate(S.transform.getCameraPoint()),z=new s.pointGeometry(I.x,I.y);E.sort((L,V)=>{if(V.overscaledZ-L.overscaledZ)return V.overscaledZ-L.overscaledZ;const F=new s.pointGeometry(L.canonical.x+(1<<L.canonical.z)*L.wrap,L.canonical.y),N=new s.pointGeometry(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),J=z.mult(1<<L.canonical.z);return J.x-=.5,J.y-=.5,J.distSqr(F)-J.distSqr(N)})})(d,this.painter),this._previousZoom=u.zoom;const f=this.proxyToSource||{};this.proxyToSource={},d.forEach(E=>{this.proxyToSource[E.key]={}}),this.terrainTileForTile={};const g=this._style._sourceCaches;for(const E in g){const S=g[E];if(!S.used||(S!==this.sourceCache&&this.resetTileLookupCache(S.id),this._setupProxiedCoordsForOrtho(S,i[E],f),S.usedForTerrain))continue;const I=i[E];S.getSource().reparseOverscaled&&this._assignTerrainTiles(I)}this.proxiedCoords[o.id]=d.map(E=>new vs(E,E.key,this.orthoMatrix)),this._assignTerrainTiles(d),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(f),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const x={};this._visibleDemTiles=[];for(const E of this.proxyCoords){const S=this.terrainTileForTile[E.key];if(!S)continue;const I=S.tileID.key;I in x||(this._visibleDemTiles.push(S),x[I]=I)}}_assignTerrainTiles(i){this._initializing||i.forEach(o=>{if(this.terrainTileForTile[o.key])return;const u=this._findTileCoveringTileID(o,this.sourceCache);u&&(this.terrainTileForTile[o.key]=u)})}_prepareDEMTextures(){const i=this.painter.context,o=i.gl;for(const u in this.terrainTileForTile){const d=this.terrainTileForTile[u],f=d.dem;!f||d.demTexture&&!d.needsDEMTextureUpload||(i.activeTexture.set(o.TEXTURE1),Mi(this.painter,d,f))}}_prepareDemTileUniforms(i,o,u,d){if(!o||o.demTexture==null)return!1;const f=i.tileID.canonical,g=Math.pow(2,o.tileID.canonical.z-f.z),x=d||"";return u[`u_dem_tl${x}`]=[f.x*g%1,f.y*g%1],u[`u_dem_scale${x}`]=g,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,o=i.gl;if(!this._emptyDepthBufferTexture){const u={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new s.Texture(i,u,o.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const o=this._visibleDemTiles.reduce((u,d)=>{if(!d.dem)return u;const f=d.dem.tree.minimums[0];return f>0&&i++,u+f},0);return i?o/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,o=i.gl;i.activeTexture.set(o.TEXTURE2);const u=this._getLoadedAreaMinimum(),d={width:1,height:1,data:new Uint8Array(s.DEMData.pack(u,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let f=this._emptyDEMTexture;return f?f.update(d,{premultiply:!1}):f=this._emptyDEMTexture=new s.Texture(i,d,o.RGBA,{premultiply:!1}),f}setupElevationDraw(i,o,u){const d=this.painter.context,f=d.gl,g=(x=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(x),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var x;g.u_dem_size=this.sourceCache.getSource().tileSize,g.u_exaggeration=this.exaggeration();const E=this.painter.transform,S=E.projection.createTileTransform(E,E.worldSize),I=i.tileID.canonical;g.u_tile_tl_up=S.upVector(I,0,0),g.u_tile_tr_up=S.upVector(I,s.EXTENT,0),g.u_tile_br_up=S.upVector(I,s.EXTENT,s.EXTENT),g.u_tile_bl_up=S.upVector(I,0,s.EXTENT),g.u_tile_up_scale=S.upVectorScale(I);let z=null,L=null,V=1;if(u&&u.morphing&&this._useVertexMorphing){const F=u.morphing.srcDemTile,N=u.morphing.dstDemTile;V=u.morphing.phase,F&&N&&(this._prepareDemTileUniforms(i,F,g,"_prev")&&(L=F),this._prepareDemTileUniforms(i,N,g)&&(z=N))}if(L&&z?(d.activeTexture.set(f.TEXTURE2),z.demTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE,f.NEAREST),d.activeTexture.set(f.TEXTURE4),L.demTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE,f.NEAREST),g.u_dem_lerp=V):(z=this.terrainTileForTile[i.tileID.key],d.activeTexture.set(f.TEXTURE2),(this._prepareDemTileUniforms(i,z,g)?z.demTexture:this.emptyDEMTexture).bind(f.NEAREST,f.CLAMP_TO_EDGE)),d.activeTexture.set(f.TEXTURE3),u&&u.useDepthForOcclusion?(this._depthTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE),g.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE),g.u_depth_size_inv=[1,1]),u&&u.useMeterToDem&&z){const F=(1<<z.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;g.u_meter_to_dem=F}u&&u.labelPlaneMatrixInv&&(g.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),o.setTerrainUniformValues(d,g)}renderToBackBuffer(i){const o=this.painter,u=this.painter.context;i.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,o.width,o.height]),this.renderingToTexture=!1,function(d,f,g,x,E){if(d.transform.projection.name==="globe")(function(S,I,z,L,V){const F=S.context,N=F.gl;let J,U;const H=S.options.showTerrainWireframe?2:0,K=(Pe,ve)=>{if(U===Pe)return;const me=[];ve&&me.push(ho[H]),me.push(ho[Pe]),me.push("PROJECTION_GLOBE_VIEW"),J=S.useProgram("globeRaster",null,me),U=Pe},W=S.colorModeForRenderPass(),X=new s.DepthMode(N.LEQUAL,s.DepthMode.ReadWrite,S.depthRangeFor3D);pn.update(V);const Q=S.transform,he=s.calculateGlobeMatrix(Q,Q.worldSize),ge=s.calculateGlobeMercatorMatrix(Q),Ge=[s.mercatorXfromLng(Q.center.lng),s.mercatorYfromLat(Q.center.lat)],De=S.globeSharedBuffers;(H?[!1,!0]:[!1]).forEach(Pe=>{U=-1;const ve=Pe?N.LINES:N.TRIANGLES;for(const me of L){const Ae=z.getTile(me),Se=Math.pow(2,me.canonical.z),[rt,ut]=s.globeBuffersForTileMesh(S,Ae,me,Se),bt=s.StencilMode.disabled,je=I.prevTerrainTileForTile[me.key],ot=I.terrainTileForTile[me.key];Br(je,ot)&&pn.newMorphing(me.key,je,ot,V,250),F.activeTexture.set(N.TEXTURE0),Ae.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const mt=pn.getMorphValuesForProxy(me.key),Kt=mt?1:0,ri={};mt&&s.extend$1(ri,{morphing:{srcDemTile:mt.from,dstDemTile:mt.to,phase:s.easeCubicInOut(mt.phase)}});const pt=s.globeMatrixForTile(me.canonical,he),It=pa(Q.projMatrix,pt,ge,s.globeToMercatorTransition(Q.zoom),Ge);if(K(Kt,Pe),I.setupElevationDraw(Ae,J,ri),S.prepareDrawProgram(F,J,me.toUnwrapped()),De){const[pi,Ri]=Pe?De.getWirefameBuffer(S.context):[De.gridIndexBuffer,De.gridSegments];J.draw(F,ve,X,bt,W,s.CullFaceMode.backCCW,It,"globe_raster",rt,pi,Ri)}if(!Pe){const pi=[me.canonical.y===0?s.globePoleMatrixForTile(me.canonical,!1,Q):null,me.canonical.y===Se-1?s.globePoleMatrixForTile(me.canonical,!0,Q):null];for(const Ri of pi){if(!Ri)continue;const fr=pa(Q.projMatrix,Ri,Ri,0,Ge);De&&J.draw(F,ve,X,bt,W,s.CullFaceMode.disabled,fr,"globe_pole_raster",ut,De.poleIndexBuffer,De.poleSegments)}}}})})(d,f,g,x,E);else{const S=d.context,I=S.gl;let z,L;const V=d.options.showTerrainWireframe?2:0,F=(K,W)=>{if(L===K)return;const X=[ho[K]];W&&X.push(ho[V]),z=d.useProgram("terrainRaster",null,X),L=K},N=d.colorModeForRenderPass(),J=new s.DepthMode(I.LEQUAL,s.DepthMode.ReadWrite,d.depthRangeFor3D);pn.update(E);const U=d.transform,H=6*Math.pow(1.5,22-U.zoom)*f.exaggeration();(V?[!1,!0]:[!1]).forEach(K=>{L=-1;const W=K?I.LINES:I.TRIANGLES,[X,Q]=K?f.getWirefameBuffer():[f.gridIndexBuffer,f.gridSegments];for(const he of x){const ge=g.getTile(he),Ge=s.StencilMode.disabled,De=f.prevTerrainTileForTile[he.key],Pe=f.terrainTileForTile[he.key];Br(De,Pe)&&pn.newMorphing(he.key,De,Pe,E,250),S.activeTexture.set(I.TEXTURE0),ge.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);const ve=pn.getMorphValuesForProxy(he.key),me=ve?1:0;let Ae;ve&&(Ae={morphing:{srcDemTile:ve.from,dstDemTile:ve.to,phase:s.easeCubicInOut(ve.phase)}});const Se=Gi(he.projMatrix,xh(he.canonical,U.renderWorldCopies)?H/10:H);F(me,K),f.setupElevationDraw(ge,z,Ae),d.prepareDrawProgram(S,z,he.toUnwrapped()),z.draw(S,W,J,Ge,N,s.CullFaceMode.backCCW,Se,"terrain_raster",f.gridBuffer,X,Q)}})}}(o,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const o=this.painter,u=this.painter.context,d=this.proxySourceCache,f=this.proxiedCoords[d.id],g=this._drapedRenderBatches.shift(),x=[],E=o.style.order;let S=0;for(const I of f){const z=d.getTileByID(I.proxyTileKey),L=d.proxyCachedFBO[I.key]?d.proxyCachedFBO[I.key][i]:void 0,V=L!==void 0?d.renderCache[L]:this.pool[S++],F=L!==void 0;if(z.texture=V.tex,F&&!V.dirty){x.push(z.tileID);continue}let N;u.bindFramebuffer.set(V.fb.framebuffer),this.renderedToTile=!1,V.dirty&&(u.clear({color:s.Color.transparent,stencil:0}),V.dirty=!1);for(let J=g.start;J<=g.end;++J){const U=o.style._layers[E[J]];if(U.isHidden(o.transform.zoom))continue;const H=o.style._getLayerSourceCache(U),K=H?this.proxyToSource[I.key][H.id]:[I];if(!K)continue;const W=K;u.viewport.set([0,0,V.fb.width,V.fb.height]),N!==(H?H.id:null)&&(this._setupStencil(V,K,U,H),N=H?H.id:null),o.renderLayer(o,H,U,W)}this.renderedToTile?(V.dirty=!0,x.push(z.tileID)):F||--S,S===5&&(S=0,this.renderToBackBuffer(x))}return this.renderToBackBuffer(x),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,o.width,o.height]),g.end+1}postRender(){}renderCacheEfficiency(i){const o=i.order.length;if(o===0)return{efficiency:100};let u,d=0,f=0,g=!1;for(let x=0;x<o;++x){const E=i._layers[i.order[x]];this._style.isLayerDraped(E)?(g&&++d,++f):g||(g=!0,u=E.id)}return f===0?{efficiency:100}:{efficiency:100*(1-d/f),firstUndrapedLayer:u}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{i=Math.min(i,o.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,o,u){if(!this._visibleDemTiles)return null;const d=this._visibleDemTiles.filter(f=>f.dem).map(f=>{const g=f.tileID,x=Math.pow(2,g.overscaledZ),{x:E,y:S}=g.canonical,I=E/x,z=(E+1)/x,L=S/x,V=(S+1)/x;return{minx:I,miny:L,maxx:z,maxy:V,t:f.dem.tree.raycastRoot(I,L,z,V,i,o,u),tile:f}});d.sort((f,g)=>(f.t!==null?f.t:Number.MAX_VALUE)-(g.t!==null?g.t:Number.MAX_VALUE));for(const f of d){if(f.t==null)return null;const g=f.tile.dem.tree.raycast(f.minx,f.miny,f.maxx,f.maxy,i,o,u);if(g!=null)return g}return null}_createFBO(){const i=this.painter.context,o=i.gl,u=this.drapeBufferSize;i.activeTexture.set(o.TEXTURE0);const d=new s.Texture(i,{width:u[0],height:u[1],data:null},o.RGBA);d.bind(o.LINEAR,o.CLAMP_TO_EDGE);const f=i.createFramebuffer(u[0],u[1],!1);return f.colorAttachment.set(d.texture),f.depthAttachment=new ji(i,f.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,f.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):f.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&o.texParameterf(o.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:f,tex:d,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const o=this._style._layers[i],u=o.isHidden(this.painter.transform.zoom),d=o.getCrossfadeParameters(),f=!!d&&d.t!==1,g=o.hasTransition();return o.type!=="custom"&&!u&&(f||g)})}_clearRasterFadeFromRenderCache(){let i=!1;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o]._source instanceof wn){i=!0;break}if(i)for(let o=0;o<this._style.order.length;++o){const u=this._style._layers[this._style.order[o]],d=u.isHidden(this.painter.transform.zoom),f=this._style._getLayerSourceCache(u);if(u.type!=="raster"||d||!f)continue;const g=u.paint.get("raster-fade-duration");for(const x of this.proxyCoords){const E=this.proxyToSource[x.key][f.id];if(E)for(const S of E){const I=Pc(f.getTile(S),f.findLoadedParent(S,0),f,this.painter.transform,g);(I.opacity!==1||I.mix!==0)&&this._clearRenderCacheForTile(f.id,S)}}}}_setupDrapedRenderBatches(){const i=this._style.order,o=i.length;if(o===0)return;const u=[];let d,f=0,g=this._style._layers[i[f]];for(;!this._style.isLayerDraped(g)&&g.isHidden(this.painter.transform.zoom)&&++f<o;)g=this._style._layers[i[f]];for(;f<o;++f){const x=this._style._layers[i[f]];x.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(x)?d===void 0&&(d=f):d!==void 0&&(u.push({start:d,end:f-1}),d=void 0))}d!==void 0&&u.push({start:d,end:f-1}),this._drapedRenderBatches=u}_setupRenderCache(i){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const g=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let x=0;x<g.length;++x){const E=Object.values(g[x]);o.renderCachePool.push(...E)}}return}this._clearRasterFadeFromRenderCache();const u=this.proxyCoords,d=this._tilesDirty;for(let g=u.length-1;g>=0;g--){const x=u[g];if(o.getTileByID(x.key),o.proxyCachedFBO[x.key]!==void 0){const E=i[x.key],S=this.proxyToSource[x.key];let I=0;for(const z in S){const L=S[z],V=E[z];if(!V||V.length!==L.length||L.some((F,N)=>F!==V[N]||d[z]&&d[z].hasOwnProperty(F.key))){I=-1;break}++I}for(const z in o.proxyCachedFBO[x.key])o.renderCache[o.proxyCachedFBO[x.key][z]].dirty=I<0||I!==Object.values(E).length}}const f=[...this._drapedRenderBatches];f.sort((g,x)=>x.end-x.start-(g.end-g.start));for(const g of f)for(const x of u){if(o.proxyCachedFBO[x.key])continue;let E=o.renderCachePool.pop();E===void 0&&o.renderCache.length<50&&(E=o.renderCache.length,o.renderCache.push(this._createFBO())),E!==void 0&&(o.proxyCachedFBO[x.key]={},o.proxyCachedFBO[x.key][g.start]=E,o.renderCache[E].dirty=!0)}this._tilesDirty={}}_setupStencil(i,o,u,d){if(!d||!this._sourceTilesOverlap[d.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const f=this.painter.context,g=f.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let x;if(u.isTileClipped())x=o.length,this._overlapStencilMode.test={func:g.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);x=1,this._overlapStencilMode.test={func:g.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+x>255&&(f.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=x,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(i,o){const u=this.painter,d=this.painter.context,f=d.gl;u._tileClippingMaskIDs={},d.setColorMode(s.ColorMode.disabled),d.setDepthMode(s.DepthMode.disabled);const g=u.useProgram("clippingMask");for(const x of i){const E=u._tileClippingMaskIDs[x.key]=--o;g.draw(d,f.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:f.ALWAYS,mask:0},E,255,f.KEEP,f.KEEP,f.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,fn(x.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(i){const o=this.painter.transform;if(i.x<0||i.x>o.width||i.y<0||i.y>o.height)return null;const u=[i.x,i.y,1,1];s.transformMat4$1(u,u,o.pixelMatrixInverse),s.scale$1(u,u,1/u[3]),u[0]/=o.worldSize,u[1]/=o.worldSize;const d=o._camera.position,f=s.mercatorZfromAltitude(1,o.center.lat),g=[d[0],d[1],d[2]/f,0],x=s.subtract([],u.slice(0,3),g);s.normalize(x,x);const E=this.raycast(g,x,this._exaggeration);return E!==null&&E?(s.scaleAndAdd(g,g,x,E),g[3]=g[2],g[2]*=f,g):null}drawDepth(){const i=this.painter,o=i.context,u=this.proxySourceCache,d=Math.ceil(i.width),f=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===d&&this._depthFBO.height===f||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const g=o.gl,x=o.createFramebuffer(d,f,!0);o.activeTexture.set(g.TEXTURE0);const E=new s.Texture(o,{width:d,height:f,data:null},g.RGBA);E.bind(g.NEAREST,g.CLAMP_TO_EDGE),x.colorAttachment.set(E.texture);const S=o.createRenderbuffer(o.gl.DEPTH_COMPONENT16,d,f);x.depthAttachment.set(S),this._depthFBO=x,this._depthTexture=E}o.bindFramebuffer.set(this._depthFBO.framebuffer),o.viewport.set([0,0,d,f]),function(g,x,E,S){if(g.transform.projection.name==="globe")return;const I=g.context,z=I.gl;I.clear({depth:1});const L=g.useProgram("terrainDepth"),V=new s.DepthMode(z.LESS,s.DepthMode.ReadWrite,g.depthRangeFor3D);for(const F of S){const N=E.getTile(F),J=Gi(F.projMatrix,0);x.setupElevationDraw(N,L),L.draw(I,z.TRIANGLES,V,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,J,"terrain_depth",x.gridBuffer,x.gridIndexBuffer,x.gridNoSkirtSegments)}}(i,this,u,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,o,u){if(i.getSource()instanceof ln)return this._setupProxiedCoordsForImageSource(i,o,u);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const d=this.proxiedCoords[i.id]=[],f=this.proxyCoords;for(let x=0;x<f.length;x++){const E=f[x],S=this._findTileCoveringTileID(E,i);if(S){const I=this._createProxiedId(E,S,u[E.key]&&u[E.key][i.id]);d.push(I),this.proxyToSource[E.key][i.id]=[I]}}let g=!1;for(let x=0;x<o.length;x++){const E=i.getTile(o[x]);if(!E||!E.hasData())continue;const S=this._findTileCoveringTileID(E.tileID,this.proxySourceCache);if(S&&S.tileID.canonical.z!==E.tileID.canonical.z){const I=this.proxyToSource[S.tileID.key][i.id],z=this._createProxiedId(S.tileID,E,u[S.tileID.key]&&u[S.tileID.key][i.id]);I?I.splice(I.length-1,0,z):this.proxyToSource[S.tileID.key][i.id]=[z],d.push(z),g=!0}}this._sourceTilesOverlap[i.id]=g}_setupProxiedCoordsForImageSource(i,o,u){if(!i.getSource().loaded())return;const d=this.proxiedCoords[i.id]=[],f=this.proxyCoords,g=i.getSource(),x=new s.pointGeometry(g.tileID.x,g.tileID.y)._div(1<<g.tileID.z),E=g.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((I,z)=>(I.min.x=Math.min(I.min.x,z.x-x.x),I.min.y=Math.min(I.min.y,z.y-x.y),I.max.x=Math.max(I.max.x,z.x-x.x),I.max.y=Math.max(I.max.y,z.y-x.y),I),{min:new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),S=(I,z)=>{const L=I.wrap+I.canonical.x/(1<<I.canonical.z),V=I.canonical.y/(1<<I.canonical.z),F=s.EXTENT/(1<<I.canonical.z),N=z.wrap+z.canonical.x/(1<<z.canonical.z),J=z.canonical.y/(1<<z.canonical.z);return L+F<N+E.min.x||L>N+E.max.x||V+F<J+E.min.y||V>J+E.max.y};for(let I=0;I<f.length;I++){const z=f[I];for(let L=0;L<o.length;L++){const V=i.getTile(o[L]);if(!V||!V.hasData()||S(z,V.tileID))continue;const F=this._createProxiedId(z,V,u[z.key]&&u[z.key][i.id]),N=this.proxyToSource[z.key][i.id];N?N.push(F):this.proxyToSource[z.key][i.id]=[F],d.push(F)}}}_createProxiedId(i,o,u){let d=this.orthoMatrix;if(u){const f=u.find(g=>g.key===o.tileID.key);if(f)return f}if(o.tileID.key!==i.key){const f=i.canonical.z-o.tileID.canonical.z;let g,x,E;d=s.create();const S=o.tileID.wrap-i.wrap<<i.overscaledZ;f>0?(g=s.EXTENT>>f,x=g*((o.tileID.canonical.x<<f)-i.canonical.x+S),E=g*((o.tileID.canonical.y<<f)-i.canonical.y)):(g=s.EXTENT<<-f,x=s.EXTENT*(o.tileID.canonical.x-(i.canonical.x+S<<-f)),E=s.EXTENT*(o.tileID.canonical.y-(i.canonical.y<<-f))),s.ortho(d,0,g,0,g,0,1),s.translate(d,d,[x,E,0])}return new vs(o.tileID,i.key,d)}_findTileCoveringTileID(i,o){let u=o.getTile(i);if(u&&u.hasData())return u;const d=this._findCoveringTileCache[o.id],f=d[i.key];if(u=f?o.getTileByID(f):null,u&&u.hasData()||f===null)return u;let g=u?u.tileID:i,x=g.overscaledZ;const E=o.getSource().minzoom,S=[];if(!f){const z=o.getSource().maxzoom;if(i.canonical.z>=z){const L=i.canonical.z-z;o.getSource().reparseOverscaled?(x=Math.max(i.canonical.z+2,o.transform.tileZoom),g=new s.OverscaledTileID(x,i.wrap,z,i.canonical.x>>L,i.canonical.y>>L)):L!==0&&(x=z,g=new s.OverscaledTileID(x,i.wrap,z,i.canonical.x>>L,i.canonical.y>>L))}g.key!==i.key&&(S.push(g.key),u=o.getTile(g))}const I=z=>{S.forEach(L=>{d[L]=z}),S.length=0};for(x-=1;x>=E&&(!u||!u.hasData());x--){u&&I(u.tileID.key);const z=g.calculateScaledKey(x);if(u=o.getTileByID(z),u&&u.hasData())break;const L=d[z];if(L===null)break;L===void 0?S.push(z):u=o.getTileByID(L)}return I(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(i){this.renderedToTile=!0}_clearRenderCacheForTile(i,o){let u=this._tilesDirty[i];u||(u=this._tilesDirty[i]={}),u[o.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(o){let u,d,f;const g=new s.StructArrayLayout2ui4,x=131;for(d=1;d<129;d++){for(u=1;u<129;u++)f=d*x+u,g.emplaceBack(f,f+1),g.emplaceBack(f,f+x),g.emplaceBack(f+1,f+x),d===128&&g.emplaceBack(f+x,f+x+1);g.emplaceBack(f+1,f+1+x)}return g}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function fa(c){const i=[];for(let o=0;o<c.length;o++){if(c[o]===null)continue;const u=c[o].split(" ");i.push(u.pop())}return i}class bs{static cacheKey(i,o,u){let d=`${i}${u?u.cacheKey:""}`;for(const f of o)d+=`/${f}`;return d}constructor(i,o,u,d,f,g){const x=i.gl;this.program=x.createProgram();const E=fa(u.staticAttributes),S=d?d.getBinderAttributes():[],I=E.concat(S),z=u.staticUniforms?fa(u.staticUniforms):[],L=d?d.getBinderUniforms():[],V=z.concat(L),F=[];for(const X of V)F.indexOf(X)<0&&F.push(X);let N=d?d.defines():[];N=N.concat(g.map(X=>`#define ${X}`));const J=N.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,ha,Ft.fragmentSource,Ro.fragmentSource,u.fragmentSource).join(`
`),U=N.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,ha,Ft.vertexSource,Ro.vertexSource,Bo.vertexSource,u.vertexSource).join(`
`),H=x.createShader(x.FRAGMENT_SHADER);if(x.isContextLost())return void(this.failedToCreate=!0);x.shaderSource(H,J),x.compileShader(H),x.attachShader(this.program,H);const K=x.createShader(x.VERTEX_SHADER);if(x.isContextLost())return void(this.failedToCreate=!0);x.shaderSource(K,U),x.compileShader(K),x.attachShader(this.program,K),this.attributes={};const W={};this.numAttributes=I.length;for(let X=0;X<this.numAttributes;X++)I[X]&&(x.bindAttribLocation(this.program,X,I[X]),this.attributes[I[X]]=X);x.linkProgram(this.program),x.deleteShader(K),x.deleteShader(H);for(let X=0;X<F.length;X++){const Q=F[X];if(Q&&!W[Q]){const he=x.getUniformLocation(this.program,Q);he&&(W[Q]=he)}}this.fixedUniforms=f(i,W),this.binderUniforms=d?d.getUniforms(i,W):[],g.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((X,Q)=>({u_dem:new s.Uniform1i(X,Q.u_dem),u_dem_prev:new s.Uniform1i(X,Q.u_dem_prev),u_dem_unpack:new s.Uniform4f(X,Q.u_dem_unpack),u_dem_tl:new s.Uniform2f(X,Q.u_dem_tl),u_dem_scale:new s.Uniform1f(X,Q.u_dem_scale),u_dem_tl_prev:new s.Uniform2f(X,Q.u_dem_tl_prev),u_dem_scale_prev:new s.Uniform1f(X,Q.u_dem_scale_prev),u_dem_size:new s.Uniform1f(X,Q.u_dem_size),u_dem_lerp:new s.Uniform1f(X,Q.u_dem_lerp),u_exaggeration:new s.Uniform1f(X,Q.u_exaggeration),u_depth:new s.Uniform1i(X,Q.u_depth),u_depth_size_inv:new s.Uniform2f(X,Q.u_depth_size_inv),u_meter_to_dem:new s.Uniform1f(X,Q.u_meter_to_dem),u_label_plane_matrix_inv:new s.UniformMatrix4f(X,Q.u_label_plane_matrix_inv),u_tile_tl_up:new s.Uniform3f(X,Q.u_tile_tl_up),u_tile_tr_up:new s.Uniform3f(X,Q.u_tile_tr_up),u_tile_br_up:new s.Uniform3f(X,Q.u_tile_br_up),u_tile_bl_up:new s.Uniform3f(X,Q.u_tile_bl_up),u_tile_up_scale:new s.Uniform1f(X,Q.u_tile_up_scale)}))(i,W)),g.indexOf("FOG")!==-1&&(this.fogUniforms=((X,Q)=>({u_fog_matrix:new s.UniformMatrix4f(X,Q.u_fog_matrix),u_fog_range:new s.Uniform2f(X,Q.u_fog_range),u_fog_color:new s.Uniform4f(X,Q.u_fog_color),u_fog_horizon_blend:new s.Uniform1f(X,Q.u_fog_horizon_blend),u_fog_temporal_offset:new s.Uniform1f(X,Q.u_fog_temporal_offset)}))(i,W))}setTerrainUniformValues(i,o){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const d in o)u[d].set(o[d])}}setFogUniformValues(i,o){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const d in o)u[d].location&&u[d].set(o[d])}}draw(i,o,u,d,f,g,x,E,S,I,z,L,V,F,N,J){const U=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(u),i.setStencilMode(d),i.setColorMode(f),i.setCullFace(g);for(const K of Object.keys(this.fixedUniforms))this.fixedUniforms[K].set(x[K]);F&&F.setUniforms(i,this.binderUniforms,L,{zoom:V});const H={[U.LINES]:2,[U.TRIANGLES]:3,[U.LINE_STRIP]:1}[o];for(const K of z.get()){const W=K.vaos||(K.vaos={});(W[E]||(W[E]=new Lr)).bind(i,this,S,F?F.getPaintVertexBuffers():[],I,K.vertexOffset,N,J),U.drawElements(o,K.primitiveLength*H,U.UNSIGNED_SHORT,K.primitiveOffset*H*2)}}}function Dc(c,i,o){const u=1/Nt(o,1,i.transform.tileZoom),d=Math.pow(2,o.tileID.overscaledZ),f=o.tileSize*Math.pow(2,i.transform.tileZoom)/d,g=f*(o.tileID.canonical.x+o.tileID.wrap*d),x=f*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[u,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[g>>16,x>>16],u_pixel_coord_lower:[65535&g,65535&x]}}const Lc=(c,i,o,u)=>{const d=i.style.light,f=d.properties.get("position"),g=[f.x,f.y,f.z],x=s.create$1();d.properties.get("anchor")==="viewport"&&(s.fromRotation(x,-i.transform.angle),s.transformMat3(g,g,x));const E=d.properties.get("color");return{u_matrix:c,u_lightpos:g,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+o,u_opacity:u}},bl=(c,i,o,u,d,f,g)=>s.extend(Lc(c,i,o,u),Dc(f,i,g),{u_height_factor:-Math.pow(2,d.overscaledZ)/g.tileSize/8}),Bc=c=>({u_matrix:c}),wl=(c,i,o,u)=>s.extend(Bc(c),Dc(o,i,u)),vh=(c,i)=>({u_matrix:c,u_world:i}),Rc=(c,i,o,u,d)=>s.extend(wl(c,i,o,u),{u_world:d}),bh=(c,i,o,u)=>{const d=c.transform;let f;return f=u.paint.get("circle-pitch-alignment")==="map"?d.calculatePixelsToTileUnitsMatrix(o):new Float32Array([d.pixelsToGLUnits[0],0,0,d.pixelsToGLUnits[1]]),{u_camera_to_center_distance:d.cameraToCenterDistance,u_matrix:c.translatePosMatrix(i.projMatrix,o,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:f}},Tl=c=>{const i=[];return c.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i},Fc=(c,i,o)=>{const u=s.EXTENT/o.tileSize;return{u_matrix:c,u_camera_to_center_distance:i.cameraToCenterDistance,u_extrude_scale:[i.pixelsToGLUnits[0]/u,i.pixelsToGLUnits[1]/u]}},El=(c,i,o=1)=>({u_matrix:c,u_color:i,u_overlay:0,u_overlay_scale:o}),Oc=(c,i,o,u)=>({u_matrix:c,u_extrude_scale:Nt(i,1,o),u_intensity:u}),Uc=(c,i,o,u,d,f)=>{const g=c.transform,x=g.calculatePixelsToTileUnitsMatrix(i),E={u_matrix:ws(c,i,o,d),u_pixels_to_tile_units:x,u_device_pixel_ratio:s.exported.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:f,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Ts(o)){const S=Fo(i,c.transform);E.u_texsize=i.lineAtlasTexture.size,E.u_scale=[S,u.fromScale,u.toScale],E.u_mix=u.t}return E},po=(c,i,o,u,d)=>{const f=c.transform,g=Fo(i,f);return{u_matrix:ws(c,i,o,d),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:f.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:s.exported.devicePixelRatio,u_image:0,u_scale:[g,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Fo(c,i){return 1/Nt(c,1,i.tileZoom)}function ws(c,i,o,u){return c.translatePosMatrix(u||i.tileID.projMatrix,i,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}function Ts(c){const i=c.paint.get("line-dasharray").value;return i.value||i.kind!=="constant"}const ma=(c,i,o,u,d,f)=>{return{u_matrix:c,u_tl_parent:i,u_scale_parent:o,u_fade_t:u.mix,u_opacity:u.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(x=d.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(g=d.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:_a(d.paint.get("raster-hue-rotate")),u_perspective_transform:f};var g,x};function _a(c){c*=Math.PI/180;const i=Math.sin(c),o=Math.cos(c);return[(2*o+1)/3,(-Math.sqrt(3)*i-o+1)/3,(Math.sqrt(3)*i-o+1)/3]}const ga=(c,i,o,u,d,f,g,x,E,S,I,z,L,V)=>{const F=d.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:F.width/F.height,u_fade_change:d.options.fadeDuration?d.symbolFadeChange:1,u_matrix:f,u_label_plane_matrix:g,u_coord_matrix:x,u_is_text:+E,u_pitch_with_map:+u,u_texsize:S,u_tile_id:I,u_zoom_transition:z,u_inv_rot_matrix:L,u_merc_center:V,u_texture:0}},Es=(c,i,o,u,d,f,g,x,E,S,I,z,L,V,F)=>{const{cameraToCenterDistance:N,_pitch:J}=d.transform;return s.extend(ga(c,i,o,u,d,f,g,x,E,S,z,L,V,F),{u_gamma_scale:u?N*Math.cos(d.terrain?0:J):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+I})},Ss=(c,i,o,u,d,f,g,x,E,S,I,z,L,V)=>s.extend(Es(c,i,o,u,d,f,g,x,!0,E,!0,I,z,L,V),{u_texsize_icon:S,u_texture_icon:1}),Xt=(c,i,o)=>({u_matrix:c,u_opacity:i,u_color:o}),ya=(c,i,o,u,d,f)=>s.extend(function(g,x,E,S){const I=E.imageManager.getPattern(g.from.toString()),z=E.imageManager.getPattern(g.to.toString()),{width:L,height:V}=E.imageManager.getPixelSize(),F=Math.pow(2,S.tileID.overscaledZ),N=S.tileSize*Math.pow(2,E.transform.tileZoom)/F,J=N*(S.tileID.canonical.x+S.tileID.wrap*F),U=N*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:I.tl,u_pattern_br_a:I.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[L,V],u_mix:x.t,u_pattern_size_a:I.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:x.fromScale,u_scale_b:x.toScale,u_tile_units_to_pixels:1/Nt(S,1,E.transform.tileZoom),u_pixel_coord_upper:[J>>16,U>>16],u_pixel_coord_lower:[65535&J,65535&U]}}(u,f,o,d),{u_matrix:c,u_opacity:i}),Vc={fillExtrusion:(c,i)=>({u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_lightpos:new s.Uniform3f(c,i.u_lightpos),u_lightintensity:new s.Uniform1f(c,i.u_lightintensity),u_lightcolor:new s.Uniform3f(c,i.u_lightcolor),u_vertical_gradient:new s.Uniform1f(c,i.u_vertical_gradient),u_opacity:new s.Uniform1f(c,i.u_opacity)}),fillExtrusionPattern:(c,i)=>({u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_lightpos:new s.Uniform3f(c,i.u_lightpos),u_lightintensity:new s.Uniform1f(c,i.u_lightintensity),u_lightcolor:new s.Uniform3f(c,i.u_lightcolor),u_vertical_gradient:new s.Uniform1f(c,i.u_vertical_gradient),u_height_factor:new s.Uniform1f(c,i.u_height_factor),u_image:new s.Uniform1i(c,i.u_image),u_texsize:new s.Uniform2f(c,i.u_texsize),u_pixel_coord_upper:new s.Uniform2f(c,i.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(c,i.u_pixel_coord_lower),u_scale:new s.Uniform3f(c,i.u_scale),u_fade:new s.Uniform1f(c,i.u_fade),u_opacity:new s.Uniform1f(c,i.u_opacity)}),fill:(c,i)=>({u_matrix:new s.UniformMatrix4f(c,i.u_matrix)}),fillPattern:(c,i)=>({u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_image:new s.Uniform1i(c,i.u_image),u_texsize:new s.Uniform2f(c,i.u_texsize),u_pixel_coord_upper:new s.Uniform2f(c,i.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(c,i.u_pixel_coord_lower),u_scale:new s.Uniform3f(c,i.u_scale),u_fade:new s.Uniform1f(c,i.u_fade)}),fillOutline:(c,i)=>({u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_world:new s.Uniform2f(c,i.u_world)}),fillOutlinePattern:(c,i)=>({u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_world:new s.Uniform2f(c,i.u_world),u_image:new s.Uniform1i(c,i.u_image),u_texsize:new s.Uniform2f(c,i.u_texsize),u_pixel_coord_upper:new s.Uniform2f(c,i.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(c,i.u_pixel_coord_lower),u_scale:new s.Uniform3f(c,i.u_scale),u_fade:new s.Uniform1f(c,i.u_fade)}),circle:(c,i)=>({u_camera_to_center_distance:new s.Uniform1f(c,i.u_camera_to_center_distance),u_extrude_scale:new s.UniformMatrix2f(c,i.u_extrude_scale),u_device_pixel_ratio:new s.Uniform1f(c,i.u_device_pixel_ratio),u_matrix:new s.UniformMatrix4f(c,i.u_matrix)}),collisionBox:(c,i)=>({u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_camera_to_center_distance:new s.Uniform1f(c,i.u_camera_to_center_distance),u_extrude_scale:new s.Uniform2f(c,i.u_extrude_scale)}),collisionCircle:(c,i)=>({u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_inv_matrix:new s.UniformMatrix4f(c,i.u_inv_matrix),u_camera_to_center_distance:new s.Uniform1f(c,i.u_camera_to_center_distance),u_viewport_size:new s.Uniform2f(c,i.u_viewport_size)}),debug:(c,i)=>({u_color:new s.UniformColor(c,i.u_color),u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_overlay:new s.Uniform1i(c,i.u_overlay),u_overlay_scale:new s.Uniform1f(c,i.u_overlay_scale)}),clippingMask:(c,i)=>({u_matrix:new s.UniformMatrix4f(c,i.u_matrix)}),heatmap:(c,i)=>({u_extrude_scale:new s.Uniform1f(c,i.u_extrude_scale),u_intensity:new s.Uniform1f(c,i.u_intensity),u_matrix:new s.UniformMatrix4f(c,i.u_matrix)}),heatmapTexture:(c,i)=>({u_image:new s.Uniform1i(c,i.u_image),u_color_ramp:new s.Uniform1i(c,i.u_color_ramp),u_opacity:new s.Uniform1f(c,i.u_opacity)}),hillshade:(c,i)=>({u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_image:new s.Uniform1i(c,i.u_image),u_latrange:new s.Uniform2f(c,i.u_latrange),u_light:new s.Uniform2f(c,i.u_light),u_shadow:new s.UniformColor(c,i.u_shadow),u_highlight:new s.UniformColor(c,i.u_highlight),u_accent:new s.UniformColor(c,i.u_accent)}),hillshadePrepare:(c,i)=>({u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_image:new s.Uniform1i(c,i.u_image),u_dimension:new s.Uniform2f(c,i.u_dimension),u_zoom:new s.Uniform1f(c,i.u_zoom),u_unpack:new s.Uniform4f(c,i.u_unpack)}),line:(c,i)=>({u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_pixels_to_tile_units:new s.UniformMatrix2f(c,i.u_pixels_to_tile_units),u_device_pixel_ratio:new s.Uniform1f(c,i.u_device_pixel_ratio),u_units_to_pixels:new s.Uniform2f(c,i.u_units_to_pixels),u_dash_image:new s.Uniform1i(c,i.u_dash_image),u_gradient_image:new s.Uniform1i(c,i.u_gradient_image),u_image_height:new s.Uniform1f(c,i.u_image_height),u_texsize:new s.Uniform2f(c,i.u_texsize),u_scale:new s.Uniform3f(c,i.u_scale),u_mix:new s.Uniform1f(c,i.u_mix),u_alpha_discard_threshold:new s.Uniform1f(c,i.u_alpha_discard_threshold)}),linePattern:(c,i)=>({u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_texsize:new s.Uniform2f(c,i.u_texsize),u_pixels_to_tile_units:new s.UniformMatrix2f(c,i.u_pixels_to_tile_units),u_device_pixel_ratio:new s.Uniform1f(c,i.u_device_pixel_ratio),u_image:new s.Uniform1i(c,i.u_image),u_units_to_pixels:new s.Uniform2f(c,i.u_units_to_pixels),u_scale:new s.Uniform3f(c,i.u_scale),u_fade:new s.Uniform1f(c,i.u_fade),u_alpha_discard_threshold:new s.Uniform1f(c,i.u_alpha_discard_threshold)}),raster:(c,i)=>({u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_tl_parent:new s.Uniform2f(c,i.u_tl_parent),u_scale_parent:new s.Uniform1f(c,i.u_scale_parent),u_fade_t:new s.Uniform1f(c,i.u_fade_t),u_opacity:new s.Uniform1f(c,i.u_opacity),u_image0:new s.Uniform1i(c,i.u_image0),u_image1:new s.Uniform1i(c,i.u_image1),u_brightness_low:new s.Uniform1f(c,i.u_brightness_low),u_brightness_high:new s.Uniform1f(c,i.u_brightness_high),u_saturation_factor:new s.Uniform1f(c,i.u_saturation_factor),u_contrast_factor:new s.Uniform1f(c,i.u_contrast_factor),u_spin_weights:new s.Uniform3f(c,i.u_spin_weights),u_perspective_transform:new s.Uniform2f(c,i.u_perspective_transform)}),symbolIcon:(c,i)=>({u_is_size_zoom_constant:new s.Uniform1i(c,i.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(c,i.u_is_size_feature_constant),u_size_t:new s.Uniform1f(c,i.u_size_t),u_size:new s.Uniform1f(c,i.u_size),u_camera_to_center_distance:new s.Uniform1f(c,i.u_camera_to_center_distance),u_pitch:new s.Uniform1f(c,i.u_pitch),u_rotate_symbol:new s.Uniform1i(c,i.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(c,i.u_aspect_ratio),u_fade_change:new s.Uniform1f(c,i.u_fade_change),u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(c,i.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(c,i.u_coord_matrix),u_is_text:new s.Uniform1i(c,i.u_is_text),u_pitch_with_map:new s.Uniform1i(c,i.u_pitch_with_map),u_texsize:new s.Uniform2f(c,i.u_texsize),u_tile_id:new s.Uniform3f(c,i.u_tile_id),u_zoom_transition:new s.Uniform1f(c,i.u_zoom_transition),u_inv_rot_matrix:new s.UniformMatrix4f(c,i.u_inv_rot_matrix),u_merc_center:new s.Uniform2f(c,i.u_merc_center),u_texture:new s.Uniform1i(c,i.u_texture)}),symbolSDF:(c,i)=>({u_is_size_zoom_constant:new s.Uniform1i(c,i.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(c,i.u_is_size_feature_constant),u_size_t:new s.Uniform1f(c,i.u_size_t),u_size:new s.Uniform1f(c,i.u_size),u_camera_to_center_distance:new s.Uniform1f(c,i.u_camera_to_center_distance),u_pitch:new s.Uniform1f(c,i.u_pitch),u_rotate_symbol:new s.Uniform1i(c,i.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(c,i.u_aspect_ratio),u_fade_change:new s.Uniform1f(c,i.u_fade_change),u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(c,i.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(c,i.u_coord_matrix),u_is_text:new s.Uniform1i(c,i.u_is_text),u_pitch_with_map:new s.Uniform1i(c,i.u_pitch_with_map),u_texsize:new s.Uniform2f(c,i.u_texsize),u_texture:new s.Uniform1i(c,i.u_texture),u_gamma_scale:new s.Uniform1f(c,i.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(c,i.u_device_pixel_ratio),u_tile_id:new s.Uniform3f(c,i.u_tile_id),u_zoom_transition:new s.Uniform1f(c,i.u_zoom_transition),u_inv_rot_matrix:new s.UniformMatrix4f(c,i.u_inv_rot_matrix),u_merc_center:new s.Uniform2f(c,i.u_merc_center),u_is_halo:new s.Uniform1i(c,i.u_is_halo)}),symbolTextAndIcon:(c,i)=>({u_is_size_zoom_constant:new s.Uniform1i(c,i.u_is_size_zoom_constant),u_is_size_feature_constant:new s.Uniform1i(c,i.u_is_size_feature_constant),u_size_t:new s.Uniform1f(c,i.u_size_t),u_size:new s.Uniform1f(c,i.u_size),u_camera_to_center_distance:new s.Uniform1f(c,i.u_camera_to_center_distance),u_pitch:new s.Uniform1f(c,i.u_pitch),u_rotate_symbol:new s.Uniform1i(c,i.u_rotate_symbol),u_aspect_ratio:new s.Uniform1f(c,i.u_aspect_ratio),u_fade_change:new s.Uniform1f(c,i.u_fade_change),u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_label_plane_matrix:new s.UniformMatrix4f(c,i.u_label_plane_matrix),u_coord_matrix:new s.UniformMatrix4f(c,i.u_coord_matrix),u_is_text:new s.Uniform1i(c,i.u_is_text),u_pitch_with_map:new s.Uniform1i(c,i.u_pitch_with_map),u_texsize:new s.Uniform2f(c,i.u_texsize),u_texsize_icon:new s.Uniform2f(c,i.u_texsize_icon),u_texture:new s.Uniform1i(c,i.u_texture),u_texture_icon:new s.Uniform1i(c,i.u_texture_icon),u_gamma_scale:new s.Uniform1f(c,i.u_gamma_scale),u_device_pixel_ratio:new s.Uniform1f(c,i.u_device_pixel_ratio),u_is_halo:new s.Uniform1i(c,i.u_is_halo)}),background:(c,i)=>({u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_opacity:new s.Uniform1f(c,i.u_opacity),u_color:new s.UniformColor(c,i.u_color)}),backgroundPattern:(c,i)=>({u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_opacity:new s.Uniform1f(c,i.u_opacity),u_image:new s.Uniform1i(c,i.u_image),u_pattern_tl_a:new s.Uniform2f(c,i.u_pattern_tl_a),u_pattern_br_a:new s.Uniform2f(c,i.u_pattern_br_a),u_pattern_tl_b:new s.Uniform2f(c,i.u_pattern_tl_b),u_pattern_br_b:new s.Uniform2f(c,i.u_pattern_br_b),u_texsize:new s.Uniform2f(c,i.u_texsize),u_mix:new s.Uniform1f(c,i.u_mix),u_pattern_size_a:new s.Uniform2f(c,i.u_pattern_size_a),u_pattern_size_b:new s.Uniform2f(c,i.u_pattern_size_b),u_scale_a:new s.Uniform1f(c,i.u_scale_a),u_scale_b:new s.Uniform1f(c,i.u_scale_b),u_pixel_coord_upper:new s.Uniform2f(c,i.u_pixel_coord_upper),u_pixel_coord_lower:new s.Uniform2f(c,i.u_pixel_coord_lower),u_tile_units_to_pixels:new s.Uniform1f(c,i.u_tile_units_to_pixels)}),terrainRaster:$n,terrainDepth:$n,skybox:(c,i)=>({u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_sun_direction:new s.Uniform3f(c,i.u_sun_direction),u_cubemap:new s.Uniform1i(c,i.u_cubemap),u_opacity:new s.Uniform1f(c,i.u_opacity),u_temporal_offset:new s.Uniform1f(c,i.u_temporal_offset)}),skyboxGradient:(c,i)=>({u_matrix:new s.UniformMatrix4f(c,i.u_matrix),u_color_ramp:new s.Uniform1i(c,i.u_color_ramp),u_center_direction:new s.Uniform3f(c,i.u_center_direction),u_radius:new s.Uniform1f(c,i.u_radius),u_opacity:new s.Uniform1f(c,i.u_opacity),u_temporal_offset:new s.Uniform1f(c,i.u_temporal_offset)}),skyboxCapture:(c,i)=>({u_matrix_3f:new s.UniformMatrix3f(c,i.u_matrix_3f),u_sun_direction:new s.Uniform3f(c,i.u_sun_direction),u_sun_intensity:new s.Uniform1f(c,i.u_sun_intensity),u_color_tint_r:new s.Uniform4f(c,i.u_color_tint_r),u_color_tint_m:new s.Uniform4f(c,i.u_color_tint_m),u_luminance:new s.Uniform1f(c,i.u_luminance)}),globeRaster:(c,i)=>({u_proj_matrix:new s.UniformMatrix4f(c,i.u_proj_matrix),u_globe_matrix:new s.UniformMatrix4f(c,i.u_globe_matrix),u_merc_matrix:new s.UniformMatrix4f(c,i.u_merc_matrix),u_zoom_transition:new s.Uniform1f(c,i.u_zoom_transition),u_merc_center:new s.Uniform2f(c,i.u_merc_center),u_image0:new s.Uniform1i(c,i.u_image0)}),globeAtmosphere:(c,i)=>({u_center:new s.Uniform2f(c,i.u_center),u_radius:new s.Uniform1f(c,i.u_radius),u_screen_size:new s.Uniform2f(c,i.u_screen_size),u_pixel_ratio:new s.Uniform1f(c,i.u_pixel_ratio),u_opacity:new s.Uniform1f(c,i.u_opacity),u_fadeout_range:new s.Uniform1f(c,i.u_fadeout_range),u_start_color:new s.Uniform3f(c,i.u_start_color),u_end_color:new s.Uniform3f(c,i.u_end_color)})};let Is;function Sl(c,i,o,u,d,f,g){const x=c.context,E=x.gl,S=c.useProgram("collisionBox"),I=[];let z=0,L=0;for(let K=0;K<u.length;K++){const W=u[K],X=i.getTile(W),Q=X.getBucket(o);if(!Q)continue;let he=W.projMatrix;d[0]===0&&d[1]===0||(he=c.translatePosMatrix(W.projMatrix,X,d,f));const ge=g?Q.textCollisionBox:Q.iconCollisionBox,Ge=Q.collisionCircleArray;if(Ge.length>0){const De=s.create(),Pe=he;s.mul(De,Q.placementInvProjMatrix,c.transform.glCoordMatrix),s.mul(De,De,Q.placementViewportMatrix),I.push({circleArray:Ge,circleOffset:L,transform:Pe,invTransform:De}),z+=Ge.length/4,L=z}ge&&(c.terrain&&c.terrain.setupElevationDraw(X,S),S.draw(x,E.LINES,s.DepthMode.disabled,s.StencilMode.disabled,c.colorModeForRenderPass(),s.CullFaceMode.disabled,Fc(he,c.transform,X),o.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,null,c.transform.zoom,null,ge.collisionVertexBuffer,ge.collisionVertexBufferExt))}if(!g||!I.length)return;const V=c.useProgram("collisionCircle"),F=new s.StructArrayLayout2f1f2i16;F.resize(4*z),F._trim();let N=0;for(const K of I)for(let W=0;W<K.circleArray.length/4;W++){const X=4*W,Q=K.circleArray[X+0],he=K.circleArray[X+1],ge=K.circleArray[X+2],Ge=K.circleArray[X+3];F.emplace(N++,Q,he,ge,Ge,0),F.emplace(N++,Q,he,ge,Ge,1),F.emplace(N++,Q,he,ge,Ge,2),F.emplace(N++,Q,he,ge,Ge,3)}(!Is||Is.length<2*z)&&(Is=function(K){const W=2*K,X=new s.StructArrayLayout3ui6;X.resize(W),X._trim();for(let Q=0;Q<W;Q++){const he=6*Q;X.uint16[he+0]=4*Q+0,X.uint16[he+1]=4*Q+1,X.uint16[he+2]=4*Q+2,X.uint16[he+3]=4*Q+2,X.uint16[he+4]=4*Q+3,X.uint16[he+5]=4*Q+0}return X}(z));const J=x.createIndexBuffer(Is,!0),U=x.createVertexBuffer(F,s.collisionCircleLayout.members,!0);for(const K of I){const W={u_matrix:K.transform,u_inv_matrix:K.invTransform,u_camera_to_center_distance:(H=c.transform).cameraToCenterDistance,u_viewport_size:[H.width,H.height]};V.draw(x,E.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,c.colorModeForRenderPass(),s.CullFaceMode.disabled,W,o.id,U,J,s.SegmentVector.simpleSegment(0,2*K.circleOffset,K.circleArray.length,K.circleArray.length/2),null,c.transform.zoom,null,null,null)}var H;U.destroy(),J.destroy()}const xa=s.identity(new Float32Array(16));function Nc(c,i,o,u,d,f){const{horizontalAlign:g,verticalAlign:x}=s.getAnchorAlignment(c),E=-(g-.5)*i,S=-(x-.5)*o,I=s.evaluateVariableOffset(c,u);return new s.pointGeometry((E/d+I[0])*f,(S/d+I[1])*f)}function wh(c,i,o,u,d,f,g,x,E,S,I,z){const L=c.text.placedSymbolArray,V=c.text.dynamicLayoutVertexArray,F=c.icon.dynamicLayoutVertexArray,N={},J=x.projMatrix,U=f.elevation,H=U?U.getAtTileOffsetFunc(x,z):K=>[0,0,0];V.clear();for(let K=0;K<L.length;K++){const W=L.get(K),X=c.allowVerticalPlacement&&!W.placedOrientation,Q=W.hidden||!W.crossTileID||X?null:u[W.crossTileID];if(Q){const he=new s.pointGeometry(W.tileAnchorX,W.tileAnchorY),ge=H(he),Ge=Yi(he,o?J:g,ge[2]),De=cn(f.cameraToCenterDistance,Ge.signedDistanceFromCamera);let Pe=d.evaluateSizeForFeature(c.textSizeData,S,W)*De/s.ONE_EM;o&&(Pe*=c.tilePixelRatio/E);const{width:ve,height:me,anchor:Ae,textOffset:Se,textScale:rt}=Q,ut=Nc(Ae,ve,me,Se,rt,Pe),bt=o?Yi(he.add(ut),g,ge[2]).point:Ge.point.add(i?ut.rotate(-f.angle):ut),je=c.allowVerticalPlacement&&W.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let ot=0;ot<W.numGlyphs;ot++)s.addDynamicAttributes(V,bt,je);I&&W.associatedIconIndex>=0&&(N[W.associatedIconIndex]={shiftedAnchor:bt,angle:je})}else Wr(W.numGlyphs,V)}if(I){F.clear();const K=c.icon.placedSymbolArray;for(let W=0;W<K.length;W++){const X=K.get(W);if(X.hidden)Wr(X.numGlyphs,F);else{const Q=N[W];if(Q)for(let he=0;he<X.numGlyphs;he++)s.addDynamicAttributes(F,Q.shiftedAnchor,Q.angle);else Wr(X.numGlyphs,F)}}c.icon.dynamicLayoutVertexBuffer.updateData(F)}c.text.dynamicLayoutVertexBuffer.updateData(V)}function Th(c,i,o){return o.iconsInText&&i?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function va(c,i,o,u,d,f,g,x,E,S,I,z){const L=c.context,V=L.gl,F=c.transform,N=F.projection.createTileTransform(F,F.worldSize),J=x==="map",U=E==="map",H=J&&o.layout.get("symbol-placement")!=="point",K=J&&!U&&!H,W=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let X=!1;const Q=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),he=[s.mercatorXfromLng(F.center.lng),s.mercatorYfromLat(F.center.lat)],ge=o.layout.get("text-variable-anchor"),Ge=F.projection.name==="globe",De=Ge?s.globeToMercatorTransition(F.zoom):0,Pe=[],ve=[];c.terrain&&U&&ve.push("PITCH_WITH_MAP_TERRAIN"),Ge&&ve.push("PROJECTION_GLOBE_VIEW"),H&&ve.push("PROJECTED_POS_ON_VIEWPORT");for(const me of u){const Ae=i.getTile(me),Se=Ae.getBucket(o);if(!Se||Se.projection!==F.projection.name)continue;const rt=d?Se.text:Se.icon;if(!rt||Se.fullyClipped||!rt.segments.get().length)continue;const ut=rt.programConfigurations.get(o.id),bt=d||Se.sdfIcons,je=d?Se.textSizeData:Se.iconSizeData,ot=U||F.pitch!==0,mt=c.useProgram(Th(bt,d,Se),ut,ve),Kt=s.evaluateSizeForZoom(je,F.zoom),ri=[me.canonical.x,me.canonical.y,1<<me.canonical.z];let pt,It,pi,Ri,fr=[0,0],Fr=null;if(d){if(It=Ae.glyphAtlasTexture,pi=V.LINEAR,pt=Ae.glyphAtlasTexture.size,Se.iconsInText){fr=Ae.imageAtlasTexture.size,Fr=Ae.imageAtlasTexture;const Zi=je.kind==="composite"||je.kind==="camera";Ri=ot||c.options.rotating||c.options.zooming||Zi?V.LINEAR:V.NEAREST}}else{const Zi=o.layout.get("icon-size").constantOr(0)!==1||Se.iconsNeedLinear;It=Ae.imageAtlasTexture,pi=bt||c.options.rotating||c.options.zooming||Zi||ot?V.LINEAR:V.NEAREST,pt=Ae.imageAtlasTexture.size}const Yr=c.transform.calculatePixelsToTileUnitsMatrix(Ae),Lt=On(me.projMatrix,Ae.tileID.canonical,U,J,c.transform,Yr),_t=c.terrain&&U&&H?s.invert(new Float32Array(16),Lt):xa,Pt=Tn(me.projMatrix,Ae.tileID.canonical,U,J,c.transform,Yr),Ti=ge&&Se.hasTextData(),Sr=o.layout.get("icon-text-fit")!=="none"&&Ti&&Se.hasIconData();if(H){const Zi=F.elevation,_o=Zi?Zi.getAtTileOffsetFunc(me,N):Kn=>[0,0,0];Sc(Se,me.projMatrix,c,d,Lt,Pt,U,S,_o,me)}const ci=c.translatePosMatrix(me.projMatrix,Ae,f,g),Ir=H||d&&ge||Sr?xa:Lt,Ns=c.translatePosMatrix(Pt,Ae,f,g,!0),mr=bt&&o.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let mo;const et=N.createInversionMatrix(me.toUnwrapped());mo=bt?Se.iconsInText?Ss(je.kind,Kt,K,U,c,ci,Ir,Ns,pt,fr,ri,De,et,he):Es(je.kind,Kt,K,U,c,ci,Ir,Ns,d,pt,!0,ri,De,et,he):ga(je.kind,Kt,K,U,c,ci,Ir,Ns,d,pt,ri,De,et,he);const st={program:mt,buffers:rt,uniformValues:mo,atlasTexture:It,atlasTextureIcon:Fr,atlasInterpolation:pi,atlasInterpolationIcon:Ri,isSDF:bt,hasHalo:mr,tile:Ae,labelPlaneMatrixInv:_t};if(W&&Se.canOverlap){X=!0;const Zi=rt.segments.get();for(const _o of Zi)Pe.push({segments:new s.SegmentVector([_o]),sortKey:_o.sortKey,state:st})}else Pe.push({segments:rt.segments,sortKey:0,state:st})}X&&Pe.sort((me,Ae)=>me.sortKey-Ae.sortKey);for(const me of Pe){const Ae=me.state;if(c.terrain&&c.terrain.setupElevationDraw(Ae.tile,Ae.program,{useDepthForOcclusion:!Ge,labelPlaneMatrixInv:Ae.labelPlaneMatrixInv}),L.activeTexture.set(V.TEXTURE0),Ae.atlasTexture.bind(Ae.atlasInterpolation,V.CLAMP_TO_EDGE),Ae.atlasTextureIcon&&(L.activeTexture.set(V.TEXTURE1),Ae.atlasTextureIcon&&Ae.atlasTextureIcon.bind(Ae.atlasInterpolationIcon,V.CLAMP_TO_EDGE)),Ae.isSDF){const Se=Ae.uniformValues;Ae.hasHalo&&(Se.u_is_halo=1,ba(Ae.buffers,me.segments,o,c,Ae.program,Q,I,z,Se)),Se.u_is_halo=0}ba(Ae.buffers,me.segments,o,c,Ae.program,Q,I,z,Ae.uniformValues)}}function ba(c,i,o,u,d,f,g,x,E){const S=u.context;d.draw(S,S.gl.TRIANGLES,f,g,x,s.CullFaceMode.disabled,E,o.id,c.layoutVertexBuffer,c.indexBuffer,i,o.paint,u.transform.zoom,c.programConfigurations.get(o.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function wa(c,i,o,u,d,f,g){const x=c.context.gl,E=o.paint.get("fill-pattern"),S=E&&E.constantOr(1),I=o.getCrossfadeParameters();let z,L,V,F,N;g?(L=S&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=x.LINES):(L=S?"fillPattern":"fill",z=x.TRIANGLES);for(const J of u){const U=i.getTile(J);if(S&&!U.patternsLoaded())continue;const H=U.getBucket(o);if(!H)continue;c.prepareDrawTile(J);const K=H.programConfigurations.get(o.id),W=c.useProgram(L,K);S&&(c.context.activeTexture.set(x.TEXTURE0),U.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),K.updatePaintBuffers(I));const X=E.constantOr(null);if(X&&U.imageAtlas){const he=U.imageAtlas,ge=he.patternPositions[X.to.toString()],Ge=he.patternPositions[X.from.toString()];ge&&Ge&&K.setConstantPatternPositions(ge,Ge)}const Q=c.translatePosMatrix(J.projMatrix,U,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(g){F=H.indexBuffer2,N=H.segments2;const he=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[x.drawingBufferWidth,x.drawingBufferHeight];V=L==="fillOutlinePattern"&&S?Rc(Q,c,I,U,he):vh(Q,he)}else F=H.indexBuffer,N=H.segments,V=S?wl(Q,c,I,U):Bc(Q);c.prepareDrawProgram(c.context,W,J.toUnwrapped()),W.draw(c.context,z,d,c.stencilModeForClipping(J),f,s.CullFaceMode.disabled,V,o.id,H.layoutVertexBuffer,F,N,o.paint,c.transform.zoom,K)}}function Ms(c,i,o,u,d,f,g){const x=c.context,E=x.gl,S=o.paint.get("fill-extrusion-pattern"),I=S.constantOr(1),z=o.getCrossfadeParameters(),L=o.paint.get("fill-extrusion-opacity");for(const V of u){const F=i.getTile(V),N=F.getBucket(o);if(!N)continue;const J=N.programConfigurations.get(o.id),U=c.useProgram(I?"fillExtrusionPattern":"fillExtrusion",J);if(c.terrain){const Q=c.terrain;if(!N.enableTerrain)continue;if(Q.setupElevationDraw(F,U,{useMeterToDem:!0}),jc(x,i,V,N,o,Q),!N.centroidVertexBuffer){const he=U.attributes.a_centroid_pos;he!==void 0&&E.vertexAttrib2f(he,0,0)}}I&&(c.context.activeTexture.set(E.TEXTURE0),F.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),J.updatePaintBuffers(z));const H=S.constantOr(null);if(H&&F.imageAtlas){const Q=F.imageAtlas,he=Q.patternPositions[H.to.toString()],ge=Q.patternPositions[H.from.toString()];he&&ge&&J.setConstantPatternPositions(he,ge)}const K=c.translatePosMatrix(V.projMatrix,F,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),W=o.paint.get("fill-extrusion-vertical-gradient"),X=I?bl(K,c,W,L,V,z,F):Lc(K,c,W,L);c.prepareDrawProgram(x,U,V.toUnwrapped()),U.draw(x,x.gl.TRIANGLES,d,f,g,s.CullFaceMode.backCCW,X,o.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,o.paint,c.transform.zoom,J,c.terrain?N.centroidVertexBuffer:null)}}function jc(c,i,o,u,d,f){const g=[U=>{let H=U.canonical.x-1,K=U.wrap;return H<0&&(H=(1<<U.canonical.z)-1,K--),new s.OverscaledTileID(U.overscaledZ,K,U.canonical.z,H,U.canonical.y)},U=>{let H=U.canonical.x+1,K=U.wrap;return H===1<<U.canonical.z&&(H=0,K++),new s.OverscaledTileID(U.overscaledZ,K,U.canonical.z,H,U.canonical.y)},U=>new s.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,(U.canonical.y===0?1<<U.canonical.z:U.canonical.y)-1),U=>new s.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y===(1<<U.canonical.z)-1?0:U.canonical.y+1)],x=U=>{const H=i.getSource().maxzoom,K=he=>{const ge=i.getTileByID(he);if(ge&&ge.hasData())return ge.getBucket(d)};let W,X,Q;return(U.overscaledZ===U.canonical.z||U.overscaledZ>=H)&&(W=K(U.key)),U.overscaledZ>=H&&(X=K(U.calculateScaledKey(U.overscaledZ+1))),U.overscaledZ>H&&(Q=K(U.calculateScaledKey(U.overscaledZ-1))),W||X||Q},E=[0,0,0],S=(U,H)=>(E[0]=Math.min(U.min.y,H.min.y),E[1]=Math.max(U.max.y,H.max.y),E[2]=s.EXTENT-H.min.x>U.max.x?H.min.x-s.EXTENT:U.max.x,E),I=(U,H)=>(E[0]=Math.min(U.min.x,H.min.x),E[1]=Math.max(U.max.x,H.max.x),E[2]=s.EXTENT-H.min.y>U.max.y?H.min.y-s.EXTENT:U.max.y,E),z=[(U,H)=>S(U,H),(U,H)=>S(H,U),(U,H)=>I(U,H),(U,H)=>I(H,U)],L=new s.pointGeometry(0,0);let V,F,N;const J=(U,H,K,W,X)=>{const Q=[[W?K:U,W?U:K,0],[W?K:H,W?H:K,0]],he=X<0?s.EXTENT+X:X,ge=[W?he:(U+H)/2,W?(U+H)/2:he,0];return K===0&&X<0||K!==0&&X>0?f.getForTilePoints(N,[ge],!0,F):Q.push(ge),f.getForTilePoints(o,Q,!0,V),Math.max(Q[0][2],Q[1][2],ge[2])/f.exaggeration()};for(let U=0;U<4;U++){const H=u.borders[U];if(H.length===0&&(u.borderDone[U]=!0),u.borderDone[U])continue;const K=N=g[U](o),W=x(K);if(!W||!W.enableTerrain||(F=f.findDEMTileFor(K),!F||!F.dem))continue;if(!V){const ge=f.findDEMTileFor(o);if(!ge||!ge.dem)return;V=ge}const X=(U<2?1:5)-U,Q=W.borders[X];let he=0;for(let ge=0;ge<H.length;ge++){const Ge=u.featuresOnBorder[H[ge]],De=Ge.borders[U];let Pe;for(;he<Q.length&&(Pe=W.featuresOnBorder[Q[he]],!(Pe.borders[X][1]>De[0]+3));)W.borderDone[X]||W.encodeCentroid(void 0,Pe,!1),he++;if(Pe&&he<Q.length){const ve=he;let me=0;for(;!(Pe.borders[X][0]>De[1]-3)&&(me++,++he!==Q.length);)Pe=W.featuresOnBorder[Q[he]];if(Pe=W.featuresOnBorder[Q[ve]],Ge.intersectsCount()>1||Pe.intersectsCount()>1||me!==1){me!==1&&(he=ve),u.encodeCentroid(void 0,Ge,!1),W.borderDone[X]||W.encodeCentroid(void 0,Pe,!1);continue}const Ae=z[U](Ge,Pe),Se=U%2?s.EXTENT-1:0;L.x=J(Ae[0],Math.min(s.EXTENT-1,Ae[1]),Se,U<2,Ae[2]),L.y=0,u.encodeCentroid(L,Ge,!1),W.borderDone[X]||W.encodeCentroid(L,Pe,!1)}else u.encodeCentroid(void 0,Ge,!1)}u.borderDone[U]=u.needsCentroidUpdate=!0,W.borderDone[X]||(W.borderDone[X]=W.needsCentroidUpdate=!0)}(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(c)}const Gc=new s.Color(1,0,0,1),Eh=new s.Color(0,1,0,1),As=new s.Color(0,0,1,1),Cs=new s.Color(1,0,1,1),$c=new s.Color(0,1,1,1);function pr(c,i,o,u){fo(c,0,i+o/2,c.transform.width,o,u)}function Ta(c,i,o,u){fo(c,i-o/2,0,o,c.transform.height,u)}function fo(c,i,o,u,d,f){const g=c.context,x=g.gl;x.enable(x.SCISSOR_TEST),x.scissor(i*s.exported.devicePixelRatio,o*s.exported.devicePixelRatio,u*s.exported.devicePixelRatio,d*s.exported.devicePixelRatio),g.clear({color:f}),x.disable(x.SCISSOR_TEST)}function Ea(c,i,o){const u=c.context,d=u.gl,f=o.projMatrix,g=c.useProgram("debug"),x=i.getTileByID(o.key);c.terrain&&c.terrain.setupElevationDraw(x,g);const E=s.DepthMode.disabled,S=s.StencilMode.disabled,I=c.colorModeForRenderPass(),z="$debug";u.activeTexture.set(d.TEXTURE0),c.emptyTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),x._makeDebugTileBoundsBuffers(c.context,c.transform.projection);const L=x._tileDebugBuffer||c.debugBuffer,V=x._tileDebugIndexBuffer||c.debugIndexBuffer,F=x._tileDebugSegments||c.debugSegments;g.draw(u,d.LINE_STRIP,E,S,I,s.CullFaceMode.disabled,El(f,s.Color.red),z,L,V,F);const N=x.latestRawTileData,J=Math.floor((N&&N.byteLength||0)/1024),U=i.getTile(o).tileSize,H=512/Math.min(U,512)*(o.overscaledZ/c.transform.zoom)*.5;let K=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(K+=` => ${o.overscaledZ}`),function(W,X){W.initDebugOverlayCanvas();const Q=W.debugOverlayCanvas,he=W.context.gl,ge=W.debugOverlayCanvas.getContext("2d");ge.clearRect(0,0,Q.width,Q.height),ge.shadowColor="white",ge.shadowBlur=2,ge.lineWidth=1.5,ge.strokeStyle="white",ge.textBaseline="top",ge.font="bold 36px Open Sans, sans-serif",ge.fillText(X,5,5),ge.strokeText(X,5,5),W.debugOverlayTexture.update(Q),W.debugOverlayTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE)}(c,`${K} ${J}kb`),g.draw(u,d.TRIANGLES,E,S,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,El(f,s.Color.transparent,H),z,c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments)}const Il=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ml}=Il;function Xr(c,i,o,u){c.emplaceBack(i,o,u)}class Sa{constructor(i){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,Xr(this.vertexArray,-1,-1,1),Xr(this.vertexArray,1,-1,1),Xr(this.vertexArray,-1,1,1),Xr(this.vertexArray,1,1,1),Xr(this.vertexArray,-1,-1,-1),Xr(this.vertexArray,1,-1,-1),Xr(this.vertexArray,-1,1,-1),Xr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Ml),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function qn(c,i,o,u,d,f){const g=c.gl,x=i.paint.get("sky-atmosphere-color"),E=i.paint.get("sky-atmosphere-halo-color"),S=i.paint.get("sky-atmosphere-sun-intensity"),I=((z,L,V,F,N)=>({u_matrix_3f:z,u_sun_direction:L,u_sun_intensity:V,u_color_tint_r:[F.r,F.g,F.b,F.a],u_color_tint_m:[N.r,N.g,N.b,N.a],u_luminance:5e-5}))(s.fromMat4([],u),d,S,x,E);g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_CUBE_MAP_POSITIVE_X+f,i.skyboxTexture,0),o.draw(c,g.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,I,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const zs={symbol:function(c,i,o,u,d){if(c.renderPass!=="translucent")return;const f=s.StencilMode.disabled,g=c.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(x,E,S,I,z,L,V){const F=E.transform,N=z==="map",J=L==="map",U=F.projection.createTileTransform(F,F.worldSize);for(const H of x){const K=I.getTile(H),W=K.getBucket(S);if(!W||W.projection!==F.projection.name||!W.text||!W.text.segments.get().length)continue;const X=s.evaluateSizeForZoom(W.textSizeData,F.zoom),Q=E.transform.calculatePixelsToTileUnitsMatrix(K),he=On(H.projMatrix,K.tileID.canonical,J,N,E.transform,Q),ge=S.layout.get("icon-text-fit")!=="none"&&W.hasIconData();if(X){const Ge=Math.pow(2,F.zoom-K.tileID.overscaledZ);wh(W,N,J,V,s.symbolSize,F,he,H,Ge,X,ge,U)}}}(u,c,o,i,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),d),o.paint.get("icon-opacity").constantOr(1)!==0&&va(c,i,o,u,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),f,g),o.paint.get("text-opacity").constantOr(1)!==0&&va(c,i,o,u,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),f,g),i.map.showCollisionBoxes&&(Sl(c,i,o,u,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),Sl(c,i,o,u,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(c,i,o,u){if(c.renderPass!=="translucent")return;const d=o.paint.get("circle-opacity"),f=o.paint.get("circle-stroke-width"),g=o.paint.get("circle-stroke-opacity"),x=o.layout.get("circle-sort-key").constantOr(1)!==void 0;if(d.constantOr(1)===0&&(f.constantOr(1)===0||g.constantOr(1)===0))return;const E=c.context,S=E.gl,I=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),z=s.StencilMode.disabled,L=c.colorModeForRenderPass(),V=[];for(let N=0;N<u.length;N++){const J=u[N],U=i.getTile(J),H=U.getBucket(o);if(!H)continue;const K=H.programConfigurations.get(o.id),W=Tl(o),X={programConfiguration:K,program:c.useProgram("circle",K,W),layoutVertexBuffer:H.layoutVertexBuffer,indexBuffer:H.indexBuffer,uniformValues:bh(c,J,U,o),tile:U};if(x){const Q=H.segments.get();for(const he of Q)V.push({segments:new s.SegmentVector([he]),sortKey:he.sortKey,state:X})}else V.push({segments:H.segments,sortKey:0,state:X})}x&&V.sort((N,J)=>N.sortKey-J.sortKey);const F={useDepthForOcclusion:c.transform.projection.name!=="globe"};for(const N of V){const{programConfiguration:J,program:U,layoutVertexBuffer:H,indexBuffer:K,uniformValues:W,tile:X}=N.state,Q=N.segments;c.terrain&&c.terrain.setupElevationDraw(X,U,F),c.prepareDrawProgram(E,U,X.tileID.toUnwrapped()),U.draw(E,S.TRIANGLES,I,z,L,s.CullFaceMode.disabled,W,o.id,H,K,Q,o.paint,c.transform.zoom,J)}},heatmap:function(c,i,o,u){if(o.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const d=c.context,f=d.gl,g=s.StencilMode.disabled,x=new s.ColorMode([f.ONE,f.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(E,S,I){const z=E.gl;E.activeTexture.set(z.TEXTURE1),E.viewport.set([0,0,S.width/4,S.height/4]);let L=I.heatmapFbo;if(L)z.bindTexture(z.TEXTURE_2D,L.colorAttachment.get()),E.bindFramebuffer.set(L.framebuffer);else{const V=z.createTexture();z.bindTexture(z.TEXTURE_2D,V),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.LINEAR),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.LINEAR),L=I.heatmapFbo=E.createFramebuffer(S.width/4,S.height/4,!1),function(F,N,J,U){const H=F.gl;H.texImage2D(H.TEXTURE_2D,0,H.RGBA,N.width/4,N.height/4,0,H.RGBA,F.extRenderToTextureHalfFloat?F.extTextureHalfFloat.HALF_FLOAT_OES:H.UNSIGNED_BYTE,null),U.colorAttachment.set(J)}(E,S,V,L)}})(d,c,o),d.clear({color:s.Color.transparent});for(let E=0;E<u.length;E++){const S=u[E];if(i.hasRenderableParent(S))continue;const I=i.getTile(S),z=I.getBucket(o);if(!z)continue;const L=z.programConfigurations.get(o.id),V=c.useProgram("heatmap",L),{zoom:F}=c.transform;c.terrain&&c.terrain.setupElevationDraw(I,V),c.prepareDrawProgram(d,V,S.toUnwrapped()),V.draw(d,f.TRIANGLES,s.DepthMode.disabled,g,x,s.CullFaceMode.disabled,Oc(S.projMatrix,I,F,o.paint.get("heatmap-intensity")),o.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,o.paint,c.transform.zoom,L)}d.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(d,f){const g=d.context,x=g.gl,E=f.heatmapFbo;if(!E)return;g.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,E.colorAttachment.get()),g.activeTexture.set(x.TEXTURE1);let S=f.colorRampTexture;S||(S=f.colorRampTexture=new s.Texture(g,f.colorRamp,x.RGBA)),S.bind(x.LINEAR,x.CLAMP_TO_EDGE),d.useProgram("heatmapTexture").draw(g,x.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,d.colorModeForRenderPass(),s.CullFaceMode.disabled,((I,z,L,V)=>({u_image:0,u_color_ramp:1,u_opacity:z.paint.get("heatmap-opacity")}))(0,f),f.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments,f.paint,d.transform.zoom)}(c,o))},line:function(c,i,o,u){if(c.renderPass!=="translucent")return;const d=o.paint.get("line-opacity"),f=o.paint.get("line-width");if(d.constantOr(1)===0||f.constantOr(1)===0)return;const g=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),x=c.colorModeForRenderPass(),E=o.paint.get("line-dasharray"),S=E.constantOr(1),I=o.layout.get("line-cap"),z=o.paint.get("line-pattern"),L=z.constantOr(1),V=o.paint.get("line-gradient"),F=o.getCrossfadeParameters(),N=L?"linePattern":"line",J=c.context,U=J.gl,H=(W=>{const X=[];Ts(W)&&X.push("RENDER_LINE_DASH"),W.paint.get("line-gradient")&&X.push("RENDER_LINE_GRADIENT");const Q=W.paint.get("line-pattern").constantOr(1),he=W.paint.get("line-opacity").constantOr(1)!==1;return!Q&&he&&X.push("RENDER_LINE_ALPHA_DISCARD"),X})(o);let K=H.includes("RENDER_LINE_ALPHA_DISCARD");c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(K=!1);for(const W of u){const X=i.getTile(W);if(L&&!X.patternsLoaded())continue;const Q=X.getBucket(o);if(!Q)continue;c.prepareDrawTile(W);const he=Q.programConfigurations.get(o.id),ge=c.useProgram(N,he,H),Ge=z.constantOr(null);if(Ge&&X.imageAtlas){const Se=X.imageAtlas,rt=Se.patternPositions[Ge.to.toString()],ut=Se.patternPositions[Ge.from.toString()];rt&&ut&&he.setConstantPatternPositions(rt,ut)}const De=E.constantOr(null),Pe=I.constantOr(null);if(!L&&De&&Pe&&X.lineAtlas){const Se=X.lineAtlas,rt=Se.getDash(De.to,Pe),ut=Se.getDash(De.from,Pe);rt&&ut&&he.setConstantPatternPositions(rt,ut)}const ve=c.terrain?W.projMatrix:null,me=L?po(c,X,o,F,ve):Uc(c,X,o,F,ve,Q.lineClipsArray.length);if(V){const Se=Q.gradients[o.id];let rt=Se.texture;if(o.gradientVersion!==Se.version){let ut=256;if(o.stepInterpolant){const bt=i.getSource().maxzoom,je=W.canonical.z===bt?Math.ceil(1<<c.transform.maxZoom-W.canonical.z):1;ut=s.clamp(s.nextPowerOfTwo(Q.maxLineLength/s.EXTENT*1024*je),256,J.maxTextureSize)}Se.gradient=s.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:ut,image:Se.gradient||void 0,clips:Q.lineClipsArray}),Se.texture?Se.texture.update(Se.gradient):Se.texture=new s.Texture(J,Se.gradient,U.RGBA),Se.version=o.gradientVersion,rt=Se.texture}J.activeTexture.set(U.TEXTURE1),rt.bind(o.stepInterpolant?U.NEAREST:U.LINEAR,U.CLAMP_TO_EDGE)}S&&(J.activeTexture.set(U.TEXTURE0),X.lineAtlasTexture.bind(U.LINEAR,U.REPEAT),he.updatePaintBuffers(F)),L&&(J.activeTexture.set(U.TEXTURE0),X.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),he.updatePaintBuffers(F)),c.prepareDrawProgram(J,ge,W.toUnwrapped());const Ae=Se=>{ge.draw(J,U.TRIANGLES,g,Se,x,s.CullFaceMode.disabled,me,o.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,o.paint,c.transform.zoom,he,Q.layoutVertexBuffer2)};if(K){const Se=c.stencilModeForClipping(W).ref;Se===0&&c.terrain&&J.clear({stencil:0});const rt={func:U.EQUAL,mask:255};me.u_alpha_discard_threshold=.8,Ae(new s.StencilMode(rt,Se,255,U.KEEP,U.KEEP,U.INVERT)),me.u_alpha_discard_threshold=0,Ae(new s.StencilMode(rt,Se,255,U.KEEP,U.KEEP,U.KEEP))}else Ae(c.stencilModeForClipping(W))}K&&(c.resetStencilClippingMasks(),c.terrain&&J.clear({stencil:0}))},fill:function(c,i,o,u){const d=o.paint.get("fill-color"),f=o.paint.get("fill-opacity");if(f.constantOr(1)===0)return;const g=c.colorModeForRenderPass(),x=o.paint.get("fill-pattern"),E=c.opaquePassEnabledForLayer()&&!x.constantOr(1)&&d.constantOr(s.Color.transparent).a===1&&f.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===E){const S=c.depthModeForSublayer(1,c.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);wa(c,i,o,u,S,g,!1)}if(c.renderPass==="translucent"&&o.paint.get("fill-antialias")){const S=c.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);wa(c,i,o,u,S,g,!0)}},"fill-extrusion":function(c,i,o,u){const d=o.paint.get("fill-extrusion-opacity");if(d!==0&&c.renderPass==="translucent"){const f=new s.DepthMode(c.context.gl.LEQUAL,s.DepthMode.ReadWrite,c.depthRangeFor3D);if(d!==1||o.paint.get("fill-extrusion-pattern").constantOr(1))Ms(c,i,o,u,f,s.StencilMode.disabled,s.ColorMode.disabled),Ms(c,i,o,u,f,c.stencilModeFor3D(),c.colorModeForRenderPass()),c.resetStencilClippingMasks();else{const g=c.colorModeForRenderPass();Ms(c,i,o,u,f,s.StencilMode.disabled,g)}}},hillshade:function(c,i,o,u){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent")return;const d=c.context,f=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),g=c.colorModeForRenderPass(),x=c.terrain&&c.terrain.renderingToTexture,[E,S]=c.renderPass!=="translucent"||x?[{},u]:c.stencilConfigForOverlap(u);for(const I of S){const z=i.getTile(I);if(z.needsHillshadePrepare&&c.renderPass==="offscreen")xs(c,z,o,f,s.StencilMode.disabled,g);else if(c.renderPass==="translucent"){const L=x&&c.terrain?c.terrain.stencilModeForRTTOverlap(I):E[I.overscaledZ];da(c,I,z,o,f,L,g)}}d.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,i,o,u,d,f){if(c.renderPass!=="translucent"||o.paint.get("raster-opacity")===0||!u.length)return;const g=c.context,x=g.gl,E=i.getSource(),S=c.useProgram("raster"),I=c.colorModeForRenderPass(),z=c.terrain&&c.terrain.renderingToTexture,[L,V]=E instanceof ln||z?[{},u]:c.stencilConfigForOverlap(u),F=V[V.length-1].overscaledZ,N=!c.options.moving;for(const J of V){const U=z?s.DepthMode.disabled:c.depthModeForSublayer(J.overscaledZ-F,o.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,x.LESS),H=J.toUnwrapped(),K=i.getTile(J);if(z&&(!K||!K.hasData()))continue;const W=z?J.projMatrix:c.transform.calculateProjMatrix(H,N),X=c.terrain&&z?c.terrain.stencilModeForRTTOverlap(J):L[J.overscaledZ],Q=f?0:o.paint.get("raster-fade-duration");K.registerFadeDuration(Q);const he=i.findLoadedParent(J,0),ge=Pc(K,he,i,c.transform,Q);let Ge,De;c.terrain&&c.terrain.prepareDrawTile(J);const Pe=o.paint.get("raster-resampling")==="nearest"?x.NEAREST:x.LINEAR;g.activeTexture.set(x.TEXTURE0),K.texture.bind(Pe,x.CLAMP_TO_EDGE),g.activeTexture.set(x.TEXTURE1),he?(he.texture.bind(Pe,x.CLAMP_TO_EDGE),Ge=Math.pow(2,he.tileID.overscaledZ-K.tileID.overscaledZ),De=[K.tileID.canonical.x*Ge%1,K.tileID.canonical.y*Ge%1]):K.texture.bind(Pe,x.CLAMP_TO_EDGE);const ve=ma(W,De||[0,0],Ge||1,ge,o,E instanceof ln?E.perspectiveTransform:[0,0]);if(c.prepareDrawProgram(g,S,H),E instanceof ln)S.draw(g,x.TRIANGLES,U,s.StencilMode.disabled,I,s.CullFaceMode.disabled,ve,o.id,E.boundsBuffer,c.quadTriangleIndexBuffer,E.boundsSegments);else{const{tileBoundsBuffer:me,tileBoundsIndexBuffer:Ae,tileBoundsSegments:Se}=c.getTileBoundsBuffers(K);S.draw(g,x.TRIANGLES,U,X,I,s.CullFaceMode.disabled,ve,o.id,me,Ae,Se)}}c.resetStencilClippingMasks()},background:function(c,i,o,u){const d=o.paint.get("background-color"),f=o.paint.get("background-opacity");if(f===0)return;const g=c.context,x=g.gl,E=c.transform,S=E.tileSize,I=o.paint.get("background-pattern");if(c.isPatternMissing(I))return;const z=!I&&d.a===1&&f===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==z)return;const L=s.StencilMode.disabled,V=c.depthModeForSublayer(0,z==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),F=c.colorModeForRenderPass(),N=c.useProgram(I?"backgroundPattern":"background");let J,U=u;U||(J=c.getBackgroundTiles(),U=Object.values(J).map(K=>K.tileID)),I&&(g.activeTexture.set(x.TEXTURE0),c.imageManager.bind(c.context));const H=o.getCrossfadeParameters();for(const K of U){const W=K.toUnwrapped(),X=u?K.projMatrix:c.transform.calculateProjMatrix(W);c.prepareDrawTile(K);const Q=i?i.getTile(K):J?J[K.key]:new s.Tile(K,S,E.zoom,c),he=I?ya(X,f,c,I,{tileID:K,tileSize:S},H):Xt(X,f,d);c.prepareDrawProgram(g,N,W);const{tileBoundsBuffer:ge,tileBoundsIndexBuffer:Ge,tileBoundsSegments:De}=c.getTileBoundsBuffers(Q);N.draw(g,x.TRIANGLES,V,L,F,s.CullFaceMode.disabled,he,o.id,ge,Ge,De)}},sky:function(c,i,o){const u=c.transform,d=u.projection.name==="mercator"||u.projection.name==="globe"?1:s.smoothstep(7,8,u.zoom),f=o.paint.get("sky-opacity")*d;if(f===0)return;const g=c.context,x=o.paint.get("sky-type"),E=new s.DepthMode(g.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),S=c.frameCounter/1e3%1;x==="atmosphere"?c.renderPass==="offscreen"?o.needsSkyboxCapture(c)&&(function(I,z,L,V){const F=I.context,N=F.gl;let J=z.skyboxFbo;if(!J){J=z.skyboxFbo=F.createFramebuffer(32,32,!1),z.skyboxGeometry=new Sa(F),z.skyboxTexture=F.gl.createTexture(),N.bindTexture(N.TEXTURE_CUBE_MAP,z.skyboxTexture),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_MAG_FILTER,N.LINEAR);for(let W=0;W<6;++W)N.texImage2D(N.TEXTURE_CUBE_MAP_POSITIVE_X+W,0,N.RGBA,32,32,0,N.RGBA,N.UNSIGNED_BYTE,null)}F.bindFramebuffer.set(J.framebuffer),F.viewport.set([0,0,32,32]);const U=z.getCenter(I,!0),H=I.useProgram("skyboxCapture"),K=new Float64Array(16);s.identity(K),s.rotateY(K,K,.5*-Math.PI),qn(F,z,H,K,U,0),s.identity(K),s.rotateY(K,K,.5*Math.PI),qn(F,z,H,K,U,1),s.identity(K),s.rotateX(K,K,.5*-Math.PI),qn(F,z,H,K,U,2),s.identity(K),s.rotateX(K,K,.5*Math.PI),qn(F,z,H,K,U,3),s.identity(K),qn(F,z,H,K,U,4),s.identity(K),s.rotateY(K,K,Math.PI),qn(F,z,H,K,U,5),F.viewport.set([0,0,I.width,I.height])}(c,o),o.markSkyboxValid(c)):c.renderPass==="sky"&&function(I,z,L,V,F){const N=I.context,J=N.gl,U=I.transform,H=I.useProgram("skybox");N.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_CUBE_MAP,z.skyboxTexture);const K=((W,X,Q,he,ge)=>({u_matrix:W,u_sun_direction:X,u_cubemap:0,u_opacity:he,u_temporal_offset:ge}))(U.skyboxMatrix,z.getCenter(I,!1),0,V,F);I.prepareDrawProgram(N,H),H.draw(N,J.TRIANGLES,L,s.StencilMode.disabled,I.colorModeForRenderPass(),s.CullFaceMode.backCW,K,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(c,o,E,f,S):x==="gradient"&&c.renderPass==="sky"&&function(I,z,L,V,F){const N=I.context,J=N.gl,U=I.transform,H=I.useProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new Sa(N)),N.activeTexture.set(J.TEXTURE0);let K=z.colorRampTexture;K||(K=z.colorRampTexture=new s.Texture(N,z.colorRamp,J.RGBA)),K.bind(J.LINEAR,J.CLAMP_TO_EDGE);const W=((X,Q,he,ge,Ge)=>({u_matrix:X,u_color_ramp:0,u_center_direction:Q,u_radius:s.degToRad(he),u_opacity:ge,u_temporal_offset:Ge}))(U.skyboxMatrix,z.getCenter(I,!1),z.paint.get("sky-gradient-radius"),V,F);I.prepareDrawProgram(N,H),H.draw(N,J.TRIANGLES,L,s.StencilMode.disabled,I.colorModeForRenderPass(),s.CullFaceMode.backCW,W,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(c,o,E,f,S)},debug:function(c,i,o){for(let u=0;u<o.length;u++)Ea(c,i,o[u])},custom:function(c,i,o){const u=c.context,d=o.implementation;if(c.transform.projection.unsupportedLayers&&c.transform.projection.unsupportedLayers.includes("custom"))s.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(c.renderPass==="offscreen"){const f=d.prerender;f&&(c.setCustomLayerDefaults(),u.setColorMode(c.colorModeForRenderPass()),f.call(d,u.gl,c.transform.customLayerMatrix()),u.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),u.setColorMode(c.colorModeForRenderPass()),u.setStencilMode(s.StencilMode.disabled);const f=d.renderingMode==="3d"?new s.DepthMode(c.context.gl.LEQUAL,s.DepthMode.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,s.DepthMode.ReadOnly);u.setDepthMode(f),d.render(u.gl,c.transform.customLayerMatrix()),u.setDirty(),c.setBaseState(),u.bindFramebuffer.set(null)}}};class Zc{constructor(i,o){this.context=new sr(i),this.transform=o,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new gs,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,o){const u=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Zn(this,i));const d=this._terrain;this.transform.elevation=u?d:null,d.update(i,this.transform,o)}_updateFog(i){const o=i.fog;if(!o||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,d]=o.getFovAdjustedRange(this.transform._fov);if(u>d)return void(this.transform.fogCullDistSq=null);const f=u+.78*(d-u);this.transform.fogCullDistSq=f*f}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,o){if(this.width=i*s.exported.devicePixelRatio,this.height=o*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._layers[u].resize()}setup(){const i=this.context,o=new s.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(s.EXTENT,0),o.emplaceBack(0,s.EXTENT),o.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(o,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const u=new s.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(s.EXTENT,0),u.emplaceBack(0,s.EXTENT),u.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=i.createVertexBuffer(u,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const d=new s.StructArrayLayout2i4;d.emplaceBack(-1,-1),d.emplaceBack(1,-1),d.emplaceBack(-1,1),d.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(d,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const f=new s.StructArrayLayout4i8;f.emplaceBack(0,0,0,0),f.emplaceBack(s.EXTENT,0,s.EXTENT,0),f.emplaceBack(0,s.EXTENT,0,s.EXTENT),f.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(f,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const g=new s.StructArrayLayout3ui6;g.emplaceBack(0,1,2),g.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(g);const x=new s.StructArrayLayout1ui2;for(const S of[0,1,3,2,0])x.emplaceBack(S);this.debugIndexBuffer=i.createIndexBuffer(x),this.emptyTexture=new s.Texture(i,{width:1,height:1,data:new Uint8Array([0,0,0,0])},i.gl.RGBA),this.identityMat=s.create();const E=this.context.gl;this.stencilClearMode=new s.StencilMode({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.loadTimeStamps.push(s.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,o=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(i,o.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,fn(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,o,u){if(!o||this.currentStencilSource===o.id||!i.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let x=!1;for(const E of u)if(this._tileClippingMaskIDs[E.key]===void 0){x=!0;break}if(!x)return}this.currentStencilSource=o.id;const d=this.context,f=d.gl;this.nextStencilID+u.length>256&&this.clearStencil(),d.setColorMode(s.ColorMode.disabled),d.setDepthMode(s.DepthMode.disabled);const g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of u){const E=o.getTile(x),S=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,{tileBoundsBuffer:I,tileBoundsIndexBuffer:z,tileBoundsSegments:L}=this.getTileBoundsBuffers(E);g.draw(d,f.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:f.ALWAYS,mask:0},S,255,f.KEEP,f.KEEP,f.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,fn(x.projMatrix),"$clipping",I,z,L)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,o=this.context.gl;return new s.StencilMode({func:o.NOTEQUAL,mask:255},i,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const o=this.context.gl;return new s.StencilMode({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(i){const o=this.context.gl,u=i.sort((g,x)=>x.overscaledZ-g.overscaledZ),d=u[u.length-1].overscaledZ,f=u[0].overscaledZ-d+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const g={};for(let x=0;x<f;x++)g[x+d]=new s.StencilMode({func:o.GEQUAL,mask:255},x+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=f,[g,u]}return[{[d]:s.StencilMode.disabled},u]}colorModeForRenderPass(){const i=this.context.gl;if(this._showOverdrawInspector){const o=1/8;return new s.ColorMode([i.CONSTANT_COLOR,i.ONE],new s.Color(o,o,o,0),[!0,!0,!0,!0])}return this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(i,o,u){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new s.DepthMode(u||this.context.gl.LEQUAL,o,[d,d])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,o){this.style=i,this.options=o,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const u=this.style.order,d=this.style._sourceCaches;for(const S in d){const I=d[S];I.used&&I.prepare(this.context)}const f={},g={},x={};for(const S in d){const I=d[S];f[S]=I.getVisibleCoordinates(),g[S]=f[S].slice().reverse(),x[S]=I.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<u.length;S++)if(this.style._layers[u[S]].is3D()){this.opaquePassCutoff=S;break}if(this.terrain&&(this.terrain.updateTileBinding(x),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),!s.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const S of u){const I=this.style._layers[S],z=i._getLayerSourceCache(I);if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const L=z?g[z.id]:void 0;(I.type==="custom"||I.isSky()||L&&L.length)&&this.renderLayer(this,z,I,L)}this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let E=s.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(E=this.style.fog.properties.get("color")),this.context.clear({color:o.showOverdrawInspector?s.Color.black:E,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[u[this.currentLayer]],I=i._getLayerSourceCache(S);if(S.isSky())continue;const z=I?g[I.id]:void 0;this._renderTileClippingMasks(S,I,z),this.renderLayer(this,I,S,z)}if(this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const S=this.style._layers[u[this.currentLayer]],I=i._getLayerSourceCache(S);S.isSky()&&this.renderLayer(this,I,S,I?g[I.id]:void 0)}for(this.transform.projection.name==="globe"&&function(S){const I=S.context,z=I.gl,L=S.transform,V=new s.DepthMode(z.LEQUAL,s.DepthMode.ReadOnly,[0,1]),F=S.useProgram("globeAtmosphere"),N=L._camera.getWorldToCamera(L.worldSize,1),J=L._camera.getCameraToClipPerspective(L._fov,L.width/L.height,L._nearZ,L._farZ),U=s.mul([],N,s.calculateGlobeMatrix(L,L.worldSize)),H=s.mul([],L.labelPlaneMatrix,J),K=s.transformMat4([],[0,0,0],U),W=s.add([],K,[L.worldSize/Math.PI/2,0,0]),X=s.transformMat4([],K,H),Q=s.transformMat4([],W,H),he=s.length(s.sub([],Q,X)),ge=1-s.globeToMercatorTransition(L.zoom),Ge={u_center:X,u_radius:he,u_screen_size:[L.width,L.height],u_pixel_ratio:s.exported.devicePixelRatio,u_opacity:ge,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};S.prepareDrawProgram(I,F);const De=S.globeSharedBuffers;De&&F.draw(I,z.TRIANGLES,V,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,Ge,"skybox",De.atmosphereVertexBuffer,De.atmosphereIndexBuffer,De.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;){const S=this.style._layers[u[this.currentLayer]],I=i._getLayerSourceCache(S);if(S.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(S)){if(S.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const z=I?(S.type==="symbol"?x:g)[I.id]:void 0;this._renderTileClippingMasks(S,I,I?f[I.id]:void 0),this.renderLayer(this,I,S,z),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let S=null;s.values(this.style._layers).forEach(I=>{const z=i._getLayerSourceCache(I);z&&!I.isHidden(this.transform.zoom)&&(!S||S.getSource().maxzoom<z.getSource().maxzoom)&&(S=z)}),S&&this.options.showTileBoundaries&&zs.debug(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){const I=S.transform.padding;pr(S,S.transform.height-(I.top||0),3,Gc),pr(S,I.bottom||0,3,Eh),Ta(S,I.left||0,3,As),Ta(S,S.transform.width-(I.right||0),3,Cs);const z=S.transform.centerPoint;(function(L,V,F,N){fo(L,V-1,F-10,2,20,N),fo(L,V-10,F-1,20,2,N)})(S,z.x,S.transform.height-z.y,$c)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}renderLayer(i,o,u,d){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||d&&d.length)&&(this.id=u.id,this.gpuTimingStart(u),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(u.type)||zs[u.type](i,o,u,d,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;let u=this.gpuTimers[i.id];u||(u=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:o.createQueryEXT()}),u.calls++,o.beginQueryEXT(o.TIME_ELAPSED_EXT,u.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}queryGpuTimers(i){const o={};for(const u in i){const d=i[u],f=this.context.extTimerQuery,g=f.getQueryObjectEXT(d.query,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(d.query),o[u]=g}return o}translatePosMatrix(i,o,u,d,f){if(!u[0]&&!u[1])return i;const g=f?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(g){const S=Math.sin(g),I=Math.cos(g);u=[u[0]*I-u[1]*S,u[0]*S+u[1]*I]}const x=[f?u[0]:Nt(o,u[0],this.transform.zoom),f?u[1]:Nt(o,u[1],this.transform.zoom),0],E=new Float32Array(16);return s.translate(E,i,x),E}saveTileTexture(i){const o=this._tileTextures[i.size[0]];o?o.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const o=this._tileTextures[i];return o&&o.length>0?o.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const o=this.imageManager.getPattern(i.from.toString()),u=this.imageManager.getPattern(i.to.toString());return!o||!u}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,o=this.style&&this.style.fog,u=[];return this.terrain&&!this.terrain.renderingToTexture&&u.push("TERRAIN"),o&&!i&&o.getOpacity(this.transform.pitch)!==0&&u.push("FOG"),i&&u.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&u.push("OVERDRAW_INSPECTOR"),u}useProgram(i,o,u){this.cache=this.cache||{};const d=u||[],f=this.currentGlobalDefines().concat(d),g=bs.cacheKey(i,f,o);return this.cache[g]||(this.cache[g]=new bs(this.context,i,vl[i],o,Vc[i],f)),this.cache[g]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(i){this.terrain&&this.terrain.prepareDrawTile(i)}prepareDrawProgram(i,o,u){if(this.terrain&&this.terrain.renderingToTexture)return;const d=this.style.fog;if(d){const f=d.getOpacity(this.transform.pitch);f!==0&&o.setFogUniformValues(i,((g,x,E,S)=>{const I=x.properties.get("color"),z=g.frameCounter/1e3%1,L=[I.r/I.a,I.g/I.a,I.b/I.a,S];return{u_fog_matrix:E?g.transform.calculateFogTileMatrix(E):g.identityMat,u_fog_range:x.getFovAdjustedRange(g.transform._fov),u_fog_color:L,u_fog_horizon_blend:x.properties.get("horizon-blend"),u_fog_temporal_offset:z}})(this,d,u,f))}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const i=this.context.gl,o=i.createTexture();return i.bindTexture(i.TEXTURE_2D,o),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,o=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const d of u)o[d.key]=i[d.key]||new s.Tile(d,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}}class Ia{constructor(i=0,o=0,u=0,d=0){if(isNaN(i)||i<0||isNaN(o)||o<0||isNaN(u)||u<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=o,this.left=u,this.right=d}interpolate(i,o,u){return o.top!=null&&i.top!=null&&(this.top=s.number(i.top,o.top,u)),o.bottom!=null&&i.bottom!=null&&(this.bottom=s.number(i.bottom,o.bottom,u)),o.left!=null&&i.left!=null&&(this.left=s.number(i.left,o.left,u)),o.right!=null&&i.right!=null&&(this.right=s.number(i.right,o.right,u)),this}getCenter(i,o){const u=s.clamp((this.left+i-this.right)/2,0,i),d=s.clamp((this.top+o-this.bottom)/2,0,o);return new s.pointGeometry(u,d)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Ia(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Wn(c,i){const o=s.getColumn(c,3);s.fromQuat(c,i),s.setColumn(c,3,o)}function qc(c,i){s.setColumn(c,3,[i[0],i[1],i[2],1])}function Al(c,i){const o=s.identity$1([]);return s.rotateZ$1(o,o,-i),s.rotateX$1(o,o,-c),o}function Cl(c,i){const o=[c[0],c[1],0],u=[i[0],i[1],0];if(s.length(o)>=1e-15){const g=s.normalize([],o);s.scale$2(u,g,s.dot(u,g)),i[0]=u[0],i[1]=u[1]}const d=s.cross([],i,c);if(s.len(d)<1e-15)return null;const f=Math.atan2(-d[1],d[0]);return Al(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),f)}class Wc{constructor(i,o){this.position=i,this.orientation=o}get position(){return this._position}set position(i){this._position=this._renderWorldCopies?function(o){if(!o)return;const u=Array.isArray(o)?new s.MercatorCoordinate(o[0],o[1],o[2]):o;return u.x=s.wrap(u.x,0,1),u}(i):i}lookAtPoint(i,o){if(this.orientation=null,!this.position)return;const u=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(i)):0,d=this.position,f=s.MercatorCoordinate.fromLngLat(i,u),g=[f.x-d.x,f.y-d.y,f.z-d.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=Cl(g,o)}setPitchBearing(i,o){this.orientation=Al(s.degToRad(i),s.degToRad(-o))}}class zl{constructor(i,o){this._transform=s.identity([]),this._orientation=s.identity$1([]),o&&(this._orientation=o,Wn(this._transform,this._orientation)),i&&qc(this._transform,i)}get mercatorPosition(){const i=this.position;return new s.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=s.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){qc(this._transform,i)}get orientation(){return this._orientation}set orientation(i){this._orientation=i,Wn(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,o){this._orientation=Al(i,o),Wn(this._transform,this._orientation)}forward(){const i=s.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=s.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=s.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,o){const u=new Float64Array(16);return s.invert(u,this.getWorldToCamera(i,o)),u}getWorldToCameraPosition(i,o,u){const d=this.position;s.scale$2(d,d,-i);const f=new Float64Array(16);return s.fromScaling(f,[u,u,u]),s.translate(f,f,d),f[10]*=o,f}getWorldToCamera(i,o){const u=new Float64Array(16),d=new Float64Array(4),f=this.position;return s.conjugate(d,this._orientation),s.scale$2(f,f,-i),s.fromQuat(u,d),s.translate(u,u,f),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=o,u[9]*=o,u[10]*=o,u[11]*=o,u}getCameraToClipPerspective(i,o,u,d){const f=new Float64Array(16);return s.perspective(f,i,o,u,d),f}getDistanceToElevation(i){const o=i===0?0:s.mercatorZfromAltitude(i,this.position[1]),u=this.forward();return(o-this.position[2])/u[2]}clone(){return new zl([...this.position],[...this.orientation])}}function Xc(c,i){const o=Aa(c),u=function(f,g,x,E,S){const I=new s.LngLat(x.lng-180*Hr,x.lat),z=new s.LngLat(x.lng+180*Hr,x.lat),L=f.project(I.lng,I.lat),V=f.project(z.lng,z.lat),F=-Math.atan2(V.y-L.y,V.x-L.x),N=s.MercatorCoordinate.fromLngLat(x);N.y=s.clamp(N.y,-.999975,.999975);const J=N.toLngLat(),U=f.project(J.lng,J.lat),H=s.MercatorCoordinate.fromLngLat(J);H.x+=Hr;const K=H.toLngLat(),W=f.project(K.lng,K.lat),X=kl(W.x-U.x,W.y-U.y,F),Q=s.MercatorCoordinate.fromLngLat(J);Q.y+=Hr;const he=Q.toLngLat(),ge=f.project(he.lng,he.lat),Ge=kl(ge.x-U.x,ge.y-U.y,F),De=Math.abs(X.x)/Math.abs(Ge.y),Pe=s.identity([]);s.rotateZ(Pe,Pe,-F*(1-(S?0:E)));const ve=s.identity([]);return s.scale(ve,ve,[1,1-(1-De)*E,1]),ve[4]=-Ge.x/Ge.y*E,s.rotateZ(ve,ve,F),s.multiply$1(ve,Pe,ve),ve}(c.projection,0,c.center,o,i),d=Ma(c);return s.scale(u,u,[d,d,1]),u}function Ma(c){const i=c.projection,o=Aa(c),u=Pl(i,c.center),d=Pl(i,s.LngLat.convert(i.center));return Math.pow(2,u*o+(1-o)*d)}function Aa(c){const i=c.projection.range;if(!i)return 0;const o=Math.max(c.width,c.height),u=Math.log(o/1024)/Math.LN2;return s.smoothstep(i[0]+u,i[1]+u,c.zoom)}const Hr=1/4e4;function Pl(c,i){const o=s.clamp(i.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),u=new s.LngLat(i.lng-180*Hr,o),d=new s.LngLat(i.lng+180*Hr,o),f=c.project(u.lng,o),g=c.project(d.lng,o),x=s.MercatorCoordinate.fromLngLat(u),E=s.MercatorCoordinate.fromLngLat(d),S=g.x-f.x,I=g.y-f.y,z=E.x-x.x,L=E.y-x.y,V=Math.sqrt((z*z+L*L)/(S*S+I*I));return Math.log(V)/Math.LN2}function kl(c,i,o){const u=Math.cos(o),d=Math.sin(o);return{x:c*u-i*d,y:c*d+i*u}}class Ps{constructor(i,o,u,d,f){this.tileSize=512,this._renderWorldCopies=f===void 0||f,this._minZoom=i||0,this._maxZoom=o||22,this._minPitch=u==null?0:u,this._maxPitch=d==null?60:d,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ia,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new zl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const i=new Ps(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.setProjection(this.getProjection()),i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i.tileSize=this.tileSize,i.setMaxBounds(this.getMaxBounds()),i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._cameraZoom=this._cameraZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,i?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(i){this._terrainEnabled()&&this._cameraZoom==null&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),i&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(i){i==null&&(i={name:"mercator"}),this.projectionOptions=i;const o=this.projection?this.getProjection():void 0;return this.projection=s.getProjection(i),!Le(o,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.pointGeometry(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const o=-i*Math.PI/180;var u;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=(u=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u),function(d,f,g){var x=f[0],E=f[1],S=f[2],I=f[3],z=Math.sin(g),L=Math.cos(g);d[0]=x*L+S*z,d[1]=E*L+I*z,d[2]=x*-z+S*L,d[3]=E*-z+I*L}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const o=s.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(i){const o=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const i=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return i===-1?(this._cameraZoom=null,!1):(this._centerAltitude=i,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let d=0,f=0;for(let g=0;g<o.length;g++){const x=new s.pointGeometry(o[g][0]*this.width,u+o[g][1]*(this.height-u)),E=i.pointCoordinate(x);if(!E)continue;const S=1/Math.hypot(E[0]-this._camera.position[0],E[1]-this._camera.position[1]);d+=E[3]*S,f+=S}return f===0?NaN:d/f}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._cameraZoom==null||!this._elevation)return;const i=this._cameraZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*o,d=this._mercatorZfromZoom(i),f=this._mercatorZfromZoom(this._maxZoom),g=Math.max(d-u,f);this._setZoom(this._zoomFromMercatorZ(g))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let u;u=i.z<this._camera.position[2]?[o.x,o.y,o.z]:[i.x,i.y,i.z];const d=s.length(s.sub([],this._camera.position,u));return s.clamp(this._zoomFromMercatorZ(d),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let o=!1;if(i.orientation&&!s.exactEquals(i.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(i.orientation)),i.position){const u=[i.position.x,i.position.y,i.position.z];s.exactEquals$1(u,this._camera.position)||(this._setCameraPosition(u),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,o=new Wc;return o.position=new s.MercatorCoordinate(i[0],i[1],i[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(i){if(!s.length$1(i))return!1;s.normalize$1(i,i);const o=s.transformQuat([],[0,0,-1],i),u=s.transformQuat([],[0,-1,0],i);if(u[2]<0)return!1;const d=Cl(o,u);return!!d&&(this._camera.orientation=d,!0)}_setCameraPosition(i){const o=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,d=this.cameraToCenterDistance;i[2]=s.clamp(i[2],d/u,d/o),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,o,u){this._unmodified=!1,this._edgeInsets.interpolate(i,o,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const o=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(i){const o=[new s.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const u=this.pointCoordinate(new s.pointGeometry(0,0)),d=this.pointCoordinate(new s.pointGeometry(this.width,0)),f=this.pointCoordinate(new s.pointGeometry(this.width,this.height)),g=this.pointCoordinate(new s.pointGeometry(0,this.height)),x=Math.floor(Math.min(u.x,d.x,f.x,g.x)),E=Math.floor(Math.max(u.x,d.x,f.x,g.x)),S=1;for(let I=x-S;I<=E+S;I++)I!==0&&o.push(new s.UnwrappedTileID(I,i))}return o}coveringTiles(i){let o=this.coveringZoomLevel(i);const u=o,d=this.elevation&&!i.isTerrainDEM,f=this.projection.name==="mercator";if(i.minzoom!==void 0&&o<i.minzoom)return[];i.maxzoom!==void 0&&o>i.maxzoom&&(o=i.maxzoom);const g=this.locationCoordinate(this.center),x=1<<o,E=[x*g.x,x*g.y,0],S=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.name!=="globe"),I=this.pointCoordinate(this.getCameraPoint()),z=x*s.mercatorZfromAltitude(1,this.center.lat),L=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),V=[x*I.x,x*I.y,L],F=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),N=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?o:0,J=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,U=i.isTerrainDEM?-J:this._elevation?this._elevation.getMinElevationBelowMSL():0,H=this.projection.isReprojectedInTileSpace?Ma(this):1,K=me=>{const Ae=1/4e4,Se=new s.MercatorCoordinate(me.x+Ae,me.y,me.z),rt=new s.MercatorCoordinate(me.x,me.y+Ae,me.z),ut=me.toLngLat(),bt=Se.toLngLat(),je=rt.toLngLat(),ot=this.locationCoordinate(ut),mt=this.locationCoordinate(bt),Kt=this.locationCoordinate(je),ri=Math.hypot(mt.x-ot.x,mt.y-ot.y),pt=Math.hypot(Kt.x-ot.x,Kt.y-ot.y);return Math.sqrt(ri*pt)*H/Ae},W=me=>{const Ae=J,Se=U;return{aabb:s.tileAABB(this,x,0,0,0,me,Se,Ae,this.projection),zoom:0,x:0,y:0,minZ:Se,maxZ:Ae,wrap:me,fullyVisible:!1}},X=[];let Q=[];const he=o,ge=i.reparseOverscaled?u:o,Ge=me=>me*me,De=Ge((L-this._centerAltitude)*z),Pe=me=>{if(!this._elevation||!me.tileID||!f)return;const Ae=this._elevation.getMinMaxForTile(me.tileID),Se=me.aabb;Ae?(Se.min[2]=Ae.min,Se.max[2]=Ae.max,Se.center[2]=(Se.min[2]+Se.max[2])/2):(me.shouldSplit=ve(me),me.shouldSplit||(Se.min[2]=Se.max[2]=Se.center[2]=this._centerAltitude))},ve=me=>{if(me.zoom<N)return!0;if(me.zoom===he)return!1;if(me.shouldSplit!=null)return me.shouldSplit;const Ae=me.aabb.distanceX(V),Se=me.aabb.distanceY(V);let rt=De;d&&(rt=Ge(me.aabb.distanceZ(V)*z));let ut=1;if(this.projection.isReprojectedInTileSpace&&u<=5){const je=Math.pow(2,me.zoom),ot=K(new s.MercatorCoordinate((me.x+.5)/je,(me.y+.5)/je));ut=ot>.85?1:ot}const bt=Ae*Ae+Se*Se+rt;return bt<Ge((1<<he-me.zoom)*F*ut*((je,ot)=>{if(ot*Ge(.707)<je)return 1;const mt=Math.sqrt(ot/je);return mt/(1.4144271570014144+(Math.pow(1.1,mt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(rt,De),bt))};if(this.renderWorldCopies)for(let me=1;me<=3;me++)X.push(W(-me)),X.push(W(me));for(X.push(W(0));X.length>0;){const me=X.pop(),Ae=me.x,Se=me.y;let rt=me.fullyVisible;if(!rt){const ut=me.aabb.intersects(S);if(ut===0)continue;rt=ut===2}if(me.zoom!==he&&ve(me))for(let ut=0;ut<4;ut++){const bt=(Ae<<1)+ut%2,je=(Se<<1)+(ut>>1),ot={aabb:f?me.aabb.quadrant(ut):s.tileAABB(this,x,me.zoom+1,bt,je,me.wrap,me.minZ,me.maxZ,this.projection),zoom:me.zoom+1,x:bt,y:je,wrap:me.wrap,fullyVisible:rt,tileID:void 0,shouldSplit:void 0,minZ:me.minZ,maxZ:me.maxZ};d&&(ot.tileID=new s.OverscaledTileID(me.zoom+1===he?ge:me.zoom+1,me.wrap,me.zoom+1,bt,je),Pe(ot)),X.push(ot)}else{const ut=me.zoom===he?ge:me.zoom;if(i.minzoom&&i.minzoom>ut)continue;const bt=E[0]-(.5+Ae+(me.wrap<<me.zoom))*(1<<o-me.zoom),je=E[1]-.5-Se,ot=me.tileID?me.tileID:new s.OverscaledTileID(ut,me.wrap,me.zoom,Ae,Se);Q.push({tileID:ot,distanceSq:bt*bt+je*je})}}if(this.fogCullDistSq){const me=this.fogCullDistSq,Ae=this.horizonLineFromTop();Q=Q.filter(Se=>{const rt=[0,0,0,1],ut=[s.EXTENT,s.EXTENT,0,1],bt=this.calculateFogTileMatrix(Se.tileID.toUnwrapped());s.transformMat4$1(rt,rt,bt),s.transformMat4$1(ut,ut,bt);const je=s.getAABBPointSquareDist(rt,ut);if(je===0)return!0;let ot=!1;const mt=this._elevation;if(mt&&je>me&&Ae!==0){const Kt=this.calculateProjMatrix(Se.tileID.toUnwrapped());let ri;i.isTerrainDEM||(ri=mt.getMinMaxForTile(Se.tileID)),ri||(ri={min:U,max:J});const pt=s.furthestTileCorner(this.rotation),It=[pt[0]*s.EXTENT,pt[1]*s.EXTENT,ri.max];s.transformMat4(It,It,Kt),ot=(1-It[1])*this.height*.5<Ae}return je<me||ot})}return Q.sort((me,Ae)=>me.distanceSq-Ae.distanceSq).map(me=>me.tileID)}resize(i,o){this.width=i,this.height=o,this.pixelsToGLUnits=[2/i,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const o=s.clamp(i.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),u=this.projection.project(i.lng,o);return new s.pointGeometry(u.x*this.worldSize,u.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(i,o){const u=this.pointCoordinate(o),d=this.pointCoordinate(this.centerPoint),f=this.locationCoordinate(i);this.setLocation(new s.MercatorCoordinate(f.x-(u.x-d.x),f.y-(u.y-d.y)))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this._coordinatePoint(this.locationCoordinate(i),!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,o){const u=o?s.mercatorZfromAltitude(o,i.lat):void 0,d=this.projection.project(i.lng,i.lat);return new s.MercatorCoordinate(d.x,d.y,u)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,o){const u=o!=null?o:this._centerAltitude,d=[i.x,i.y,0,1],f=[i.x,i.y,1,1];s.transformMat4$1(d,d,this.pixelMatrixInverse),s.transformMat4$1(f,f,this.pixelMatrixInverse);const g=f[3];s.scale$1(d,d,1/d[3]),s.scale$1(f,f,1/g);const x=d[2],E=f[2];return{p0:d,p1:f,t:x===E?0:(u-x)/(E-x)}}screenPointToMercatorRay(i){const o=[i.x,i.y,0,1],u=[i.x,i.y,1,1];return s.transformMat4$1(o,o,this.pixelMatrixInverse),s.transformMat4$1(u,u,this.pixelMatrixInverse),s.scale$1(o,o,1/o[3]),s.scale$1(u,u,1/u[3]),o[2]=s.mercatorZfromAltitude(o[2],this._center.lat)*this.worldSize,u[2]=s.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,s.scale$1(o,o,1/this.worldSize),s.scale$1(u,u,1/this.worldSize),new s.Ray([o[0],o[1],o[2]],s.normalize([],s.sub([],u,o)))}rayIntersectionCoordinate(i){const{p0:o,p1:u,t:d}=i,f=s.mercatorZfromAltitude(o[2],this._center.lat),g=s.mercatorZfromAltitude(u[2],this._center.lat);return new s.MercatorCoordinate(s.number(o[0],u[0],d)/this.worldSize,s.number(o[1],u[1],d)/this.worldSize,s.number(f,g,d))}pointCoordinate(i,o=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(i.x,i.y,o)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);const o=this.elevation;let u=this.elevation.pointCoordinate(i);if(u)return new s.MercatorCoordinate(u[0],u[1],u[2]);let d=0,f=this.horizonLineFromTop();if(i.y>f)return this.pointCoordinate(i);const g=.02*f,x=i.clone();for(let E=0;E<10&&f-d>g;E++){x.y=s.number(d,f,.66);const S=o.pointCoordinate(x);S?(f=x.y,u=S):d=x.y}return u?new s.MercatorCoordinate(u[0],u[1],u[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){if(this.elevation)return!this.elevation.pointCoordinate(i);{const o=this.horizonLineFromTop();return i.y<o}}_coordinatePoint(i,o){const u=o&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,d=[i.x*this.worldSize,i.y*this.worldSize,u+i.toAltitude(),1];return s.transformMat4$1(d,d,this.pixelMatrix),d[3]>0?new s.pointGeometry(d[0]/d[3],d[1]/d[3]):new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(i,o){const u=new s.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),d=new s.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),f=new s.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),g=new s.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let x=this.pointCoordinate(u,i),E=this.pointCoordinate(d,i);const S=this.pointCoordinate(f,o),I=this.pointCoordinate(g,o),z=(L,V)=>(V.y-L.y)/(V.x-L.x);return x.y>1&&E.y>=0?x=new s.MercatorCoordinate((1-I.y)/z(I,x)+I.x,1):x.y<0&&E.y<=1&&(x=new s.MercatorCoordinate(-I.y/z(I,x)+I.x,0)),E.y>1&&x.y>=0?E=new s.MercatorCoordinate((1-S.y)/z(S,E)+S.x,1):E.y<0&&x.y<=1&&(E=new s.MercatorCoordinate(-S.y/z(S,E)+S.x,0)),new s.LngLatBounds().extend(this.coordinateLocation(x)).extend(this.coordinateLocation(E)).extend(this.coordinateLocation(I)).extend(this.coordinateLocation(S))}_getBounds3D(){const i=this.elevation;if(!i.visibleDemTiles.length)return this._getBounds(0,0);const o=i.visibleDemTiles.reduce((u,d)=>{if(d.dem){const f=d.dem.tree;u.min=Math.min(u.min,f.minimums[0]),u.max=Math.max(u.max,f.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBounds(o.min*i.exaggeration(),o.max*i.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(i=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,u=this.height/2-o*(1-this._horizonShift);return i?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,o){return this.projection.createTileTransform(this,o).createTileMatrix(i)}calculateDistanceTileData(i){const o=i.key,u=this._distanceTileDataCache;if(u[o])return u[o];const d=i.canonical,f=1/this.height,g=this.cameraWorldSize/this.zoomScale(d.z),x=(d.x+Math.pow(2,d.z)*i.wrap)*g,E=d.y*g,S=this.point,I=this.angle,z=Math.sin(-I),L=-Math.cos(-I);return u[o]={bearing:[z,L],center:[(S.x-x)*f,(S.y-E)*f],scale:g/s.EXTENT*f},u[o]}calculateFogTileMatrix(i){const o=i.key,u=this._fogTileMatrixCache;if(u[o])return u[o];const d=this.calculatePosMatrix(i,this.cameraWorldSize);return s.multiply$1(d,this.worldToFogMatrix,d),u[o]=new Float32Array(d),u[o]}calculateProjMatrix(i,o=!1){const u=i.key,d=o?this._alignedProjMatrixCache:this._projMatrixCache;if(d[u])return d[u];const f=this.calculatePosMatrix(i,this.worldSize);return s.multiply$1(f,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:o?this.alignedProjMatrix:this.projMatrix,f),d[u]=new Float32Array(f),d[u]}calculatePixelsToTileUnitsMatrix(i){const o=i.tileID.key,u=this._pixelsToTileUnitsCache;if(u[o])return u[o];const d=function(f,g){const{scale:x}=f.tileTransform,E=x*s.EXTENT/(f.tileSize*Math.pow(2,g.zoom-f.tileID.overscaledZ+f.tileID.canonical.z));return S=new Float32Array(4),L=(I=g.inverseAdjustmentMatrix)[1],V=I[2],F=I[3],J=(z=[E,E])[1],S[0]=I[0]*(N=z[0]),S[1]=L*N,S[2]=V*J,S[3]=F*J,S;var S,I,z,L,V,F,N,J}(i,this);return u[o]=d,u[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const o=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(o),d=this._camera.forward(),f=s.mercatorZfromAltitude(1,this._center.lat);u[2]/=f,d[2]/=f,s.normalize(d,d);const g=i.raycast(u,d,i.exaggeration());if(g){const x=s.scaleAndAdd([],u,d,g),E=new s.MercatorCoordinate(x[0],x[1],s.mercatorZfromAltitude(x[2],s.latFromMercatorY(x[1]))),S=(E.z+s.length([E.x-u[0],E.y-u[1],E.z-u[2]*f]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(S),this._centerAltitude=E.toAltitude(),this._center=this.coordinateLocation(E),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const o=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(o),d=i.getAtPointOrZero(new s.MercatorCoordinate(...u)),f=this._minimumHeightOverTerrain()*Math.cos(s.degToRad(this._maxPitch)),g=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*d;if(g<f){const x=this.locationCoordinate(this._center,this._centerAltitude),E=[x.x-u[0],x.y-u[1],x.z-u[2]],S=s.length(E);E[2]-=(f-g)/this._projectionScaler;const I=s.length(E);if(I===0)return;s.scale$2(E,E,S/I*this._projectionScaler),this._camera.position=[x.x-E[0],x.y-E[1],x.z*this._projectionScaler-E[2]],this._camera.orientation=Cl(E,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const z=this.center;return z.lat=s.clamp(z.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(z.lng=s.clamp(z.lng,this.minLng,this.maxLng)),this.center=z,void(this._constraining=!1)}const i=this._unmodified,{x:o,y:u}=this.point;let d=0,f=o,g=u;const x=this.width/2,E=this.height/2,S=this.worldMinY*this.scale,I=this.worldMaxY*this.scale;if(u-E<S&&(g=S+E),u+E>I&&(g=I-E),I-S<this.height&&(d=Math.max(d,this.height/(I-S)),g=(I+S)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const z=this.worldMinX*this.scale,L=this.worldMaxX*this.scale,V=this.worldSize/2-(z+L)/2;f=(o+V+this.worldSize)%this.worldSize-V,f-x<z&&(f=z+x),f+x>L&&(f=L-x),L-z<this.width&&(d=Math.max(d,this.width/(L-z)),f=(L+z)/2)}f===o&&g===u||(this.center=this.unproject(new s.pointGeometry(f,g))),d&&(this.zoom+=this.scaleZoom(d)),this._constrainCameraAltitude(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this._fov/2,o=this.centerOffset,u=this.pixelsPerMeter;this._projectionScaler=u/(s.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(i)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const d=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?u:1),f=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);f[8]=2*-o.x/this.width,f[9]=2*o.y/this.height;let g=s.mul([],f,d);if(this.projection.isReprojectedInTileSpace){const W=this.locationCoordinate(this.center),X=s.identity([]);s.translate(X,X,[W.x*this.worldSize,W.y*this.worldSize,0]),s.multiply$1(X,X,Xc(this)),s.translate(X,X,[-W.x*this.worldSize,-W.y*this.worldSize,0]),s.multiply$1(g,g,X),this.inverseAdjustmentMatrix=function(Q){const he=Xc(Q,!0);return _e([],[he[0],he[1],he[4],he[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],g,[this.worldSize,this.worldSize,this.worldSize/u,1]),this.projMatrix=g,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const x=new Float32Array(16);s.identity(x),s.scale(x,x,[1,-1,1]),s.rotateX(x,x,this._pitch),s.rotateZ(x,x,this.angle);const E=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),S=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;E[8]=2*-o.x/this.width,E[9]=2*(o.y+S)/this.height,this.skyboxMatrix=s.multiply$1(x,E,x);const I=this.point,z=I.x,L=I.y,V=this.width%2/2,F=this.height%2/2,N=Math.cos(this.angle),J=Math.sin(this.angle),U=z-Math.round(z)+N*V+J*F,H=L-Math.round(L)+N*F+J*V,K=new Float64Array(g);if(s.translate(K,K,[U>.5?U-1:U,H>.5?H-1:H,0]),this.alignedProjMatrix=K,g=s.create(),s.scale(g,g,[this.width/2,-this.height/2,1]),s.translate(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=s.create(),s.scale(g,g,[1,-1,1]),s.translate(g,g,[-1,-1,0]),s.scale(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g,this.pixelMatrix=s.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},g=s.invert(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSize,o=this.cameraPixelsPerMeter,u=this._camera.position,d=1/this.height,f=[i,i,o];s.scale$2(f,f,d),s.scale$2(u,u,-1),s.multiply$2(u,u,f);const g=s.create();s.translate(g,g,u),s.scale(g,g,f),this.mercatorFogMatrix=g,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,o,d)}_computeCameraPosition(i){const o=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),d=this.point,f=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*o-i/this.worldSize*this._centerAltitude;return[d.x/this.worldSize-u[0]*f,d.y/this.worldSize-u[1]*f,i/this.worldSize*this._centerAltitude-u[2]*f]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=i[2];let d=1;u>0&&(d=Math.min((o-this._camera.position[2])/u,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,i,d),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,o=this._camera.forward(),{pitch:u,bearing:d}=this._camera.getPitchBearing(),f=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,g=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),x=Math.max((i[2]-f)/Math.cos(u),g),E=this._zoomFromMercatorZ(x);s.scaleAndAdd(i,i,o,x),this._pitch=s.clamp(u,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(d,-Math.PI,Math.PI),this._setZoom(s.clamp(E,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new s.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((this._cameraZoom!=null?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(i,o){const u=Math.min(i.x,o.x),d=Math.max(i.x,o.x),f=Math.min(i.y,o.y),g=Math.max(i.y,o.y);if(f<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const x=[new s.pointGeometry(u,f),new s.pointGeometry(d,g),new s.pointGeometry(u,g),new s.pointGeometry(d,f)],E=this.renderWorldCopies?-3:0,S=this.renderWorldCopies?4:1;for(const I of x){const z=this.pointRayIntersection(I);if(z.t<0)return!0;const L=this.rayIntersectionCoordinate(z);if(L.x<E||L.y<0||L.x>S||L.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.pointGeometry(0,0),new s.pointGeometry(this.width,this.height))}zoomDeltaToMovement(i,o){const u=s.length(s.sub([],this._camera.position,i)),d=this._zoomFromMercatorZ(u)+o;return u-this._mercatorZfromZoom(d)}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.pointGeometry(0,i))}}function Xn(c,i){let o=!1,u=null;const d=()=>{u=null,o&&(c(),u=setTimeout(d,i),o=!1)};return()=>(o=!0,u||d(),u)}class Hc{constructor(i){this._hashName=i&&encodeURIComponent(i),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Xn(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,s.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return s.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(i){const o=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,d=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,d),g=Math.round(o.lng*f)/f,x=Math.round(o.lat*f)/f,E=this._map.getBearing(),S=this._map.getPitch();let I="";if(I+=i?`/${g}/${x}/${u}`:`${u}/${x}/${g}`,(E||S)&&(I+="/"+Math.round(10*E)/10),S&&(I+=`/${Math.round(S)}`),this._hashName){const z=this._hashName;let L=!1;const V=s.window.location.hash.slice(1).split("&").map(F=>{const N=F.split("=")[0];return N===z?(L=!0,`${N}=${I}`):F}).filter(F=>F);return L||V.push(`${z}=${I}`),`#${V.join("&")}`}return`#${I}`}_getCurrentHash(){const i=s.window.location.hash.replace("#","");if(this._hashName){let o;return i.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(o=u)}),(o&&o[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._getCurrentHash();if(i.length>=3&&!i.some(o=>isNaN(o))){const o=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:o,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,i)}}const Sn={linearity:.3,easing:s.bezier(0,0,.3,1)},Oo=s.extend({deceleration:2500,maxSpeed:1400},Sn),Kc=s.extend({deceleration:20,maxSpeed:1400},Sn),Dl=s.extend({deceleration:1e3,maxSpeed:360},Sn),Gt=s.extend({deceleration:1e3,maxSpeed:90},Sn);class Ca{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,o=s.exported.now();for(;i.length>0&&o-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new s.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)o.zoom+=f.zoomDelta||0,o.bearing+=f.bearingDelta||0,o.pitch+=f.pitchDelta||0,f.panDelta&&o.pan._add(f.panDelta),f.around&&(o.around=f.around),f.pinchAround&&(o.pinchAround=f.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(o.pan.mag()){const f=ks(o.pan.mag(),u,s.extend({},Oo,i||{}));d.offset=o.pan.mult(f.amount/o.pan.mag()),d.center=this._map.transform.center,za(d,f)}if(o.zoom){const f=ks(o.zoom,u,Kc);d.zoom=this._map.transform.zoom+f.amount,za(d,f)}if(o.bearing){const f=ks(o.bearing,u,Dl);d.bearing=this._map.transform.bearing+s.clamp(f.amount,-179,179),za(d,f)}if(o.pitch){const f=ks(o.pitch,u,Gt);d.pitch=this._map.transform.pitch+f.amount,za(d,f)}if(d.zoom||d.bearing){const f=o.pinchAround===void 0?o.around:o.pinchAround;d.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),s.extend(d,{noMoveStart:!0})}}function za(c,i){(!c.duration||c.duration<i.duration)&&(c.duration=i.duration,c.easing=i.easing)}function ks(c,i,o){const{maxSpeed:u,linearity:d,deceleration:f}=o,g=s.clamp(c*d/(i/1e3),-u,u),x=Math.abs(g)/(f*d);return{easing:o.easing,duration:1e3*x,amount:g*(x/2)}}class Ji extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,u,d={}){const f=fe.mousePos(o.getCanvasContainer(),u),g=o.unproject(f);super(i,s.extend({point:f,lngLat:g,originalEvent:u},d)),this._defaultPrevented=!1,this.target=o}}class Pa extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,u){const d=i==="touchend"?u.changedTouches:u.touches,f=fe.touchPos(o.getCanvasContainer(),d),g=f.map(E=>o.unproject(E)),x=f.reduce((E,S,I,z)=>E.add(S.div(z.length)),new s.pointGeometry(0,0));super(i,{points:f,point:x,lngLats:g,lngLat:o.unproject(x),originalEvent:u}),this._defaultPrevented=!1}}class Sh extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,u){super(i,{originalEvent:u}),this._defaultPrevented=!1}}class Yc{constructor(i,o){this._map=i,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new Sh(i.type,this._map,i))}mousedown(i,o){return this._mousedownPos=o,this._firePreventable(new Ji(i.type,this._map,i))}mouseup(i){this._map.fire(new Ji(i.type,this._map,i))}preclick(i){const o=s.extend({},i);o.type="preclick",this._map.fire(new Ji(o.type,this._map,o))}click(i,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Ji(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Ji(i.type,this._map,i))}mouseover(i){this._map.fire(new Ji(i.type,this._map,i))}mouseout(i){this._map.fire(new Ji(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Pa(i.type,this._map,i))}touchmove(i){this._map.fire(new Pa(i.type,this._map,i))}touchend(i){this._map.fire(new Pa(i.type,this._map,i))}touchcancel(i){this._map.fire(new Pa(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ih{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(i){this._map.fire(new Ji(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ji("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Ji(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ll{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,o){this.isEnabled()&&i.shiftKey&&i.button===0&&(fe.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(i,o){if(!this._active)return;const u=o;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=u,this._box||(this._box=fe.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const f=Math.min(d.x,u.x),g=Math.max(d.x,u.x),x=Math.min(d.y,u.y),E=Math.max(d.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${f}px,${x}px)`,this._box.style.width=g-f+"px",this._box.style.height=E-x+"px")})}mouseupWindow(i,o){if(!this._active||i.button!==0)return;const u=this._startPos,d=o;if(this.reset(),fe.suppressClick(),u.x!==d.x||u.y!==d.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:f=>f.fitScreenCoordinates(u,d,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),fe.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,o){return this._map.fire(new s.Event(i,{originalEvent:o}))}}function Uo(c,i){const o={};for(let u=0;u<c.length;u++)o[c[u].identifier]=i[u];return o}class Ds{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,o,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),u.length===this.numTouches&&(this.centroid=function(d){const f=new s.pointGeometry(0,0);for(const g of d)f._add(g);return f.div(d.length)}(o),this.touches=Uo(u,o)))}touchmove(i,o,u){if(this.aborted||!this.centroid)return;const d=Uo(u,o);for(const f in this.touches){const g=this.touches[f],x=d[f];(!x||x.dist(g)>30)&&(this.aborted=!0)}}touchend(i,o,u){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class Ls{constructor(i){this.singleTap=new Ds(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,o,u){this.singleTap.touchstart(i,o,u)}touchmove(i,o,u){this.singleTap.touchmove(i,o,u)}touchend(i,o,u){const d=this.singleTap.touchend(i,o,u);if(d){const f=i.timeStamp-this.lastTime<500,g=!this.lastTap||this.lastTap.dist(d)<30;if(f&&g||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class Bl{constructor(){this._zoomIn=new Ls({numTouches:1,numTaps:2}),this._zoomOut=new Ls({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,o,u){this._zoomIn.touchstart(i,o,u),this._zoomOut.touchstart(i,o,u)}touchmove(i,o,u){this._zoomIn.touchmove(i,o,u),this._zoomOut.touchmove(i,o,u)}touchend(i,o,u){const d=this._zoomIn.touchend(i,o,u),f=this._zoomOut.touchend(i,o,u);return d?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:g.getZoom()+1,around:g.unproject(d)},{originalEvent:i})}):f?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:g.getZoom()-1,around:g.unproject(f)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Jc={0:1,2:2};class Vo{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(i,o){return!1}_move(i,o){return{}}mousedown(i,o){if(this._lastPoint)return;const u=fe.mouseButton(i);this._correctButton(i,u)&&(this._lastPoint=o,this._eventButton=u)}mousemoveWindow(i,o){const u=this._lastPoint;if(u){if(i.preventDefault(),function(d,f){const g=Jc[f];return d.buttons===void 0||(d.buttons&g)!==g}(i,this._eventButton))this.reset();else if(this._moved||!(o.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(u,o)}}mouseupWindow(i){this._lastPoint&&fe.mouseButton(i)===this._eventButton&&(this._moved&&fe.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ka extends Vo{mousedown(i,o){super.mousedown(i,o),this._lastPoint&&(this._active=!0)}_correctButton(i,o){return o===0&&!i.ctrlKey}_move(i,o){return{around:o,panDelta:o.sub(i)}}}class Rr extends Vo{_correctButton(i,o){return o===0&&i.ctrlKey||o===2}_move(i,o){const u=.8*(o.x-i.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(i){i.preventDefault()}}class Rl extends Vo{_correctButton(i,o){return o===0&&i.ctrlKey||o===2}_move(i,o){const u=-.5*(o.y-i.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(i){i.preventDefault()}}class Qc{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.pointGeometry(0,0)}touchstart(i,o,u){return this._calculateTransform(i,o,u)}touchmove(i,o,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.preventDefault(),this._calculateTransform(i,o,u)}}touchend(i,o,u){this._calculateTransform(i,o,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,o,u){u.length>0&&(this._active=!0);const d=Uo(u,o),f=new s.pointGeometry(0,0),g=new s.pointGeometry(0,0);let x=0;for(const S in d){const I=d[S],z=this._touches[S];z&&(f._add(I),g._add(I.sub(z)),x++,d[S]=I)}if(this._touches=d,x<this._minTouches||!g.mag())return;const E=g.div(x);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(x),panDelta:E}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=fe.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Da{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(i){}_move(i,o,u){return{}}touchstart(i,o,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([o[0],o[1]]))}touchmove(i,o,u){if(!this._firstTwoTouches)return;i.preventDefault();const[d,f]=this._firstTwoTouches,g=In(u,o,d),x=In(u,o,f);if(!g||!x)return;const E=this._aroundCenter?null:g.add(x).div(2);return this._move([g,x],E,i)}touchend(i,o,u){if(!this._firstTwoTouches)return;const[d,f]=this._firstTwoTouches,g=In(u,o,d),x=In(u,o,f);g&&x||(this._active&&fe.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function In(c,i,o){for(let u=0;u<c.length;u++)if(c[u].identifier===o)return i[u]}function Fl(c,i){return Math.log(c/i)/Math.LN2}class La extends Da{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,o){const u=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Fl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Fl(this._distance,u),pinchAround:o}}}function Ba(c,i){return 180*c.angleWith(i)/Math.PI}class Ra extends Da{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,o){const u=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ba(this._vector,u),pinchAround:o}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const o=25/(Math.PI*this._minDiameter)*360,u=Ba(i,this._startVector);return Math.abs(u)<o}}function Fa(c){return Math.abs(c.y)>Math.abs(c.x)}class eu extends Da{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(i){this._lastPoints=i,Fa(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,o,u){const d=i[0].sub(this._lastPoints[0]),f=i[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&u.touches.length<3)&&(this._valid=this.gestureBeginsVertically(d,f,u.timeStamp),this._valid))return this._lastPoints=i,this._active=!0,{pitchDelta:(d.y+f.y)/2*-.5}}gestureBeginsVertically(i,o,u){if(this._valid!==void 0)return this._valid;const d=i.mag()>=2,f=o.mag()>=2;if(!d&&!f)return;if(!d||!f)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const g=i.y>0==o.y>0;return Fa(i)&&Fa(o)&&g}}const No={panStep:100,bearingStep:15,pitchStep:10};class Mh{constructor(){const i=No;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let o=0,u=0,d=0,f=0,g=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?u=-1:(i.preventDefault(),f=-1);break;case 39:i.shiftKey?u=1:(i.preventDefault(),f=1);break;case 38:i.shiftKey?d=1:(i.preventDefault(),g=-1);break;case 40:i.shiftKey?d=-1:(i.preventDefault(),g=1);break;default:return}return this._rotationDisabled&&(u=0,d=0),{cameraAnimation:x=>{const E=x.getZoom();x.easeTo({duration:300,easeId:"keyboardHandler",easing:Ah,zoom:o?Math.round(E)+o*(i.shiftKey?2:1):E,bearing:x.getBearing()+u*this._bearingStep,pitch:x.getPitch()+d*this._pitchStep,offset:[-f*this._panStep,-g*this._panStep],center:x.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ah(c){return c*(2-c)}const Ol=4.000244140625;class Oa{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._handler=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=i.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const u=s.exported.now(),d=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,o!==0&&o%Ol==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(d*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),i.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=i,this._delta-=o,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=fe.mousePos(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform,o=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>Ol?this._wheelZoomRate:this._defaultZoomRate;let S=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&S!==0&&(S=1/S);const I=o(),z=Math.pow(2,I),L=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(L*S))),this._type==="wheel"&&(this._startZoom=o(),this._easing=this._smoothOutEasing(200)),this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:o(),d=this._startZoom,f=this._easing;let g,x=!1;if(this._type==="wheel"&&d&&f){const E=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),S=f(E);g=s.number(d,u,S),E<1?this._frameId||(this._frameId=!0):x=!0}else g=u,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:g-o(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let o=s.ease;if(this._prevEase){const u=this._prevEase,d=(s.exported.now()-u.start)/u.duration,f=u.easing(d+.01)-u.easing(d),g=.27/Math.sqrt(f*f+1e-4)*.01,x=Math.sqrt(.0729-g*g);o=s.bezier(g,x,.25,1)}return this._prevEase={start:s.exported.now(),duration:i,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=fe.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!s.window.document.fullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Ul{constructor(i,o){this._clickZoom=i,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class tu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,o){return i.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(i.shiftKey?-1:1),around:u.unproject(o)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class iu{constructor(){this._tap=new Ls({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(i,o,u){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=o[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(i,o,u))}touchmove(i,o,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const d=o[0],f=d.y-this._swipePoint.y;return this._swipePoint=d,i.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(i,o,u)}touchend(i,o,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(i,o,u)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ua{constructor(i,o,u){this._el=i,this._mousePan=o,this._touchPan=u}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Vl{constructor(i,o,u){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=o,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ru{constructor(i,o,u,d){this._el=i,this._touchZoom=o,this._touchRotate=u,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Bs=c=>c.zoom||c.drag||c.pitch||c.rotate;class nu extends s.Event{}class ou{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,o){const u=s.sub([],o,i);this.radius=s.length(u[2]<0?s.div([],u,this.constants):[u[0],u[1],0])}projectRay(i){s.div(i,i,this.constants),s.normalize(i,i),s.mul$1(i,i,this.constants);const o=s.scale$2([],i,this.radius);if(o[2]>0){const u=s.scale$2([],[0,0,1],s.dot(o,[0,0,1])),d=s.scale$2([],s.normalize([],[o[0],o[1],0]),this.radius),f=s.add([],o,s.scale$2([],s.sub([],s.add([],d,u),o),2));o[0]=f[0],o[1]=f[1]}return o}}function Rs(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class jo{constructor(i,o){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ca(i),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ou,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),s.bindAll(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[d,f,g]of this._listeners)d.addEventListener(f,d===s.window.document?this.handleWindowEvent:this.handleEvent,g)}destroy(){for(const[i,o,u]of this._listeners)i.removeEventListener(o,i===s.window.document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(i){const o=this._map,u=o.getCanvasContainer();this._add("mapEvent",new Yc(o,i));const d=o.boxZoom=new Ll(o,i);this._add("boxZoom",d);const f=new Bl,g=new tu;o.doubleClickZoom=new Ul(g,f),this._add("tapZoom",f),this._add("clickZoom",g);const x=new iu;this._add("tapDragZoom",x);const E=o.touchPitch=new eu(o);this._add("touchPitch",E);const S=new Rr(i),I=new Rl(i);o.dragRotate=new Vl(i,S,I),this._add("mouseRotate",S,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]);const z=new ka(i),L=new Qc(o,i);o.dragPan=new Ua(u,z,L),this._add("mousePan",z),this._add("touchPan",L,["touchZoom","touchRotate"]);const V=new Ra,F=new La;o.touchZoomRotate=new ru(u,F,V,x),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",F,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ih(o));const N=o.scrollZoom=new Oa(o,this);this._add("scrollZoom",N,["mousePan"]);const J=o.keyboard=new Mh;this._add("keyboard",J);for(const U of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[U]&&o[U].enable(i[U])}_add(i,o,u){this._handlers.push({handlerName:i,handler:o,allowed:u}),this._handlersById[i]=o}stop(i){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Bs(this._eventsInProgress))||this.isZooming()}_blockedByActive(i,o,u){for(const d in i)if(d!==u&&(!o||o.indexOf(d)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const o=[];for(const u of i)this._el.contains(u.target)&&o.push(u);return o}handleEvent(i,o){this._updatingCamera=!0;const u=i.type==="renderFrame",d=u?void 0:i,f={needsRenderFrame:!1},g={},x={},E=i.touches?this._getMapTouches(i.touches):void 0,S=E?fe.touchPos(this._el,E):u?void 0:fe.mousePos(this._el,i);for(const{handlerName:L,handler:V,allowed:F}of this._handlers){if(!V.isEnabled())continue;let N;this._blockedByActive(x,F,L)?V.reset():V[o||i.type]&&(N=V[o||i.type](i,S,E),this.mergeHandlerResult(f,g,N,L,d),N&&N.needsRenderFrame&&this._triggerRenderFrame()),(N||V.isActive())&&(x[L]=V)}const I={};for(const L in this._previousActiveHandlers)x[L]||(I[L]=d);this._previousActiveHandlers=x,(Object.keys(I).length||Rs(f))&&(this._changes.push([f,g,I]),this._triggerRenderFrame()),(Object.keys(x).length||Rs(f))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=f;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(i,o,u,d,f){if(!u)return;s.extend(i,u);const g={handlerName:d,originalEvent:u.originalEvent||f};u.zoomDelta!==void 0&&(o.zoom=g),u.panDelta!==void 0&&(o.drag=g),u.pitchDelta!==void 0&&(o.pitch=g),u.bearingDelta!==void 0&&(o.rotate=g)}_applyChanges(){const i={},o={},u={};for(const[d,f,g]of this._changes)d.panDelta&&(i.panDelta=(i.panDelta||new s.pointGeometry(0,0))._add(d.panDelta)),d.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+d.pitchDelta),d.around!==void 0&&(i.around=d.around),d.aroundCoord!==void 0&&(i.aroundCoord=d.aroundCoord),d.pinchAround!==void 0&&(i.pinchAround=d.pinchAround),d.noInertia&&(i.noInertia=d.noInertia),s.extend(o,f),s.extend(u,g);this._updateMapTransform(i,o,u),this._changes=[]}_updateMapTransform(i,o,u){const d=this._map,f=d.transform,g=H=>[H.x,H.y,H.z];if((H=>{const K=this._eventsInProgress.drag;return K&&!this._handlersById[K.handlerName].isActive()})()&&!Rs(i)){const H=f.zoom;f.cameraElevationReference="sea",f.recenterOnTerrain(),f.cameraElevationReference="ground",H!==f.zoom&&this._map._update(!0)}if(!Rs(i))return this._fireEvents(o,u,!0);let{panDelta:x,zoomDelta:E,bearingDelta:S,pitchDelta:I,around:z,aroundCoord:L,pinchAround:V}=i;V!==void 0&&(z=V),(H=>o.drag&&!this._eventsInProgress.drag)()&&z&&(this._dragOrigin=g(f.pointCoordinate3D(z)),this._trackingEllipsoid.setup(f._camera.position,this._dragOrigin)),f.cameraElevationReference="sea",d._stop(!0),z=z||d.transform.centerPoint,S&&(f.bearing+=S),I&&(f.pitch+=I),f._updateCameraState();const F=[0,0,0];if(x){const H=f.pointCoordinate(z),K=f.pointCoordinate(z.sub(x));H&&K&&(F[0]=K.x-H.x,F[1]=K.y-H.y)}const N=f.zoom,J=[0,0,0];if(E){const H=g(L||f.pointCoordinate3D(z)),K={dir:s.normalize([],s.sub([],H,f._camera.position))};if(K.dir[2]<0){const W=f.zoomDeltaToMovement(H,E);s.scale$2(J,K.dir,W)}}const U=s.add(F,F,J);f._translateCameraConstrained(U),E&&Math.abs(f.zoom-N)>1e-4&&f.recenterOnTerrain(),f.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(o,u,!0)}_fireEvents(i,o,u){const d=Bs(this._eventsInProgress),f=Bs(i),g={};for(const I in i){const{originalEvent:z}=i[I];this._eventsInProgress[I]||(g[`${I}start`]=z),this._eventsInProgress[I]=i[I]}!d&&f&&this._fireEvent("movestart",f.originalEvent);for(const I in g)this._fireEvent(I,g[I]);f&&this._fireEvent("move",f.originalEvent);for(const I in i){const{originalEvent:z}=i[I];this._fireEvent(I,z)}const x={};let E;for(const I in this._eventsInProgress){const{handlerName:z,originalEvent:L}=this._eventsInProgress[I];this._handlersById[z].isActive()||(delete this._eventsInProgress[I],E=o[z]||L,x[`${I}end`]=E)}for(const I in x)this._fireEvent(I,x[I]);const S=Bs(this._eventsInProgress);if(u&&(d||f)&&!S){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=L=>L!==0&&-this._bearingSnap<L&&L<this._bearingSnap;I?(z(I.bearing||this._map.getBearing())&&(I.bearing=0),this._map.easeTo(I,{originalEvent:E})):(this._map.fire(new s.Event("moveend",{originalEvent:E})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,o){this._map.fire(new s.Event(i,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new nu("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Nl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class su extends s.Evented{constructor(i,o){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=o.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,o){return this.jumpTo({center:i},o)}panBy(i,o,u){return i=s.pointGeometry.convert(i).mult(-1),this.panTo(this.transform.center,s.extend({offset:i},o),u)}panTo(i,o,u){return this.easeTo(s.extend({center:i},o),u)}getZoom(){return this.transform.zoom}setZoom(i,o){return this.jumpTo({zoom:i},o),this}zoomTo(i,o,u){return this.easeTo(s.extend({zoom:i},o),u)}zoomIn(i,o){return this.zoomTo(this.getZoom()+1,i,o),this}zoomOut(i,o){return this.zoomTo(this.getZoom()-1,i,o),this}getBearing(){return this.transform.bearing}setBearing(i,o){return this.jumpTo({bearing:i},o),this}getPadding(){return this.transform.padding}setPadding(i,o){return this.jumpTo({padding:i},o),this}rotateTo(i,o,u){return this.easeTo(s.extend({bearing:i},o),u)}resetNorth(i,o){return this.rotateTo(0,s.extend({duration:1e3},i),o),this}resetNorthPitch(i,o){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},i),o),this}snapToNorth(i,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,o):this}getPitch(){return this.transform.pitch}setPitch(i,o){return this.jumpTo({pitch:i},o),this}cameraForBounds(i,o){i=s.LngLatBounds.convert(i);const u=o&&o.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),u,o)}_extendCameraOptions(i){const o={top:0,bottom:0,right:0,left:0};if(typeof(i=s.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=="number"){const u=i.padding;i.padding={top:u,bottom:u,right:u,left:u}}return i.padding=s.extend(o,i.padding),i}_cameraForBoxAndBearing(i,o,u,d){const f=this._extendCameraOptions(d),g=this.transform,x=g.padding,E=g.project(s.LngLat.convert(i)),S=g.project(s.LngLat.convert(o)),I=E.rotate(-s.degToRad(u)),z=S.rotate(-s.degToRad(u)),L=new s.pointGeometry(Math.max(I.x,z.x),Math.max(I.y,z.y)),V=new s.pointGeometry(Math.min(I.x,z.x),Math.min(I.y,z.y)),F=L.sub(V),N=(g.width-(x.left+x.right+f.padding.left+f.padding.right))/F.x,J=(g.height-(x.top+x.bottom+f.padding.top+f.padding.bottom))/F.y;if(J<0||N<0)return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const U=Math.min(g.scaleZoom(g.scale*Math.min(N,J)),f.maxZoom),H=typeof f.offset.x=="number"?new s.pointGeometry(f.offset.x,f.offset.y):s.pointGeometry.convert(f.offset),K=new s.pointGeometry((f.padding.left-f.padding.right)/2,(f.padding.top-f.padding.bottom)/2).rotate(u*Math.PI/180),W=H.add(K).mult(g.scale/g.zoomScale(U));return{center:g.unproject(E.add(S).div(2).sub(W)),zoom:U,bearing:u}}_cameraForBox(i,o,u,d,f){const g=this._extendCameraOptions(f);u=u||0,d=d||0,i=s.LngLat.convert(i),o=s.LngLat.convert(o);const x=this.transform.clone();x.padding=g.padding;const E=this.getFreeCameraOptions(),S=new s.LngLat(.5*(i.lng+o.lng),.5*(i.lat+o.lat)),I=.5*(u+d);if(x._camera.position[2]<s.mercatorZfromAltitude(I,S.lat))return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");E.lookAtPoint(S),x.setFreeCameraOptions(E);const z=s.MercatorCoordinate.fromLngLat(i),L=s.MercatorCoordinate.fromLngLat(o),V=x.pointRayIntersection(x.centerPoint,I),F=[(N=x.rayIntersectionCoordinate(V)).x,N.y,N.z];var N;const J=x.screenPointToMercatorRay(x.centerPoint),U=x.projection.name!=="globe";let H,K=0;do{const W=Math.floor(x.zoom),X=1<<W,Q=Math.min(X*z.x,X*L.x),he=Math.min(X*z.y,X*L.y),ge=Math.max(X*z.x,X*L.x),Ge=Math.max(X*z.y,X*L.y),De=new s.Aabb([Q,he,u],[ge,Ge,d]),Pe=s.Frustum.fromInvProjectionMatrix(x.invProjMatrix,x.worldSize,W,U);if(De.intersects(Pe)!==2){H&&(x._camera.position=s.scaleAndAdd([],x._camera.position,J.dir,-H),x._updateStateFromCamera());break}const ve=s.sub([],x._camera.position,F);H=.5*s.length(ve),x._camera.position=s.scaleAndAdd([],x._camera.position,J.dir,H);try{x._updateStateFromCamera()}catch{return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++K<10);return{center:x.center,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch}}fitBounds(i,o,u){return this._fitInternal(this.cameraForBounds(i,o),o,u)}_raycastElevationBox(i,o){const u=this.transform.elevation;if(!u)return;const d=new s.pointGeometry(i.x,o.y),f=new s.pointGeometry(o.x,i.y),g=u.pointCoordinate(i);if(!g)return;const x=u.pointCoordinate(o);if(!x)return;const E=u.pointCoordinate(d);if(!E)return;const S=u.pointCoordinate(f);if(!S)return;const I=new s.MercatorCoordinate(g[0],g[1]).toLngLat(),z=new s.MercatorCoordinate(x[0],x[1]).toLngLat(),L=new s.MercatorCoordinate(E[0],E[1]).toLngLat(),V=new s.MercatorCoordinate(S[0],S[1]).toLngLat(),F=Math.min(I.lng,Math.min(z.lng,Math.min(L.lng,V.lng))),N=Math.min(I.lat,Math.min(z.lat,Math.min(L.lat,V.lat))),J=Math.max(I.lng,Math.max(z.lng,Math.max(L.lng,V.lng))),U=Math.max(I.lat,Math.max(z.lat,Math.max(L.lat,V.lat))),H=Math.min(g[3],Math.min(x[3],Math.min(E[3],S[3]))),K=Math.max(g[3],Math.max(x[3],Math.max(E[3],S[3])));return{minLngLat:new s.LngLat(F,N),maxLngLat:new s.LngLat(J,U),minAltitude:H,maxAltitude:K}}fitScreenCoordinates(i,o,u,d,f){let g,x,E,S;const I=s.pointGeometry.convert(i),z=s.pointGeometry.convert(o),L=this._raycastElevationBox(I,z);if(L)g=L.minLngLat,x=L.maxLngLat,E=L.minAltitude,S=L.maxAltitude;else{if(this.transform.anyCornerOffEdge(I,z))return this;g=this.transform.pointLocation(I),x=this.transform.pointLocation(z)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(s.pointGeometry.convert(i)),this.transform.pointLocation(s.pointGeometry.convert(o)),u,d):this._cameraForBox(g,x,E,S,d),d,f)}_fitInternal(i,o,u){return i?(delete(o=s.extend(i,o)).padding,o.linear?this.easeTo(o,u):this.flyTo(o,u)):this}jumpTo(i,o){this.stop();const u=i.preloadOnly?this.transform.clone():this.transform;let d=!1,f=!1,g=!1;return"zoom"in i&&u.zoom!==+i.zoom&&(d=!0,u.zoom=+i.zoom),i.center!==void 0&&(u.center=s.LngLat.convert(i.center)),"bearing"in i&&u.bearing!==+i.bearing&&(f=!0,u.bearing=+i.bearing),"pitch"in i&&u.pitch!==+i.pitch&&(g=!0,u.pitch=+i.pitch),i.padding==null||u.isPaddingEqual(i.padding)||(u.padding=i.padding),i.preloadOnly?(this._preloadTiles(u),this):(this.fire(new s.Event("movestart",o)).fire(new s.Event("move",o)),d&&this.fire(new s.Event("zoomstart",o)).fire(new s.Event("zoom",o)).fire(new s.Event("zoomend",o)),f&&this.fire(new s.Event("rotatestart",o)).fire(new s.Event("rotate",o)).fire(new s.Event("rotateend",o)),g&&this.fire(new s.Event("pitchstart",o)).fire(new s.Event("pitch",o)).fire(new s.Event("pitchend",o)),this.fire(new s.Event("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(Nl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,o){const u=this.transform;if(!u.projection.supportsFreeCamera)return void s.warnOnce(Nl);this.stop();const d=u.zoom,f=u.pitch,g=u.bearing;u.setFreeCameraOptions(i);const x=d!==u.zoom,E=f!==u.pitch,S=g!==u.bearing;return this.fire(new s.Event("movestart",o)).fire(new s.Event("move",o)),x&&this.fire(new s.Event("zoomstart",o)).fire(new s.Event("zoom",o)).fire(new s.Event("zoomend",o)),S&&this.fire(new s.Event("rotatestart",o)).fire(new s.Event("rotate",o)).fire(new s.Event("rotateend",o)),E&&this.fire(new s.Event("pitchstart",o)).fire(new s.Event("pitch",o)).fire(new s.Event("pitchend",o)),this.fire(new s.Event("moveend",o)),this}easeTo(i,o){this._stop(!1,i.easeId),((i=s.extend({offset:[0,0],duration:500,easing:s.ease},i)).animate===!1||!i.essential&&s.exported.prefersReducedMotion)&&(i.duration=0);const u=this.transform,d=this.getZoom(),f=this.getBearing(),g=this.getPitch(),x=this.getPadding(),E="zoom"in i?+i.zoom:d,S="bearing"in i?this._normalizeBearing(i.bearing,f):f,I="pitch"in i?+i.pitch:g,z="padding"in i?i.padding:u.padding,L=s.pointGeometry.convert(i.offset);let V=u.centerPoint.add(L);const F=u.projection.name==="globe"?u.pointCoordinate(V).toLngLat():u.pointLocation(V),N=s.LngLat.convert(i.center||F);this._normalizeCenter(N);const J=u.project(F),U=u.project(N).sub(J),H=u.zoomScale(E-d);let K,W;i.around&&(K=s.LngLat.convert(i.around),W=u.locationPoint(K));const X=this._zooming||E!==d,Q=this._rotating||f!==S,he=this._pitching||I!==g,ge=!u.isPaddingEqual(z),Ge=Pe=>ve=>{if(X&&(Pe.zoom=s.number(d,E,ve)),Q&&(Pe.bearing=s.number(f,S,ve)),he&&(Pe.pitch=s.number(g,I,ve)),ge&&(Pe.interpolatePadding(x,z,ve),V=Pe.centerPoint.add(L)),K)Pe.setLocationAtPoint(K,W);else{const me=Pe.zoomScale(Pe.zoom-d),Ae=E>d?Math.min(2,H):Math.max(.5,H),Se=Math.pow(Ae,1-ve),rt=Pe.unproject(J.add(U.mult(ve*Se)).mult(me));Pe.setLocationAtPoint(Pe.renderWorldCopies?rt.wrap():rt,V)}return i.preloadOnly||this._fireMoveEvents(o),Pe};if(i.preloadOnly){const Pe=this._emulate(Ge,i.duration,u);return this._preloadTiles(Pe),this}const De={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=X,this._rotating=Q,this._pitching=he,this._padding=ge,this._easeId=i.easeId,this._prepareEase(o,i.noMoveStart,De),this._ease(Ge(u),Pe=>{u.recenterOnTerrain(),this._afterEase(o,Pe)},i),this}_prepareEase(i,o,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",o||u.moving||this.fire(new s.Event("movestart",i)),this._zooming&&!u.zooming&&this.fire(new s.Event("zoomstart",i)),this._rotating&&!u.rotating&&this.fire(new s.Event("rotatestart",i)),this._pitching&&!u.pitching&&this.fire(new s.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new s.Event("move",i)),this._zooming&&this.fire(new s.Event("zoom",i)),this._rotating&&this.fire(new s.Event("rotate",i)),this._pitching&&this.fire(new s.Event("pitch",i))}_afterEase(i,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId,this.transform.cameraElevationReference="ground";const u=this._zooming,d=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new s.Event("zoomend",i)),d&&this.fire(new s.Event("rotateend",i)),f&&this.fire(new s.Event("pitchend",i)),this.fire(new s.Event("moveend",i))}flyTo(i,o){if(!i.essential&&s.exported.prefersReducedMotion){const je=s.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(je,o)}this.stop(),i=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},i);const u=this.transform,d=this.getZoom(),f=this.getBearing(),g=this.getPitch(),x=this.getPadding(),E="zoom"in i?s.clamp(+i.zoom,u.minZoom,u.maxZoom):d,S="bearing"in i?this._normalizeBearing(i.bearing,f):f,I="pitch"in i?+i.pitch:g,z="padding"in i?i.padding:u.padding,L=u.zoomScale(E-d),V=s.pointGeometry.convert(i.offset);let F=u.centerPoint.add(V);const N=u.pointLocation(F),J=s.LngLat.convert(i.center||N);this._normalizeCenter(J);const U=u.project(N),H=u.project(J).sub(U);let K=i.curve;const W=Math.max(u.width,u.height),X=W/L,Q=H.mag();if("minZoom"in i){const je=s.clamp(Math.min(i.minZoom,d,E),u.minZoom,u.maxZoom),ot=W/u.zoomScale(je-d);K=Math.sqrt(ot/Q*2)}const he=K*K;function ge(je){const ot=(X*X-W*W+(je?-1:1)*he*he*Q*Q)/(2*(je?X:W)*he*Q);return Math.log(Math.sqrt(ot*ot+1)-ot)}function Ge(je){return(Math.exp(je)-Math.exp(-je))/2}function De(je){return(Math.exp(je)+Math.exp(-je))/2}const Pe=ge(0);let ve=function(je){return De(Pe)/De(Pe+K*je)},me=function(je){return W*((De(Pe)*(Ge(ot=Pe+K*je)/De(ot))-Ge(Pe))/he)/Q;var ot},Ae=(ge(1)-Pe)/K;if(Math.abs(Q)<1e-6||!isFinite(Ae)){if(Math.abs(W-X)<1e-6)return this.easeTo(i,o);const je=X<W?-1:1;Ae=Math.abs(Math.log(X/W))/K,me=function(){return 0},ve=function(ot){return Math.exp(je*K*ot)}}i.duration="duration"in i?+i.duration:1e3*Ae/("screenSpeed"in i?+i.screenSpeed/K:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const Se=f!==S,rt=I!==g,ut=!u.isPaddingEqual(z),bt=je=>ot=>{const mt=ot*Ae,Kt=1/ve(mt);je.zoom=ot===1?E:d+je.scaleZoom(Kt),Se&&(je.bearing=s.number(f,S,ot)),rt&&(je.pitch=s.number(g,I,ot)),ut&&(je.interpolatePadding(x,z,ot),F=je.centerPoint.add(V));const ri=ot===1?J:je.unproject(U.add(H.mult(me(mt))).mult(Kt));return je.setLocationAtPoint(je.renderWorldCopies?ri.wrap():ri,F),je._updateCenterElevation(),i.preloadOnly||this._fireMoveEvents(o),je};if(i.preloadOnly){const je=this._emulate(bt,i.duration,u);return this._preloadTiles(je),this}return this._zooming=!0,this._rotating=Se,this._pitching=rt,this._padding=ut,this._prepareEase(o,!1),this._ease(bt(u),()=>this._afterEase(o),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,o)}if(!i){const u=this.handlers;u&&u.stop(!1)}return this}_ease(i,o,u){u.animate===!1||u.duration===0?(i(1),o()):(this._easeStart=s.exported.now(),this._easeOptions=u,this._onEaseFrame=i,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,o){i=s.wrap(i,-180,180);const u=Math.abs(i-o);return Math.abs(i-360-o)<u&&(i-=360),Math.abs(i+360-o)<u&&(i+=360),i}_normalizeCenter(i){const o=this.transform;if(!o.renderWorldCopies||o.maxBounds)return;const u=i.lng-o.center.lng;i.lng+=u>180?-360:u<-180?360:0}_emulate(i,o,u){const d=Math.ceil(15*o/1e3),f=[],g=i(u.clone());for(let x=0;x<=d;x++){const E=g(x/d);f.push(E.clone())}return f}}class jl{constructor(i={}){this.options=i,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const o=this.options&&this.options.compact;return this._map=i,this._container=fe.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=fe.create("button","mapboxgl-ctrl-attrib-button",this._container),fe.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=fe.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,o){const u=this._map._getUIString(`AttributionControl.${o}`);i.setAttribute("aria-label",u),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",u)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(i){const u=o.reduce((d,f,g)=>(f.value&&(d+=`${f.key}=${f.value}${g<o.length-1?"&":""}`),d),"?");i.href=`${s.config.FEEDBACK_URL}/${u}${this._map._hash?this._map._hash.getHashString(!0):""}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const o=this._map.style._sourceCaches;for(const d in o){const f=o[d];if(f.used){const g=f.getSource();g.attribution&&i.indexOf(g.attribution)<0&&i.push(g.attribution)}}i.sort((d,f)=>d.length-f.length),i=i.filter((d,f)=>{for(let g=f+1;g<i.length;g++)if(i[g].indexOf(d)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const u=i.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,i.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Gl{constructor(){s.bindAll(["_updateLogo"],this),s.bindAll(["_updateCompact"],this)}onAdd(i){this._map=i,this._container=fe.create("div","mapboxgl-ctrl");const o=fe.create("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const o in i){const u=i[o].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const o=i[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class $l{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const o=++this._id;return this._queue.push({callback:i,id:o,cancelled:!1}),o}remove(i){const o=this._currentlyRunning,u=o?this._queue.concat(o):this._queue;for(const d of u)if(d.id===i)return void(d.cancelled=!0)}run(i=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const u of o)if(!u.cancelled&&(u.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Zl(c,i,o){if(c=new s.LngLat(c.lng,c.lat),i){const u=new s.LngLat(c.lng-360,c.lat),d=new s.LngLat(c.lng+360,c.lat),f=360*Math.ceil(Math.abs(c.lng-o.center.lng)/360),g=o.locationPoint(c).distSqr(i),x=i.x<0||i.y<0||i.x>o.width||i.y>o.height;o.locationPoint(u).distSqr(i)<g&&(x||Math.abs(u.lng-o.center.lng)<f)?c=u:o.locationPoint(d).distSqr(i)<g&&(x||Math.abs(d.lng-o.center.lng)<f)&&(c=d)}for(;Math.abs(c.lng-o.center.lng)>180;){const u=o.locationPoint(c);if(u.x>=0&&u.y>=0&&u.x<=o.width&&u.y<=o.height)break;c.lng>o.center.lng?c.lng-=360:c.lng+=360}return c}const $i={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ql extends s.Evented{constructor(i,o){if(super(),(i instanceof s.window.HTMLElement||o)&&(i=s.extend({element:i},o)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),i&&i.element)this._element=i.element,this._offset=s.pointGeometry.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=fe.create("div");const d=41,f=27,g=fe.createSVG("svg",{display:"block",height:d*this._scale+"px",width:f*this._scale+"px",viewBox:`0 0 ${f} ${d}`},this._element),x=fe.createSVG("radialGradient",{id:"shadowGradient"},fe.createSVG("defs",{},g));fe.createSVG("stop",{offset:"10%","stop-opacity":.4},x),fe.createSVG("stop",{offset:"100%","stop-opacity":.05},x),fe.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},g),fe.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},g),fe.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},g),fe.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},g),this._offset=s.pointGeometry.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()});const u=this._element.classList;for(const d in $i)u.remove(`mapboxgl-marker-anchor-${d}`);u.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=s.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const o=38.1,u=13.5,d=Math.sqrt(Math.pow(u,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-o],"bottom-left":[d,-1*(o-u+d)],"bottom-right":[-d,-1*(o-u+d)],left:[u,-1*(o-u)],right:[-u,-1*(o-u)]}:this._offset}this._popup=i,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const o=i.code,u=i.charCode||i.keyCode;o!=="Space"&&o!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(i){const o=i.originalEvent.target,u=this._element;this._popup&&(o===u||u.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const i=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(i))return void this._clearFadeTimer();const o=this._map.unproject(i);let u=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const f=this._map.getFreeCameraOptions();if(f.position){const g=f.position.toLngLat();u=g.distanceTo(o)<.9*g.distanceTo(this._lngLat)}}const d=(1-this._map._queryFogOpacity(o))*(u?.2:1);this._element.style.opacity=`${d}`,this._popup&&this._popup._setOpacity(`${d}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(i){const o=this._map.transform;return!!i&&i.x>=0&&i.x<o.width&&i.y>=0&&i.y<o.height}_updateDOM(){const i=this._pos||new s.pointGeometry(0,0),o=this._calculatePitch(),u=this._calculateRotation();this._element.style.transform=`${$i[this._anchor]} translate(${i.x}px, ${i.y}px) rotateX(${o}deg) rotateZ(${u}deg)`}_calculatePitch(){return this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?0:this._pitchAlignment==="map"?this._map.getPitch():0}_calculateRotation(){return this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?this._rotation:this._rotationAlignment==="map"?this._rotation-this._map.getBearing():0}_update(i){s.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=Zl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),i===!0?this._updateFrameId=s.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const i=this._map.transform,o=this._offset.mult(this._scale);return this._rotationAlignment==="map"&&o._rotate(i.angle),this._pitchAlignment==="map"&&(o.y*=Math.cos(i._pitch)),o}getOffset(){return this._offset}setOffset(i){return this._offset=s.pointGeometry.convert(i),this._update(),this}_onMove(i){if(!this._isDragging){const o=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=o}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(i){this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Mn{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const o=s.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,o,u){this._start=this.getValue(o),this._end=i,this._startTime=o,this._endTime=o+u}}const au={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:Kr,HTMLElement:Go,ImageBitmap:$o}=s.window,Ch={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Wl(c){c.parentNode&&c.parentNode.removeChild(c)}const zh={showCompass:!0,showZoom:!0,visualizePitch:!1};class lu{constructor(i,o,u=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new Rr({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,u&&(this.mousePitch=new Rl({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(i,o){this.mouseRotate.mousedown(i,o),this.mousePitch&&this.mousePitch.mousedown(i,o),fe.disableDrag()}move(i,o){const u=this.map,d=this.mouseRotate.mousemoveWindow(i,o);if(d&&d.bearingDelta&&u.setBearing(u.getBearing()+d.bearingDelta),this.mousePitch){const f=this.mousePitch.mousemoveWindow(i,o);f&&f.pitchDelta&&u.setPitch(u.getPitch()+f.pitchDelta)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){fe.enableDrag(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(s.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),fe.mousePos(this.element,i)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,fe.mousePos(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=fe.touchPos(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=fe.touchPos(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Fs={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let ar,Os=0,Zo=!1;const Us={maxWidth:100,unit:"metric"};function Ye(c,i,o){const u=o&&o.maxWidth||100,d=c._containerHeight/2,f=c.unproject([0,d]),g=c.unproject([u,d]),x=f.distanceTo(g);if(o&&o.unit==="imperial"){const E=3.2808*x;E>5280?qo(i,u,E/5280,c._getUIString("ScaleControl.Miles"),c):qo(i,u,E,c._getUIString("ScaleControl.Feet"),c)}else o&&o.unit==="nautical"?qo(i,u,x/1852,c._getUIString("ScaleControl.NauticalMiles"),c):x>=1e3?qo(i,u,x/1e3,c._getUIString("ScaleControl.Kilometers"),c):qo(i,u,x,c._getUIString("ScaleControl.Meters"),c)}function qo(c,i,o,u,d){const f=function(x){const E=Math.pow(10,`${Math.floor(x)}`.length-1);let S=x/E;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(I){const z=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*z)/z}(S),E*S}(o),g=f/o;d._requestDomTask(()=>{c.style.width=i*g+"px",c.innerHTML=`${f}&nbsp;${u}`})}const cu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Vs=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Hn={version:s.version,supported:pe,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends su{constructor(c){if((c=s.extend({},Ch,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ps(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=c.collectResourceTiming,this._optimizeForTerrain=c.optimizeForTerrain,this._renderTaskQueue=new $l,this._domRenderTaskQueue=new $l,this._controls=[],this._markers=[],this._mapId=s.uniqueId(),this._locale=s.extend({},au,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Mn(0),this._requestManager=new s.RequestManager(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,typeof c.container=="string"){if(this._container=s.window.document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof Go))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new jo(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,c.style&&this.setStyle(c.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),this._hash=c.hash&&new Hc(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,s.extend({},c.fitBoundsOptions,{duration:0})))),this.resize(),c.attributionControl&&this.addControl(new jl({customAttribution:c.customAttribution})),this._logoControl=new Gl,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new s.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new s.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(c,i){if(i===void 0&&(i=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=c.onAdd(this);this._controls.push(c);const u=this._controlPositions[i];return i.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(c);return i>-1&&this._controls.splice(i,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new s.Event("movestart",c)).fire(new s.Event("move",c)),this.fire(new s.Event("resize",c)),i&&this.fire(new s.Event("moveend",c)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(s.LngLatBounds.convert(c)),this._update()}setMinZoom(c){if((c=c==null?-2:c)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c==null?22:c)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c==null?0:c)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c==null?85:c)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this._update()}getProjection(){return this.transform.getProjection()}setProjection(c){return this._lazyInitEmptyStyle(),typeof c=="string"&&(c={name:c}),this._runtimeProjection=c,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(c){return this.transform.locationPoint3D(s.LngLat.convert(c))}unproject(c){return this.transform.pointLocation3D(s.pointGeometry.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(c,i,o){if(c==="mouseenter"||c==="mouseover"){let u=!1;const d=g=>{const x=i.filter(S=>this.getLayer(S)),E=x.length?this.queryRenderedFeatures(g.point,{layers:x}):[];E.length?u||(u=!0,o.call(this,new Ji(c,this,g.originalEvent,{features:E}))):u=!1},f=()=>{u=!1};return{layers:new Set(i),listener:o,delegates:{mousemove:d,mouseout:f}}}if(c==="mouseleave"||c==="mouseout"){let u=!1;const d=g=>{const x=i.filter(E=>this.getLayer(E));(x.length?this.queryRenderedFeatures(g.point,{layers:x}):[]).length?u=!0:u&&(u=!1,o.call(this,new Ji(c,this,g.originalEvent)))},f=g=>{u&&(u=!1,o.call(this,new Ji(c,this,g.originalEvent)))};return{layers:new Set(i),listener:o,delegates:{mousemove:d,mouseout:f}}}{const u=d=>{const f=i.filter(x=>this.getLayer(x)),g=f.length?this.queryRenderedFeatures(d.point,{layers:f}):[];g.length&&(d.features=g,o.call(this,d),delete d.features)};return{layers:new Set(i),listener:o,delegates:{[c]:u}}}}on(c,i,o){if(o===void 0)return super.on(c,i);Array.isArray(i)||(i=[i]);const u=this._createDelegatedListener(c,i,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(u);for(const d in u.delegates)this.on(d,u.delegates[d]);return this}once(c,i,o){if(o===void 0)return super.once(c,i);Array.isArray(i)||(i=[i]);const u=this._createDelegatedListener(c,i,o);for(const d in u.delegates)this.once(d,u.delegates[d]);return this}off(c,i,o){if(o===void 0)return super.off(c,i);i=new Set(Array.isArray(i)?i:[i]);const u=(f,g)=>{if(f.size!==g.size)return!1;for(const x of f)if(!g.has(x))return!1;return!0},d=this._delegatedListeners?this._delegatedListeners[c]:void 0;return d&&(f=>{for(let g=0;g<f.length;g++){const x=f[g];if(x.listener===o&&u(x.layers,i)){for(const E in x.delegates)this.off(E,x.delegates[E]);return f.splice(g,1),this}}})(d),this}queryRenderedFeatures(c,i){return this.style?(i!==void 0||c===void 0||c instanceof s.pointGeometry||Array.isArray(c)||(i=c,c=void 0),this.style.queryRenderedFeatures(c=c||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(c,i){return this.style.querySourceFeatures(c,i)}queryTerrainElevation(c,i){const o=this.transform.elevation;return o?(i=s.extend({},{exaggerated:!0},i),o.getAtPoint(s.MercatorCoordinate.fromLngLat(c),null,i.exaggerated)):null}setStyle(c,i){return(i=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&c?(this._diffStyle(c,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(c,i))}_getUIString(c){const i=this._locale[c];if(i==null)throw new Error(`Missing UI string '${c}'`);return i}_updateStyle(c,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),c&&(this.style=new dr(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c):this.style.loadJSON(c)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new dr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,i){if(typeof c=="string"){const o=this._requestManager.normalizeStyleURL(c),u=this._requestManager.transformRequest(o,s.ResourceType.Style);s.getJSON(u,(d,f)=>{d?this.fire(new s.ErrorEvent(d)):f&&this._updateDiff(f,i)})}else typeof c=="object"&&this._updateDiff(c,i)}_updateDiff(c,i){try{this.style.setState(c)&&this._update(!0)}catch(o){s.warnOnce(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(c,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.warnOnce("There is no style added to the map.")}addSource(c,i){return this._lazyInitEmptyStyle(),this.style.addSource(c,i),this._update(!0)}isSourceLoaded(c){const i=this.style&&this.style._getSourceCaches(c);if(i.length!==0)return i.every(o=>o.loaded());this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${c}'`)))}areTilesLoaded(){const c=this.style&&this.style._sourceCaches;for(const i in c){const o=c[i]._tiles;for(const u in o){const d=o[u];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}addSourceType(c,i,o){return this._lazyInitEmptyStyle(),this.style.addSourceType(c,i,o)}removeSource(c){return this.style.removeSource(c),this._updateTerrain(),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,i,{pixelRatio:o=1,sdf:u=!1,stretchX:d,stretchY:f,content:g}={}){if(this._lazyInitEmptyStyle(),i instanceof Kr||$o&&i instanceof $o){const{width:x,height:E,data:S}=s.exported.getImageData(i);this.style.addImage(c,{data:new s.RGBAImage({width:x,height:E},S),pixelRatio:o,stretchX:d,stretchY:f,content:g,sdf:u,version:0})}else{if(i.width===void 0||i.height===void 0)return this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:x,height:E,data:S}=i,I=i;this.style.addImage(c,{data:new s.RGBAImage({width:x,height:E},new Uint8Array(S)),pixelRatio:o,stretchX:d,stretchY:f,content:g,sdf:u,version:0,userImage:I}),I.onAdd&&I.onAdd(this,c)}}}updateImage(c,i){const o=this.style.getImage(c);if(!o)return this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=i instanceof Kr||$o&&i instanceof $o?s.exported.getImageData(i):i,{width:d,height:f,data:g}=u;return d===void 0||f===void 0?this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):d!==o.data.width||f!==o.data.height?this.fire(new s.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(o.data.replace(g,!(i instanceof Kr||$o&&i instanceof $o)),void this.style.updateImage(c,o))}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,i){s.getImage(this._requestManager.transformRequest(c,s.ResourceType.Image),(o,u)=>{i(o,u instanceof Kr?s.exported.getImageData(u):u)})}listImages(){return this.style.listImages()}addLayer(c,i){return this._lazyInitEmptyStyle(),this.style.addLayer(c,i),this._update(!0)}moveLayer(c,i){return this.style.moveLayer(c,i),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}setLayerZoomRange(c,i,o){return this.style.setLayerZoomRange(c,i,o),this._update(!0)}setFilter(c,i,o={}){return this.style.setFilter(c,i,o),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,i,o,u={}){return this.style.setPaintProperty(c,i,o,u),this._update(!0)}getPaintProperty(c,i){return this.style.getPaintProperty(c,i)}setLayoutProperty(c,i,o,u={}){return this.style.setLayoutProperty(c,i,o,u),this._update(!0)}getLayoutProperty(c,i){return this.style.getLayoutProperty(c,i)}setLight(c,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){this.transform.projection.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(c),this.transform):0}setFeatureState(c,i){return this.style.setFeatureState(c,i),this._update()}removeFeatureState(c,i){return this.style.removeFeatureState(c,i),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let o,u=this._container;for(;u&&!o;){const d=s.window.getComputedStyle(u).transform;d&&d!=="none"&&(o=d.match(/matrix.*\((.+)\)/)[1].split(", ")),u=u.parentElement}o?(this._containerWidth=o[0]&&o[0]!=="0"?Math.abs(c/o[0]):c,this._containerHeight=o[3]&&o[3]!=="0"?Math.abs(i/o[3]):i):(this._containerWidth=c,this._containerHeight=i)}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=fe.create("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=fe.create("div","mapboxgl-canvas-container",c);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=fe.create("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=fe.create("div","mapboxgl-control-container",c),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(d=>{u[d]=fe.create("div",`mapboxgl-ctrl-${d}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,i){const o=s.exported.devicePixelRatio||1;this._canvas.width=o*Math.ceil(c),this._canvas.height=o*Math.ceil(i),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${i}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const i=this._markers.indexOf(c);i!==-1&&this._markers.splice(i,1)}_setupPainter(){const c=s.extend({},pe.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",c)||this._canvas.getContext("experimental-webgl",c);i?(s.storeAuthState(i,!0),this.painter=new Zc(i,this.transform),this.on("data",o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(i)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let i;const o=this.painter.context.extTimerQuery,u=s.exported.now();this.listens("gpu-timing-frame")&&(i=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,i));let d=this._updateAverageElevation(u);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjection();let f=!1;const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,S=this.transform.pitch,I=s.exported.now();this.style.zoomHistory.update(E,I);const z=new s.EvaluationParameters(E,{now:I,fadeDuration:g,pitch:S,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),L=z.crossFadingFactor();L===1&&L===this._crossFadingFactor||(f=!0,this._crossFadingFactor=L),this.style.update(z)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||f)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const E=s.exported.now()-u;o.endQueryEXT(o.TIME_ELAPSED_EXT,i),setTimeout(()=>{const S=o.getQueryObjectEXT(i,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(i),this.fire(new s.Event("gpu-timing-frame",{cpuTime:E,gpuTime:S}))},50)}if(this.listens("gpu-timing-layer")){const E=this.painter.collectGpuTimers();setTimeout(()=>{const S=this.painter.queryGpuTimers(E);this.fire(new s.Event("gpu-timing-layer",{layerTimes:S}))},50)}const x=this._sourcesDirty||this._styleDirty||this._placementDirty||d;if(x||this._repaint)this.triggerRepaint();else{const E=!this.isMoving()&&this.loaded();if(E&&(d=this._updateAverageElevation(u,!0)),d)this.triggerRepaint();else if(this._triggerFrame(!1),E&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const S=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:S})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||x||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const c of this._markers)c._update()}_updateAverageElevation(c,i=!1){const o=u=>(this.transform.averageElevation=u,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);if((i||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const u=this.transform.averageElevation;let d=this.transform.sampleAverageElevation();isNaN(d)?d=0:this._averageElevationLastSampledAt=c;const f=Math.abs(u-d);if(f>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(d),o(d);this._averageElevation.easeTo(d,c,300)}else if(f>1e-4)return this._averageElevation.jumpTo(d),o(d)}return!!this._averageElevation.isEasing(c)&&o(this._averageElevation.getValue(c))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===s.AUTH_ERR_MSG||c.status===401)){const i=this.painter.context.gl;s.storeAuthState(i,!1),this._logoControl instanceof Gl&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const o=this.painter.context.gl,u=o.createFramebuffer();function d(f){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,f,0);const g=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,g),g}return o.bindFramebuffer(o.FRAMEBUFFER,u),this._canvasPixelComparison(d(c),i.canvasCopies.map(d),i.timeStamps)}_canvasPixelComparison(c,i,o){let u=o[1]-o[0];const d=c.length/4;for(let f=0;f<i.length;f++){const g=i[f];let x=0;for(let E=0;E<g.length;E+=4)g[E]===c[E]&&g[E+1]===c[E+1]&&g[E+2]===c[E+2]&&g[E+3]===c[E+3]&&(x+=1);u+=(o[f+2]-o[f+1])*(1-x/d)}return u}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1));const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),Wl(this._canvasContainer),Wl(this._controlContainer),Wl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=s.exported.frame(i=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(i)}))}_preloadTiles(c){const i=this.style&&Object.values(this.style._sourceCaches)||[];return s.asyncAll(i,(o,u)=>o._preloadTiles(c,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}_setCacheLimits(c,i){s.setCacheLimits(c,i)}get version(){return s.version}},NavigationControl:class{constructor(c){this.options=s.extend({},zh,c),this._container=fe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),fe.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),fe.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=fe.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const c=this._map.getZoom(),i=c===this._map.getMaxZoom(),o=c===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())}_rotateCompassArrow(){const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new lu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(c,i){const o=fe.create("button",c,this._container);return o.type="button",o.addEventListener("click",i),o}_setButtonTitle(c,i){const o=this._map._getUIString(`NavigationControl.${i}`);c.setAttribute("aria-label",o),c.firstElementChild&&c.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends s.Evented{constructor(c){super(),this.options=s.extend({},Fs,c),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Xn(this._updateMarkerRotation,20)}onAdd(c){var i;return this._map=c,this._container=fe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),i=this._setupUI,ar!==void 0?i(ar):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(o=>{ar=o.state!=="denied",i(ar)}):(ar=!!s.window.navigator.geolocation,i(ar)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,Os=0,Zo=!1}_isOutOfMapMaxBounds(c){const i=this._map.getMaxBounds(),o=c.coords;return i&&(o.longitude<i.getWest()||o.longitude>i.getEast()||o.latitude<i.getSouth()||o.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",c)),this._finish()}}_updateCamera(c){const i=new s.LngLat(c.coords.longitude,c.coords.latitude),o=c.coords.accuracy,u=this._map.getBearing(),d=s.extend({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(o),d,{geolocateSource:!0})}_updateMarker(c){if(c){const i=new s.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map._containerHeight/2,i=this._map.unproject([0,c]),o=this._map.unproject([100,c]),u=i.distanceTo(o)/100,d=Math.ceil(2*this._accuracy/u);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&Zo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=fe.create("button","mapboxgl-ctrl-geolocate",this._container),fe.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=fe.create("div","mapboxgl-user-location"),this._dotElement.appendChild(fe.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(fe.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ql({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=fe.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ql({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Os--,Zo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Os++,Os>1?(c={maximumAge:6e5,timeout:0},Zo=!0):(c=this.options.positionOptions,Zo=!1),this._geolocationWatchID=s.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else s.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&c()}).catch(console.error):c()}_clearWatch(){s.window.navigator.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:jl,ScaleControl:class{constructor(c){this.options=s.extend({},Us,c),s.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Ye(this._map,this._container,this.options)}onAdd(c){return this._map=c,this._container=fe.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(c){this.options.unit=c,Ye(this._map,this._container,this.options)}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof s.window.HTMLElement?this._container=c.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=fe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=fe.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);fe.create("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden",!0),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(c){super(),this.options=s.extend(Object.create(cu),c),s.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=s.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(s.window.document.createTextNode(c))}setHTML(c){const i=s.window.document.createDocumentFragment(),o=s.window.document.createElement("body");let u;for(o.innerHTML=c;u=o.firstChild,u;)i.appendChild(u);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=fe.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._container&&this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._container&&this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let i;return this._classList.delete(c)?i=!1:(this._classList.add(c),i=!0),this._container&&this._updateClassList(),i}_createCloseButton(){this.options.closeButton&&(this._closeButton=fe.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(c){this._update(c.point)}_onMouseMove(c){this._update(c.point)}_onDrag(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const i=this._pos,o=this._container.offsetWidth,u=this._container.offsetHeight;let d;return d=i.y+c.bottom.y<u?["top"]:i.y>this._map.transform.height-u?["bottom"]:[],i.x<o/2?d.push("left"):i.x>this._map.transform.width-o/2&&d.push("right"),d.length===0?"bottom":d.join("-")}_updateClassList(){const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),this._container.className=c.join(" ")}_update(c){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=fe.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=fe.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Zl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c){const i=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),o=function(f){if(f||(f=new s.pointGeometry(0,0)),typeof f=="number"){const g=Math.round(Math.sqrt(.5*Math.pow(f,2)));return{center:new s.pointGeometry(0,0),top:new s.pointGeometry(0,f),"top-left":new s.pointGeometry(g,g),"top-right":new s.pointGeometry(-g,g),bottom:new s.pointGeometry(0,-f),"bottom-left":new s.pointGeometry(g,-g),"bottom-right":new s.pointGeometry(-g,-g),left:new s.pointGeometry(f,0),right:new s.pointGeometry(-f,0)}}if(f instanceof s.pointGeometry||Array.isArray(f)){const g=s.pointGeometry.convert(f);return{center:g,top:g,"top-left":g,"top-right":g,bottom:g,"bottom-left":g,"bottom-right":g,left:g,right:g}}return{center:s.pointGeometry.convert(f.center||[0,0]),top:s.pointGeometry.convert(f.top||[0,0]),"top-left":s.pointGeometry.convert(f["top-left"]||[0,0]),"top-right":s.pointGeometry.convert(f["top-right"]||[0,0]),bottom:s.pointGeometry.convert(f.bottom||[0,0]),"bottom-left":s.pointGeometry.convert(f["bottom-left"]||[0,0]),"bottom-right":s.pointGeometry.convert(f["bottom-right"]||[0,0]),left:s.pointGeometry.convert(f.left||[0,0]),right:s.pointGeometry.convert(f.right||[0,0])}}(this.options.offset),u=this._anchor=this._getAnchor(o),d=i.add(o[u]).round();this._map._requestDomTask(()=>{this._container&&u&&(this._container.style.transform=`${$i[u]} translate(${d.x}px,${d.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(Vs);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._content&&(this._content.style.opacity=c),this._tip&&(this._tip.style.opacity=c)}},Marker:ql,Style:dr,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.pointGeometry,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:Wc,Evented:s.Evented,config:s.config,prewarm:function(){ne().acquire(te)},clearPrewarmedResources:function(){const c=ue;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(te),ue=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(c){s.config.ACCESS_TOKEN=c},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(c){s.config.API_URL=c},get workerCount(){return ce.workerCount},set workerCount(c){ce.workerCount=c},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){s.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){s.clearTileCache(c)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return Hn});var oe=R;return oe})})(cg);var l1=cg.exports;export{s1 as a,a1 as b,o1 as c,l1 as m,n1 as o};
